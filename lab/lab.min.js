!function(){function FastClick(e){"use strict";var t,n=this;if(this.trackingClick=!1,this.trackingClickStart=0,this.targetElement=null,this.touchStartX=0,this.touchStartY=0,this.lastTouchIdentifier=0,this.touchBoundary=10,this.layer=e,!e||!e.nodeType)throw new TypeError("Layer must be a document node");this.onClick=function(){return FastClick.prototype.onClick.apply(n,arguments)},this.onMouse=function(){return FastClick.prototype.onMouse.apply(n,arguments)},this.onTouchStart=function(){return FastClick.prototype.onTouchStart.apply(n,arguments)},this.onTouchMove=function(){return FastClick.prototype.onTouchMove.apply(n,arguments)},this.onTouchEnd=function(){return FastClick.prototype.onTouchEnd.apply(n,arguments)},this.onTouchCancel=function(){return FastClick.prototype.onTouchCancel.apply(n,arguments)},FastClick.notNeeded(e)||(this.deviceIsAndroid&&(e.addEventListener("mouseover",this.onMouse,!0),e.addEventListener("mousedown",this.onMouse,!0),e.addEventListener("mouseup",this.onMouse,!0)),e.addEventListener("click",this.onClick,!0),e.addEventListener("touchstart",this.onTouchStart,!1),e.addEventListener("touchmove",this.onTouchMove,!1),e.addEventListener("touchend",this.onTouchEnd,!1),e.addEventListener("touchcancel",this.onTouchCancel,!1),Event.prototype.stopImmediatePropagation||(e.removeEventListener=function(t,n,r){var i=Node.prototype.removeEventListener;"click"===t?i.call(e,t,n.hijacked||n,r):i.call(e,t,n,r)},e.addEventListener=function(t,n,r){var i=Node.prototype.addEventListener;"click"===t?i.call(e,t,n.hijacked||(n.hijacked=function(e){e.propagationStopped||n(e)}),r):i.call(e,t,n,r)}),"function"==typeof e.onclick&&(t=e.onclick,e.addEventListener("click",function(e){t(e)},!1),e.onclick=null))}function RGBColor(e){this.ok=!1,"#"==e.charAt(0)&&(e=e.substr(1,6)),e=e.replace(/ /g,""),e=e.toLowerCase();var t={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};for(var n in t)e==n&&(e=t[n]);for(var r=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(e){return[parseInt(e[1]),parseInt(e[2]),parseInt(e[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)]}}],i=0;i<r.length;i++){var o=r[i].re,a=r[i].process,s=o.exec(e);s&&(channels=a(s),this.r=channels[0],this.g=channels[1],this.b=channels[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var e=this.r.toString(16),t=this.g.toString(16),n=this.b.toString(16);return 1==e.length&&(e="0"+e),1==t.length&&(t="0"+t),1==n.length&&(n="0"+n),"#"+e+t+n},this.getHelpXML=function(){for(var e=new Array,n=0;n<r.length;n++)for(var i=r[n].example,o=0;o<i.length;o++)e[e.length]=i[o];for(var a in t)e[e.length]=a;var s=document.createElement("ul");s.setAttribute("id","rgbcolor-examples");for(var n=0;n<e.length;n++)try{var l=document.createElement("li"),u=new RGBColor(e[n]),c=document.createElement("div");c.style.cssText="margin: 3px; border: 1px solid black; background:"+u.toHex()+"; color:"+u.toHex(),c.appendChild(document.createTextNode("test"));var d=document.createTextNode(" "+e[n]+" -> "+u.toRGB()+" -> "+u.toHex());l.appendChild(c),l.appendChild(d),s.appendChild(l)}catch(h){}return s}}var requirejs,require,define;!function(e){function t(e,t){return v.call(e,t)}function n(e,t){var n,r,i,o,a,s,l,u,c,d,h=t&&t.split("/"),p=m.map,f=p&&p["*"]||{};if(e&&"."===e.charAt(0))if(t){for(h=h.slice(0,h.length-1),e=h.concat(e.split("/")),u=0;u<e.length;u+=1)if(d=e[u],"."===d)e.splice(u,1),u-=1;else if(".."===d){if(1===u&&(".."===e[2]||".."===e[0]))break;u>0&&(e.splice(u-1,2),u-=2)}e=e.join("/")}else 0===e.indexOf("./")&&(e=e.substring(2));if((h||f)&&p){for(n=e.split("/"),u=n.length;u>0;u-=1){if(r=n.slice(0,u).join("/"),h)for(c=h.length;c>0;c-=1)if(i=p[h.slice(0,c).join("/")],i&&(i=i[r])){o=i,a=u;break}if(o)break;!s&&f&&f[r]&&(s=f[r],l=u)}!o&&s&&(o=s,a=l),o&&(n.splice(0,a,o),e=n.join("/"))}return e}function r(t,n){return function(){return c.apply(e,y.call(arguments,0).concat([t,n]))}}function i(e){return function(t){return n(t,e)}}function o(e){return function(t){p[e]=t}}function a(n){if(t(f,n)){var r=f[n];delete f[n],g[n]=!0,u.apply(e,r)}if(!t(p,n)&&!t(g,n))throw new Error("No "+n);return p[n]}function s(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function l(e){return function(){return m&&m.config&&m.config[e]||{}}}var u,c,d,h,p={},f={},m={},g={},v=Object.prototype.hasOwnProperty,y=[].slice;d=function(e,t){var r,o=s(e),l=o[0];return e=o[1],l&&(l=n(l,t),r=a(l)),l?e=r&&r.normalize?r.normalize(e,i(t)):n(e,t):(e=n(e,t),o=s(e),l=o[0],e=o[1],l&&(r=a(l))),{f:l?l+"!"+e:e,n:e,pr:l,p:r}},h={require:function(e){return r(e)},exports:function(e){var t=p[e];return"undefined"!=typeof t?t:p[e]={}},module:function(e){return{id:e,uri:"",exports:p[e],config:l(e)}}},u=function(n,i,s,l){var u,c,m,v,y,b,x=[];if(l=l||n,"function"==typeof s){for(i=!i.length&&s.length?["require","exports","module"]:i,y=0;y<i.length;y+=1)if(v=d(i[y],l),c=v.f,"require"===c)x[y]=h.require(n);else if("exports"===c)x[y]=h.exports(n),b=!0;else if("module"===c)u=x[y]=h.module(n);else if(t(p,c)||t(f,c)||t(g,c))x[y]=a(c);else{if(!v.p)throw new Error(n+" missing "+c);v.p.load(v.n,r(l,!0),o(c),{}),x[y]=p[c]}m=s.apply(p[n],x),n&&(u&&u.exports!==e&&u.exports!==p[n]?p[n]=u.exports:m===e&&b||(p[n]=m))}else n&&(p[n]=s)},requirejs=require=c=function(t,n,r,i,o){return"string"==typeof t?h[t]?h[t](n):a(d(t,n).f):(t.splice||(m=t,n.splice?(t=n,n=r,r=null):t=e),n=n||function(){},"function"==typeof r&&(r=i,i=o),i?u(e,t,n,r):setTimeout(function(){u(e,t,n,r)},4),c)},c.config=function(e){return m=e,m.deps&&c(m.deps,m.callback),c},define=function(e,n,r){n.splice||(r=n,n=[]),t(p,e)||t(f,e)||(f[e]=[e,n,r])},define.amd={jQuery:!0}}(),define("../../vendor/almond/almond",function(){}),define("lab.version",["require"],function(){return{repo:{branch:"master",commit:{sha:"413b261b766cbcf60b13fb60a893ee59682e0bb8",short_sha:"413b261b",url:"https://github.com/concord-consortium/lab/commit/413b261b",author:"William Day",email:"code@william-day.com",date:"2013-11-06 09:53:54 -0500",short_message:"radioactivity core model update + variants",message:"radioactivity core model update + variants"},dirty:!1}}}),define("common/actual-root",[],function(){var e,t=/^(\/.+?\/)(interactives|embeddable)\.html$/,n=/(\/.+?\/)(doc|examples|experiments)(\/\w+)*?\/\w+\.html/;return e=document.location.pathname.match(t),e&&e[1]?e[1]:(e=document.location.pathname.match(n),e&&e[1]||"/")}),define("lab.config",["require","common/actual-root"],function(e){var t,n=e("common/actual-root");return t={sharing:!0,logging:!0,tracing:!1,home:"http://lab.ritesproject.net",homeForSharing:null,homeInteractivePath:"/examples/interactives/interactive.html",homeEmbeddablePath:"/examples/interactives/embeddable.html",benchmarkAPIurl:"https://script.google.com/macros/s/AKfycbzosXAVPdVRFUrF6FRI42dzQb2IGLnF9GlIbj9gUpeWpXALKgM/exec",actualRoot:"",utmCampaign:null,fontface:"Lato",hostName:"localhost:9292",authoring:!1,environment:"development","static":!1},t.actualRoot=n,t}),define("arrays/index",["require","exports","module"],function(e,t){var n={};n.version="0.0.1",n.webgl="undefined"!=typeof window&&!!window.WebGLRenderingContext,n.typed=function(){try{return new Float64Array(0),!0}catch(e){return!1}}(),n.create=function(e,t,r){r||(r=n.webgl||n.typed?"Float32Array":"regular"),void 0===t&&(t=0);var i;if("regular"===r)i=new Array(e);else switch(r){case"Float64Array":i=new Float64Array(e);break;case"Float32Array":i=new Float32Array(e);break;case"Int32Array":i=new Int32Array(e);break;case"Int16Array":i=new Int16Array(e);break;case"Int8Array":i=new Int8Array(e);break;case"Uint32Array":i=new Uint32Array(e);break;case"Uint16Array":i=new Uint16Array(e);break;case"Uint8Array":i=new Uint8Array(e);break;case"Uint8ClampedArray":i=new Uint8ClampedArray(e);break;default:throw new Error("arrays: couldn't understand array type \""+r+'".')}return n.fill(i,t),i},n.fill=function(e,t){for(var n=-1,r=e.length;++n<r;)e[n]=t},n.constructor_function=function(e){if(e.buffer&&e.buffer.__proto__&&e.buffer.__proto__.constructor&&"[object Array]"===Object.prototype.toString.call(e))return e.__proto__.constructor;switch(e.constructor){case Array:return Array;case Float32Array:return Float32Array;case Uint8Array:return Uint8Array;case Float64Array:return Float64Array;case Int32Array:return Int32Array;case Int16Array:return Int16Array;case Int8Array:return Int8Array;case Uint32Array:return Uint32Array;case Uint16Array:return Uint16Array;case Uint8ClampedArray:return Uint8ClampedArray;default:throw new Error("arrays.constructor_function: must be an Array or Typed Array:   source: "+e)}},n.copy=function(e,t,r){for(var i=void 0!==r?r:e.length,o=-1;++o<i;)t[o]=e[o];return n.constructor_function(t)===Array&&(t.length=i),t},n.clone=function(e){var t,r,i,o=e.length;if(i=n.constructor_function(e),i===Array){for(r=new i(o),t=0;o>t;t++)r[t]=e[t];return r}if(e.buffer.slice)return r=new i(e.buffer.slice(0));for(r=new i(o),t=0;o>t;t++)r[t]=e[t];return r},n.between=function(e,t,n){return n<Math.max(e,t)&&n>Math.min(e,t)},n.max=function(e){return Math.max.apply(Math,e)},n.min=function(e){return Math.min.apply(Math,e)},n.maxTypedArray=function(e){var t,n,r=Number.MIN_VALUE,i=e.length;for(n=0;i>n;n++)t=e[n],r=t>r?t:r;return r},n.minTypedArray=function(e){var t,n,r=Number.MAX_VALUE,i=e.length;for(n=0;i>n;n++)t=e[n],r=r>t?t:r;return r},n.maxAnyArray=function(e){try{return Math.max.apply(Math,e)}catch(t){if(t instanceof TypeError){var n,r,i=Number.MIN_VALUE,o=e.length;for(r=0;o>r;r++)n=e[r],i=n>i?n:i;return i}}},n.minAnyArray=function(e){try{return Math.min.apply(Math,e)}catch(t){if(t instanceof TypeError){var n,r,i=Number.MAX_VALUE,o=e.length;for(r=0;o>r;r++)n=e[r],i=i>n?n:i;return i}}},n.average=function(e){var t,n=0,r=e.length;for(t=0;r>t;t++)n+=e[t];return n/r},n.extend=function(e,t){var r,i,o;if(i=n.constructor_function(e),i===Array){for(o=e.length,e.length=t;t>o;o++)e[o]=0;return e}return r=new i(t),r.set(e.subarray(0,t)),r},n.remove=function(e,t){var r,i=n.constructor_function(e);if(i!==Array)throw new Error("arrays.remove for typed arrays not implemented yet.");return r=e.slice(t+1),e.length=t,Array.prototype.push.apply(e,r),e},n.isArray=function(e){if(void 0===e||null===e)return!1;switch(Object.prototype.toString.call(e)){case"[object Array]":case"[object Float32Array]":case"[object Float64Array]":case"[object Uint8Array]":case"[object Uint16Array]":case"[object Uint32Array]":case"[object Uint8ClampedArray]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":return!0;default:return!1}};for(var r in n)n.hasOwnProperty(r)&&(t[r]=n[r])}),define("arrays",["arrays/index"],function(e){return e}),FastClick.prototype.deviceIsAndroid=navigator.userAgent.indexOf("Android")>0,FastClick.prototype.deviceIsIOS=/iP(ad|hone|od)/.test(navigator.userAgent),FastClick.prototype.deviceIsIOS4=FastClick.prototype.deviceIsIOS&&/OS 4_\d(_\d)?/.test(navigator.userAgent),FastClick.prototype.deviceIsIOSWithBadTarget=FastClick.prototype.deviceIsIOS&&/OS ([6-9]|\d{2})_\d/.test(navigator.userAgent),FastClick.prototype.needsClick=function(e){"use strict";switch(e.nodeName.toLowerCase()){case"button":case"select":case"textarea":if(e.disabled)return!0;break;case"input":if(this.deviceIsIOS&&"file"===e.type||e.disabled)return!0;break;case"label":case"video":return!0}return/\bneedsclick\b/.test(e.className)},FastClick.prototype.needsFocus=function(e){"use strict";switch(e.nodeName.toLowerCase()){case"textarea":return!0;case"select":return!this.deviceIsAndroid;case"input":switch(e.type){case"button":case"checkbox":case"file":case"image":case"radio":case"submit":return!1}return!e.disabled&&!e.readOnly;default:return/\bneedsfocus\b/.test(e.className)}},FastClick.prototype.sendClick=function(e,t){"use strict";var n,r;document.activeElement&&document.activeElement!==e&&document.activeElement.blur(),r=t.changedTouches[0],n=document.createEvent("MouseEvents"),n.initMouseEvent(this.determineEventType(e),!0,!0,window,1,r.screenX,r.screenY,r.clientX,r.clientY,!1,!1,!1,!1,0,null),n.forwardedTouchEvent=!0,e.dispatchEvent(n)},FastClick.prototype.determineEventType=function(e){"use strict;";return this.deviceIsAndroid&&"select"===e.tagName.toLowerCase()?"mousedown":"click"},FastClick.prototype.focus=function(e){"use strict";var t;this.deviceIsIOS&&e.setSelectionRange&&0!==e.type.indexOf("date")&&"time"!==e.type?(t=e.value.length,e.setSelectionRange(t,t)):e.focus()},FastClick.prototype.updateScrollParent=function(e){"use strict";var t,n;if(t=e.fastClickScrollParent,!t||!t.contains(e)){n=e;do{if(n.scrollHeight>n.offsetHeight){t=n,e.fastClickScrollParent=n;break}n=n.parentElement}while(n)}t&&(t.fastClickLastScrollTop=t.scrollTop)},FastClick.prototype.getTargetElementFromEventTarget=function(e){"use strict";return e.nodeType===Node.TEXT_NODE?e.parentNode:e},FastClick.prototype.onTouchStart=function(e){"use strict";var t,n,r;if(e.targetTouches.length>1)return!0;if(t=this.getTargetElementFromEventTarget(e.target),n=e.targetTouches[0],this.deviceIsIOS){if(r=window.getSelection(),r.rangeCount&&!r.isCollapsed)return!0;if(!this.deviceIsIOS4){if(n.identifier===this.lastTouchIdentifier)return e.preventDefault(),!1;this.lastTouchIdentifier=n.identifier,this.updateScrollParent(t)}}return this.trackingClick=!0,this.trackingClickStart=e.timeStamp,this.targetElement=t,this.touchStartX=n.pageX,this.touchStartY=n.pageY,e.timeStamp-this.lastClickTime<200&&e.preventDefault(),!0},FastClick.prototype.touchHasMoved=function(e){"use strict";var t=e.changedTouches[0],n=this.touchBoundary;return Math.abs(t.pageX-this.touchStartX)>n||Math.abs(t.pageY-this.touchStartY)>n?!0:!1},FastClick.prototype.onTouchMove=function(e){"use strict";return this.trackingClick?((this.targetElement!==this.getTargetElementFromEventTarget(e.target)||this.touchHasMoved(e))&&(this.trackingClick=!1,this.targetElement=null),!0):!0},FastClick.prototype.findControl=function(e){"use strict";return void 0!==e.control?e.control:e.htmlFor?document.getElementById(e.htmlFor):e.querySelector("button, input:not([type=hidden]), keygen, meter, output, progress, select, textarea")},FastClick.prototype.onTouchEnd=function(e){"use strict";var t,n,r,i,o,a=this.targetElement;if(!this.trackingClick)return!0;if(e.timeStamp-this.lastClickTime<200)return this.cancelNextClick=!0,!0;if(this.cancelNextClick=!1,this.lastClickTime=e.timeStamp,n=this.trackingClickStart,this.trackingClick=!1,this.trackingClickStart=0,this.deviceIsIOSWithBadTarget&&(o=e.changedTouches[0],a=document.elementFromPoint(o.pageX-window.pageXOffset,o.pageY-window.pageYOffset)||a,a.fastClickScrollParent=this.targetElement.fastClickScrollParent),r=a.tagName.toLowerCase(),"label"===r){if(t=this.findControl(a)){if(this.focus(a),this.deviceIsAndroid)return!1;a=t}}else if(this.needsFocus(a))return e.timeStamp-n>100||this.deviceIsIOS&&window.top!==window&&"input"===r?(this.targetElement=null,!1):(this.focus(a),this.deviceIsIOS4&&"select"===r||(this.targetElement=null,e.preventDefault()),!1);return this.deviceIsIOS&&!this.deviceIsIOS4&&(i=a.fastClickScrollParent,i&&i.fastClickLastScrollTop!==i.scrollTop)?!0:(this.needsClick(a)||(e.preventDefault(),this.sendClick(a,e)),!1)},FastClick.prototype.onTouchCancel=function(){"use strict";this.trackingClick=!1,this.targetElement=null},FastClick.prototype.onMouse=function(e){"use strict";return this.targetElement?e.forwardedTouchEvent?!0:e.cancelable?!this.needsClick(this.targetElement)||this.cancelNextClick?(e.stopImmediatePropagation?e.stopImmediatePropagation():e.propagationStopped=!0,e.stopPropagation(),e.preventDefault(),!1):!0:!0:!0},FastClick.prototype.onClick=function(e){"use strict";var t;return this.trackingClick?(this.targetElement=null,this.trackingClick=!1,!0):"submit"===e.target.type&&0===e.detail?!0:(t=this.onMouse(e),t||(this.targetElement=null),t)},FastClick.prototype.destroy=function(){"use strict";var e=this.layer;this.deviceIsAndroid&&(e.removeEventListener("mouseover",this.onMouse,!0),e.removeEventListener("mousedown",this.onMouse,!0),e.removeEventListener("mouseup",this.onMouse,!0)),e.removeEventListener("click",this.onClick,!0),e.removeEventListener("touchstart",this.onTouchStart,!1),e.removeEventListener("touchmove",this.onTouchMove,!1),e.removeEventListener("touchend",this.onTouchEnd,!1),e.removeEventListener("touchcancel",this.onTouchCancel,!1)},FastClick.notNeeded=function(e){"use strict";var t;if("undefined"==typeof window.ontouchstart)return!0;if(/Chrome\/[0-9]+/.test(navigator.userAgent)){if(!FastClick.prototype.deviceIsAndroid)return!0;if(t=document.querySelector("meta[name=viewport]"),t&&-1!==t.content.indexOf("user-scalable=no"))return!0}return"none"===e.style.msTouchAction?!0:!1},FastClick.attach=function(e){"use strict";return new FastClick(e)},"undefined"!=typeof define&&define.amd?define("fastclick",[],function(){"use strict";return FastClick}):"undefined"!=typeof module&&module.exports?(module.exports=FastClick.attach,module.exports.FastClick=FastClick):window.FastClick=FastClick,define("common/console",["require","lab.config"],function(e){var t,n,r=e("lab.config"),i=function(){};return"undefined"==typeof console&&(console={},window&&(window.console=console)),n=console,void 0===n.log&&(n.log=i),void 0===n.info&&(n.info=i),void 0===n.warn&&(n.warn=i),void 0===n.error&&(n.error=i),void 0===n.time&&(n.time=i),void 0===n.timeEnd&&(n.timeEnd=i),void 0===n.log.apply&&(n.log=Function.prototype.bind.call(console.log,console)),void 0===n.info.apply&&(n.info=Function.prototype.bind.call(console.info,console)),void 0===n.warn.apply&&(n.warn=Function.prototype.bind.call(console.warn,console)),void 0===n.error.apply&&(n.error=Function.prototype.bind.call(console.error,console)),void 0===n.time.apply&&(n.time=Function.prototype.bind.call(console.time,console)),void 0===n.timeEnd.apply&&(n.timeEnd=Function.prototype.bind.call(console.timeEnd,console)),t={log:function(){r.logging&&n.log.apply(n,arguments)},info:function(){r.logging&&n.info.apply(n,arguments)},warn:function(){r.logging&&n.warn.apply(n,arguments)},error:function(){r.logging&&n.error.apply(n,arguments)},time:function(){r.tracing&&n.time.apply(n,arguments)},timeEnd:function(){r.tracing&&n.timeEnd.apply(n,arguments)}}}),define("common/alert",["require","common/console"],function(e){var t=e("common/console"),n="undefined"!=typeof alert?alert:t.error;return function(e){n(e)}}),define("common/controllers/interactive-metadata",[],function(){return{interactive:{title:{required:!0},publicationStatus:{defaultValue:"public"},subtitle:{defaultValue:""},about:{defaultValue:""},importedFrom:{},aspectRatio:{defaultValue:1.3},fontScale:{defaultValue:1},helpOnLoad:{defaultValue:!1},models:{required:!0},parameters:{defaultValue:[]},outputs:{defaultValue:[]},filteredOutputs:{defaultValue:[]},experiment:{required:!1},exports:{required:!1},hideExportDataControl:{required:!1,defaultValue:!1},components:{defaultValue:[]},layout:{defaultValue:{}},template:{defaultValue:"simple"},helpTips:{defaultValue:[]}},model:{type:{required:!0},id:{required:!0},url:{conflictsWith:["model"]},importedFrom:{},model:{conflictsWith:["url"]},onLoad:{},viewOptions:{},modelOptions:{},parameters:{},outputs:{},filteredOutputs:{}},parameter:{name:{required:!0},initialValue:{required:!0},onChange:{},label:{},unitType:{},unitName:{},unitPluralName:{},unitAbbreviation:{}},output:{name:{required:!0},value:{required:!0},label:{},unitType:{},unitName:{},unitPluralName:{},unitAbbreviation:{}},filteredOutput:{name:{required:!0},property:{required:!0},type:{defaultValue:"RunningAverage"},period:{defaultValue:2500},label:{},unitType:{},unitName:{},unitPluralName:{},unitAbbreviation:{}},exports:{perRun:{required:!1,defaultValue:[]},perTick:{required:!0}},experiment:{timeSeries:{required:!0},parameters:{required:!0,defaultValue:[]},destinations:{required:!0,defaultValue:[]},stateButtons:{required:!0,startRun:{required:!0,defaultValue:"start-run"},stopRun:{required:!0,defaultValue:"stop-run"},saveRun:{required:!0,defaultValue:"save-run"},nextRun:{required:!0,defaultValue:"next-run"},clearAll:{required:!0,defaultValue:"clear-all"}},onReset:{},savedRuns:{defaultValue:[]}},experimentTimeSeries:{time:{defaultValue:"displayTime"},properties:{required:!0,defaultValue:[]}},experimentParameter:{inputs:{required:!0,defaultValue:[]},outputs:{required:!0,defaultValue:[]}},experimentDestination:{type:{required:!0},componentIds:{required:!0,defaultValue:[]},properties:{required:!0,defaultValue:[]}},experimentSavedRun:{timeStamp:{required:!0},timeSeries:{required:!0,defaultValue:[]},parameters:{required:!0,defaultValue:[]}},playback:{id:{required:!0},type:{required:!0},stepping:{defaultValue:!0}},text:{id:{required:!0},type:{required:!0},onClick:{},text:{defaultValue:""},width:{defaultValue:"auto"},height:{defaultValue:"auto"},tooltip:{defaultValue:""}},image:{id:{required:!0},type:{required:!0},src:{defaultValue:""},width:{defaultValue:"auto"},height:{defaultValue:"auto"},onClick:{},tooltip:{defaultValue:""}},div:{id:{required:!0},type:{required:!0},content:{defaultValue:""},width:{defaultValue:"auto"},height:{defaultValue:"auto"},onClick:{},classes:{defaultValue:[]},tooltip:{defaultValue:""}},button:{id:{required:!0},type:{required:!0},action:{required:!0},text:{defaultValue:""},width:{defaultValue:""},height:{defaultValue:""},disabled:{defaultValue:!1},tooltip:{defaultValue:""}},checkbox:{id:{required:!0},type:{required:!0},text:{defaultValue:""},textOn:{defaultValue:"right"},width:{defaultValue:"auto"},height:{defaultValue:"auto"},property:{conflictsWith:["initialValue"]},onClick:{},initialValue:{conflictsWith:["property"]},disabled:{defaultValue:!1},tooltip:{defaultValue:""}},slider:{id:{required:!0},type:{required:!0},min:{required:!0},max:{required:!0},steps:{required:!0},title:{defaultValue:""},labels:{defaultValue:[]},width:{defaultValue:"auto"},height:{defaultValue:"auto"},displayValue:{},property:{conflictsWith:["initialValue","action"]},action:{conflictsWith:["property"]},initialValue:{conflictsWith:["property"]},disabled:{defaultValue:!1},tooltip:{defaultValue:""}},pulldown:{id:{required:!0},type:{required:!0},label:{defaultValue:""},labelOn:{defaultValue:"top"},options:{defaultValue:[]},property:{},disabled:{defaultValue:!1},tooltip:{defaultValue:""}},pulldownOption:{text:{defaultValue:""},action:{conflictsWith:["value"]},value:{conflictsWith:["action"]},selected:{conflictsWith:["value"]},disabled:{},loadModel:{}},radio:{id:{required:!0},type:{required:!0},orientation:{defaultValue:"vertical"},label:{defaultValue:""},labelOn:{defaultValue:"top"},options:{defaultValue:[]},property:{},disabled:{defaultValue:!1},tooltip:{defaultValue:""}},radioOption:{text:{defaultValue:""},action:{conflictsWith:["value"]},value:{conflictsWith:["action"]},selected:{conflictsWith:["value"]},disabled:{},loadModel:{}},numericOutput:{id:{required:!0},type:{required:!0},property:{required:!0},label:{defaultValue:""},units:{defaultValue:""},orientation:{defaultValue:"horizontal"},width:{defaultValue:"auto"},height:{defaultValue:"auto"},displayValue:{},tooltip:{defaultValue:""}},thermometer:{id:{required:!0},type:{required:!0},min:{required:!0},max:{required:!0},width:{defaultValue:"2.5em"},height:{defaultValue:"100%"},labelIsReading:{defaultValue:!1},reading:{defaultValue:{units:"K",offset:0,scale:1,digits:0}},labels:{defaultValue:[]}},table:{id:{required:!0},type:{required:!0},title:{defaultValue:null},clearDataOnReset:{defaultValue:!0},streamDataFromModel:{defaultValue:!0},addNewRows:{defaultValue:!0},visibleRows:{defaultValue:4},indexColumn:{defaultValue:!0},propertyColumns:{defaultValue:[]},headerData:{defaultValue:[]},tableData:{defaultValue:[]},width:{defaultValue:"auto"},height:{defaultValue:"100%"},tooltip:{defaultValue:""}},graph:{id:{required:!0},type:{required:!0},clearDataOnReset:{defaultValue:!0},resetAxesOnReset:{defaultValue:!0},streamDataFromModel:{defaultValue:!0},enableAutoScaleButton:{defaultValue:!0},enableAxisScaling:{defaultValue:!0},dataPoints:{defaultValue:[]},markAllDataPoints:{defaultValue:!1},showRulersOnSelection:{defaultValue:!1},fontScaleRelativeToParent:{defaultValue:!0},properties:{defaultValue:[]},xProperty:{defaultValue:"displayTime"},title:{defaultValue:"Graph"},lineWidth:{defaultValue:2},width:{defaultValue:"100%"},height:{defaultValue:"100%"},xlabel:{defaultValue:"Model Time (ps)"},xmin:{defaultValue:0},xmax:{defaultValue:20},ylabel:{defaultValue:""},ymin:{defaultValue:0},ymax:{defaultValue:10},xTickCount:{defaultValue:10},yTickCount:{defaultValue:10},xscaleExponent:{defaultValue:.5},yscaleExponent:{defaultValue:.5},xFormatter:{defaultValue:".2r"},yFormatter:{defaultValue:".2r"},lines:{defaultValue:!0},bars:{defaultValue:!1},tooltip:{defaultValue:""}},barGraph:{id:{required:!0},type:{required:!0},property:{required:!0},secondProperty:{conflictsWith:["averagePeriod"]},min:{defaultValue:0},max:{defaultValue:10},title:{defaultValue:""},titleOn:{defaultValue:"right"},labels:{defaultValue:5},units:{defaultValue:!1},gridLines:{defaultValue:10},labelFormat:{defaultValue:"0.1f"},averagePeriod:{conflictsWith:["secondProperty"]},barWidth:{defaultValue:"2em"},height:{defaultValue:"100%"},barColor:{defaultValue:"#e23c34"},fillColor:{defaultValue:"#fff"},tooltip:{defaultValue:""}},helpTip:{component:{defaultValue:""},text:{defaultValue:""}}}}),define("common/validator",["require","arrays"],function(e){function t(e,t){this.prop=e,this.message=t}function n(e){return null!==e&&"object"==typeof e}function r(e,n,r){var i,o;for(i=0,o=r.length;o>i;i++)if(e.hasOwnProperty(r[i]))throw new t(n,"Properties set contains conflicting properties: "+r[i]+" and "+n)}function i(e,n,r,i){if(e.readOnly)throw new t(n,"Properties set tries to overwrite read-only property "+n);if(!i&&e.immutable)throw new t(n,"Properties set tries to overwrite immutable property "+n);return e.validate?e.validate(r):r}var o=e("arrays");return t.prototype=new Error,t.prototype.constructor=t,{validate:function(e,t,n){var o,a,s={};if(arguments.length<2)throw new Error("Incorrect usage. Provide metadata and hash which should be validated.");for(o in t)t.hasOwnProperty(o)&&(a=e[o],"undefined"!=typeof a&&(t[o]=i(a,o,t[o],n),a.conflictsWith&&r(t,o,a.conflictsWith),s[o]=t[o]));return s},validateSingleProperty:i,propertyIsWritable:function(e){return!e.readOnly},propertyChangeInvalidates:function(e){return"undefined"==typeof e.propertyChangeInvalidates?!0:!!e.propertyChangeInvalidates},validateCompleteness:function(e,r){var i,a,s,l={};if(arguments.length<2)throw new Error("Incorrect usage. Provide metadata and hash which should be validated.");for(i in e)if(e.hasOwnProperty(i))if(a=e[i],s=a.defaultValue,"undefined"==typeof r[i]){if(a.required===!0)throw new t(i,"Properties set is missing required property "+i);o.isArray(s)?l[i]=o.copy(s,[]):n(s)?l[i]=$.extend(!0,{},s):"undefined"!=typeof s&&(l[i]=s)}else l[i]=!o.isArray(r[i])&&n(r[i])&&n(s)?$.extend(!0,{},s,r[i]):o.isArray(r[i])?$.extend(!0,[],r[i]):r[i];return this.validate(e,l,!0)},ValidationError:t}}),define("common/interactive-not-found",["require"],function(){return function(e){return{title:"Interactive not found",subtitle:"Couldn't load Interactive definition",about:["Problem loading: ["+e+"]("+e+")","Either the definition for this Interactive has moved, been deleted or there have been network problems.","It would be good to report this issue"],publicationStatus:"broken",fontScale:1.3,models:[],components:[{type:"text",id:"interactive-not-found",text:["##Oops!","","####We couldn't find the Interactive you are looking for:","["+e+"]("+e+")","","It may have moved (without leaving a forwarding address).","Try searching our [Next-Generation Molecular Workbench Activities page](http://mw.concord.org/nextgen/interactives/)."]}],layout:{error:["interactive-not-found"]},template:[{id:"error",width:"interactive.width","padding-top":"1em","padding-bottom":"0.5em","padding-right":"1em","padding-left":"1em"}]}}}),function(){var e=this,t=e._,n={},r=Array.prototype,i=Object.prototype,o=Function.prototype,a=r.push,s=r.slice,l=r.concat,u=(r.unshift,i.toString),c=i.hasOwnProperty,d=r.forEach,h=r.map,p=r.reduce,f=r.reduceRight,m=r.filter,g=r.every,v=r.some,y=r.indexOf,b=r.lastIndexOf,x=Array.isArray,w=Object.keys,_=o.bind,T=function(e){return e instanceof T?e:this instanceof T?(this._wrapped=e,void 0):new T(e)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=T),exports._=T):e._=T,T.VERSION="1.4.2";var A=T.each=T.forEach=function(e,t,r){if(null!=e)if(d&&e.forEach===d)e.forEach(t,r);else if(e.length===+e.length){for(var i=0,o=e.length;o>i;i++)if(t.call(r,e[i],i,e)===n)return}else for(var a in e)if(T.has(e,a)&&t.call(r,e[a],a,e)===n)return};T.map=T.collect=function(e,t,n){var r=[];return null==e?r:h&&e.map===h?e.map(t,n):(A(e,function(e,i,o){r[r.length]=t.call(n,e,i,o)}),r)},T.reduce=T.foldl=T.inject=function(e,t,n,r){var i=arguments.length>2;
if(null==e&&(e=[]),p&&e.reduce===p)return r&&(t=T.bind(t,r)),i?e.reduce(t,n):e.reduce(t);if(A(e,function(e,o,a){i?n=t.call(r,n,e,o,a):(n=e,i=!0)}),!i)throw new TypeError("Reduce of empty array with no initial value");return n},T.reduceRight=T.foldr=function(e,t,n,r){var i=arguments.length>2;if(null==e&&(e=[]),f&&e.reduceRight===f)return r&&(t=T.bind(t,r)),arguments.length>2?e.reduceRight(t,n):e.reduceRight(t);var o=e.length;if(o!==+o){var a=T.keys(e);o=a.length}if(A(e,function(s,l,u){l=a?a[--o]:--o,i?n=t.call(r,n,e[l],l,u):(n=e[l],i=!0)}),!i)throw new TypeError("Reduce of empty array with no initial value");return n},T.find=T.detect=function(e,t,n){var r;return C(e,function(e,i,o){return t.call(n,e,i,o)?(r=e,!0):void 0}),r},T.filter=T.select=function(e,t,n){var r=[];return null==e?r:m&&e.filter===m?e.filter(t,n):(A(e,function(e,i,o){t.call(n,e,i,o)&&(r[r.length]=e)}),r)},T.reject=function(e,t,n){return T.filter(e,function(e,r,i){return!t.call(n,e,r,i)},n)},T.every=T.all=function(e,t,r){t||(t=T.identity);var i=!0;return null==e?i:g&&e.every===g?e.every(t,r):(A(e,function(e,o,a){return(i=i&&t.call(r,e,o,a))?void 0:n}),!!i)};var C=T.some=T.any=function(e,t,r){t||(t=T.identity);var i=!1;return null==e?i:v&&e.some===v?e.some(t,r):(A(e,function(e,o,a){return i||(i=t.call(r,e,o,a))?n:void 0}),!!i)};T.contains=T.include=function(e,t){return null==e?!1:y&&e.indexOf===y?-1!=e.indexOf(t):C(e,function(e){return e===t})},T.invoke=function(e,t){var n=s.call(arguments,2);return T.map(e,function(e){return(T.isFunction(t)?t:e[t]).apply(e,n)})},T.pluck=function(e,t){return T.map(e,function(e){return e[t]})},T.where=function(e,t){return T.isEmpty(t)?[]:T.filter(e,function(e){for(var n in t)if(t[n]!==e[n])return!1;return!0})},T.max=function(e,t,n){if(!t&&T.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.max.apply(Math,e);if(!t&&T.isEmpty(e))return-1/0;var r={computed:-1/0};return A(e,function(e,i,o){var a=t?t.call(n,e,i,o):e;a>=r.computed&&(r={value:e,computed:a})}),r.value},T.min=function(e,t,n){if(!t&&T.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.min.apply(Math,e);if(!t&&T.isEmpty(e))return 1/0;var r={computed:1/0};return A(e,function(e,i,o){var a=t?t.call(n,e,i,o):e;a<r.computed&&(r={value:e,computed:a})}),r.value},T.shuffle=function(e){var t,n=0,r=[];return A(e,function(e){t=T.random(n++),r[n-1]=r[t],r[t]=e}),r};var E=function(e){return T.isFunction(e)?e:function(t){return t[e]}};T.sortBy=function(e,t,n){var r=E(t);return T.pluck(T.map(e,function(e,t,i){return{value:e,index:t,criteria:r.call(n,e,t,i)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||void 0===n)return 1;if(r>n||void 0===r)return-1}return e.index<t.index?-1:1}),"value")};var S=function(e,t,n,r){var i={},o=E(t);return A(e,function(t,a){var s=o.call(n,t,a,e);r(i,s,t)}),i};T.groupBy=function(e,t,n){return S(e,t,n,function(e,t,n){(T.has(e,t)?e[t]:e[t]=[]).push(n)})},T.countBy=function(e,t,n){return S(e,t,n,function(e,t){T.has(e,t)||(e[t]=0),e[t]++})},T.sortedIndex=function(e,t,n,r){n=null==n?T.identity:E(n);for(var i=n.call(r,t),o=0,a=e.length;a>o;){var s=o+a>>>1;n.call(r,e[s])<i?o=s+1:a=s}return o},T.toArray=function(e){return e?e.length===+e.length?s.call(e):T.values(e):[]},T.size=function(e){return null==e?0:e.length===+e.length?e.length:T.keys(e).length},T.first=T.head=T.take=function(e,t,n){return null==e?void 0:null==t||n?e[0]:s.call(e,0,t)},T.initial=function(e,t,n){return s.call(e,0,e.length-(null==t||n?1:t))},T.last=function(e,t,n){return null==e?void 0:null==t||n?e[e.length-1]:s.call(e,Math.max(e.length-t,0))},T.rest=T.tail=T.drop=function(e,t,n){return s.call(e,null==t||n?1:t)},T.compact=function(e){return T.filter(e,function(e){return!!e})};var k=function(e,t,n){return A(e,function(e){T.isArray(e)?t?a.apply(n,e):k(e,t,n):n.push(e)}),n};T.flatten=function(e,t){return k(e,t,[])},T.without=function(e){return T.difference(e,s.call(arguments,1))},T.uniq=T.unique=function(e,t,n,r){T.isFunction(t)&&(r=n,n=t,t=!1);var i=n?T.map(e,n,r):e,o=[],a=[];return A(i,function(n,r){(t?r&&a[a.length-1]===n:T.contains(a,n))||(a.push(n),o.push(e[r]))}),o},T.union=function(){return T.uniq(l.apply(r,arguments))},T.intersection=function(e){var t=s.call(arguments,1);return T.filter(T.uniq(e),function(e){return T.every(t,function(t){return T.indexOf(t,e)>=0})})},T.difference=function(e){var t=l.apply(r,s.call(arguments,1));return T.filter(e,function(e){return!T.contains(t,e)})},T.zip=function(){for(var e=s.call(arguments),t=T.max(T.pluck(e,"length")),n=new Array(t),r=0;t>r;r++)n[r]=T.pluck(e,""+r);return n},T.object=function(e,t){if(null==e)return{};for(var n={},r=0,i=e.length;i>r;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},T.indexOf=function(e,t,n){if(null==e)return-1;var r=0,i=e.length;if(n){if("number"!=typeof n)return r=T.sortedIndex(e,t),e[r]===t?r:-1;r=0>n?Math.max(0,i+n):n}if(y&&e.indexOf===y)return e.indexOf(t,n);for(;i>r;r++)if(e[r]===t)return r;return-1},T.lastIndexOf=function(e,t,n){if(null==e)return-1;var r=null!=n;if(b&&e.lastIndexOf===b)return r?e.lastIndexOf(t,n):e.lastIndexOf(t);for(var i=r?n:e.length;i--;)if(e[i]===t)return i;return-1},T.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=arguments[2]||1;for(var r=Math.max(Math.ceil((t-e)/n),0),i=0,o=new Array(r);r>i;)o[i++]=e,e+=n;return o};var P=function(){};T.bind=function(e,t){var n,r;if(e.bind===_&&_)return _.apply(e,s.call(arguments,1));if(!T.isFunction(e))throw new TypeError;return r=s.call(arguments,2),n=function(){if(!(this instanceof n))return e.apply(t,r.concat(s.call(arguments)));P.prototype=e.prototype;var i=new P,o=e.apply(i,r.concat(s.call(arguments)));return Object(o)===o?o:i}},T.bindAll=function(e){var t=s.call(arguments,1);return 0==t.length&&(t=T.functions(e)),A(t,function(t){e[t]=T.bind(e[t],e)}),e},T.memoize=function(e,t){var n={};return t||(t=T.identity),function(){var r=t.apply(this,arguments);return T.has(n,r)?n[r]:n[r]=e.apply(this,arguments)}},T.delay=function(e,t){var n=s.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},T.defer=function(e){return T.delay.apply(T,[e,1].concat(s.call(arguments,1)))},T.throttle=function(e,t){var n,r,i,o,a=0,s=function(){a=new Date,i=null,o=e.apply(n,r)};return function(){var l=new Date,u=t-(l-a);return n=this,r=arguments,0>=u?(clearTimeout(i),a=l,o=e.apply(n,r)):i||(i=setTimeout(s,u)),o}},T.debounce=function(e,t,n){var r,i;return function(){var o=this,a=arguments,s=function(){r=null,n||(i=e.apply(o,a))},l=n&&!r;return clearTimeout(r),r=setTimeout(s,t),l&&(i=e.apply(o,a)),i}},T.once=function(e){var t,n=!1;return function(){return n?t:(n=!0,t=e.apply(this,arguments),e=null,t)}},T.wrap=function(e,t){return function(){var n=[e];return a.apply(n,arguments),t.apply(this,n)}},T.compose=function(){var e=arguments;return function(){for(var t=arguments,n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},T.after=function(e,t){return 0>=e?t():function(){return--e<1?t.apply(this,arguments):void 0}},T.keys=w||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)T.has(e,n)&&(t[t.length]=n);return t},T.values=function(e){var t=[];for(var n in e)T.has(e,n)&&t.push(e[n]);return t},T.pairs=function(e){var t=[];for(var n in e)T.has(e,n)&&t.push([n,e[n]]);return t},T.invert=function(e){var t={};for(var n in e)T.has(e,n)&&(t[e[n]]=n);return t},T.functions=T.methods=function(e){var t=[];for(var n in e)T.isFunction(e[n])&&t.push(n);return t.sort()},T.extend=function(e){return A(s.call(arguments,1),function(t){for(var n in t)e[n]=t[n]}),e},T.pick=function(e){var t={},n=l.apply(r,s.call(arguments,1));return A(n,function(n){n in e&&(t[n]=e[n])}),t},T.omit=function(e){var t={},n=l.apply(r,s.call(arguments,1));for(var i in e)T.contains(n,i)||(t[i]=e[i]);return t},T.defaults=function(e){return A(s.call(arguments,1),function(t){for(var n in t)null==e[n]&&(e[n]=t[n])}),e},T.clone=function(e){return T.isObject(e)?T.isArray(e)?e.slice():T.extend({},e):e},T.tap=function(e,t){return t(e),e};var R=function(e,t,n,r){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return e===t;e instanceof T&&(e=e._wrapped),t instanceof T&&(t=t._wrapped);var i=u.call(e);if(i!=u.call(t))return!1;switch(i){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if("object"!=typeof e||"object"!=typeof t)return!1;for(var o=n.length;o--;)if(n[o]==e)return r[o]==t;n.push(e),r.push(t);var a=0,s=!0;if("[object Array]"==i){if(a=e.length,s=a==t.length)for(;a--&&(s=R(e[a],t[a],n,r)););}else{var l=e.constructor,c=t.constructor;if(l!==c&&!(T.isFunction(l)&&l instanceof l&&T.isFunction(c)&&c instanceof c))return!1;for(var d in e)if(T.has(e,d)&&(a++,!(s=T.has(t,d)&&R(e[d],t[d],n,r))))break;if(s){for(d in t)if(T.has(t,d)&&!a--)break;s=!a}}return n.pop(),r.pop(),s};T.isEqual=function(e,t){return R(e,t,[],[])},T.isEmpty=function(e){if(null==e)return!0;if(T.isArray(e)||T.isString(e))return 0===e.length;for(var t in e)if(T.has(e,t))return!1;return!0},T.isElement=function(e){return!(!e||1!==e.nodeType)},T.isArray=x||function(e){return"[object Array]"==u.call(e)},T.isObject=function(e){return e===Object(e)},A(["Arguments","Function","String","Number","Date","RegExp"],function(e){T["is"+e]=function(t){return u.call(t)=="[object "+e+"]"}}),T.isArguments(arguments)||(T.isArguments=function(e){return!(!e||!T.has(e,"callee"))}),"function"!=typeof/./&&(T.isFunction=function(e){return"function"==typeof e}),T.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},T.isNaN=function(e){return T.isNumber(e)&&e!=+e},T.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"==u.call(e)},T.isNull=function(e){return null===e},T.isUndefined=function(e){return void 0===e},T.has=function(e,t){return c.call(e,t)},T.noConflict=function(){return e._=t,this},T.identity=function(e){return e},T.times=function(e,t,n){for(var r=0;e>r;r++)t.call(n,r)},T.random=function(e,t){return null==t&&(t=e,e=0),e+(0|Math.random()*(t-e+1))};var O={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};O.unescape=T.invert(O.escape);var M={escape:new RegExp("["+T.keys(O.escape).join("")+"]","g"),unescape:new RegExp("("+T.keys(O.unescape).join("|")+")","g")};T.each(["escape","unescape"],function(e){T[e]=function(t){return null==t?"":(""+t).replace(M[e],function(t){return O[e][t]})}}),T.result=function(e,t){if(null==e)return null;var n=e[t];return T.isFunction(n)?n.call(e):n},T.mixin=function(e){A(T.functions(e),function(t){var n=T[t]=e[t];T.prototype[t]=function(){var e=[this._wrapped];return a.apply(e,arguments),D.call(this,n.apply(T,e))}})};var N=0;T.uniqueId=function(e){var t=N++;return e?e+t:t},T.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var I=/(.)^/,L={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},B=/\\|'|\r|\n|\t|\u2028|\u2029/g;T.template=function(e,t,n){n=T.defaults({},n,T.templateSettings);var r=new RegExp([(n.escape||I).source,(n.interpolate||I).source,(n.evaluate||I).source].join("|")+"|$","g"),i=0,o="__p+='";e.replace(r,function(t,n,r,a,s){o+=e.slice(i,s).replace(B,function(e){return"\\"+L[e]}),o+=n?"'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":r?"'+\n((__t=("+r+"))==null?'':__t)+\n'":a?"';\n"+a+"\n__p+='":"",i=s+t.length}),o+="';\n",n.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{var a=new Function(n.variable||"obj","_",o)}catch(s){throw s.source=o,s}if(t)return a(t,T);var l=function(e){return a.call(this,e,T)};return l.source="function("+(n.variable||"obj")+"){\n"+o+"}",l},T.chain=function(e){return T(e).chain()};var D=function(e){return this._chain?T(e).chain():e};T.mixin(T),A(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=r[e];T.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),"shift"!=e&&"splice"!=e||0!==n.length||delete n[0],D.call(this,n)}}),A(["concat","join","slice"],function(e){var t=r[e];T.prototype[e]=function(){return D.call(this,t.apply(this._wrapped,arguments))}}),T.extend(T.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}.call(this),define("underscore",function(e){return function(){var t;return t||e._}}(this)),function(){{var e,t=this,n=t.Backbone,r=[],i=(r.push,r.slice);r.splice}e="undefined"!=typeof exports?exports:t.Backbone={},e.VERSION="1.1.0";var o=t._;o||"undefined"==typeof require||(o=require("underscore")),e.$=t.jQuery||t.Zepto||t.ender||t.$,e.noConflict=function(){return t.Backbone=n,this},e.emulateHTTP=!1,e.emulateJSON=!1;var a=e.Events={on:function(e,t,n){if(!l(this,"on",e,[t,n])||!t)return this;this._events||(this._events={});var r=this._events[e]||(this._events[e]=[]);return r.push({callback:t,context:n,ctx:n||this}),this},once:function(e,t,n){if(!l(this,"once",e,[t,n])||!t)return this;var r=this,i=o.once(function(){r.off(e,i),t.apply(this,arguments)});return i._callback=t,this.on(e,i,n)},off:function(e,t,n){var r,i,a,s,u,c,d,h;if(!this._events||!l(this,"off",e,[t,n]))return this;if(!e&&!t&&!n)return this._events={},this;for(s=e?[e]:o.keys(this._events),u=0,c=s.length;c>u;u++)if(e=s[u],a=this._events[e]){if(this._events[e]=r=[],t||n)for(d=0,h=a.length;h>d;d++)i=a[d],(t&&t!==i.callback&&t!==i.callback._callback||n&&n!==i.context)&&r.push(i);r.length||delete this._events[e]}return this},trigger:function(e){if(!this._events)return this;var t=i.call(arguments,1);if(!l(this,"trigger",e,t))return this;var n=this._events[e],r=this._events.all;return n&&u(n,t),r&&u(r,arguments),this},stopListening:function(e,t,n){var r=this._listeningTo;if(!r)return this;var i=!t&&!n;n||"object"!=typeof t||(n=this),e&&((r={})[e._listenId]=e);for(var a in r)e=r[a],e.off(t,n,this),(i||o.isEmpty(e._events))&&delete this._listeningTo[a];return this}},s=/\s+/,l=function(e,t,n,r){if(!n)return!0;if("object"==typeof n){for(var i in n)e[t].apply(e,[i,n[i]].concat(r));return!1}if(s.test(n)){for(var o=n.split(s),a=0,l=o.length;l>a;a++)e[t].apply(e,[o[a]].concat(r));return!1}return!0},u=function(e,t){var n,r=-1,i=e.length,o=t[0],a=t[1],s=t[2];switch(t.length){case 0:for(;++r<i;)(n=e[r]).callback.call(n.ctx);return;case 1:for(;++r<i;)(n=e[r]).callback.call(n.ctx,o);return;case 2:for(;++r<i;)(n=e[r]).callback.call(n.ctx,o,a);return;case 3:for(;++r<i;)(n=e[r]).callback.call(n.ctx,o,a,s);return;default:for(;++r<i;)(n=e[r]).callback.apply(n.ctx,t)}},c={listenTo:"on",listenToOnce:"once"};o.each(c,function(e,t){a[t]=function(t,n,r){var i=this._listeningTo||(this._listeningTo={}),a=t._listenId||(t._listenId=o.uniqueId("l"));return i[a]=t,r||"object"!=typeof n||(r=this),t[e](n,r,this),this}}),a.bind=a.on,a.unbind=a.off,o.extend(e,a);var d=e.Model=function(e,t){var n=e||{};t||(t={}),this.cid=o.uniqueId("c"),this.attributes={},t.collection&&(this.collection=t.collection),t.parse&&(n=this.parse(n,t)||{}),n=o.defaults({},n,o.result(this,"defaults")),this.set(n,t),this.changed={},this.initialize.apply(this,arguments)};o.extend(d.prototype,a,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(){return o.clone(this.attributes)},sync:function(){return e.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return o.escape(this.get(e))},has:function(e){return null!=this.get(e)},set:function(e,t,n){var r,i,a,s,l,u,c,d;if(null==e)return this;if("object"==typeof e?(i=e,n=t):(i={})[e]=t,n||(n={}),!this._validate(i,n))return!1;a=n.unset,l=n.silent,s=[],u=this._changing,this._changing=!0,u||(this._previousAttributes=o.clone(this.attributes),this.changed={}),d=this.attributes,c=this._previousAttributes,this.idAttribute in i&&(this.id=i[this.idAttribute]);for(r in i)t=i[r],o.isEqual(d[r],t)||s.push(r),o.isEqual(c[r],t)?delete this.changed[r]:this.changed[r]=t,a?delete d[r]:d[r]=t;if(!l){s.length&&(this._pending=!0);for(var h=0,p=s.length;p>h;h++)this.trigger("change:"+s[h],this,d[s[h]],n)}if(u)return this;if(!l)for(;this._pending;)this._pending=!1,this.trigger("change",this,n);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,o.extend({},t,{unset:!0}))},clear:function(e){var t={};for(var n in this.attributes)t[n]=void 0;return this.set(t,o.extend({},e,{unset:!0}))},hasChanged:function(e){return null==e?!o.isEmpty(this.changed):o.has(this.changed,e)},changedAttributes:function(e){if(!e)return this.hasChanged()?o.clone(this.changed):!1;var t,n=!1,r=this._changing?this._previousAttributes:this.attributes;for(var i in e)o.isEqual(r[i],t=e[i])||((n||(n={}))[i]=t);return n},previous:function(e){return null!=e&&this._previousAttributes?this._previousAttributes[e]:null},previousAttributes:function(){return o.clone(this._previousAttributes)},fetch:function(e){e=e?o.clone(e):{},void 0===e.parse&&(e.parse=!0);var t=this,n=e.success;return e.success=function(r){return t.set(t.parse(r,e),e)?(n&&n(t,r,e),t.trigger("sync",t,r,e),void 0):!1},B(this,e),this.sync("read",this,e)},save:function(e,t,n){var r,i,a,s=this.attributes;if(null==e||"object"==typeof e?(r=e,n=t):(r={})[e]=t,n=o.extend({validate:!0},n),r&&!n.wait){if(!this.set(r,n))return!1}else if(!this._validate(r,n))return!1;r&&n.wait&&(this.attributes=o.extend({},s,r)),void 0===n.parse&&(n.parse=!0);var l=this,u=n.success;return n.success=function(e){l.attributes=s;var t=l.parse(e,n);return n.wait&&(t=o.extend(r||{},t)),o.isObject(t)&&!l.set(t,n)?!1:(u&&u(l,e,n),l.trigger("sync",l,e,n),void 0)},B(this,n),i=this.isNew()?"create":n.patch?"patch":"update","patch"===i&&(n.attrs=r),a=this.sync(i,this,n),r&&n.wait&&(this.attributes=s),a},destroy:function(e){e=e?o.clone(e):{};var t=this,n=e.success,r=function(){t.trigger("destroy",t,t.collection,e)};if(e.success=function(i){(e.wait||t.isNew())&&r(),n&&n(t,i,e),t.isNew()||t.trigger("sync",t,i,e)},this.isNew())return e.success(),!1;B(this,e);var i=this.sync("delete",this,e);return e.wait||r(),i},url:function(){var e=o.result(this,"urlRoot")||o.result(this.collection,"url")||L();return this.isNew()?e:e+("/"===e.charAt(e.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(e){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},isValid:function(e){return this._validate({},o.extend(e||{},{validate:!0}))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=o.extend({},this.attributes,e);var n=this.validationError=this.validate(e,t)||null;return n?(this.trigger("invalid",this,n,o.extend(t,{validationError:n})),!1):!0}});var h=["keys","values","pairs","invert","pick","omit"];o.each(h,function(e){d.prototype[e]=function(){var t=i.call(arguments);return t.unshift(this.attributes),o[e].apply(o,t)}});var p=e.Collection=function(e,t){t||(t={}),t.model&&(this.model=t.model),void 0!==t.comparator&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,o.extend({silent:!0},t))},f={add:!0,remove:!0,merge:!0},m={add:!0,remove:!1};o.extend(p.prototype,a,{model:d,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return e.sync.apply(this,arguments)},add:function(e,t){return this.set(e,o.extend({merge:!1},t,m))},remove:function(e,t){var n=!o.isArray(e);e=n?[e]:o.clone(e),t||(t={});var r,i,a,s;for(r=0,i=e.length;i>r;r++)s=e[r]=this.get(e[r]),s&&(delete this._byId[s.id],delete this._byId[s.cid],a=this.indexOf(s),this.models.splice(a,1),this.length--,t.silent||(t.index=a,s.trigger("remove",s,this,t)),this._removeReference(s));return n?e[0]:e},set:function(e,t){t=o.defaults({},t,f),t.parse&&(e=this.parse(e,t));var n=!o.isArray(e);e=n?e?[e]:[]:o.clone(e);var r,i,a,s,l,u,c,h=t.at,p=this.model,m=this.comparator&&null==h&&t.sort!==!1,g=o.isString(this.comparator)?this.comparator:null,v=[],y=[],b={},x=t.add,w=t.merge,_=t.remove,T=!m&&x&&_?[]:!1;for(r=0,i=e.length;i>r;r++){if(l=e[r],a=l instanceof d?s=l:l[p.prototype.idAttribute],u=this.get(a))_&&(b[u.cid]=!0),w&&(l=l===s?s.attributes:l,t.parse&&(l=u.parse(l,t)),u.set(l,t),m&&!c&&u.hasChanged(g)&&(c=!0)),e[r]=u;else if(x){if(s=e[r]=this._prepareModel(l,t),!s)continue;v.push(s),s.on("all",this._onModelEvent,this),this._byId[s.cid]=s,null!=s.id&&(this._byId[s.id]=s)}T&&T.push(u||s)}if(_){for(r=0,i=this.length;i>r;++r)b[(s=this.models[r]).cid]||y.push(s);y.length&&this.remove(y,t)}if(v.length||T&&T.length)if(m&&(c=!0),this.length+=v.length,null!=h)for(r=0,i=v.length;i>r;r++)this.models.splice(h+r,0,v[r]);else{T&&(this.models.length=0);var A=T||v;for(r=0,i=A.length;i>r;r++)this.models.push(A[r])}if(c&&this.sort({silent:!0}),!t.silent){for(r=0,i=v.length;i>r;r++)(s=v[r]).trigger("add",s,this,t);(c||T&&T.length)&&this.trigger("sort",this,t)}return n?e[0]:e},reset:function(e,t){t||(t={});for(var n=0,r=this.models.length;r>n;n++)this._removeReference(this.models[n]);return t.previousModels=this.models,this._reset(),e=this.add(e,o.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),e},push:function(e,t){return this.add(e,o.extend({at:this.length},t))},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return this.add(e,o.extend({at:0},t))},shift:function(e){var t=this.at(0);return this.remove(t,e),t},slice:function(){return i.apply(this.models,arguments)},get:function(e){return null==e?void 0:this._byId[e.id]||this._byId[e.cid]||this._byId[e]},at:function(e){return this.models[e]},where:function(e,t){return o.isEmpty(e)?t?void 0:[]:this[t?"find":"filter"](function(t){for(var n in e)if(e[n]!==t.get(n))return!1;return!0})},findWhere:function(e){return this.where(e,!0)},sort:function(e){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return e||(e={}),o.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(o.bind(this.comparator,this)),e.silent||this.trigger("sort",this,e),this},pluck:function(e){return o.invoke(this.models,"get",e)},fetch:function(e){e=e?o.clone(e):{},void 0===e.parse&&(e.parse=!0);var t=e.success,n=this;return e.success=function(r){var i=e.reset?"reset":"set";n[i](r,e),t&&t(n,r,e),n.trigger("sync",n,r,e)},B(this,e),this.sync("read",this,e)},create:function(e,t){if(t=t?o.clone(t):{},!(e=this._prepareModel(e,t)))return!1;t.wait||this.add(e,t);var n=this,r=t.success;return t.success=function(e,t,i){i.wait&&n.add(e,i),r&&r(e,t,i)},e.save(null,t),e},parse:function(e){return e},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){if(e instanceof d)return e.collection||(e.collection=this),e;t=t?o.clone(t):{},t.collection=this;var n=new this.model(e,t);return n.validationError?(this.trigger("invalid",this,n.validationError,t),!1):n},_removeReference:function(e){this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,r){("add"!==e&&"remove"!==e||n===this)&&("destroy"===e&&this.remove(t,r),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],null!=t.id&&(this._byId[t.id]=t)),this.trigger.apply(this,arguments))}});var g=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain"];o.each(g,function(e){p.prototype[e]=function(){var t=i.call(arguments);return t.unshift(this.models),o[e].apply(o,t)}});var v=["groupBy","countBy","sortBy"];o.each(v,function(e){p.prototype[e]=function(t,n){var r=o.isFunction(t)?t:function(e){return e.get(t)};return o[e](this.models,r,n)}});var y=e.View=function(e){this.cid=o.uniqueId("view"),e||(e={}),o.extend(this,o.pick(e,x)),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},b=/^(\S+)\s*(.*)$/,x=["model","collection","el","id","attributes","className","tagName","events"];o.extend(y.prototype,a,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(t,n){return this.$el&&this.undelegateEvents(),this.$el=t instanceof e.$?t:e.$(t),this.el=this.$el[0],n!==!1&&this.delegateEvents(),this},delegateEvents:function(e){if(!e&&!(e=o.result(this,"events")))return this;this.undelegateEvents();for(var t in e){var n=e[t];if(o.isFunction(n)||(n=this[e[t]]),n){var r=t.match(b),i=r[1],a=r[2];n=o.bind(n,this),i+=".delegateEvents"+this.cid,""===a?this.$el.on(i,n):this.$el.on(i,a,n)}}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_ensureElement:function(){if(this.el)this.setElement(o.result(this,"el"),!1);else{var t=o.extend({},o.result(this,"attributes"));this.id&&(t.id=o.result(this,"id")),this.className&&(t["class"]=o.result(this,"className"));var n=e.$("<"+o.result(this,"tagName")+">").attr(t);this.setElement(n,!1)}}}),e.sync=function(t,n,r){var i=_[t];o.defaults(r||(r={}),{emulateHTTP:e.emulateHTTP,emulateJSON:e.emulateJSON});var a={type:i,dataType:"json"};if(r.url||(a.url=o.result(n,"url")||L()),null!=r.data||!n||"create"!==t&&"update"!==t&&"patch"!==t||(a.contentType="application/json",a.data=JSON.stringify(r.attrs||n.toJSON(r))),r.emulateJSON&&(a.contentType="application/x-www-form-urlencoded",a.data=a.data?{model:a.data}:{}),r.emulateHTTP&&("PUT"===i||"DELETE"===i||"PATCH"===i)){a.type="POST",r.emulateJSON&&(a.data._method=i);var s=r.beforeSend;r.beforeSend=function(e){return e.setRequestHeader("X-HTTP-Method-Override",i),s?s.apply(this,arguments):void 0}}"GET"===a.type||r.emulateJSON||(a.processData=!1),"PATCH"===a.type&&w&&(a.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var l=r.xhr=e.ajax(o.extend(a,r));return n.trigger("request",n,l,r),l};var w=!("undefined"==typeof window||!window.ActiveXObject||window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent),_={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};e.ajax=function(){return e.$.ajax.apply(e.$,arguments)};var T=e.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},A=/\((.*?)\)/g,C=/(\(\?)?:\w+/g,E=/\*\w+/g,S=/[\-{}\[\]+?.,\\\^$|#\s]/g;o.extend(T.prototype,a,{initialize:function(){},route:function(t,n,r){o.isRegExp(t)||(t=this._routeToRegExp(t)),o.isFunction(n)&&(r=n,n=""),r||(r=this[n]);var i=this;return e.history.route(t,function(o){var a=i._extractParameters(t,o);r&&r.apply(i,a),i.trigger.apply(i,["route:"+n].concat(a)),i.trigger("route",n,a),e.history.trigger("route",i,n,a)}),this},navigate:function(t,n){return e.history.navigate(t,n),this},_bindRoutes:function(){if(this.routes){this.routes=o.result(this,"routes");for(var e,t=o.keys(this.routes);null!=(e=t.pop());)this.route(e,this.routes[e])}},_routeToRegExp:function(e){return e=e.replace(S,"\\$&").replace(A,"(?:$1)?").replace(C,function(e,t){return t?e:"([^/]+)"}).replace(E,"(.*?)"),new RegExp("^"+e+"$")},_extractParameters:function(e,t){var n=e.exec(t).slice(1);return o.map(n,function(e){return e?decodeURIComponent(e):null})}});var k=e.History=function(){this.handlers=[],o.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},P=/^[#\/]|\s+$/g,R=/^\/+|\/+$/g,O=/msie [\w.]+/,M=/\/$/,N=/[?#].*$/;k.started=!1,o.extend(k.prototype,a,{interval:50,getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getFragment:function(e,t){if(null==e)if(this._hasPushState||!this._wantsHashChange||t){e=this.location.pathname;var n=this.root.replace(M,"");e.indexOf(n)||(e=e.slice(n.length))}else e=this.getHash();return e.replace(P,"")},start:function(t){if(k.started)throw new Error("Backbone.history has already been started");k.started=!0,this.options=o.extend({root:"/"},this.options,t),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var n=this.getFragment(),r=document.documentMode,i=O.exec(navigator.userAgent.toLowerCase())&&(!r||7>=r);this.root=("/"+this.root+"/").replace(R,"/"),i&&this._wantsHashChange&&(this.iframe=e.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(n)),this._hasPushState?e.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!i?e.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=n;var a=this.location,s=a.pathname.replace(/[^\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!s)return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0;this._hasPushState&&s&&a.hash&&(this.fragment=this.getHash().replace(P,""),this.history.replaceState({},document.title,this.root+this.fragment+a.search))}return this.options.silent?void 0:this.loadUrl()},stop:function(){e.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),k.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(){var e=this.getFragment();return e===this.fragment&&this.iframe&&(e=this.getFragment(this.getHash(this.iframe))),e===this.fragment?!1:(this.iframe&&this.navigate(e),this.loadUrl(),void 0)},loadUrl:function(e){return e=this.fragment=this.getFragment(e),o.any(this.handlers,function(t){return t.route.test(e)?(t.callback(e),!0):void 0})},navigate:function(e,t){if(!k.started)return!1;t&&t!==!0||(t={trigger:!!t});var n=this.root+(e=this.getFragment(e||""));if(e=e.replace(N,""),this.fragment!==e){if(this.fragment=e,""===e&&"/"!==n&&(n=n.slice(0,-1)),this._hasPushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,e,t.replace))}return t.trigger?this.loadUrl(e):void 0}},_updateHash:function(e,t,n){if(n){var r=e.href.replace(/(javascript:|#).*$/,"");e.replace(r+"#"+t)}else e.hash="#"+t}}),e.history=new k;var I=function(e,t){var n,r=this;n=e&&o.has(e,"constructor")?e.constructor:function(){return r.apply(this,arguments)},o.extend(n,r,t);var i=function(){this.constructor=n};return i.prototype=r.prototype,n.prototype=new i,e&&o.extend(n.prototype,e),n.__super__=r.prototype,n};d.extend=p.extend=T.extend=y.extend=k.extend=I;var L=function(){throw new Error('A "url" property or function must be specified')},B=function(e,t){var n=t.error;t.error=function(r){n&&n(e,r,t),e.trigger("error",e,r,t)}}}.call(this),define("backbone",["underscore"],function(e){return function(){var t;return t||e.Backbone}}(this)),define("grapher/bar-graph/bar-graph-model",["require","backbone"],function(e){var t=e("backbone"),n=t.Model.extend({defaults:{value:0,secondValue:null,min:0,max:10,barWidth:"2em",height:"20em",title:"",titleOn:"right",barColor:"#e23c34",fillColor:"white",labels:10,units:"",gridLines:10,labelFormat:"0.1f"}});return n}),define("common/jquery-plugins",[],function(){$.fn.measure=function(e,t,n){var r,i,o;return r=$(this).clone(!1),r.css({visibility:"hidden",position:"absolute"}),r.appendTo(n),i=t?r.find(t):r,o=e.apply(i),r.remove(),o},$.fn.truncate=function(e){var t,n,r=$(this),i=$("<span>");if(i.text(r.text()),i.css({"font-size":r.css("font-size"),"font-weight":r.css("font-weight"),"white-space":"nowrap",visibility:"hidden"}),i.appendTo(r.parent()),t=i.width(),t>e){for(n=i.text()+"...",i.text(n);t>e&&n.length>3;)n=i.text().slice(0,-4)+"...",i.text(n),t=i.width();
r.attr("title",r.text()),r.text(n)}i.remove()}}),define("grapher/bar-graph/bar-graph-view",["require","common/jquery-plugins","backbone"],function(e){e("common/jquery-plugins");var t=e("backbone"),n=0,r=function(){return n++},i=function(e){return e.node().getBBox().width},o=16,a=function(e){var t=e/o;return function(e){return e*t}},s=function(e,t){var n,r,i=[],o={};for(n=0,r=t.length;r>n;n++)i[n]=t[n].value,o[i[n]]=t[n].label;e.tickValues(i).tickFormat(function(e){return o[e]})},l=function(e,t){var n=d3.format(e);return function(e){return n(e)+" "+t}},u=t.View.extend({tagName:"div",className:"bar-graph",initialize:function(){this.uid=r(),this.$topArea=$('<div class="top-area">').appendTo(this.$el),this.vis=d3.select(this.el).append("svg"),this.defs=this.vis.append("defs"),this.axisContainer=this.vis.append("g"),this.fill=this.vis.append("rect"),this.bar=this.vis.append("rect"),this.gridContainer=this.vis.append("g"),this.trianglePos=this.vis.append("g"),this.traingle=this.trianglePos.append("polygon"),this.titleContainer=this.vis.append("g"),this.yScale=d3.scale.linear(),this.heightScale=d3.scale.linear(),this.yAxis=d3.svg.axis(),this.scale=null,this.barWidth=null,this.$bottomArea=$('<div class="bottom-area">').appendTo(this.$el),this.model.on("change",this.modelChanged,this)},render:function(){var e=this.model.toJSON(),t=parseFloat(this.$el.css("font-size")),n=this.scale=a(t),r=e.labels>0||e.labels.length>0,o=r?n(8):n(3),u=r?n(8):n(3),c=0;this.$el.outerHeight(e.height),this._setupHorizontalTitle(),this.svgHeight=this.$el.height()-this.$topArea.height()-this.$bottomArea.height(),this.vis.attr({width:600,height:this.svgHeight}),this.yScale.domain([e.min,e.max]).range([this.svgHeight-o,u]).clamp(!0),this.heightScale.domain([e.min,e.max]).range([0,this.svgHeight-o-u]).clamp(!0),this.axisContainer.selectAll("*").remove(),r&&(this.yAxis.scale(this.yScale).tickValues(null).tickPadding(0).tickSize(0,0,0).orient("left"),"number"==typeof e.labels?this.yAxis.ticks(e.labels).tickFormat(l(e.labelFormat,e.units)):s(this.yAxis,e.labels),this.axisContainer.call(this.yAxis),c+=i(this.axisContainer),this.axisContainer.attr("transform","translate("+c+")"),c+=n(5)),this.fill.attr({width:e.barWidth,height:this.heightScale(e.max),x:c,y:this.yScale(e.max),rx:"0.5em",ry:"0.5em",fill:this._getFillGradient(e.fillColor)}),this.bar.attr({width:e.barWidth,x:c,rx:"0.5em",ry:"0.5em",fill:this._getBarGradient(e.barColor)}),this.barWidth=i(this.fill),this.traingle.classed("triangle",!0).attr({points:"15,-7 15,7 1,0",transform:"translate("+c+") scale("+n(1)+")"}),this._setupGrid(c),c+=this.barWidth,c=this._setupTitle(c),this.vis.attr("width",c/t+"em"),this.$el.css("min-width",c/t+"em"),this.$el.css("min-width",c/t+.8+"em"),this.update()},update:function(){var e=this.model.get("value"),t=this.model.get("secondValue");this.bar.attr("height",this.heightScale(e)).attr("y",this.yScale(e)),"undefined"!=typeof t&&null!==t?(this.traingle.classed("hidden",!1),this.trianglePos.attr("transform","translate(0,"+this.yScale(t)+")")):this.traingle.classed("hidden",!0)},modelChanged:function(){var e,t,n,r=this.model.changedAttributes(),i=0;for(n in r)if(r.hasOwnProperty(n)&&(i++,i>2))return this.render(),void 0;e="undefined"!=typeof r.value,t="undefined"!=typeof r.secondValue,1===i&&(e||t)||2===i&&e&&t?this.update():this.render()},_getBarGradient:function(e){var t="bar-gradient-"+this.uid,n=this.defs.select("#"+t);return e=d3.rgb(e),n.empty()?n=this.defs.append("linearGradient").attr("id",t).attr("x1","0%").attr("y1","0%").attr("x2","0%").attr("y2","100%"):n.selectAll("stop").remove(),n.append("stop").attr("stop-color",e.brighter(2).toString()).attr("offset","0%"),n.append("stop").attr("stop-color",e.toString()).attr("offset","100%"),"url(#"+t+")"},_getFillGradient:function(e){var t="fill-gradient-"+this.uid,n=this.defs.select("#"+t);return n.empty()?n=this.defs.append("linearGradient").attr("id",t).attr("x1","0%").attr("y1","0%").attr("x2","0%").attr("y2","100%"):n.selectAll("stop").remove(),n.append("stop").attr("stop-color",e).attr("offset","0%"),n.append("stop").attr("stop-color",e).attr("stop-opacity",.5).attr("offset","15%"),n.append("stop").attr("stop-color",e).attr("stop-opacity",.4).attr("offset","100%"),"url(#"+t+")"},_setupGrid:function(e){var t=this.yScale.ticks(this.model.get("gridLines")),n=this.yScale,r=this.barWidth;return t.pop(),t.shift(),this.grid=this.gridContainer.selectAll(".grid-line").data(t,String),this.grid.enter().append("path").attr("class","grid-line"),this.grid.exit().remove(),this.grid.attr("d",function(t){return"M "+e+" "+Math.round(n(t))+" h "+r}),e},_setupTitle:function(e){var t,n,r,i,o=this.model.get("title"),a=this;return o&&"right"===this.model.get("titleOn")&&(e+=this.scale(10),t=$.isArray(o),n=t?o.length:1,r=this.titleContainer.selectAll(".title").data(t?o:[o]),r.exit().remove(),i=r.enter().append("g").attr("class","title"),i.append("title"),i.append("text"),r.each(function(e,t){var r=d3.select(this);r.select("title").text(e),r.select("text").text(a._processTitle(e)).attr("dy",-(n-t-1)+"em")}),this.titleContainer.attr("transform","translate("+e+", "+this.svgHeight/2+") rotate(90)"),e+=parseFloat($(r.node()).css("font-size"))*n),e},_setupHorizontalTitle:function(){var e,t=this.model.get("title"),n=this.model.get("titleOn");this.$topArea.empty(),this.$bottomArea.empty(),t&&0!==t.length&&"right"!==n&&(t=$.isArray(t)?t:[t],"top"===n?e=this.$topArea:"bottom"===n&&(e=this.$bottomArea),t.forEach(function(t){e.append('<p class="title">'+t+"</p>")}))},_processTitle:function(e){var t,n=$('<span class="title">'+e+"</span>").appendTo(this.$el);return n.truncate(this.svgHeight),t=n.text(),n.remove(),t}});return u}),define("common/controllers/bar-graph-controller",["require","grapher/bar-graph/bar-graph-model","grapher/bar-graph/bar-graph-view","common/controllers/interactive-metadata","common/validator"],function(e){var t=e("grapher/bar-graph/bar-graph-model"),n=e("grapher/bar-graph/bar-graph-view"),r=e("common/controllers/interactive-metadata"),i=e("common/validator"),o={min:"min",max:"max",title:"title",titleOn:"titleOn",barColor:"barColor",fillColor:"fillColor",labels:"labels",gridLines:"gridLines",labelFormat:"labelFormat",units:"units"},a=function(e){var t,n,r={};for(t in o)o.hasOwnProperty(t)&&(n=o[t],void 0!==e[t]&&(r[n]=e[t]));return r};return function(e,o){function s(){u=o.getModel(),e=i.validateCompleteness(r.barGraph,e),c=new t(a(e)),d=new n({model:c,id:e.id}),d.$el.addClass("component"),h=e.property,p=e.secondProperty,e.tooltip&&d.$el.attr("title",e.tooltip)}var l,u,c,d,h,p,f=function(){c.set({value:u.get(h)})},m=function(){c.set({secondValue:u.get(p)})};return l={modelLoadedCallback:function(){var t="";u&&(u.removeObserver(h,f),p&&u.removeObserver(p,m)),u=o.getModel(),u.addPropertiesListener([h],f),"undefined"!=typeof e.averagePeriod&&null!==e.averagePeriod&&(p=h+"-bargraph-"+e.id+"-average",u.defineFilteredOutput(p,{},h,"RunningAverage",e.averagePeriod)),p&&u.addPropertiesListener([p],m),e.units===!0?t=u.getPropertyDescription(h).getUnitAbbreviation():e.units&&(t=e.units),c.set({barWidth:e.barWidth,height:e.height,units:t}),d.render(),f()},getViewContainer:function(){return d.$el},resize:function(){d.render()},serialize:function(){var t=$.extend(!0,{},e);return t}},s(),l}}),define("grapher/core/axis",["require"],function(){return{numberWidthUsingFormatter:function(e,t,n,r,i){var o,a,s,l,u,c;return o=e.append("svg").attr("width",t).attr("height",n).attr("class","graph"),a=o.append("g").append("text").attr("class","axis").attr("x",-r/4+"px").attr("dy",".35em").attr("text-anchor","end").text(i),c=a.node(),c.getBBox?(s=a.node().getBBox(),l=s.width,u=s.height):(l=0,u=0),o.remove(),[l,u]},axisProcessDrag:function(e,t,n){var r,i,o=n,a=0,s=n[0],l=n[1],u=l-s;return 0!==t&&(s>=0&&l>s?(a=s,r=e-a,i=.4*r+a,t>i&&(change=r/(t-a),u=l-a,o=[s,s+u*change])):0>s&&l>0?(a=0,r=e-a,i=.4*r+a,(e>=0&&t>i||0>e&&i>t)&&(change=r/(t-a),o=[s*change,l*change])):0>s&&0>l&&(a=l,r=e-a,i=.4*r+a,i>t&&(change=r/(t-a),u=s-a,o=[l+u*change,l]))),o[0]=+o[0].toPrecision(5),o[1]=+o[1].toPrecision(5),o}}}),define("grapher/core/graph",["require","grapher/core/axis"],function(e){var t=e("grapher/core/axis"),n={autoscale:"Show all data (autoscale)"};return function(e,r,i){function o(e,t,n){switch((t||!r)&&(r=u(t)),a(e,n),r.xrange=r.xmax-r.xmin,r.yrange=r.ymax-r.ymin,Hn="[object Array]"===Object.prototype.toString.call(r.title)?r.title:[r.title],Hn.reverse(),Dn=r.sampleInterval,Fn=r.dataSampleStart,Nn=r.lineWidth,Mt={width:120,height:120},p(),Kt=d3.format(r.xFormatter),Jt=d3.format(r.yFormatter),Xt=function(e){var t=jt.domain(),n=Math.abs(.01*(t[1]-t[0]));return Math.abs(0+e)<n&&(e=0),Kt(e)},Yt=function(e){var t=qt.domain(),n=Math.abs(.01*(t[1]-t[0]));return Math.abs(0+e)<n&&(e=0),Jt(e)},Wt=r.xTickCount,Ht=r.yTickCount,In=[],r.dataType){case"fake":nr=v(),In=[nr];break;case"points":mt(r.dataPoints);break;case"samples":gt(r.dataSamples,Dn,Fn)}tr=[],er=null,y(nr.length)}function a(e,t){e&&(Et=d3.select(e),St=Et.node(),kt=$(St),Pt=Et.property("clientWidth"),Rt=Et.property("clientHeight")),t&&(i=t),void 0!==Nt&&(Nt.remove(),Nt=void 0),void 0!==Qt&&(Qt.remove(),Qt=void 0),void 0!==tn&&(tn.remove(),tn=void 0),an=r.dataChange?"ns-resize":"crosshair",s(),Jn=0/0,Zn=0/0,Qn=null}function s(e,t){e||t?(Pt=e,St.style.width=Pt+"px",t?(Rt=t,St.style.height=Rt+"px"):(St.style.height="100%",t=Et.property("clientHeight"),Rt=t,St.style.height=Rt+"px")):(Pt=Math.max(Et.property("clientWidth"),60),Rt=Math.max(Et.property("clientHeight"),60)),d()}function l(){s(),sn=parseFloat(kt.css("font-size")),r.fontScaleRelativeToParent||kt.css("font-size",.5+Kn.value/6+"em"),sn=parseFloat(kt.css("font-size")),ln=sn/2,un=sn/4,void 0===Nt?(cn=sn,dn=sn,hn=sn,pn=sn):(cn=parseFloat($("svg.graph text.title").css("font-size")),dn=parseFloat($("svg.graph text.axis").css("font-size")),hn=parseFloat($("svg.graph text.xlabel").css("font-size")),pn=parseFloat($("svg.graph text.ylabel").css("font-size"))),c(),f(),zt=d3.svg.line().x(function(e,t){return jt(nr[t][0])}).y(function(e,t){return qt(nr[t][1])})}function u(e){if(e)for(var t in rr)void 0===e[t]&&(e[t]=rr[t]);else e=rr;return e.axisShift<1&&(e.axisShift=1),e}function c(){switch(void 0===jt?(fn=[sn,sn],mn=[2*sn,sn]):(fn=t.numberWidthUsingFormatter(Et,Pt,Rt,dn,h(jt.ticks(Wt),Xt)),mn=t.numberWidthUsingFormatter(Et,Pt,Rt,dn,h(qt.ticks(Ht),Yt))),gn=fn[0],yn=fn[1],_n=.6*gn,Cn=1.1*yn,xn=Cn+1.3*yn,Tn=xn-yn/3,vn=mn[0],bn=mn[1],En=vn+yn/4,wn=En+bn,An=-(En+bn/4),Kn.value){case 0:Ot={top:ln,right:ln,bottom:sn,left:sn};break;case 1:Ot={top:r.title?1.8*cn:sn,right:ln,bottom:sn,left:sn};break;case 2:Ot={top:r.title?1.8*cn:sn,right:_n,bottom:1.25*dn,left:1.25*vn},Wt=Math.max(6,r.xTickCount/2),Ht=Math.max(6,r.yTickCount/2);break;case 3:Ot={top:r.title?1.8*cn:sn,right:_n,bottom:r.xlabel?xn:1.25*dn,left:r.ylabel?wn:vn};break;default:Ot={top:r.title?1.8*cn:sn,right:_n,bottom:r.xlabel?xn:1.25*dn,left:r.ylabel?wn:vn}}Kn.value>2?Ot.top+=(Hn.length-1)*Kn.value/3*Kn.value/3*sn:Hn=[Hn[0]],Mt.width=Math.max(Pt-Ot.left-Ot.right,60),Mt.height=Math.max(Rt-Ot.top-Ot.bottom,60)}function d(){r.responsiveLayout?Pt<=Kn.icon?(Kn.category="icon",Kn.value=0):Pt<=Kn.tiny?(Kn.category="tiny",Kn.value=1):Pt<=Kn.small?(Kn.category="small",Kn.value=2):Pt<=Kn.medium?(Kn.category="medium",Kn.value=3):(Kn.category="large",Kn.value=4):(Kn.category="large",Kn.value=4)}function h(e,t,n){var r,i,o,a=0,s=0;for(n=n||5,o=0;o<e.length;o++)r=t(+e[o].toPrecision(n)),r=r.replace(/^\s\s*/,"").replace(/\s\s*$/,""),i=r.length,i>a&&(a=i,s=o);return t(e[s])}function p(){function e(e,t){var n=e.domain;return e.domain=function(r){return arguments.length&&t(r),n.apply(e,arguments)},e}jt=e(d3.scale[r.xscale](),function(e){r.xmin=e[0],r.xmax=e[1]}),qt=e(d3.scale[r.yscale](),function(e){r.ymin=e[0],r.ymax=e[1]}),f()}function f(){m(),g()}function m(){jt.domain([r.xmin,r.xmax]).range([0,Mt.width]),M()}function g(){qt.domain([r.ymin,r.ymax]).range([Mt.height,0])}function v(){var e,t=r.yrange/2,n=t/2;return r.datacount=Mt.width/30,r.xtic=r.xrange/r.datacount,r.ytic=r.yrange/r.datacount,e=d3.range(r.datacount).map(function(e){return[e*r.xtic+r.xmin,r.ymin+n+Math.random()*t]})}function y(e){return"number"==typeof e&&(Bn=e),"number"!=typeof Bn&&(Bn=nr.length-1),Bn}function b(e,t,n){var r=0,i=[];for(t=t||1,n=n||0,r=0;r<e.length;r++)i.push([r*t+n,e[r]]);return i}function x(e){i=e,e?en.text(e):en.text("")}function w(){Zt=Et.append("div"),Zt.attr("class","button-layer").style("z-index",3),r.enableAutoScaleButton&&Zt.append("a").attr({"class":"autoscale-button",title:n.autoscale}).on("click",function(){X()}).append("i").attr("class","icon-picture"),_()}function _(){Zt.style({width:1.75*sn+"px",height:1.25*sn+"px",top:Ot.top+ln+"px",left:Ot.left+(Mt.width-2*sn)+"px"})}function T(){Nt=Et.append("svg").attr("width",Pt).attr("height",Rt).attr("class","graph").style("z-index",2),It=Nt.append("g").attr("transform","translate("+Ot.left+","+Ot.top+")"),Lt=It.append("rect").attr("class","plot").attr("width",Mt.width).attr("height",Mt.height).attr("pointer-events","all").attr("fill","rgba(255,255,255,0)").on("mousemove",F).on("mousedown",G).on("touchstart",G),Lt.call(d3.behavior.zoom().x(jt).y(qt).on("zoom",S)),Qt=Et.append("div").attr("class","background").style({width:Mt.width+"px",height:Mt.height+"px",top:Ot.top+"px",left:Ot.left+"px","z-index":0}),nt(),Bt=It.append("svg").attr("class","viewbox").attr("top",0).attr("left",0).attr("width",Mt.width).attr("height",Mt.height).attr("viewBox","0 0 "+Mt.width+" "+Mt.height),Gt=Bt.append("line").attr("stroke",jn).attr("stroke-dasharray","2,2").attr("y1",0).attr("y2",Mt.height).attr("x1",function(){return null===er?0:er[0]}).attr("x2",function(){return null===er?0:er[0]}).attr("class","ruler hidden"),$t=Bt.append("line").attr("stroke",jn).attr("stroke-dasharray","2,2").attr("x1",0).attr("x2",Mt.width).attr("y1",function(){return null===er?0:er[1]}).attr("y2",function(){return null===er?0:er[1]}).attr("class","ruler hidden"),kn=Nt.append("rect").attr("class","draggable-axis").attr("x",Ot.left-En).attr("y",Ot.top).attr("rx",bn/6).attr("width",En).attr("height",Mt.height).attr("pointer-events","all").style("cursor","row-resize").on("mousedown",q).on("touchstart",q),Rn=kn.append("title"),Sn=Nt.append("rect").attr("class","draggable-axis").attr("x",Ot.left).attr("y",Mt.height+Ot.top).attr("rx",bn/6).attr("width",Mt.width).attr("height",Cn).attr("pointer-events","all").style("cursor","col-resize").on("mousedown",j).on("touchstart",j),Pn=Sn.append("title"),Kn.value<=2&&r.ylabel&&Pn.text(r.xlabel),Kn.catefory&&r.ylabel&&Rn.text(r.ylabel),E(),Gn=Bt.append("g").attr("class","brush"),r.title&&Kn.value>0?(Dt=It.selectAll("text").data(Hn,function(e){return e}),Dt.enter().append("text").attr("class","title").text(function(e){return e}).attr("x",function(){return Mt.width/2-Math.min(Mt.width,C(this))/2}).attr("dy",function(e,t){return-t*cn-ln+"px"}),Ut=Dt.append("title").text("")):r.title&&(Ut=Lt.append("title").text(r.title)),Kn.value>2&&(Ft=It.append("text").attr("class","axis").attr("class","xlabel").text(r.xlabel).attr("x",Mt.width/2).attr("y",Mt.height).attr("dy",Tn+"px").style("text-anchor","middle")),Kn.value>2&&(Vt=It.append("g").append("text").attr("class","axis").attr("class","ylabel").text(r.ylabel).style("text-anchor","middle").attr("transform","translate("+An+" "+Mt.height/2+") rotate(-90)"),"small"===Kn.category&&kn.append("title").text(r.ylabel)),d3.select(St).on("mousemove.drag",H).on("touchmove.drag",H).on("mouseup.drag",z).on("touchend.drag",z),en=It.append("text").attr("class","graph-notification").text(i).attr("x",Mt.width/2).attr("y",Mt.height/2).style("text-anchor","middle"),B(),D()}function A(){It.attr("width",Pt).attr("height",Rt).attr("transform","translate("+Ot.left+","+Ot.top+")"),Lt.attr("width",Mt.width).attr("height",Mt.height),Qt.style({width:Mt.width+"px",height:Mt.height+"px",top:Ot.top+"px",left:Ot.left+"px","z-index":0}),Bt.attr("top",0).attr("left",0).attr("width",Mt.width).attr("height",Mt.height).attr("viewBox","0 0 "+Mt.width+" "+Mt.height),kn.attr("x",Ot.left-En).attr("y",Ot.top-bn/2).attr("width",En).attr("height",Mt.height+bn),Sn.attr("x",Ot.left).attr("y",Mt.height+Ot.top).attr("width",Mt.width).attr("height",Cn),E(),r.title&&Kn.value>0?(Dt.attr("x",function(){return Mt.width/2-Math.min(Mt.width,C(this))/2}).attr("dy",function(e,t){return-t*cn-ln+"px"}),Ut.text("")):r.title&&Ut.text(r.title),r.xlabel&&Kn.value>2?(Ft.attr("x",Mt.width/2).attr("y",Mt.height).attr("dy",Tn+"px"),Pn.text("")):Pn.text(r.xlabel),r.ylabel&&Kn.value>2?(Vt.attr("transform","translate("+An+" "+Mt.height/2+") rotate(-90)"),Rn.text("")):Rn.text(r.ylabel),en.attr("x",Mt.width/2).attr("y",Mt.height/2),It.selectAll("g.x").remove(),It.selectAll("g.y").remove(),B(),D(),rt()}function C(e){return e.getComputedTextLength?e.getComputedTextLength():100}function E(){Kn.value<=1?(Sn.style({fill:"rgba(196, 196, 196, 0.2)"}),kn.style({fill:"rgba(196, 196, 196, 0.2)"})):(Sn.style({fill:null}),kn.style({fill:null}))}function S(){c(),A();var e=It.selectAll("g.x").data(jt.ticks(Wt),String).attr("transform",qn),t=e.enter().insert("g","a").attr("class","x").attr("transform",qn);t.append("line").attr("stroke",jn).attr("y1",0).attr("y2",Mt.height),Kn.value>1&&t.append("text").attr("class","axis").attr("y",Mt.height).attr("dy",dn+"px").attr("text-anchor","middle").text(Xt).on("mouseover",function(){d3.select(this).style("font-weight","bold")}).on("mouseout",function(){d3.select(this).style("font-weight","normal")}),e.exit().remove();var n=It.selectAll("g.y").data(qt.ticks(Ht),String).attr("transform",Wn),i=n.enter().insert("g","a").attr("class","y").attr("transform",Wn).attr("background-fill","#FFEEB6");if(i.append("line").attr("stroke",jn).attr("x1",0).attr("x2",Mt.width),Kn.value>1){if("log"===r.yscale){var o=i[0].length;i=o>100?i.filter(function(e){return!!e.toString().match(/(\.[0]*|^)[1]/)}):o>50?i.filter(function(e){return!!e.toString().match(/(\.[0]*|^)[12]/)}):i.filter(function(e){return!!e.toString().match(/(\.[0]*|^)[125]/)})}i.append("text").attr("class","axis").attr("x",-dn/4+"px").attr("dy",".35em").attr("text-anchor","end").style("cursor","ns-resize").text(Yt).on("mouseover",function(){d3.select(this).style("font-weight","bold")}).on("mouseout",function(){d3.select(this).style("font-weight","normal")})}n.exit().remove(),Lt.call(d3.behavior.zoom().x(jt).y(qt).on("zoom",S)),k()}function k(e){y(e),at(Bn),B(),d3.event&&d3.event.keyCode&&(d3.event.preventDefault(),d3.event.stopPropagation())}function P(e){y(e),R()}function R(e){var t,n=jt.domain(),i=Math.round(n[0]),o=(Math.round(n[1]),Math.max(0,i),n[1]-n[0]),a=.95*o;y(e),t=Bn>0?nr[Bn-1][0]:nr[Bn][0],Xn?(Xn=on(),Xn?(N(),S()):k(Bn)):t>n[0]+a?(on=O(.9*a,r.axisShift),Xn=on(),S()):t<n[1]-a&&Bn<nr.length&&i>0?(on=O(.9*a,r.axisShift,-1),Xn=on(),S()):t<n[0]?(on=O(.1*a,1,-1),Xn=on(),S()):k(Bn)}function O(e,t,n){var r=jt.domain()[0],i=jt.domain()[1],o=1/t,a=0;return function(){var t;return n=n||1,a+=o,t=e*Yn(a),n>0?(jt.domain([r+t,i+t]),jt.domain()[0]<r+e):(jt.domain([r-t,i-t]),jt.domain()[0]>r-e)}}function M(){Xn=!1,on=null}function N(){isNaN(Jn)||(Jn=0/0),isNaN(Zn)||(Zn=0/0)}function I(e){var t=[];return e===er&&t.push("selected"),0===t.length?null:t.join(" ")}function L(){var e=jt.domain(),t=jt.range();On=(t[1]-t[0])/(e[1]-e[0]),On=Math.min(Math.max(On,4),8),Mn=On/3}function B(){var e,t=null;r.markAllDataPoints&&Kn.value>1?t=nr:r.markNearbyDataPoints&&Kn.value>1&&(t=tr.slice(0),null!==er&&-1===t.indexOf(er)&&t.push(er)),null!==t&&(L(),e=It.select("svg").selectAll("circle").data(t),e.enter().append("circle").attr("class",I).attr("cx",function(e){return jt(e[0])}).attr("cy",function(e){return qt(e[1])}).attr("r",On).style("stroke-width",Mn).style("cursor",an).on("mousedown.drag",W).on("touchstart.drag",W).append("title").text(function(e){return"( "+Xt(e[0])+", "+Yt(e[1])+" )"}),e.attr("class",I).attr("cx",function(e){return jt(e[0])}).attr("cy",function(e){return qt(e[1])}).select("title").text(function(e){return"( "+Xt(e[0])+", "+Yt(e[1])+" )"}),e.exit().remove()),D()}function D(){r.showRulersOnSelection&&null!==er?(Gt.attr("y1",0).attr("y2",Mt.height).attr("x1",function(){return null===er?0:jt(er[0])}).attr("x2",function(){return null===er?0:jt(er[0])}).attr("class",function(){return"ruler"+(null===er?" hidden":"")}),$t.attr("x1",0).attr("x2",Mt.width).attr("y1",function(){return null===er?0:qt(er[1])}).attr("y2",function(){return null===er?0:qt(er[1])}).attr("class",function(){return"ruler"+(null===er?" hidden":"")})):(Gt.attr("class","ruler hidden"),$t.attr("class","ruler hidden"))}function F(){if(r.markNearbyDataPoints){var e,t,n,i,o,a=d3.mouse(It.node()),s=jt.invert(Math.max(0,Math.min(Mt.width,a[0])));for(tr=[],o=0;o<In.length;o++)nr=In[o],e=V(s,o),null!==e&&(t=nr.indexOf(e),n=t-r.extraCirclesVisibleOnHover,i=t+(r.extraCirclesVisibleOnHover+1),0>n&&(n=0),i>nr.length-1&&(i=nr.length),tr=tr.concat(nr.slice(n,i)));k()}}function V(e,t){if(("undefined"==typeof t||null===t)&&(t=0),nr=In[t],0===nr.length)return null;for(var n,r,i,o,a=0,s=nr.length-1;s>a;)n=Math.floor((a+s)/2),nr[n][0]<e?a=n+1:s=n;return r=nr[n-1],i=nr[n],o=nr[n+1],"undefined"!=typeof r&&Math.abs(r[0]-e)<=Math.abs(i[0]-e)?r:"undefined"==typeof o||Math.abs(i[0]-e)<=Math.abs(o[0]-e)?i:o}function G(){if(r.enableAxisScaling){var e;if(d3.event.preventDefault(),d3.select("body").style("cursor","move"),d3.event.altKey)if(Lt.style("cursor","nesw-resize"),d3.event.shiftKey&&r.addData){e=d3.mouse(It.node());var t=[];t[0]=jt.invert(Math.max(0,Math.min(Mt.width,e[0]))),t[1]=qt.invert(Math.max(0,Math.min(Mt.height,e[1]))),nr.push(t),nr.sort(function(e,t){return e[0]<t[0]?-1:e[0]>t[0]?1:0}),er=t,k()}else e=d3.mouse(It.node()),Jn=jt.invert(e[0]),Zn=qt.invert(e[1]),Qn=!1,d3.event.stopPropagation()}}function U(){return!1}function j(){if(r.enableAxisScaling){St.focus(),document.onselectstart=U,d3.event.preventDefault();var e=d3.mouse(It.node());Jn=jt.invert(e[0])}}function q(){if(r.enableAxisScaling){St.focus(),d3.event.preventDefault(),document.onselectstart=U;var e=d3.mouse(It.node());Zn=qt.invert(e[1])}}function W(e){St.focus(),d3.event.preventDefault(),document.onselectstart=U,er=Qn=er===e?null:e,k()}function H(){var e,n,i,o,a,s,l,u=d3.mouse(It.node());document.onselectstart=function(){return!0},d3.event.preventDefault(),Qn&&(r.dataChange?Qn[1]=qt.invert(Math.max(0,Math.min(Mt.height,u[1]))):(e=nr.indexOf(Qn),e&&e<nr.length-1&&(n=jt.invert(u[0]),i=Qn[0],o=nr[e+1],a=nr[e-1],s=i-(i-a[0])/2,l=i+(o[0]-i)/2,s>n?(Qn=a,er=Qn):n>l&&(Qn=o,er=Qn))),k()),isNaN(Jn)||(d3.select("body").style("cursor","col-resize"),Lt.style("cursor","col-resize"),Xn?jt.domain(t.axisProcessDrag(Jn,jt.invert(u[0]),jt.domain())):jt.domain(t.axisProcessDrag(Jn,jt.invert(u[0]),jt.domain())),L(),S(),d3.event.stopPropagation()),isNaN(Zn)||(d3.select("body").style("cursor","row-resize"),Lt.style("cursor","row-resize"),qt.domain(t.axisProcessDrag(Zn,qt.invert(u[1]),qt.domain())),S(),d3.event.stopPropagation())}function z(){d3.select("body").style("cursor","auto"),Lt.style("cursor","auto"),document.onselectstart=function(){return!0},isNaN(Jn)||(S(),Jn=0/0),isNaN(Zn)||(S(),Zn=0/0),Qn=null}function X(){var e,t,n,i,o,a,s,l,u=1/0,c=-1/0,d=1/0,h=-1/0;if(!(nr.length<2)){for(e=0;e<In.length;e++)for(nr=In[e],t=0,n=nr.length;n>t;t++)i=nr[t],o=i[0],a=i[1],u>o&&(u=o),o>c&&(c=o),d>a&&(d=a),a>h&&(h=a);switch(l=function(e,t){return 0>e?-Math.pow(-e,t):Math.pow(e,t)},r.yscale){case"linear":s=function(e){return e};break;case"log":d=Math.log(d)/Math.log(10),h=Math.log(h)/Math.log(10),s=function(e){return Math.pow(10,e)};break;case"pow":d=l(d,r.yscaleExponent),h=l(h,r.yscaleExponent),s=function(e){return l(e,1/r.yscaleExponent)}}jt.domain([u,c]).nice(),qt.domain([s(d-.15*(h-d)),s(h+.15*(h-d))]).nice(),S()}}function Y(e){return arguments.length?(null===e?or=!1:0===e.length?(or=!0,ir.xmin=1/0,ir.xmax=1/0):(or=!0,ir.xmin=e[0],ir.xmax=e[1]),tt(),Vn&&Vn(Y()),Un):or?1/0===ir.xmax&&1/0===ir.xmin?[]:[ir.xmin,ir.xmax]:null}function K(){return or}function J(e){return arguments.length?(e=!!e,ar!==e&&(ar=e,tt()),Un):ar}function Z(e){return arguments.length?(e=!!e,sr!==e&&(sr=e,tt()),Un):sr}function Q(e){return arguments.length?(Vn=e,Un):Vn}function et(){var e;sr&&(e=$n.extent(),Y(e[0]!==e[1]?e:[]))}function tt(){or&&ar?($n=$n||d3.svg.brush().x(jt).extent([ir.xmin||0,ir.xmax||0]).on("brush",et),Gn.call($n.extent([ir.xmin||0,ir.xmax||0])).style("display","inline").style("pointer-events",sr?"all":"none").selectAll("rect").attr("height",Mt.height)):Gn.style("display","none")}function nt(){tn=Et.append("canvas"),nn=tn.node(),rt()}function rt(){tn.attr("class","overlay").style({position:"absolute",width:Mt.width+"px",height:Mt.height+"px",top:Ot.top+"px",left:Ot.left+"px","z-index":1}),nn=tn.node(),nn.width=Mt.width,nn.height=Mt.height,nn.top=Ot.top,nn.left=Ot.left,ot(),at(Bn)}function it(){nn.getContext&&(nn.width=nn.width,rn.lineWidth=Nn,rn.fillStyle=zn,rn.fillRect(0,0,nn.width,nn.height),rn.strokeStyle="rgba(255,65,0, 1.0)")}function ot(){nn.getContext&&(rn=nn.getContext("2d"),rn.globalCompositeOperation="source-over",rn.lineWidth=Nn,rn.fillStyle=zn,rn.fillRect(0,0,nn.width,nn.height),rn.strokeStyle="rgba(255,65,0, 1.0)")}function at(e){var t,n,i,o,a,s,l,u,c,d,h,p=qt(1e-5),f=r.lines,m=r.bars,g=(2*Math.PI,In.length);if("undefined"!=typeof nn.getContext)if(y(e),it(),rn.fillRect(0,0,nn.width,nn.height),rn.lineWidth=Nn,u=jt.domain()[0],c=jt.domain()[1],h=Math.max(0,u),f)for(t=0;g>t&&(nr=In[t],l=nr.length,0!==l);t++){for(s=0,n=0;l>n&&!(nr[n][0]>=u);n++)s++;if(s>0&&--s,s>=l)break;if(o=jt(nr[s][0]),a=qt(nr[s][1]),st(t),rn.beginPath(),rn.moveTo(o,a),i=nr[s][0],s++,Ln>t){for(;e>s&&(i=nr[s][0],o=jt(i),a=qt(nr[s][1]),rn.lineTo(o,a),!(i>=c));s++);if(rn.stroke(),l>s&&c>i){for(st(t,!0),rn.lineWidth=Nn/2;l>s&&(i=nr[s][0],o=jt(i),a=qt(nr[s][1]),rn.lineTo(o,a),!(i>=c));s++);rn.stroke()}}else{st(0,!0),rn.lineWidth=Nn/2;for(var v=0;l-1>s&&(i=nr[s][0],o=jt(i),!(v>o))&&(v=o,a=qt(nr[s][1]),rn.lineTo(o,a),!(i>=c));s++);rn.stroke()}}else if(m)for(t=0;g>t;t++){for(nr=In[t],l=nr.length,st(t),d=e-1,s=h;d>s;s++)o=jt(nr[s][0]),a=qt(nr[s][1]),0!==a&&(rn.beginPath(),rn.moveTo(o,p),rn.lineTo(o,a),rn.stroke());if(d=nr.length-1,d>s)for(st(t,!0);d>s;s++)o=jt(nr[s][0]),a=qt(nr[s][1]),rn.beginPath(),rn.moveTo(o,p),rn.lineTo(o,a),rn.stroke()}else for(t=0;g>t;t++){for(nr=In[t],l=nr.length,s=0,n=0;l>n&&!(nr[n][0]>=u);n++)s++;if(s>0&&--s,s>=l)break;for(o=jt(nr[s][0]),a=qt(nr[s][1]),lt(t),i=nr[s][0],s++;e>s&&(i=nr[s][0],o=jt(i),a=qt(nr[s][1]),rn.fillRect(o,a,Nn,Nn),!(i>=c));s++);if(l>s&&c>i)for(lt(t,!0);l>s&&(i=nr[s][0],o=jt(i),a=qt(nr[s][1]),rn.fillRect(o,a,Nn,Nn),!(i>=c));s++);}}function st(e,t){var n=t?.5:1;switch(e){case 0:rn.strokeStyle="rgba(160,00,0,"+n+")";break;case 1:rn.strokeStyle="rgba(44,160,0,"+n+")";break;case 2:rn.strokeStyle="rgba(44,0,160,"+n+")";break;default:rn.strokeStyle="rgba(44,0,160,"+n+")"}}function lt(e,t){var n=t?.4:1;switch(e){case 0:rn.fillStyle="rgba(160,00,0,"+n+")";break;case 1:rn.fillStyle="rgba(44,160,0,"+n+")";break;case 2:rn.fillStyle="rgba(44,0,160,"+n+")";break;default:rn.fillStyle="rgba(44,0,160,"+n+")"}}function ut(e){Ln=e.length,pt(e),y(nr.length),P()}function ct(e){ft(e),y(nr.length),P()}function dt(e){var t=nr.length,n=(t+Fn)*Dn,r=[n,e];nr.push(r),y(nr.length),P()}function ht(e){nr.push(e),y(nr.length),P()}function pt(e){if("[object Array]"===Object.prototype.toString.call(e[0])){for(var t=0;t<e.length;t++)nr=In[t],nr.push.apply(nr,[e[t]]),In[t]=nr;nr=In[0]}else nr.push.apply(nr,e),In=[nr]}function ft(e){var t,n;if("[object Array]"===Object.prototype.toString.call(e[0])){for(n=0;n<e.length;n++)In[n]||In.push([]),nr=In[n],t=nr.length*Dn,nr.push.apply(nr,b(e[n],Dn,t)),In[n]=nr;nr=In[0]}else for(n=0;n<e.length;n++)In[n]||In.push([]),t=In[n].length*Dn,In[n].push([t,e[n]])}function mt(e){function t(e){var t=[];return e.forEach(function(e){t.push(e)}),t}if(In=[],e&&0!==e.length)if("[object Array]"===Object.prototype.toString.call(e[0])){for(var n=0;n<e.length;n++)In.push(t(e[n]));nr=In[0]}else nr=e,In=[t(nr)];else nr=[],In=[nr];y(nr.length-1),M()}function gt(e,t,n){if(In=[],"[object Array]"===Object.prototype.toString.call(e[0])){for(var r=0;r<e.length;r++)In.push(b(e[r],t,n));nr=In[0]}else nr=b(e,t,n),In=[nr];Dn=t,Fn=n}function vt(e){gt(e,Dn,Fn)}function yt(e){nr.length&&(nr.splice(e,1),Bn>=nr.length&&(Bn=nr.length-1))}function bt(){Nt.node().addEventListener("keydown",function(e){if(!er)return!1;if("keydown"===e.type){switch(e.keyCode){case 8:case 46:if(r.dataChange){var t=nr.indexOf(er);yt(t),er=nr.length?nr[t>0?t-1:0]:null,k()}e.preventDefault(),e.stopPropagation()}e.preventDefault()}})}function xt(){r.title&&Dt&&Dt.text(r.title),Tt()}function wt(){r.xlabel&&Ft&&Ft.text(r.xlabel),Tt()}function _t(){r.ylabel&&Vt?Vt.text(r.ylabel):Vt.style("display","none"),Tt()}function Tt(){l(),void 0===Nt?T():A(),r.showButtons&&(Zt||w(),_()),S()}function At(e,t,n){return arguments.length?o(e,t,n):o(),Tt(),Tt(),S(),bt(),Un}function Ct(e,t){return s(e,t),a(),Tt(),S(),Un}var Et,St,kt,Pt,Rt,Ot,Mt,Nt,It,Lt,Bt,Dt,Ft,Vt,Gt,$t,Ut,jt,qt,Wt,Ht,zt,Xt,Yt,Kt,Jt,Zt,Qt,en,tn,nn,rn,on,an,sn,ln,un,cn,dn,hn,pn,fn,mn,gn,vn,yn,bn,xn,wn,_n,Tn,An,Cn,En,Sn,kn,Pn,Rn,On,Mn,Nn,In,Ln,Bn,Dn,Fn,Vn,Gn,$n,Un={},jn=function(e){return e?"#ccc":"#666"},qn=function(e){return"translate("+jt(e)+",0)"},Wn=function(e){return"translate(0,"+qt(e)+")"},Hn=[],zn="rgba(255,255,255, 0.0)",Xn=!1,Yn=d3.ease("cubic"),Kn={category:"medium",value:3,icon:120,tiny:240,small:480,medium:960,large:1920},Jn=0/0,Zn=0/0,Qn=null,er=null,tr=[],nr=[],rr={showButtons:!0,responsiveLayout:!1,fontScaleRelativeToParent:!0,enableAutoScaleButton:!0,enableAxisScaling:!0,dataType:"points",dataPoints:[],dataSamples:[],sampleInterval:1,dataSampleStart:0,title:"graph",xlabel:"x-axis",ylabel:"y-axis",xmax:10,xmin:0,ymax:10,ymin:0,xTickCount:10,yTickCount:10,xFormatter:".3s",yFormatter:".3s",xscale:"linear",yscale:"linear",xscaleExponent:.5,yscaleExponent:.5,axisShift:10,markAllDataPoints:!1,markNearbyDataPoints:!1,extraCirclesVisibleOnHover:2,showRulersOnSelection:!1,lineWidth:2,dataChange:!1,addData:!1,notification:!1,lines:!0,bars:!1},ir={xmin:null,xmax:null,ymin:null,ymax:null},or=!1,ar=!1,sr=!0;return Un={update:k,repaint:Tt,reset:At,redraw:S,resize:Ct,notify:x,selectionDomain:Y,selectionVisible:J,selectionListener:Q,selectionEnabled:Z,hasSelection:K,brushElement:function(){return Gn},brushControl:function(){return $n},brushListener:function(){return et},scale:s,updateOrRescale:P,xDomain:function(e){return arguments.length?(r.xmin=e[0],r.xmax=e[1],m&&(m(),S()),Un):[r.xmin,r.xmax]},yDomain:function(e){return arguments.length?(r.ymin=e[0],r.ymax=e[1],g&&(g(),S()),Un):[r.ymin,r.ymax]},xmin:function(e){return arguments.length?(r.xmin=e,r.xrange=r.xmax-r.xmin,m&&(m(),S()),Un):r.xmin},xmax:function(e){return arguments.length?(r.xmax=e,r.xrange=r.xmax-r.xmin,m&&(m(),S()),Un):r.xmax},ymin:function(e){return arguments.length?(r.ymin=e,r.yrange=r.ymax-r.ymin,g&&(g(),S()),Un):r.ymin},ymax:function(e){return arguments.length?(r.ymax=e,r.yrange=r.ymax-r.ymin,g&&(g(),S()),Un):r.ymax},xLabel:function(e){return arguments.length?(r.xlabel=e,wt(),Un):r.xlabel},yLabel:function(e){return arguments.length?(r.ylabel=e,_t(),Un):r.ylabel},title:function(e){return arguments.length?(r.title=e,xt(),Un):r.title},width:function(e){return arguments.length?(Mt.width=e,Un):Mt.width},height:function(e){return arguments.length?(Mt.height=e,Un):Mt.height},elem:function(e){return arguments.length?(Et=d3.select(e),graph(Et),Un):Et},numberOfPoints:function(){return nr?nr.length:!1},addPoints:ut,addPoint:ht,resetPoints:mt,addSamples:ct,addSample:dt,resetSamples:vt},o(e,r,i),St&&(Tt(),Tt()),Un}}),define("common/controllers/graph-controller",["require","grapher/core/graph","common/controllers/interactive-metadata","common/validator"],function(e){var t=e("grapher/core/graph"),n=e("common/controllers/interactive-metadata"),r=e("common/validator"),i={title:"title",enableAutoScaleButton:"enableAutoScaleButton",enableAxisScaling:"enableAxisScaling",dataPoints:"dataPoints",markAllDataPoints:"markAllDataPoints",showRulersOnSelection:"showRulersOnSelection",fontScaleRelativeToParent:"fontScaleRelativeToParent",xlabel:"xlabel",xmin:"xmin",xmax:"xmax",ylabel:"ylabel",ymin:"ymin",ymax:"ymax",lineWidth:"lineWidth",xTickCount:"xTickCount",yTickCount:"yTickCount",xscaleExponent:"xscaleExponent",yscaleExponent:"yscaleExponent",xFormatter:"xFormatter",yFormatter:"yFormatter",lines:"lines",bars:"bars"},o=0;
return function(e,a){function s(){T=a.getScriptingAPI(),_=a.getModel(),e=r.validateCompleteness(n.graph,e),A=e.properties.slice(),b=$("<div>").attr("id",e.id).addClass("graph"),b.addClass("component"),b.css({width:e.width,height:e.height}),e.tooltip&&b.attr("title",e.tooltip)}function l(){var t,n,r,i=[];for(r=_.get(e.xProperty),t=0,n=A.length;n>t;t++)i.push([r,_.get(A[t])]);return i}function u(){var t,n,r={};for(t in i)i.hasOwnProperty(t)&&(n=i[t],r[n]=e[t]);return r}function c(){var t,n=l();if(e.streamDataFromModel){for(t=0;t<n.length;t++)E[t]=[n[t]];x.resetPoints(E)}else{for(t=0;t<n.length;t++)E[t]=[];x.resetPoints()}x.repaint()}function d(){var e,t=l();for(e=0;e<t.length;e++)E[e].push(t[e]);x.addPoints(t)}function h(){var e;for(e=0;e<A.length;e++)E[e].length=_.stepCounter()+1;x.resetPoints(E)}function p(){x.updateOrRescale(_.stepCounter())}function f(){x.reset("#"+e.id,u())}function m(){e.streamDataFromModel&&(_.on("tick."+S,d),_.on("stepBack."+S,p),_.on("stepForward."+S,p),_.on("seek."+S,p),_.on("play."+S,function(){x.numberOfPoints()&&_.stepCounter()<x.numberOfPoints()&&h()}),_.on("invalidation."+S,function(){h()}),_.on("reset."+S,y))}function g(){C&&(_.removePropertyDescriptionObserver(C,v),C=null),e.ylabel||1!==A.length||(C=A[0],v(),_.addPropertyDescriptionObserver(C,v))}function v(){var e=_.getPropertyDescription(C);x.yLabel(e.getLabel()+" ("+e.getUnitAbbreviation()+")")}function y(){x?e.clearDataOnReset&&(c(),e.resetAxesOnReset&&f()):x=new t(b[0],u(),void 0,a.getNextTabIndex()),g()}var b,x,w,_,T,A,C,E=[],S="graphController"+ ++o;return w={type:"graph",modelLoadedCallback:function(){_=a.getModel(),T=a.getScriptingAPI(),x?f():x=new t(b[0],u(),void 0,a.getNextTabIndex()),c(),m(),g(),x.repaint()},appendDataPropertiesToComponent:d,addDataSet:function(e){E.push(e)},clearDataSets:function(){E.length=A.length},setAttributes:function(t){x&&($.extend(e,t),c(),t.dataPoints&&(E=t.dataPoints),f()),g()},syncAxisRangesToPropertyRanges:function(){var t,n,r=_.getPropertyDescription(e.xProperty),i=A.map(function(e){return _.getPropertyDescription(e)});r&&null!=r.getMin()&&null!=r.getMax()&&x.xDomain([r.getMin(),r.getMax()]),t=1/0,n=-1/0,i.forEach(function(e){e&&(e.getMin()<t&&(t=e.getMin()),e.getMax()>n&&(n=e.getMax()))}),isFinite(t)&&isFinite(n)&&x.yDomain([t,n])},scrollXAxisToZero:function(){var e=x.xmin(),t=x.xmax();(e>0||0>t)&&x.xDomain([0,t-e])},getView:function(){return x},getViewContainer:function(){return b},resize:function(){x&&x.resize()},reset:function(){x&&f()},update:function(){x&&x.update()},serialize:function(){var t=$.extend(!0,{},e),n=x.xDomain(),r=x.yDomain(),i=e.xmin;return t.ymin=r[0],t.ymax=r[1],t.xmin=i,t.xmax=i+n[1]-n[0],t}},s(),w}}),define("import-export/dg-exporter",["require","common/console"],function(e){var t=e("common/console");return{gameName:"Next Gen MW",parentCollectionName:"Summary of Run",childCollectionName:"Time Series of Run",perRunColumnLabelCount:0,perRunColumnLabelPositions:{},mockDGController:{doCommand:function(e){return t.log("action: ",e.action),t.log("args: ",e.args),{caseID:0}}},isDgGameControllerDefined:function(){return Lab.config.dataGamesProxyPrefix?!!(window.parent&&window.parent.DG&&window.parent.DG.currGameController):!1},canExportData:function(){return this.isDgGameControllerDefined()},getDGGameController:function(){return this.isDgGameControllerDefined()?window.parent.DG.currGameController:this.mockDGController},doCommand:function(e,t){var n=this.getDGGameController();return n.doCommand({action:e,args:t})},exportData:function(e,t,n,r){var i,o,a,s,l,u,c=[],d=[],h=[];for(u=0;u<t.length;u++)i=e[u],o=t[u],null==this.perRunColumnLabelPositions[i]&&(this.perRunColumnLabelPositions[i]=this.perRunColumnLabelCount++),a=this.perRunColumnLabelPositions[i],c[a]={name:i},d[a]=o;for(u=0;u<n.length;u++)h.push({name:n[u]});this.doCommand("initGame",{name:this.gameName}),this.doCommand("createCollection",{name:this.parentCollectionName,attrs:c,childAttrName:"contents"}),this.doCommand("createCollection",{name:this.childCollectionName,attrs:h}),s=this.doCommand("openCase",{collection:this.parentCollectionName,values:d}),this.doCommand("createCases",{collection:this.childCollectionName,values:r,parent:s.caseID}),this.doCommand("closeCase",{collection:this.parentCollectionName,values:l,caseID:s.caseID})},openTable:function(){this.doCommand("createComponent",{type:"DG.TableView",log:!1})},logAction:function(e){this.doCommand("logAction",{formatStr:e})}}}),define("common/controllers/basic-dialog",[],function(){function e(e){this.$element=$("<div>"),this.$element.dialog($.extend({},t,e))}var t={autoOpen:!1,dialogClass:"interactive-dialog",appendTo:"#responsive-content",width:"80%"};return e.prototype.open=function(){this.$element.dialog("open")},e.prototype.set=function(e,t){this.$element.dialog("option",e,t)},e.prototype.setContent=function(e){this.$element.empty(),this.$element.append('<input type="hidden" autofocus="autofocus" />'),this.$element.append(e)},e}),define("common/controllers/export-controller",["require","import-export/dg-exporter","common/controllers/basic-dialog","underscore"],function(e){function t(e,t){var n=new r({width:"60%",modal:!0,buttons:t});n.setContent(e),n.open()}var n=e("import-export/dg-exporter"),r=e("common/controllers/basic-dialog"),i=e("underscore"),o=function(e,r){function a(){var e,t,n=[];for(e=0,t=E.length;t>e;e++)n.push(_.get(E[e]));return n}function s(){x=[a()]}function l(){x.push(a()),k=!0}function u(){x.length=_.stepCounter()+1}function c(e,t,n){var r,a="User "+e+".";t&&(r={fields:t.perRunPropertyLabels,values:t.perRunPropertyValues}),n&&(r=i.extend(r||{},n)),r&&(a+=" Per-run Settings and Data: ",a+=JSON.stringify(r)),o.logAction(a)}function d(){return o.canExportData()&&k}function h(e){var n,r;t("<p>You're setting up a new run without saving your data. Please indicate why:</p><form id='export-alert-form'>  <p><input type='radio' name='reason' value='trying-things-out'>I'm just trying things out.</input></p>  <p><input type='radio' name='reason' value='strange-data'>The data looks strange.</input></p>  <p><input type='radio' name='reason' value='making-adjustments'>I'm making adjustments before collecting data.</input></p>  <p><input type='radio' name='reason' value='other'>Other</input></p>  <label class='lab-disabled'><em>Please explain &quot;other&quot; responses below</em></label>  <textarea disabled class='lab-disabled' rows='4' style='width:100%'></textarea></form>",{OK:function(){c("discarded data",y(),{reasonCode:$(this).find("input[name=reason]:checked").val(),reasonText:$(this).find("textarea").val()}),$(this).remove(),e.proceed()},Cancel:function(){$(this).remove(),e.cancel()}}),r=$("#export-alert-form label"),n=$("#export-alert-form textarea"),$("#export-alert-form input[name=reason]").on("change",function(){var e="other"===$("#export-alert-form input[name=reason]:checked").val();r.toggleClass("lab-disabled",!e),n.toggleClass("lab-disabled",!e).prop("disabled",!e),e&&n.focus()})}function p(){if(!A)return[];var e=y(),t=[];return e.perRunPropertyValues.forEach(function(e,n){var r=A.perRunPropertyValues[n];e!==r&&t.push({field:A.perRunPropertyLabels[n],valueAtStart:r,valueExported:e})}),t}function f(){_.on("tick.exportController",l),_.on("reset.exportController",s),_.on("play.exportController",function(){u(),c("started the model",y()),A||(A=y())}),_.on("invalidation.exportController",u),_.on("willReset.exportController",function(){T=y()})}function m(e,t){return e===_&&d()?(h(t),!0):!1}function g(){r.on("modelLoaded",function(e){v("modelLoaded",e)}),r.on("modelReset",function(e){v("modelReset",e)}),r.on("willResetModel",m)}function v(e,t){"modelLoaded"===e?"reload"===t?c("reloaded the model",T):c("loaded a model"):"modelReset"===e&&("new-run"===t?c("set up a new run",T):c("reset the model",T)),A=null,T=null,k=!1}function y(){var e={};e.perRunPropertyLabels=[],e.perRunPropertyValues=[];for(var t=0;t<C.length;t++)e.perRunPropertyLabels[t]=b(C[t]),e.perRunPropertyValues[t]=_.get(C[t]);return e}function b(e){var t=_.getPropertyDescription(e),n=t.getLabel(),r=t.getUnitAbbreviation(),i="";return i+=n.length>0?n:e,r&&r.length>0&&(i+=" (",i+=r,i+=")"),i}var x,w,_,T,A,C=(e.perRun||[]).slice(),E=["displayTime"].concat(e.perTick.slice()),S=1,k=!1;return _=r.getModel(),g(),w={modelLoadedCallback:function(){_=r.getModel(),s(),f()},canExportData:function(){return o.canExportData()},isUnexportedDataPresent:function(){return k},exportData:function(){var e,t,r=[],i=[],o=[];for(e=p(),c("exported the model",y(),{changedParameters:e}),e.length>0&&c("changed parameters between start and export",null,{changedParameters:e}),r[0]="Run",i[0]=S++,t=0;t<C.length;t++)r[t+1]=b(C[t]),i[t+1]=_.get(C[t]);for(t=0;t<E.length;t++)o[t]=b(E[t]);n.exportData(r,i,o,x),n.openTable(),k=!1}}};return o.canExportData=function(){return n.canExportData()},o.logAction=function(){n.logAction.apply(n,arguments)},o}),define("common/controllers/scripting-api",["require","common/alert"],function(e){var t=e("common/alert"),n=0;return function(e){function r(e){o.on("reset.common-scripting-api-"+n++,e)}function i(){o=e.getModel()}var o,a={api:function(){function n(e){return"number"==typeof e&&parseFloat(e)===parseInt(e,10)}function i(e){return"object"==typeof e&&e.slice===Array.prototype.slice}function a(e){return e?Math.random()*e:Math.random()}function s(e){return Math.floor(Math.random()*e)}function l(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function u(e,t){var n,r=[];for(n=0;t>n;n++)r[n]=n;for(n=0;e>n;n++)l(r,n,n+s(t-n));return r.length=e,r}function c(e,t,n){var r;"undefined"!=typeof _gaq&&(r=_gaq,e||(e="Interactive"),r.push(["_trackEvent",e,t,n]))}return{isInteger:n,isArray:i,randomInteger:s,randomFloat:a,swapElementsOfArray:l,choose:u,deg2rad:Math.PI/180,rad2deg:180/Math.PI,trackEvent:c,format:d3.format,get:function(){return o.get.apply(o,arguments)},set:function(){return o.set.apply(o,arguments)},freeze:function(){return o.freeze.apply(o,arguments)},unfreeze:function(){return o.unfreeze.apply(o,arguments)},loadModel:function(t){o.stop(),e.loadModel(t,null)},getLoadedModelId:function(){return e.getLoadedModelId()},onPropertyChange:function(e,t){o.addPropertiesListener([e],function(){t(o.get(e))})},callAt:function(e,t){function n(){o.properties.time>=e&&(t(),a())}function i(){o.addObserver("time",n)}function a(){o.removeObserver("time",n)}r(i),i()},callEvery:function(e,t){function n(){for(;o.properties.time-a>=e;)t(),a+=e}function i(){a=0}var a=0;o.addObserver("time",n),r(i)},onClick:function(t,n){e.modelController.modelContainer.setClickHandler("."+t,n)},onDrag:function(t,n){e.modelController.modelContainer.setDragHandler(t,n)},onSelect:function(t){e.modelController.modelContainer.setSelectHandler(t)},setComponentDisabled:function(t,n){e.getComponent(t).setDisabled(n)},appendDataPropertiesToComponent:function(t){var n=e.getComponent(t);void 0!==n&&n.appendDataPropertiesToComponent()},setComponentAttributes:function(t,n){var r=e.getComponent(t);void 0!==r&&r.setAttributes(n)},getComponentData:function(t,n){var r=e.getComponent(t);return void 0!==r&&r.getData?r.getData(n):void 0},syncAxisRangesToPropertyRanges:function(t){var n=e.getComponent(t);if(!n)throw new Error("Component "+t+" not found.");if(!n.syncAxisRangesToPropertyRanges)throw new Error("Component "+t+" does not support syncAxisRangesToPropertyRanges.");n.syncAxisRangesToPropertyRanges()},scrollXAxisToZero:function(t){var n=e.getComponent(t);if(!n)throw new Error("Component "+t+" not found.");if(!n.syncAxisRangesToPropertyRanges)throw new Error("Component "+t+" does not support scrollXAxisToZero.");n.scrollXAxisToZero()},start:function(){o.start(),c("Interactive","Start","Starting interactive: "+e.get("title"))},onStart:function(e){o.on("play.custom-script",e)},stop:function(){o.stop()},onStop:function(e){o.on("stop.custom-script",e)},reset:function(t){e.resetModel(t)},reload:function(){e.reloadModel()},stepForward:function(){o.stepForward(),o.isNewStep()||e.updateModelView()},stepBack:function(){o.stepBack(),e.updateModelView()},tick:function(){o.tick()},isStopped:function(){return o.isStopped()},getTime:function(){return o.get("time")},getFPS:function(){return o.getFPS()},getSimulationProgressRate:function(){return o.getSimulationProgressRate()},startPerformanceTuning:function(){o.performanceOptimizer.enable()},repaint:function(){e.repaintModelView()},canExportData:function(){var t=e.getDGExportController();return t&&t.canExportData()||!1},isUnexportedDataPresent:function(){var t=e.getDGExportController();return t&&t.isUnexportedDataPresent()||!1},exportData:function(){var t=e.getDGExportController();if(!t||!t.canExportData())throw new Error("No exports have been specified.");t.exportData()},Math:Math,undefined:void 0,alert:t,console:null!==window.console?window.console:{log:function(){},error:function(){},warn:function(){},dir:function(){}}}}(),freeze:function(){Object.freeze(this.api)},extend:function(e){$.extend(this.api,new e(this.api,o))},exposeScriptingAPI:function(){window.script=$.extend({},this.api),window.script.run=function(e,t){var n,r=[],i=[];for(n in t)t.hasOwnProperty(n)&&(r.push(n),i.push(t[n]));return a.makeFunctionInScriptContext.apply(null,r.concat(e)).apply(null,i)}},makeFunctionInScriptContext:function(){function e(){var e,t,n,r,i=Object.getOwnPropertyNames(window);for(t=0,n=i.length;n>t;t++)e=i[t],o.hasOwnProperty(e)||(r=function(e){return function(){throw new ReferenceError(e+" is not defined")}}(e),Object.defineProperty(o,e,{set:r,get:r}))}var n,r,i,o={},s=Array.prototype.slice.call(arguments,0,arguments.length-1),l=arguments[arguments.length-1];"string"!=typeof l&&(l=l.join("      \n")),n="with (shadowedGlobals) {\n  with (scriptingAPI) {\n    return function("+s.join(",")+") {\n      'use strict';\n      "+l+"\n    };\n  }\n}";try{r=new Function("shadowedGlobals","scriptingAPI",n),i=r(o,a.api)}catch(u){return t('Error compiling script: "'+u.toString()+'"\nScript:\n\n'+l),function(){throw new Error("Cannot run a script that could not be compiled")}}return function(){e();try{return i.apply(null,Array.prototype.slice.call(arguments))}catch(n){t('Error running script: "'+n.toString()+'"\nScript:\n\n'+l)}}}};return i(),e.on("modelLoaded",i),a}}),define("common/inherit",[],function(){return function(e,t){function n(){}n.prototype=t.prototype,e.prototype=new n,e.superClass=t.prototype,e.prototype.constructor=e}}),define("common/views/view-state",[],function(){return{disableView:function(e){e.hasClass("lab-disabled")||(e.addClass("lab-disabled"),e.append('<div class="lab-disabled-overlay"/>'))},enableView:function(e){e.removeClass("lab-disabled"),e.find(".lab-disabled-overlay").remove()}}}),define("common/controllers/disablable",["common/views/view-state"],function(){var e=require("common/views/view-state"),t=e.enableView,n=e.disableView;return function(e,r){e.setDisabled=function(e){var r=this.getViewContainer();e?(n(r),this.isDisabled=!0):(t(r),this.isDisabled=!1)},e.isDisabled=!1,r&&e.setDisabled(r.disabled)}}),define("common/controllers/interactive-component",["require","common/controllers/interactive-metadata","common/validator","common/controllers/disablable"],function(e){function t(e,t,i){this._interactivesController=i,this._scriptingAPI=this._interactivesController.getScriptingAPI(),this._model=this._interactivesController.getModel(),this.component=r.validateCompleteness(n[e],t),this.$element=$("<div>").attr("id",t.id).addClass("component"),this.component.width&&this.$element.css("width",this.component.width),this.component.height&&this.$element.css("height",this.component.height),this.component.disabled&&this.setDisabled(this.component.disabled),this._optionallyAddOnClickHandlers(),this.component.classes&&this.component.classes.length&&this.$element.addClass(this.component.classes.join(" ")),this.component.tooltip&&this.$element.attr("title",this.component.tooltip)}var n=e("common/controllers/interactive-metadata"),r=e("common/validator"),i=e("common/controllers/disablable");return t.prototype._modelLoadedCallback=function(){this._scriptingAPI=this._interactivesController.getScriptingAPI(),this._model=this._interactivesController.getModel(),this._optionallyAddOnClickHandlers()},t.prototype._updateClickHandler=function(e){this.$element.off("click."+this._nameSpace),this._actionClickFunction="function"!=typeof e?this._scriptingAPI.makeFunctionInScriptContext(e):e;var t=this;this.$element.on("click."+this._nameSpace,this._clickTargetSelector||null,function(){t._actionClickFunction()}),this.$element.addClass("clickable")},t.prototype._optionallyAddOnClickHandlers=function(){void 0!==this.component.onClick&&this._updateClickHandler(this.component.onClick),void 0!==this.component.action&&this._updateClickHandler(this.component.action)},t.prototype.setAction=function(e){"function"!=typeof script&&(this.component.action=e),this._updateClickHandler(e)},t.prototype.setOnClick=function(e){void 0!==this.component.onClick&&(this.component.onClick=e,this._updateClickHandler(this.component.onClick))},t.prototype.getViewContainer=function(){return this.$element},t.prototype.serialize=function(){return this.component},i(t.prototype),t}),define("common/controllers/button-controller",["common/inherit","common/controllers/interactive-component"],function(){function e(e,t){this._actionClickFunction=function(){},this._nameSpace="button"+ ++r,n.call(this,"button",e,t),this.$element.addClass("interactive-button"),this.button=$("<button>").html(e.text).appendTo(this.$element),this._clickTargetSelector="button"}var t=require("common/inherit"),n=require("common/controllers/interactive-component"),r=0;return t(e,n),e.prototype.modelLoadedCallback=function(){e.superClass._modelLoadedCallback.call(this)},e}),define("common/controllers/checkbox-controller",["common/controllers/interactive-metadata","common/controllers/disablable","common/validator"],function(){var e=require("common/controllers/interactive-metadata"),t=require("common/controllers/disablable"),n=require("common/validator");return function(r,i){function o(){s(v.get(u))}function a(){var e=v.getPropertyDescription(u);g.setDisabled(e.getFrozen())}function s(e){e?(h.prop("checked",!0),p.addClass("checked")):(h.prop("checked",!1),p.removeClass("checked"))}function l(e){e.preventDefault(),h.prop("checked")?s(!1):s(!0),h.trigger("change")}var u,c,d,h,p,f,m,g,v,y;return v=i.getModel(),y=i.getScriptingAPI(),r=n.validateCompleteness(e.checkbox,r),u=r.property,c=r.onClick,d=r.initialValue,f=$("<label>").append("<span>"+r.text+"</span>"),f.attr("for",r.id),h=$('<input type="checkbox">').attr("id",r.id),i&&h.attr("tabindex",i.getNextTabIndex()),p=$('<div class="fakeCheckable">'),h.css("display","none"),m="left"===r.textOn?$("<div>").append(f).append(h).append(p.addClass("right")):$("<div>").append(h).append(p).append(f),m.addClass("interactive-checkbox"),m.addClass("component"),p.on("click",l),f.on("click",l),m.css({width:r.width,height:r.height}),c&&(c=y.makeFunctionInScriptContext("value",c)),h.on("change",function(){var e,t=!1;$(this).is(":checked")&&(t=!0),void 0!==u&&(e={},e[u]=t,v.set(e)),void 0!==c&&c(t)}),r.tooltip&&m.attr("title",r.tooltip),g={modelLoadedCallback:function(){v&&void 0!==u&&(v.removeObserver(u,o),v.removePropertyDescriptionObserver(u,a)),v=i.getModel(),y=i.getScriptingAPI(),c=r.onClick,c&&(c=y.makeFunctionInScriptContext("value",c)),void 0!==u?(v.addPropertiesListener([u],o),v.addPropertyDescriptionObserver(u,a),o()):void 0!==d&&(s(d),c&&c(d))},getViewContainer:function(){return m},serialize:function(){var e=$.extend(!0,{},r);return void 0===u&&(e.initialValue=h.is(":checked")?!0:!1),e}},t(g,r),g}}),function(e){function t(){return"Markdown.mk_block( "+uneval(this.toString())+", "+uneval(this.trailing)+", "+uneval(this.lineNumber)+" )"}function n(){var e=require("util");return"Markdown.mk_block( "+e.inspect(this.toString())+", "+e.inspect(this.trailing)+", "+e.inspect(this.lineNumber)+" )"}function r(e){for(var t=0,n=-1;-1!==(n=e.indexOf("\n",n+1));)t++;return t}function i(e,t){function n(e){this.len_after=e,this.name="close_"+t}var r=e+"_state",i="strong"==e?"em_state":"strong_state";return function(o){if(this[r][0]==t)return this[r].shift(),[o.length,new n(o.length-t.length)];var a=this[i].slice(),s=this[r].slice();this[r].unshift(t);{var l=this.processInline(o.substr(t.length)),u=l[l.length-1];this[r].shift()}if(u instanceof n){l.pop();var c=o.length-u.len_after;return[c,[e].concat(l)]}return this[i]=a,this[r]=s,[t.length,t]}}function o(e){for(var t=e.split(""),n=[""],r=!1;t.length;){var i=t.shift();switch(i){case" ":r?n[n.length-1]+=i:n.push("");break;case"'":case'"':r=!r;break;case"\\":i=t.shift();default:n[n.length-1]+=i}}return n}function s(e){return g(e)&&e.length>1&&"object"==typeof e[1]&&!g(e[1])?e[1]:void 0}function l(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function u(e){if("string"==typeof e)return l(e);var t=e.shift(),n={},r=[];for(!e.length||"object"!=typeof e[0]||e[0]instanceof Array||(n=e.shift());e.length;)r.push(u(e.shift()));var i="";for(var o in n)i+=" "+o+'="'+l(n[o])+'"';return"img"==t||"br"==t||"hr"==t?"<"+t+i+"/>":"<"+t+i+">"+r.join("")+"</"+t+">"}function c(e,t,n){var r;n=n||{};var i=e.slice(0);"function"==typeof n.preprocessTreeNode&&(i=n.preprocessTreeNode(i,t));var o=s(i);if(o){i[1]={};for(r in o)i[1][r]=o[r];o=i[1]}if("string"==typeof i)return i;switch(i[0]){case"header":i[0]="h"+i[1].level,delete i[1].level;break;case"bulletlist":i[0]="ul";break;case"numberlist":i[0]="ol";break;case"listitem":i[0]="li";break;case"para":i[0]="p";break;case"markdown":i[0]="html",o&&delete o.references;break;case"code_block":i[0]="pre",r=o?2:1;var a=["code"];a.push.apply(a,i.splice(r,i.length-r)),i[r]=a;break;case"inlinecode":i[0]="code";break;case"img":i[1].src=i[1].href,delete i[1].href;break;case"linebreak":i[0]="br";break;case"link":i[0]="a";break;case"link_ref":i[0]="a";var l=t[o.ref];if(!l)return o.original;delete o.ref,o.href=l.href,l.title&&(o.title=l.title),delete o.original;break;case"img_ref":i[0]="img";var l=t[o.ref];if(!l)return o.original;delete o.ref,o.src=l.href,l.title&&(o.title=l.title),delete o.original}if(r=1,o){for(var u in i[1]){r=2;break}1===r&&i.splice(r,1)}for(;r<i.length;++r)i[r]=c(i[r],t,n);return i}function d(e){for(var t=s(e)?2:1;t<e.length;)"string"==typeof e[t]?t+1<e.length&&"string"==typeof e[t+1]?e[t]+=e.splice(t+1,1)[0]:++t:(d(e[t]),++t)}var h=e.Markdown=function(e){switch(typeof e){case"undefined":this.dialect=h.dialects.Gruber;break;case"object":this.dialect=e;break;default:if(!(e in h.dialects))throw new Error("Unknown Markdown dialect '"+String(e)+"'");this.dialect=h.dialects[e]}this.em_state=[],this.strong_state=[],this.debug_indent=""};e.parse=function(e,t){var n=new h(t);return n.toTree(e)},e.toHTML=function(t,n,r){var i=e.toHTMLTree(t,n,r);return e.renderJsonML(i)},e.toHTMLTree=function(e,t,n){"string"==typeof e&&(e=this.parse(e,t));var r=s(e),i={};r&&r.references&&(i=r.references);var o=c(e,i,n);return d(o),o};var f=h.mk_block=function(e,r,i){1==arguments.length&&(r="\n\n");var o=new String(e);return o.trailing=r,o.inspect=n,o.toSource=t,void 0!=i&&(o.lineNumber=i),o};h.prototype.split_blocks=function(e){e=e.replace(/(\r\n|\n|\r)/g,"\n");var t,n=/([\s\S]+?)($|\n#|\n(?:\s*\n|$)+)/g,i=[],o=1;for(null!=(t=/^(\s*\n)/.exec(e))&&(o+=r(t[0]),n.lastIndex=t[0].length);null!==(t=n.exec(e));)"\n#"==t[2]&&(t[2]="\n",n.lastIndex--),i.push(f(t[1],t[2],o)),o+=r(t[0]);return i},h.prototype.processBlock=function(e,t){var n=this.dialect.block,r=n.__order__;if("__call__"in n)return n.__call__.call(this,e,t);for(var i=0;i<r.length;i++){var o=n[r[i]].call(this,e,t);if(o)return(!g(o)||o.length>0&&!g(o[0]))&&this.debug(r[i],"didn't return a proper array"),o}return[]},h.prototype.processInline=function(e){return this.dialect.inline.__call__.call(this,String(e))},h.prototype.toTree=function(e,t){var n=e instanceof Array?e:this.split_blocks(e),r=this.tree;try{for(this.tree=t||this.tree||["markdown"];n.length;){var i=this.processBlock(n.shift(),n);i.length&&this.tree.push.apply(this.tree,i)}return this.tree}finally{t&&(this.tree=r)}},h.prototype.debug=function(){var e=Array.prototype.slice.call(arguments);e.unshift(this.debug_indent),"undefined"!=typeof print&&print.apply(print,e),"undefined"!=typeof console&&"undefined"!=typeof console.log&&console.log.apply(null,e)},h.prototype.loop_re_over_block=function(e,t,n){for(var r,i=t.valueOf();i.length&&null!=(r=e.exec(i));)i=i.substr(r[0].length),n.call(this,r);return i},h.dialects={},h.dialects.Gruber={block:{atxHeader:function(e,t){var n=e.match(/^(#{1,6})\s*(.*?)\s*#*\s*(?:\n|$)/);if(!n)return void 0;var r=["header",{level:n[1].length}];return Array.prototype.push.apply(r,this.processInline(n[2])),n[0].length<e.length&&t.unshift(f(e.substr(n[0].length),e.trailing,e.lineNumber+2)),[r]},setextHeader:function(e,t){var n=e.match(/^(.*)\n([-=])\2\2+(?:\n|$)/);if(!n)return void 0;var r="="===n[2]?1:2,i=["header",{level:r},n[1]];return n[0].length<e.length&&t.unshift(f(e.substr(n[0].length),e.trailing,e.lineNumber+2)),[i]},code:function(e,t){var n=[],r=/^(?: {0,3}\t| {4})(.*)\n?/;if(!e.match(r))return void 0;e:for(;;){var i=this.loop_re_over_block(r,e.valueOf(),function(e){n.push(e[1])});if(i.length){t.unshift(f(i,e.trailing));break e}if(!t.length)break e;if(!t[0].match(r))break e;n.push(e.trailing.replace(/[^\n]/g,"").substring(2)),e=t.shift()}return[["code_block",n.join("\n")]]},horizRule:function(e,t){var n=e.match(/^(?:([\s\S]*?)\n)?[ \t]*([-_*])(?:[ \t]*\2){2,}[ \t]*(?:\n([\s\S]*))?$/);if(!n)return void 0;var r=[["hr"]];return n[1]&&r.unshift.apply(r,this.processBlock(n[1],[])),n[3]&&t.unshift(f(n[3])),r},lists:function(){function e(e){return new RegExp("(?:^("+l+"{0,"+e+"} {0,3})("+o+")\\s+)|(^"+l+"{0,"+(e-1)+"}[ ]{0,4})")}function t(e){return e.replace(/ {0,3}\t/g,"    ")}function n(e,t,n,r){if(t)return e.push(["para"].concat(n)),void 0;var i=e[e.length-1]instanceof Array&&"para"==e[e.length-1][0]?e[e.length-1]:e;r&&e.length>1&&n.unshift(r);for(var o=0;o<n.length;o++){var a=n[o],s="string"==typeof a;s&&i.length>1&&"string"==typeof i[i.length-1]?i[i.length-1]+=a:i.push(a)}}function r(e,t){for(var n=new RegExp("^("+l+"{"+e+"}.*?\\n?)*$"),r=new RegExp("^"+l+"{"+e+"}","gm"),i=[];t.length>0&&n.exec(t[0]);){var o=t.shift(),a=o.replace(r,"");i.push(f(a,o.trailing,o.lineNumber))}return i}function i(e,t,n){var r=e.list,i=r[r.length-1];if(!(i[1]instanceof Array&&"para"==i[1][0]))if(t+1==n.length)i.push(["para"].concat(i.splice(1,i.length-1)));else{var o=i.pop();i.push(["para"].concat(i.splice(1,i.length-1)),o)}}var o="[*+-]|\\d+\\.",a=/[*+-]/,s=new RegExp("^( {0,3})("+o+")[ 	]+"),l="(?: {0,3}\\t| {4})";return function(o,l){function u(e){var t=a.exec(e[2])?["bulletlist"]:["numberlist"];return p.push({list:t,indent:e[1]}),t}var c=o.match(s);if(!c)return void 0;for(var d,h,p=[],f=u(c),g=!1,v=[p[0].list];;){for(var y=o.split(/(?=\n)/),b="",x=0;x<y.length;x++){var w="",_=y[x].replace(/^\n/,function(e){return w=e,""}),T=e(p.length);if(c=_.match(T),void 0!==c[1]){b.length&&(n(d,g,this.processInline(b),w),g=!1,b=""),c[1]=t(c[1]);var A=Math.floor(c[1].length/4)+1;if(A>p.length)f=u(c),d.push(f),d=f[1]=["listitem"];else{var C=!1;for(h=0;h<p.length;h++)if(p[h].indent==c[1]){f=p[h].list,p.splice(h+1,p.length-(h+1)),C=!0;break}C||(A++,A<=p.length?(p.splice(A,p.length-A),f=p[A-1].list):(f=u(c),d.push(f))),d=["listitem"],f.push(d)}w=""}_.length>c[0].length&&(b+=w+_.substr(c[0].length))}b.length&&(n(d,g,this.processInline(b),w),g=!1,b="");var E=r(p.length,l);E.length>0&&(m(p,i,this),d.push.apply(d,this.toTree(E,[])));var S=l[0]&&l[0].valueOf()||"";if(!S.match(s)&&!S.match(/^ /))break;o=l.shift();var k=this.dialect.block.horizRule(o,l);if(k){v.push.apply(v,k);break}m(p,i,this),g=!0}return v}}(),blockquote:function(e,t){if(!e.match(/^>/m))return void 0;var n=[];if(">"!=e[0]){for(var r=e.split(/\n/),i=[],o=e.lineNumber;r.length&&">"!=r[0][0];)i.push(r.shift()),o++;var a=f(i.join("\n"),"\n",e.lineNumber);n.push.apply(n,this.processBlock(a,[])),e=f(r.join("\n"),e.trailing,o)}for(;t.length&&">"==t[0][0];){var l=t.shift();e=f(e+e.trailing+l,l.trailing,e.lineNumber)}var u=e.replace(/^> ?/gm,""),c=(this.tree,this.toTree(u,["blockquote"])),d=s(c);return d&&d.references&&(delete d.references,v(d)&&c.splice(1,1)),n.push(c),n},referenceDefn:function(e,t){var n=/^\s*\[(.*?)\]:\s*(\S+)(?:\s+(?:(['"])(.*?)\3|\((.*?)\)))?\n?/;if(!e.match(n))return void 0;s(this.tree)||this.tree.splice(1,0,{});var r=s(this.tree);void 0===r.references&&(r.references={});var i=this.loop_re_over_block(n,e,function(e){e[2]&&"<"==e[2][0]&&">"==e[2][e[2].length-1]&&(e[2]=e[2].substring(1,e[2].length-1));var t=r.references[e[1].toLowerCase()]={href:e[2]};void 0!==e[4]?t.title=e[4]:void 0!==e[5]&&(t.title=e[5])});return i.length&&t.unshift(f(i,e.trailing)),[]},para:function(e){return[["para"].concat(this.processInline(e))]}}},h.dialects.Gruber.inline={__oneElement__:function(e,t,n){var r,i;t=t||this.dialect.inline.__patterns__;var o=new RegExp("([\\s\\S]*?)("+(t.source||t)+")");if(r=o.exec(e),!r)return[e.length,e];if(r[1])return[r[1].length,r[1]];var i;return r[2]in this.dialect.inline&&(i=this.dialect.inline[r[2]].call(this,e.substr(r.index),r,n||[])),i=i||[r[2].length,r[2]]},__call__:function(e,t){function n(e){"string"==typeof e&&"string"==typeof i[i.length-1]?i[i.length-1]+=e:i.push(e)}for(var r,i=[];e.length>0;)r=this.dialect.inline.__oneElement__.call(this,e,t,i),e=e.substr(r.shift()),m(r,n);return i},"]":function(){},"}":function(){},__escape__:/^\\[\\`\*_{}\[\]()#\+.!\-]/,"\\":function(e){return this.dialect.inline.__escape__.exec(e)?[2,e.charAt(1)]:[1,"\\"]},"![":function(e){var t=e.match(/^!\[(.*?)\][ \t]*\([ \t]*([^")]*?)(?:[ \t]+(["'])(.*?)\3)?[ \t]*\)/);if(t){t[2]&&"<"==t[2][0]&&">"==t[2][t[2].length-1]&&(t[2]=t[2].substring(1,t[2].length-1)),t[2]=this.dialect.inline.__call__.call(this,t[2],/\\/)[0];var n={alt:t[1],href:t[2]||""};return void 0!==t[4]&&(n.title=t[4]),[t[0].length,["img",n]]}return t=e.match(/^!\[(.*?)\][ \t]*\[(.*?)\]/),t?[t[0].length,["img_ref",{alt:t[1],ref:t[2].toLowerCase(),original:t[0]}]]:[2,"!["]},"[":function y(e){var t=String(e),n=h.DialectHelpers.inline_until_char.call(this,e.substr(1),"]");if(!n)return[1,"["];var y,r,i=1+n[0],o=n[1];e=e.substr(i);var a=e.match(/^\s*\([ \t]*([^"']*)(?:[ \t]+(["'])(.*?)\2)?[ \t]*\)/);if(a){var s=a[1];if(i+=a[0].length,s&&"<"==s[0]&&">"==s[s.length-1]&&(s=s.substring(1,s.length-1)),!a[3])for(var l=1,u=0;u<s.length;u++)switch(s[u]){case"(":l++;break;case")":0==--l&&(i-=s.length-u,s=s.substring(0,u))}return s=this.dialect.inline.__call__.call(this,s,/\\/)[0],r={href:s||""},void 0!==a[3]&&(r.title=a[3]),y=["link",r].concat(o),[i,y]}return a=e.match(/^\s*\[(.*?)\]/),a?(i+=a[0].length,r={ref:(a[1]||String(o)).toLowerCase(),original:t.substr(0,i)},y=["link_ref",r].concat(o),[i,y]):1==o.length&&"string"==typeof o[0]?(r={ref:o[0].toLowerCase(),original:t.substr(0,i)},y=["link_ref",r,o[0]],[i,y]):[1,"["]},"<":function(e){var t;return null!=(t=e.match(/^<(?:((https?|ftp|mailto):[^>]+)|(.*?@.*?\.[a-zA-Z]+))>/))?t[3]?[t[0].length,["link",{href:"mailto:"+t[3]},t[3]]]:"mailto"==t[2]?[t[0].length,["link",{href:t[1]},t[1].substr("mailto:".length)]]:[t[0].length,["link",{href:t[1]},t[1]]]:[1,"<"]},"`":function(e){var t=e.match(/(`+)(([\s\S]*?)\1)/);return t&&t[2]?[t[1].length+t[2].length,["inlinecode",t[3]]]:[1,"`"]},"  \n":function(){return[3,["linebreak"]]}},h.dialects.Gruber.inline["**"]=i("strong","**"),h.dialects.Gruber.inline.__=i("strong","__"),h.dialects.Gruber.inline["*"]=i("em","*"),h.dialects.Gruber.inline._=i("em","_"),h.buildBlockOrder=function(e){var t=[];for(var n in e)"__order__"!=n&&"__call__"!=n&&t.push(n);e.__order__=t},h.buildInlinePatterns=function(e){var t=[];for(var n in e)if(!n.match(/^__.*__$/)){var r=n.replace(/([\\.*+?|()\[\]{}])/g,"\\$1").replace(/\n/,"\\n");t.push(1==n.length?r:"(?:"+r+")")}t=t.join("|"),e.__patterns__=t;var i=e.__call__;e.__call__=function(e,n){return void 0!=n?i.call(this,e,n):i.call(this,e,t)
}},h.DialectHelpers={},h.DialectHelpers.inline_until_char=function(e,t){for(var n=0,r=[];;){if(e.charAt(n)==t)return n++,[n,r];if(n>=e.length)return null;var i=this.dialect.inline.__oneElement__.call(this,e.substr(n));n+=i[0],r.push.apply(r,i.slice(1))}},h.subclassDialect=function(e){function t(){}function n(){}return t.prototype=e.block,n.prototype=e.inline,{block:new t,inline:new n}},h.buildBlockOrder(h.dialects.Gruber.block),h.buildInlinePatterns(h.dialects.Gruber.inline),h.dialects.Maruku=h.subclassDialect(h.dialects.Gruber),h.dialects.Maruku.processMetaHash=function(e){for(var t=o(e),n={},r=0;r<t.length;++r)if(/^#/.test(t[r]))n.id=t[r].substring(1);else if(/^\./.test(t[r]))n["class"]=n["class"]?n["class"]+t[r].replace(/./," "):t[r].substring(1);else if(/\=/.test(t[r])){var i=t[r].split(/\=/);n[i[0]]=i[1]}return n},h.dialects.Maruku.block.document_meta=function(e){if(e.lineNumber>1)return void 0;if(!e.match(/^(?:\w+:.*\n)*\w+:.*$/))return void 0;s(this.tree)||this.tree.splice(1,0,{});var t=e.split(/\n/);for(p in t){var n=t[p].match(/(\w+):\s*(.*)$/),r=n[1].toLowerCase(),i=n[2];this.tree[1][r]=i}return[]},h.dialects.Maruku.block.block_meta=function(e){var t=e.match(/(^|\n) {0,3}\{:\s*((?:\\\}|[^\}])*)\s*\}$/);if(!t)return void 0;var n,r=this.dialect.processMetaHash(t[2]);if(""===t[1]){var i=this.tree[this.tree.length-1];if(n=s(i),"string"==typeof i)return void 0;n||(n={},i.splice(1,0,n));for(a in r)n[a]=r[a];return[]}var o=e.replace(/\n.*$/,""),l=this.processBlock(o,[]);n=s(l[0]),n||(n={},l[0].splice(1,0,n));for(a in r)n[a]=r[a];return l},h.dialects.Maruku.block.definition_list=function(e,t){var n,r,i=/^((?:[^\s:].*\n)+):\s+([\s\S]+)$/,o=["dl"];if(!(r=e.match(i)))return void 0;for(var a=[e];t.length&&i.exec(t[0]);)a.push(t.shift());for(var s=0;s<a.length;++s){var r=a[s].match(i),l=r[1].replace(/\n$/,"").split(/\n/),u=r[2].split(/\n:\s+/);for(n=0;n<l.length;++n)o.push(["dt",l[n]]);for(n=0;n<u.length;++n)o.push(["dd"].concat(this.processInline(u[n].replace(/(\n)\s+/,"$1"))))}return[o]},h.dialects.Maruku.block.table=function b(e){var t,n,r=function(e,t){t=t||"\\s",t.match(/^[\\|\[\]{}?*.+^$]$/)&&(t="\\"+t);for(var n,r=[],i=new RegExp("^((?:\\\\.|[^\\\\"+t+"])*)"+t+"(.*)");n=e.match(i);)r.push(n[1]),e=n[2];return r.push(e),r},i=/^ {0,3}\|(.+)\n {0,3}\|\s*([\-:]+[\-| :]*)\n((?:\s*\|.*(?:\n|$))*)(?=\n|$)/,o=/^ {0,3}(\S(?:\\.|[^\\|])*\|.*)\n {0,3}([\-:]+\s*\|[\-| :]*)\n((?:(?:\\.|[^\\|])*\|.*(?:\n|$))*)(?=\n|$)/;if(n=e.match(i))n[3]=n[3].replace(/^\s*\|/gm,"");else if(!(n=e.match(o)))return void 0;var b=["table",["thead",["tr"]],["tbody"]];n[2]=n[2].replace(/\|\s*$/,"").split("|");var a=[];for(m(n[2],function(e){e.match(/^\s*-+:\s*$/)?a.push({align:"right"}):e.match(/^\s*:-+\s*$/)?a.push({align:"left"}):e.match(/^\s*:-+:\s*$/)?a.push({align:"center"}):a.push({})}),n[1]=r(n[1].replace(/\|\s*$/,""),"|"),t=0;t<n[1].length;t++)b[1][1].push(["th",a[t]||{}].concat(this.processInline(n[1][t].trim())));return m(n[3].replace(/\|\s*$/gm,"").split("\n"),function(e){var n=["tr"];for(e=r(e,"|"),t=0;t<e.length;t++)n.push(["td",a[t]||{}].concat(this.processInline(e[t].trim())));b[2].push(n)},this),[b]},h.dialects.Maruku.inline["{:"]=function(e,t,n){if(!n.length)return[2,"{:"];var r=n[n.length-1];if("string"==typeof r)return[2,"{:"];var i=e.match(/^\{:\s*((?:\\\}|[^\}])*)\s*\}/);if(!i)return[2,"{:"];var o=this.dialect.processMetaHash(i[1]),a=s(r);a||(a={},r.splice(1,0,a));for(var l in o)a[l]=o[l];return[i[0].length,""]},h.dialects.Maruku.inline.__escape__=/^\\[\\`\*_{}\[\]()#\+.!\-|:]/,h.buildBlockOrder(h.dialects.Maruku.block),h.buildInlinePatterns(h.dialects.Maruku.inline);var m,g=Array.isArray||function(e){return"[object Array]"==Object.prototype.toString.call(e)};m=Array.prototype.forEach?function(e,t,n){return e.forEach(t,n)}:function(e,t,n){for(var r=0;r<e.length;r++)t.call(n||e,e[r],r,e)};var v=function(e){for(var t in e)if(hasOwnProperty.call(e,t))return!1;return!0};e.renderJsonML=function(e,t){t=t||{},t.root=t.root||!1;var n=[];if(t.root)n.push(u(e));else for(e.shift(),!e.length||"object"!=typeof e[0]||e[0]instanceof Array||e.shift();e.length;)n.push(u(e.shift()));return n.join("\n\n")}}(function(){return"undefined"==typeof exports?(window.markdown={},window.markdown):exports}()),define("markdown",function(e){return function(){var t;return t||e.markdown}}(this)),define("common/markdown-to-html",["require","markdown"],function(e){var t=e("markdown"),n='class="opens-in-new-window" target="blank"';return function(e){var r,i="";return $.isArray(e)||(e=[e]),e.forEach(function(e){i+=e+"\n"}),r='<div class="markdown-typography">'+t.toHTML(i)+"</div>",r.replace(/<a(.*?)>/g,"<a$1 "+n+">")}}),define("common/controllers/text-controller",["require","common/markdown-to-html","common/inherit","common/controllers/interactive-component"],function(e){function t(e,t){i.call(this,"text",e,t),this.$element.addClass("interactive-text"),this.$element.append(n(this.component.text))}var n=e("common/markdown-to-html"),r=e("common/inherit"),i=e("common/controllers/interactive-component");return r(t,i),t.prototype.modelLoadedCallback=function(){t.superClass._modelLoadedCallback.call(this)},t}),define("common/controllers/image-controller",["require","lab.config","common/inherit","common/controllers/interactive-component"],function(e){function t(e,t){var n="undefined"!=typeof Lab?Lab.config.actualRoot:"";i.call(this,"image",e,t),this._controller=t,this._$img=$("<img>"),this._externalUrl=o.test(this.component.src),this._resourcesUrl=a.test(this.component.src),this._externalUrl?this._$img.attr("src",this.component.src):this._resourcesUrl&&this._$img.attr("src",this.component.src.replace(a,n+"/resources/")),"auto"!==this.component.width&&this._$img.css("width","100%"),"auto"!==this.component.height&&this._$img.css("height","100%"),this._$img.appendTo(this.$element)}var n=e("lab.config"),r=e("common/inherit"),i=e("common/controllers/interactive-component"),o=/^https?:\/\//i,a=/^{resources}\//i;return r(t,i),t.prototype.modelLoadedCallback=function(){var e,t;this._externalUrl||(e=this.component.src,t=this._controller.modelController.modelUrl,t=t.slice(0,t.lastIndexOf("/")+1),e=n.actualRoot+t+e,this._$img.attr("src",e))},t}),define("common/controllers/radio-controller",["common/controllers/interactive-metadata","common/validator","common/controllers/disablable"],function(){var e=require("common/controllers/interactive-metadata"),t=require("common/validator"),n=require("common/controllers/disablable");return function(r,i){function o(){var e,t,n=p.get(r.property),o=i.getLoadedModelId();for(e=0,t=h.length;t>e;e++){if(void 0===h[e].value&&!h[e].loadModel)return;void 0!==h[e].value&&h[e].value===n||h[e].loadModel===o?(m[e].attr("checked",!0),g[e].addClass("checked")):(m[e].removeAttr("checked"),g[e].removeClass("checked"))}}function a(){var e=p.getPropertyDescription(r.property);u.setDisabled(e.getFrozen())}function s(e){var t,n,r=$(this).closest("span"),i=r.find("input"),o=r.find(".fakeCheckable");if(e.preventDefault(),void 0===i.attr("disabled")){for(t=0,n=m.length;n>t;t++)m[t].removeAttr("checked"),g[t].removeClass("checked");void 0!==i.attr("checked")?(i.removeAttr("checked"),o.removeClass("checked")):(i.attr("checked","checked"),o.addClass("checked")),i.trigger("change")}}function l(){var o,a,l,v,y,b;for(p=i.getModel(),f=i.getScriptingAPI(),r=t.validateCompleteness(e.radio,r),h=r.options,y=0,b=h.length;b>y;y++)h[y]=t.validateCompleteness(e.radioOption,h[y]);for(c=$("<div>").attr("id",r.id),c.addClass("interactive-radio"),c.addClass("component"),c.addClass(r.orientation),r.label&&(l=$("<span>").text(r.label),l.addClass("label"),l.addClass("top"===r.labelOn?"on-top":"on-left"),c.append(l)),y=0,b=h.length;b>y;y++)v=h[y],o=$("<input>").attr("type","radio").attr("name",r.id).attr("tabindex",i.getNextTabIndex()).attr("id",r.id+"-"+y),m.push(o),l=$("<label>").attr("for",r.id+"-"+y).text(v.text),a=$('<div class="fakeCheckable">'),g.push(a),v.disabled&&(o.attr("disabled",v.disabled),a.addClass("disabled")),v.selected&&(o.attr("checked",v.selected),a.addClass("checked")),d=$("<span>").addClass("option").append(o).append(a).append(l),c.append(d),a.on("touchstart click",s),l.on("touchstart click",s),o.change(function(e){return function(){e.action?f.makeFunctionInScriptContext(e.action)():e.loadModel?(p.stop(),i.loadModel(e.loadModel)):void 0!==e.value&&p.set(r.property,e.value)}}(v));r.tooltip&&c.attr("title",r.tooltip),n(u,r)}var u,c,d,h,p,f,m=[],g=[];return u={modelLoadedCallback:function(){p&&void 0!==r.property&&(p.removeObserver(r.property,o),p.removePropertyDescriptionObserver(r.property,a)),p=i.getModel(),f=i.getScriptingAPI(),void 0!==r.property&&(p.addPropertiesListener([r.property],o),p.addPropertyDescriptionObserver(r.property,a)),o()},getViewContainer:function(){return c},serialize:function(){var e,t;if(void 0===r.property)for(e=0,t=h.length;t>e;e++)m[e].attr("checked")?h[e].selected=!0:delete h[e].selected;return $.extend(!0,{},r)}},l(),u}}),define("common/controllers/slider-controller",["common/controllers/interactive-metadata","common/validator","common/controllers/disablable"],function(){var e=require("common/controllers/interactive-metadata"),t=require("common/validator"),n=require("common/controllers/disablable");return function(r,i){function o(){r.action&&(d=E.makeFunctionInScriptContext("value",r.action),_.bind("slide",function(e,t){d(t.value),m&&T.text(g(t.value))})),c&&_.bind("slide",function(e,t){var n={};n[c]=t.value,C&&C.set(n),m&&T.text(g(t.value))}),m&&(g=E.makeFunctionInScriptContext("value",m))}function a(){for(E=i.getScriptingAPI(),C=i.getModel(),r=t.validateCompleteness(e.slider,r),s=r.min,l=r.max,u=r.steps,c=r.property,h=r.initialValue,p=r.title,f=r.labels,m=r.displayValue,C=i.getModel(),void 0===s&&(s=0),void 0===l&&(l=10),void 0===u&&(u=10),x=$('<p class="title">'+p+"</p>"),A=$('<div class="container">'),_=$('<div class="html-slider">').attr("id",r.id),_.appendTo(A),_.slider({min:s,max:l,step:(l-s)/u}),T=_.find(".ui-slider-handle"),T.attr("tabindex",i.getNextTabIndex()),b=$('<div class="interactive-slider">').append(x).append(A),b.addClass("component"),v=0;v<f.length;v++)y=f[v],w=$('<p class="label">'+y.label+"</p>"),w.css("left",(y.value-s)/(l-s)*100+"%"),A.append(w);o(),r.tooltip&&b.attr("title",r.tooltip),n(S,r),b.css({width:r.width,height:r.height}),"auto"===r.width&&b.css("min-width","12em"),S.resize()}var s,l,u,c,d,h,p,f,m,g,v,y,b,x,w,_,T,A,C,E,S,k=function(){var e=i.getModel().get(c);_.slider("value",e),m&&T.text(g(e))},P=function(){var e=C.getPropertyDescription(c);S.setDisabled(e.getFrozen())};return S={modelLoadedCallback:function(){C&&c&&(C.removeObserver(c,k),C.removePropertyDescriptionObserver(c,P)),E=i.getScriptingAPI(),C=i.getModel(),c&&(C.addPropertiesListener([c],k),C.addPropertyDescriptionObserver(c,P)),o(),void 0!==h&&null!==h?d&&(_.slider("value",h),d(h),m&&T.text(g(h))):c&&k()},getViewContainer:function(){return b},resize:function(){var e,t;"auto"!==r.height&&(e=b.height()-x.outerHeight(!0),void 0!==w&&(e-=w.outerHeight(!0)),A.css("height",e),_.css("top",.5*e),t=parseFloat(T.css("font-size")),T.css("height",e+.4*t),T.css("top",-.5*e-.4*t))},serialize:function(){var e=$.extend(!0,{},r);return c||(e.initialValue=_.slider("value")),e}},a(),S}}),define("common/views/select-box-view",[],function(){return function(e){function t(){var e;return n?(n=!1,void 0):(e=$(this).prop("selectedIndex"),u(a[e],e),void 0)}var n,r,i,o=e.id,a=e.options,s=e.label,l=e.labelOn,u=e.onChange;return{update:function(e){n=!0,r.data("selectBox-selectBoxIt").selectOption(e.toString())},render:function(e){function n(t){var n=parseFloat(e.css("font-size"));return t/n}function u(){return this.width()}var c,d,h,p,f,m,g=[];return r=$("<select>"),a.forEach(function(e){c=$("<option>").html(e.text),g.push(c),e.disabled&&c.prop("disabled",e.disabled),e.selected&&c.prop("selected",e.selected),void 0!==e.value&&c.prop("value",e.value),r.append(c)}),r.change(t),i=$("<div>").attr("id",o),s&&(d=$("<span>").text(s),d.addClass("label"),d.addClass("top"===l?"on-top":"on-left"),i.append(d)),i.append(r),r.selectBoxIt(),i.find(".selectboxit").css("width","auto"),h=n(i.measure(u,"ul",e)),p=n(i.measure(u,".selectboxit-arrow-container",e)),f=h+"em",m=h+p+.3+"em",i.find(".selectboxit").css("width",m),i.find(".selectboxit-text").css("max-width",f),i.find(".selectboxit-container select").css({width:m,height:"100%"}),i}}}}),define("common/controllers/pulldown-controller",["common/controllers/interactive-metadata","common/validator","common/controllers/disablable","common/views/select-box-view","common/jquery-plugins"],function(){var e=require("common/controllers/interactive-metadata"),t=require("common/validator"),n=require("common/controllers/disablable"),r=require("common/views/select-box-view");return require("common/jquery-plugins"),function(i,o){function a(e){var t,n;for(t=0;t<i.options.length;t++)if(n=i.options[t],n.loadModel===e)return n.text;return!1}function s(){var e,t;t=o.getLoadedModelId(),e=a(t),void 0!==i.property?f.update(d.get(i.property)):e&&f.update(e)}function l(){var e=d.getPropertyDescription(i.property);c.setDisabled(e.getFrozen())}function u(){var a,s,l=o.interactiveContainer;for(d=o.getModel(),h=o.getScriptingAPI(),i=t.validateCompleteness(e.pulldown,i),p=i.options,a=0,s=p.length;s>a;a++)p[a]=t.validateCompleteness(e.pulldownOption,p[a]);f=new r({id:i.id,options:p,label:i.label,labelOn:i.labelOn,onChange:function(e){e.action?h.makeFunctionInScriptContext(e.action)():e.loadModel?(d.stop(),o.loadModel(e.loadModel)):void 0!==e.value&&(d.properties[i.property]=e.value)}}),m=f.render(l),m.addClass("interactive-pulldown").addClass("component"),i.tooltip&&m.attr("title",i.tooltip),n(c,i)}var c,d,h,p,f,m;return c={modelLoadedCallback:function(){h=o.getScriptingAPI(),void 0!==i.property?(d&&(d.removeObserver(i.property,s),d.removePropertyDescriptionObserver(i.property,l)),d=o.getModel(),d.addObserver(i.property,s),d.addPropertyDescriptionObserver(i.property,l)):d=o.getModel(),s()},getViewContainer:function(){return m},serialize:function(){var e,t,n;if(void 0===i.property)for(n=m.find("option"),e=0,t=p.length;t>e;e++)$(n[e]).prop("selected")?p[e].selected=!0:delete p[e].selected;return $.extend(!0,{},i)}},u(),c}}),define("common/views/numeric-output-view",[],function(){return function(e){var t,n,r,i,o,a=e.id,s=e.label,l=e.unit;return{update:function(e){i.text(e)},updateLabel:function(e){n.html(e)},updateUnits:function(e){o.html(e)},hideUnits:function(){o.css("opacity",0)},showUnits:function(){o.css("opacity",1)},render:function(){return t=$('<div class="numeric-output">'),n=$('<span class="label"></span>'),r=$('<span class="output"></span>'),i=$('<span class="value"></span>'),o=$('<span class="units"></span>'),s&&n.html(s),l&&o.html(l),t.attr("id",a).append(n).append(r.append(i).append(o)),t}}}}),define("common/controllers/numeric-output-controller",["common/controllers/interactive-metadata","common/validator","common/views/numeric-output-view"],function(){var e=require("common/controllers/interactive-metadata"),t=require("common/validator"),n=require("common/views/numeric-output-view");return function(r,i){function o(){var e=f.properties[a];u&&(e=u(e)),c.update(e)}var a,s,l,u,c,d,h,p,f,m;return f=i.getModel(),m=i.getScriptingAPI(),r=t.validateCompleteness(e.numericOutput,r),a=r.property,l=r.units,s=r.label,u=r.displayValue,c=new n({id:r.id,units:l,label:s}),d=c.render(),d.addClass("component"),d.addClass(r.orientation),d.css({width:r.width,height:r.height}),u&&(u=m.makeFunctionInScriptContext("value",u)),r.tooltip&&d.attr("title",r.tooltip),p={modelLoadedCallback:function(){f&&f.removeObserver(a,o),f=i.getModel(),m=i.getScriptingAPI(),a&&(h=f.getPropertyDescription(a),h&&(s||c.updateLabel(h.getLabel()),l||c.updateUnits(h.getUnitAbbreviation())),o(),f.addObserver(a,o))},getViewContainer:function(){return d},serialize:function(){return $.extend(!0,{},r)}}}}),define("common/views/table-view",[],function(){return function(e){function t(){var e,t;for(_.find("th").remove("th"),e=0;e<k.length;e++)t=$("<th>"),t.text(k[e]),t.click(n),_.append(t)}function n(e){var t,n=$(this),r="asc",i="desc";t=r,n.hasClass(r)?(n.removeClass(r),n.addClass(i),t=i):n.hasClass(i)?(n.removeClass(i),n.addClass(r),t=r):(n.addClass(i),t=i),n.siblings().removeClass("sorted"),A=T.find("tr"),A.tsort("td:eq("+n.index()+")",{sortFunction:function(e,n){var i=Math.abs(parseFloat(e.s)),o=Math.abs(parseFloat(n.s));return t===r?i===o?0:i>o?1:-1:i===o?0:o>i?1:-1}}),n.addClass("sorted"),e.preventDefault()}function r(){v=w.find("tr:first th").map(function(){return $(this).width()}),T.find("tr:first td").each(function(e){$(this).width(v[e])})}function i(e){return $(T.find("tr")).filter(function(){return $(this).data("index")===e})}function o(e){return e.data("index")}function a(e){var t=e.position();return t.top<C.top?-1:t.top>E?1:0}function s(e){var t=B.indexOf(e);return-1!==t?(B.splice(t,1),i(e).removeClass("selected")):void 0}function l(e){var t;if(-1===B.indexOf(e)){B.push(e),t=i(e),t.addClass("selected");var n=a(t);return-1===n&&t[0].scrollIntoView(!0),1===n&&t[0].scrollIntoView(),t}}function u(){var e,t,n=[];for(e=0;e<B.length;e++)t=B[e],n.push([t,i(t).index()]);return n.sort(function(e,t){return e[1]-t[1]})}function c(){var e,t,n,r;for(t=u(),n=t[0],r=t[t.length-1],A=T.find("tr"),e=n[1];e<=r[1];e++)l($(A[e]).data("index"))}function d(){var e;for(e=0;e<B.length;e++)i(B[e]).removeClass("selected");B=[]}function h(e,t){var n,i,o,a;for(o=$('<tr class="data">'),$(o).data("index",t),n=0;n<e.length;n++)a=$("<td>"),i=e[n],"string"==typeof i?a.text(i):"number"==typeof i&&a.text(P[n](i)),o.append(a);T.append(o),R.length<2&&r(),o[0].scrollIntoView(),d(),l(t)}function p(e){var t=$(T.find("tr")).filter(function(){return $(this).data("index")===e});t.remove()}function f(e,t){var n,r=$(T.find("tr")).filter(function(){return $(this).data("index")===t}),i=$(r).find("td"),o=i.length;for(n=0;n<e.length;n++)o>n&&$(i[n]).text(P[n](e[n]))}function m(){var e;if(T.find(".data").remove(),R)for(e=0;e<R.length;e++)h(R[e],e)}function g(){C=T.position(),E=T.height()}var v,y,b,x,w,_,T,A,C,E,S=e.id,k=e.columns,P=e.formatters,R=(e.visibleRows,e.tableData),O=e.title,M=e.width,N=e.height,I=e.tooltip,L=e.klasses||[],B=[];return{render:function(){var e,n;for(y=$("<div>"),x=$("<table>"),T=$("<tbody>"),_=$('<tr class="header">'),w=$("<thead>").append(_),x.append(w).append(T),t(),m(),b=$("<div>").addClass("table-wrapper").append(x),y.attr("id",S),O&&(n=$("<div>").addClass("title").text(O),y.append(n)),y.append(b),e=0;e<L.length;e++)y.addClass(L[e]);return I&&y.attr("title",I),M&&y.css("width",M),N&&y.css("height",N),T.delegate("tr","click",function(e){var t=o($(e.currentTarget));e.shiftKey||e.metaKey||d(),l(t),e.shiftKey&&c()}),g(),y},resize:function(){var e;x.height(b.height()),e=x.height()-w.outerHeight(!0),T.height(e-6),r(),g()},appendDataRow:h,removeDataRow:p,replaceDataRow:f,removeSelection:s,addSelection:l,clearSelection:d,updateTable:function(e){k=e.columns||k,P=e.formatters||P,R=e.tableData||R,t(),m(),r(),g()}}}}),define("common/controllers/table-controller",["require","common/controllers/interactive-metadata","common/validator","common/views/table-view"],function(e){var t=e("common/controllers/interactive-metadata"),n=e("common/validator"),r=e("common/views/table-view"),i=0;return function(e,o){function a(){var i=o.interactiveContainer;g=o.getModel(),e=n.validateCompleteness(t.table,e),s(),b=0,_=$.extend(!0,[],e.tableData),T=$.extend(!0,[],e.headerData),v=new r({id:e.id,title:e.title,columns:x,tableData:_,formatters:w,visibleRows:e.visibleRows,width:e.width,height:e.height,tooltip:e.tooltip,klasses:["interactive-table","component"]}),y=v.render(i)}function s(){var t,n,r,i,o;for(x=[],w=[],e.indexColumn&&(x.push("#"),w.push(d3.format("f"))),t=0;t<e.propertyColumns.length;t++)"undefined"!=typeof g?(n=e.propertyColumns[t],r=g.getPropertyDescription(n),r?(i=r.getLabel(),o=r.getUnitAbbreviation(),o&&(i+=" ("+o+")"),x.push(i),w.push(d3.format(".3r"))):(x.push(e.propertyColumns[t]),w.push(d3.format(".3r")))):(x.push(e.propertyColumns[t]),w.push(d3.format(".3r")))}function l(){s(),v.updateTable({columns:x,formatters:w,tableData:_})}function u(){var t,n=[];for(b++,e.indexColumn&&n.push(b),t=0;t<e.propertyColumns.length;t++)n.push(g.get(e.propertyColumns[t]));_.push(n),v.appendDataRow(n,b)}function c(){var t,n=[];for(e.indexColumn&&n.push(b),t=0;t<e.propertyColumns.length;t++)n.push(g.get(e.propertyColumns[t]));0===_.length?(_.push(n),v.appendDataRow(n,b)):(_[_.length-1]=n,v.replaceDataRow(n,b))}function d(){var e=g.stepCounter();_.length>e-1&&(_.length=e,b=e,l())}function h(){v.clearSelection(),v.addSelection(g.stepCounter()+1)}function p(){g.on("tick."+A,function(){e.addNewRows?u():c()}),g.on("stepBack."+A,h),g.on("stepForward."+A,h),g.on("seek."+A,h),g.on("play."+A,function(){g.stepCounter()<_.length&&d()}),g.on("invalidation."+A,function(){c()}),g.on("reset."+A,f)}function f(){e.clearDataOnReset&&(_=$.extend(!0,[],e.tableData),T=$.extend(!0,[],e.headerData),b=0,l())}var m,g,v,y,b,x,w,_,T,A="tableController"+ ++i;return m={modelLoadedCallback:function(){g=o.getModel(),_=$.extend(!0,[],e.tableData),T=$.extend(!0,[],e.headerData),b=0,l(),e.streamDataFromModel&&p()},resize:function(){v&&v.resize()},getData:function(t){var n,r,i,o,a,s=[];for(n=0;n<_.length;n++){for(r=_[n],a=[],o=0;o<t.length;o++)i=e.propertyColumns.indexOf(t[o]),e.indexColumn&&i++,a.push(r[i]);s.push(a)}return[s]},appendDataPropertiesToComponent:u,getViewContainer:function(){return y},serialize:function(){var t=$.extend(!0,{},e);return t.headerData=x,t.tableData=_,t}},a(),m}}),define("iframe-phone/structured-clone",["require"],function(){function e(){var e=0;if(window.postMessage)try{window.onmessage=function(t){var r=Object.prototype.toString.call(t.data);e=-1!=r.indexOf("Null")||-1!=r.indexOf("DOMWindow")?1:0,n={structuredClones:e}},window.postMessage(document.createElement("a"),"*")}catch(t){e=t.DATA_CLONE_ERR||"Cannot post cyclic structures."==t.message?1:0,n={structuredClones:e}}}function t(){return n&&n.structuredClones>0}var n=!1,r={};return e(),r.supported=t,r}),define("common/parent-message-controller",["require","iframe-phone/structured-clone"],function(e){function t(e,t){h.supported()?window.parent.postMessage(e,t):window.parent.postMessage(JSON.stringify(e),t)}function n(e){t(e,u)}function r(e){t(e,"*")}function i(e,t){d[e]=t}function o(){d={}}function a(){return Object.keys(d)}function s(e){if(e.source===window.parent){var t=e.data;"string"==typeof t&&(t=JSON.parse(t)),u||"hello"===t.type&&(u=t.origin),e.origin===u&&d[t.type]&&d[t.type](t)}}function l(){window.parent!==window&&(r({type:"hello",origin:document.location.href.match(/(.*?\/\/.*?)\//)[1]}),window.addEventListener("message",s,!1))}var u,c,d={},h=e("iframe-phone/structured-clone");return c={initialize:l,getListenerNames:a,addListener:i,removeAllListeners:o,post:n}}),define("common/benchmark/browser-detect",[],function(){function e(){var e=navigator.userAgent.match(/\(([^)]+)\).*/);if(!e)return"na";var n=e[1],r=n.split("; ");if("Macintosh"===r[0])return r[1];if(r[0].match(/^Windows/)){var i=navigator.userAgent.match(/\(.*?(Windows NT.+?)[;)]/),o="";return n.match(/WOW64/)?o="64/32":n.match(/Win64; IA64/)?o="64":n.match(/Win64; x64/)&&(o="64"),t[i[1]]+"/"+o}return r[0].match(/^X11/)?r.join("/"):"na"}var t={"Windows NT 6.2":"Windows 8","Windows NT 6.1":"Windows 7","Windows NT 6.0":"Windows Vista","Windows NT 5.2":"Windows Server 2003; Windows XP x64 Edition","Windows NT 5.1":"Windows XP","Windows NT 5.01":"Windows 2000, Service Pack 1 (SP1)","Windows NT 5.0":"Windows 2000","Windows NT 4.0":"Microsoft Windows NT 4.0"};return{isMobile:function(e){return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|android|playbook|silk|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}(navigator.userAgent||navigator.vendor||window.opera),what_browser:function(){var n,r=/ (Chrome)\/(.*?) /,i=/ (Firefox)\/([0123456789ab.]+)/,o=/ AppleWebKit\/([0123456789.+]+) \(KHTML, like Gecko\) Version\/([0123456789.]+) (Safari)\/([0123456789.]+)/,a=/ (MSIE) ([0123456789.]+);/,s=/^(Opera)\/.+? Version\/([0123456789.]+)$/,l=/.+?\((iPhone); CPU.+?OS .+?Version\/([0123456789._]+)/,u=/.+?\((iPad); CPU.+?OS .+?Version\/([0123456789._]+)/,c=/.+?\((iPod); CPU (iPhone.+?) like.+?Version\/([0123456789ab._]+)/,d=/.+?(Android) ([0123456789.]+).*?; (.+?)\).+? Chrome\/([0123456789.]+)/,h=/.+?(Android.+?\)).+? Firefox\/([0123456789.]+)/,p=/.+?(Android) ([0123456789ab.]+).*?; (.+?)\)/;if(n=navigator.userAgent.match(d),n&&n[1])return{browser:"Chrome for Android",version:n[4],oscpu:n[1]+"/"+n[2]+"/"+n[3]};if(n=navigator.userAgent.match(r),n&&n[1])return{browser:n[1],version:n[2],oscpu:e()};if(n=navigator.userAgent.match(i),n&&n[1]){var f=navigator.buildID,m="";return f&&f.length>=8&&(m="("+f.slice(0,4)+"-"+f.slice(4,6)+"-"+f.slice(6,8)+")"),{browser:n[1],version:n[2]+" "+m,oscpu:e()}}if(n=navigator.userAgent.match(h),n&&n[1])return{browser:"Firefox",version:n[2],oscpu:n[1]};if(n=navigator.userAgent.match(p),n&&n[1])return{browser:"Android",version:n[2],oscpu:n[1]+"/"+n[2]+"/"+n[3]};if(n=navigator.userAgent.match(o),n&&n[3])return{browser:n[3],version:n[2]+"/"+n[1],oscpu:e()};if(n=navigator.userAgent.match(a),n&&n[1]){var g=navigator.userAgent.match(/\(.*?(Windows.+?); (.+?)[;)].*/);return{browser:n[1],version:n[2],oscpu:t[g[1]]+"/"+navigator.cpuClass+"/"+navigator.platform}}return n=navigator.userAgent.match(s),n&&n[1]?{browser:n[1],version:n[2],oscpu:e()}:(n=navigator.userAgent.match(l),n&&n[1]?{browser:"Mobile Safari",version:n[2],oscpu:n[1]+"/iOS/"+n[2]}:(n=navigator.userAgent.match(u),n&&n[1]?{browser:"Mobile Safari",version:n[2],oscpu:n[1]+"/iOS/"+n[2]}:(n=navigator.userAgent.match(c),n&&n[1]?{browser:"Mobile Safari",version:n[3],oscpu:n[1]+"/iOS/"+n[2]}:{browser:"",version:navigator.appVersion,oscpu:""})))}}}),define("common/benchmark/benchmark",["require","./browser-detect"],function(e){function t(e,t,n){function r(t){var n=e.getElementsByTagName("tr")[0],r=n.appendChild(document.createElement("th"));r.innerHTML=t,m[t]=f++}function o(t){t=t||0;var n,r=e.appendChild(document.createElement("tr"));for(n=0;t>n;n++)r.appendChild(document.createElement("td"));return r}function a(e,t,n){var r;n=n||l,r=n.getElementsByTagName("td")[m[e]],"string"==typeof t&&"<"===t.slice(0,1)?r.innerHTML=t:r.textContent=t}function s(){function e(e){return Math.floor(e)===e}var n,r,o,a,s,l,u,c,d=g.length,h=i.getElementsByTagName("td"),p=d3.format("5.1f"),f=d3.format("f");for(n=0;n<t.length;n++)if(o=t[n],l=m[o.name],o.numeric===!1)a=g[2],s=a.getElementsByTagName("td")[l],h[l].innerHTML=s.innerHTML;else{for(u=0,r=2;d>r;r++)a=g[r],s=a.getElementsByTagName("td")[l],u+=+s.textContent;c=u/(d-2),c=o.formatter?o.formatter(c):e(c)?f(u/(d-2)):p(u/(d-2)),h[l].textContent=c}}var l,u,c,d,h,p=0,f=0,m={},g=e.getElementsByTagName("tr");if(e.style.display="",0===g.length){for(o(),r("browser"),r("version"),r("cpu/os"),r("date"),r("commit"),r("branch"),p=0;p<t.length;p++)r(t[p].name);i=o(f),i.className="average"}else for(c=g[0],d=c.getElementsByTagName("th"),p=0,h=d.length;h>p;p++)m[d[p].innerHTML]=f++;for(l=o(f),l.className="sample",p=0;6>p;p++)u=n[p],a(u[0],u[1]),a(u[0],u[1],i);for(p=6;p<n.length;p++)u=n[p],a(u[0],u[1]);s()}function n(e,t,n,r){function i(e){function n(n){e.formatter?l.push([e.name,e.formatter(n)]):l.push([e.name,n]),a.length>0?i(a.shift()):(r&&r(),t&&t(l))}e.run(n)}var o,a=e.slice(),l=[],u=s(),c=d3.time.format("%Y-%m-%d %H:%M");return l.push(["browser",u.browser]),l.push(["version",u.version]),l.push(["cpu/os",u.oscpu]),l.push(["date",c(new Date)]),o="<a href='"+Lab.version.repo.commit.url+"' class='opens-in-new-window' target='_blank'>"+Lab.version.repo.commit.short_sha+"</a>",Lab.version.repo.dirty&&(o+=" <i>dirty</i>"),l.push(["commit",o]),l.push(["branch",Lab.version.repo.branch]),n&&n(),i(a.shift()),l}function r(e,r,i,o,a){var s;return n(e,function(n){t(r,e,n),i(n)},o,a),s}var i,o="0.0.1",a=e("./browser-detect"),s=a.what_browser,l=a.isMobile;return{version:o,what_browser:function(){return s()},get isMobile(){return l},run:function(e,t,n,i,o){r(e,t,n,i,o)},bench:function(e,t,r,i){return n(e,t,r,i)},renderToTable:function(e,n,r){t(e,n,r)}}}),define("common/controllers/parent-message-api",["require","common/parent-message-controller","common/benchmark/benchmark"],function(e){var t=e("common/parent-message-controller"),n=e("common/benchmark/benchmark");return function(e,r,i){function o(n){t.post({type:"propertyValue",name:n,values:e.get(n)})}t.removeAllListeners(),t.addListener("setFocus",function(){r&&r.setFocus&&r.setFocus()}),t.addListener("loadInteractive",function(e){i&&i.loadInteractive&&i.loadInteractive(e.data)}),t.addListener("loadModel",function(e){i&&i.loadModel&&i.loadModel(e.data.modelId,e.data.modelObject)}),t.addListener("getModelState",function(){i&&i.modelController&&t.post({type:"modelState",values:i.modelController.state()})}),t.addListener("getInteractiveState",function(){i&&i.modelController&&t.post({type:"interactiveState",values:i.serialize()})}),t.addListener("runBenchmarks",function(){var e,r;i&&i.modelController&&(e=i.modelController,r=i.benchmarks.concat(e.benchmarks),n.bench(r,function(e){console.log(e),t.post({type:"returnBenchmarks",values:{results:e,benchmarks:r}},function(){},function(){})}))}),t.addListener("listenForDispatchEvent",function(n){var r=n.eventName,i=n.properties,o={},a=0,s=null;e.on(r,function(){if(i)for(a=0;a<i.length;a++)s=i[a],o[s]=e.get(s);t.post({type:r,values:o})})}),t.addListener("removeListenerForDispatchEvent",function(t){{var n=t.eventName;t.properties}e.on(n,null)}),t.addListener("get",function(e){o(e.propertyName)}),t.addListener("observe",function(t){e.addPropertiesListener(t.propertyName,function(){o(t.propertyName)}),o(t.propertyName)}),t.addListener("set",function(t){var n={};n[t.propertyName]=t.propertyValue,e.set(n)}),t.addListener("tick",function(t){e.tick(t.numTimes)}),t.addListener("play",function(){e.start()}),t.addListener("stop",function(){e.stop()}),t.initialize()}}),function(e,t){if("object"==typeof exports&&exports)t(exports);else{var n={};t(n),"function"==typeof define&&define.amd?define("mustache",n):e.Mustache=n
}}(this,function(e){function t(e,t){return x.call(e,t)}function n(e){return!t(g,e)}function r(e){return"function"==typeof e}function i(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function o(e){return String(e).replace(/[&<>"'\/]/g,function(e){return T[e]})}function a(e){this.string=e,this.tail=e,this.pos=0}function s(e,t){this.view=null==e?{}:e,this.parent=t,this._cache={".":this.view}}function l(){this.clearCache()}function u(t,n,i,o){function a(e){return n.render(e,i)}for(var s,l,c,d="",h=0,p=t.length;p>h;++h)switch(s=t[h],l=s[1],s[0]){case"#":if(c=i.lookup(l),"object"==typeof c||"string"==typeof c)if(_(c))for(var f=0,m=c.length;m>f;++f)d+=u(s[4],n,i.push(c[f]),o);else c&&(d+=u(s[4],n,i.push(c),o));else if(r(c)){var g=null==o?null:o.slice(s[3],s[5]);c=c.call(i.view,g,a),null!=c&&(d+=c)}else c&&(d+=u(s[4],n,i,o));break;case"^":c=i.lookup(l),(!c||_(c)&&0===c.length)&&(d+=u(s[4],n,i,o));break;case">":c=n.getPartial(l),r(c)&&(d+=c(i));break;case"&":c=i.lookup(l),null!=c&&(d+=c);break;case"name":c=i.lookup(l),null!=c&&(d+=e.escape(c));break;case"text":d+=l}return d}function c(e){for(var t,n=[],r=n,i=[],o=0,a=e.length;a>o;++o)switch(t=e[o],t[0]){case"#":case"^":i.push(t),r.push(t),r=t[4]=[];break;case"/":var s=i.pop();s[5]=t[2],r=i.length>0?i[i.length-1][4]:n;break;default:r.push(t)}return n}function d(e){for(var t,n,r=[],i=0,o=e.length;o>i;++i)t=e[i],t&&("text"===t[0]&&n&&"text"===n[0]?(n[1]+=t[1],n[3]=t[3]):(n=t,r.push(t)));return r}function h(e){return[new RegExp(i(e[0])+"\\s*"),new RegExp("\\s*"+i(e[1]))]}function p(t,r){function o(){if(E&&!S)for(;C.length;)delete A[C.pop()];else C=[];E=!1,S=!1}if(t=t||"",r=r||e.tags,"string"==typeof r&&(r=r.split(m)),2!==r.length)throw new Error("Invalid tags: "+r.join(", "));for(var s,l,u,p,g,x,w=h(r),_=new a(t),T=[],A=[],C=[],E=!1,S=!1;!_.eos();){if(s=_.pos,u=_.scanUntil(w[0]))for(var k=0,P=u.length;P>k;++k)p=u.charAt(k),n(p)?C.push(A.length):S=!0,A.push(["text",p,s,s+1]),s+=1,"\n"==p&&o();if(!_.scan(w[0]))break;if(E=!0,l=_.scan(b)||"name",_.scan(f),"="===l?(u=_.scanUntil(v),_.scan(v),_.scanUntil(w[1])):"{"===l?(u=_.scanUntil(new RegExp("\\s*"+i("}"+r[1]))),_.scan(y),_.scanUntil(w[1]),l="&"):u=_.scanUntil(w[1]),!_.scan(w[1]))throw new Error("Unclosed tag at "+_.pos);if(g=[l,u,s,_.pos],A.push(g),"#"===l||"^"===l)T.push(g);else if("/"===l){if(x=T.pop(),!x)throw new Error('Unopened section "'+u+'" at '+s);if(x[1]!==u)throw new Error('Unclosed section "'+x[1]+'" at '+s)}else if("name"===l||"{"===l||"&"===l)S=!0;else if("="===l){if(r=u.split(m),2!==r.length)throw new Error("Invalid tags at "+s+": "+r.join(", "));w=h(r)}}if(x=T.pop())throw new Error('Unclosed section "'+x[1]+'" at '+_.pos);return c(d(A))}var f=/\s*/,m=/\s+/,g=/\S/,v=/\s*=/,y=/\s*\}/,b=/#|\^|\/|>|\{|&|=|!/,x=RegExp.prototype.test,w=Object.prototype.toString,_=Array.isArray||function(e){return"[object Array]"===w.call(e)},T={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};a.prototype.eos=function(){return""===this.tail},a.prototype.scan=function(e){var t=this.tail.match(e);if(t&&0===t.index){var n=t[0];return this.tail=this.tail.substring(n.length),this.pos+=n.length,n}return""},a.prototype.scanUntil=function(e){var t,n=this.tail.search(e);switch(n){case-1:t=this.tail,this.tail="";break;case 0:t="";break;default:t=this.tail.substring(0,n),this.tail=this.tail.substring(n)}return this.pos+=t.length,t},s.make=function(e){return e instanceof s?e:new s(e)},s.prototype.push=function(e){return new s(e,this)},s.prototype.lookup=function(e){var t;if(e in this._cache)t=this._cache[e];else{for(var n=this;n;){if(e.indexOf(".")>0){t=n.view;for(var i=e.split("."),o=0;null!=t&&o<i.length;)t=t[i[o++]]}else t=n.view[e];if(null!=t)break;n=n.parent}this._cache[e]=t}return r(t)&&(t=t.call(this.view)),t},l.prototype.clearCache=function(){this._cache={},this._partialCache={}},l.prototype.compile=function(t,n){var r=this._cache[t];if(!r){var i=e.parse(t,n);r=this._cache[t]=this.compileTokens(i,t)}return r},l.prototype.compilePartial=function(e,t,n){var r=this.compile(t,n);return this._partialCache[e]=r,r},l.prototype.getPartial=function(e){return e in this._partialCache||!this._loadPartial||this.compilePartial(e,this._loadPartial(e)),this._partialCache[e]},l.prototype.compileTokens=function(e,t){var n=this;return function(i,o){if(o)if(r(o))n._loadPartial=o;else for(var a in o)n.compilePartial(a,o[a]);return u(e,n,s.make(i),t)}},l.prototype.render=function(e,t,n){return this.compile(e)(t,n)},e.name="mustache.js",e.version="0.7.3",e.tags=["{{","}}"],e.Scanner=a,e.Context=s,e.Writer=l,e.parse=p,e.escape=o;var A=new l;e.clearCache=function(){return A.clearCache()},e.compile=function(e,t){return A.compile(e,t)},e.compilePartial=function(e,t,n){return A.compilePartial(e,t,n)},e.compileTokens=function(e,t){return A.compileTokens(e,t)},e.render=function(e,t,n){return A.render(e,t,n)},e.to_html=function(t,n,i,o){var a=e.render(t,n,i);return r(o)?(o(a),void 0):a}}),define("text",["module"],function(e){"use strict";var t,n,r=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],i=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,o=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,a="undefined"!=typeof location&&location.href,s=a&&location.protocol&&location.protocol.replace(/\:/,""),l=a&&location.hostname,u=a&&(location.port||void 0),c=[],d=e.config&&e.config()||{};return t={version:"2.0.2",strip:function(e){if(e){e=e.replace(i,"");var t=e.match(o);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:d.createXhr||function(){var e,t,n;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(t=0;3>t;t+=1){n=r[t];try{e=new ActiveXObject(n)}catch(i){}if(e){r=[n];break}}return e},parseName:function(e){var t=!1,n=e.indexOf("."),r=e.substring(0,n),i=e.substring(n+1,e.length);return n=i.indexOf("!"),-1!==n&&(t=i.substring(n+1,i.length),t="strip"===t,i=i.substring(0,n)),{moduleName:r,ext:i,strip:t}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,r,i){var o,a,s,l=t.xdRegExp.exec(e);return l?(o=l[2],a=l[3],a=a.split(":"),s=a[1],a=a[0],!(o&&o!==n||a&&a.toLowerCase()!==r.toLowerCase()||(s||a)&&s!==i)):!0},finishLoad:function(e,n,r,i){r=n?t.strip(r):r,d.isBuild&&(c[e]=r),i(r)},load:function(e,n,r,i){if(i.isBuild&&!i.inlineText)return r(),void 0;d.isBuild=i.isBuild;var o=t.parseName(e),c=o.moduleName+"."+o.ext,h=n.toUrl(c),p=d.useXhr||t.useXhr;!a||p(h,s,l,u)?t.get(h,function(n){t.finishLoad(e,o.strip,n,r)},function(e){r.error&&r.error(e)}):n([c],function(e){t.finishLoad(o.moduleName+"."+o.ext,o.strip,e,r)})},write:function(e,n,r){if(c.hasOwnProperty(n)){var i=t.jsEscape(c[n]);r.asModule(e+"!"+n,"define(function () { return '"+i+"';});\n")}},writeFile:function(e,n,r,i,o){var a=t.parseName(n),s=a.moduleName+"."+a.ext,l=r.toUrl(a.moduleName+"."+a.ext)+".js";t.load(s,r,function(){var n=function(e){return i(l,e)};n.asModule=function(e,t){return i.asModule(e,l,t)},t.write(e,s,n,o)},o)}},"undefined"!=typeof process&&process.versions&&process.versions.node?(n=require.nodeRequire("fs"),t.get=function(e,t){var r=n.readFileSync(e,"utf8");0===r.indexOf("")&&(r=r.substring(1)),t(r)}):"undefined"!=typeof Packages&&"undefined"!=typeof java?t.get=function(e,t){var n,r,i="utf-8",o=new java.io.File(e),a=java.lang.System.getProperty("line.separator"),s=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(o),i)),l="";try{for(n=new java.lang.StringBuffer,r=s.readLine(),r&&r.length()&&65279===r.charAt(0)&&(r=r.substring(1)),n.append(r);null!==(r=s.readLine());)n.append(a),n.append(r);l=String(n.toString())}finally{s.close()}t(l)}:t.createXhr()&&(t.get=function(e,n,r){var i=t.createXhr();i.open("GET",e,!0),d.onXhr&&d.onXhr(i,e),i.onreadystatechange=function(){var t,o;4===i.readyState&&(t=i.status,t>399&&600>t?(o=new Error(e+" HTTP status: "+t),o.xhr=i,r(o)):n(i.responseText))},i.send(null)}),t}),define("text!common/controllers/thermometer.tpl",[],function(){return'<div class="interactive-thermometer component" id="{{id}}">\n  <div class="thermometer-main-container">\n    <div class="thermometer">\n      <div class="thermometer-fill"></div>\n    </div>\n    <p class="label">{{labelText}}</p>\n  </div>\n  <div class="labels-container">\n    {{#labels}}\n      <span class="value-label" style="bottom: {{position}}">{{label}}</span>\n    {{/labels}}\n  </div>\n</div>'}),define("common/controllers/thermometer-controller",["require","mustache","text!common/controllers/thermometer.tpl","common/controllers/interactive-metadata","common/validator","common/jquery-plugins"],function(e){var t=e("mustache"),n=e("text!common/controllers/thermometer.tpl"),r=e("common/controllers/interactive-metadata"),i=e("common/validator");return e("common/jquery-plugins"),function(e,o){function a(){var a,y,x,w,_,T,A,C,E,S,k,P;for(b=o.getModel(),e=i.validateCompleteness(r.thermometer,e),a=e.reading,s=a.units,y=a.offset,x=a.scale,l=a.digits,S=e.min,E=e.max,u=function(e){return x*e+y},c=function(e){return(e-S)/(E-S)*100+"%"},d=e.labelIsReading,_=d?"":"Thermometer",w={id:e.id,labelText:d?"":"Thermometer"},T=e.labels,C=-1/0,w.labels=[],k=0,P=T.length;P>k;k++)w.labels.push({label:T[k].label,position:c(u(T[k].value))}),T[k].label.length>C&&(C=T[k].label.length,A=k);p=$(t.render(n,w)),f=p.find(".thermometer"),m=p.find(".thermometer-fill"),g=p.find(".label"),v=p.find(".labels-container"),C=p.measure(function(){return this.width()/parseFloat(this.css("font-size"))+"em"},".value-label:eq("+A+")",o.interactiveContainer),v.css("width",C),p.css("height",e.height),h=!1,/%$/.test(e.width)?(p.css("width",e.width),h=!0):f.css("width",e.width)}var s,l,u,c,d,h,p,f,m,g,v,y,b,x=function(e){e=u(e),g.text(e.toFixed(l)+" "+s)},w=function(){var e=b.get("targetTemperature");m.css("height",c(u(e))),d&&x(e)};return y={modelLoadedCallback:function(){b&&b.removeObserver("targetTemperature",w),b=o.getModel(),b.addPropertiesListener("targetTemperature",w),w()},getViewContainer:function(){return p},resize:function(){var e=p.height()-g.height();f.height(e),v.height(e),h&&f.width(p.width()-v.width())},serialize:function(){return e}},a(),y}}),define("common/layout/detect-font-change",[],function(){function e(e){var t=Math.ceil(1.5*parseFloat(e.match(/[\d\.]+px/),10)),n=document.createElement("canvas"),r=n.getContext("2d");return isNaN(t)&&(t=20),n.width=t,n.height=t,r.font=e,r.fillText("A",0,t),n.toDataURL()}function t(e){window.clearInterval(o[e]),delete o[e],delete a[e]}function n(n,r,o,s){return a[n]=e(n),function(){return e(n)!==a[n]?(s(),i[n]=!0,t(n),void 0):(Date.now()-r>o&&t(n),void 0)}}var r={timeout:3e3,interval:250,onchange:function(){}},i={},o={},a={};return function(e){var t,a={};return Object.keys(e).concat(Object.keys(r)).forEach(function(t){a[t]=null!=e[t]?e[t]:r[t]}),t=a.font,i[t]?!1:o[t]?!0:(o[t]=window.setInterval(n(t,Date.now(),a.timeout,a.onchange),a.interval),!0)}}),define("common/controllers/playback-controller",["require","common/inherit","common/layout/detect-font-change","common/controllers/interactive-component"],function(e){function t(e,t){i.call(this,"playback",e,t),this.$element.addClass("interactive-playback"),this._modelStopped=!0,this._modelPlayable=!0,this._showClock=!0,this._timeDesc=null,this._model=null,this._scriptingAPI=null,this._interactivesController=t,r({font:o,onchange:$.proxy(this._showClockChanged,this)})}var n=e("common/inherit"),r=e("common/layout/detect-font-change"),i=e("common/controllers/interactive-component"),o="bold 2em Lato";return n(t,i),t.prototype._createControlsFor={video:function(){var e=this._scriptingAPI;this.$element.removeClass("text").addClass("video"),this._$reset=$('<button class="reset"><i class="icon-step-backward"></i></button>').appendTo(this.$element),this._$playPause=$('<button class="play-pause"><i class="icon-play"></i><i class="icon-pause"></i></button>').appendTo(this.$element),this._$timeDisplay=$('<span class="time-display">').appendTo(this._$playPause),this._$timeCanvas=$("<canvas>").appendTo(this._$timeDisplay),this._timeCtx=this._$timeCanvas[0].getContext("2d"),this._$stepBackward=$('<button class="step"><i class="icon-backward"></i></button>').insertBefore(this._$playPause),this._$stepForward=$('<button class="step"><i class="icon-forward"></i></button>').insertAfter(this._$playPause),this._$reset.after('<div class="spacer reset">'),this._$stepBackward.after('<div class="spacer step">'),this._$stepForward.before('<div class="spacer step">'),this._$reset.on("click",e.reload),this._$playPause.on("click",$.proxy(function(){this._modelStopped?this._modelPlayable&&e.start():e.stop()},this)),this._$stepBackward.on("click",e.stepBack),this._$stepForward.on("click",e.stepForward),this._$playPause.attr("title","Start / pause the simulation"),this._$reset.attr("title","Reset the simulation"),this._$stepBackward.attr("title","Step back"),this._$stepForward.attr("title","Step forward")},text:function(){var e=this._scriptingAPI;this.$element.removeClass("video").addClass("text"),this._$start=$('<button class="start">Start</button>').appendTo(this.$element),this._$stop=$('<button class="stop">Stop</button>').appendTo(this.$element),this._$reset=$('<button class="reset">Reset</button>').appendTo(this.$element),this._$reset.on("click",e.reload),this._$start.on("click",e.start),this._$stop.on("click",e.stop),this._$start.attr("title","Start the simulation or data collection"),this._$stop.attr("title","Stop the simulation or data collection"),this._$reset.attr("title","Reset the simulation or data collection")}},t.prototype._updateButtonStatesFor={video:function(){var e=!this._modelStopped,t=this._modelPlayable;e?this._$playPause.addClass("playing"):this._$playPause.removeClass("playing"),t||e?this._$playPause.removeClass("disabled"):this._$playPause.addClass("disabled")},text:function(){this._modelStopped?this._$stop.addClass("disabled"):this._$stop.removeClass("disabled"),this._modelPlayable?this._$start.removeClass("disabled"):this._$start.addClass("disabled")}},t.prototype._simulationStateChanged=function(){this._modelStopped=this._model.isStopped(),this._modelPlayable=this._model.properties.isPlayable===!1?!1:!0,this._updateButtonStatesFor[this.controlButtonStyle].call(this)},t.prototype._showClockChanged=function(){"video"===this.controlButtonStyle&&(this._showClock=this._model.get("showClock"),this._showClock?(this._$playPause.addClass("with-clock"),this._timeDesc=this._model.getPropertyDescription("displayTime"),this._timeChanged()):this._$playPause.removeClass("with-clock"))},t.prototype._timeChanged=function(){this._showClock&&"video"===this.controlButtonStyle&&(this._timeCtx.clearRect(0,0,this._canvWidth,this._canvHeigth),this._timeCtx.fillText(this._timeDesc.format(this._model.get("displayTime")),this._canvWidth,.85*this._canvHeigth))},t.prototype._updateControlButtonChoicesFor={video:function(e){var t;e?"play"===e?(this.$element.find(".play-pause").removeClass("hidden"),this.$element.find(".spacer, .step, .reset").addClass("hidden")):"reset"===e?(this.$element.find(".reset").removeClass("hidden"),this.$element.find(".spacer, .play-pause, .step").addClass("hidden")):"play_reset"===e?(this.$element.find(".spacer, .play-pause, .reset").removeClass("hidden"),this.$element.find(".step").addClass("hidden")):"play_reset_step"===e&&this.$element.find(".spacer, .step, .reset, .play-pause").removeClass("hidden"):this.$element.find(".step, .reset, .play-pause").addClass("hidden"),t=this.$element.find("button"),t.removeClass("first"),t.removeClass("last"),t=t.not(".hidden"),t.first().addClass("first"),t.last().addClass("last")},text:function(e){if(e)if("play"===e)this.$element.find(".start, .stop").removeClass("hidden"),this.$element.find(".reset").addClass("hidden");else if("reset"===e)this.$element.find(".reset").removeClass("hidden"),this.$element.find(".start, .stop").addClass("hidden");else{if("play_reset"!==e)throw new Error('controlButtons option "'+e+'" is not understood or is not compatible with controlButtonStyle "text"');this.$element.find(".start, .stop, .reset").removeClass("hidden")}else this.$element.find(".reset, .start, .stop").addClass("hidden")}},t.prototype._controlButtonChoicesChanged=function(){var e=this._model.properties.controlButtons;this._updateControlButtonChoicesFor[this.controlButtonStyle].call(this,e)},t.prototype._controlButtonStyleChanged=function(){var e=this._model.properties.controlButtonStyle||"video";if(this.controlButtonStyle!==e){if(this.controlButtonStyle=e,this.$element.empty(),!this._createControlsFor[e])throw new Error('Unknown controlButtonStyle "'+e+'"');this._createControlsFor[e].call(this)}},t.prototype.modelLoadedCallback=function(){this._model=this._interactivesController.getModel(),this._scriptingAPI=this._interactivesController.getScriptingAPI().api,this._model.on("play."+this.component.id,$.proxy(this._simulationStateChanged,this)),this._model.on("stop."+this.component.id,$.proxy(this._simulationStateChanged,this)),this._model.addObserver("isPlayable",$.proxy(this._simulationStateChanged,this)),this._model.addObserver("showClock",$.proxy(this._showClockChanged,this)),this._model.addObserver("displayTime",$.proxy(this._timeChanged,this)),this._model.addObserver("controlButtons",$.proxy(this._controlButtonChoicesChanged,this)),this._model.addObserver("controlButtonStyle",$.proxy(this._controlButtonStyleChanged,this)),this._controlButtonStyleChanged(),this._controlButtonChoicesChanged(),this._simulationStateChanged(),this._showClockChanged()},t.prototype.resize=function(){this._$timeCanvas&&(this._canvWidth=2*this._$timeCanvas.width(),this._canvHeigth=2*this._$timeCanvas.height(),this._$timeCanvas.attr("width",this._canvWidth),this._$timeCanvas.attr("height",this._canvHeigth),this._timeCtx.font=o,this._timeCtx.fillStyle="#939598",this._timeCtx.textAlign="right",this._showClockChanged())},t}),define("common/controllers/div-controller",["require","common/inherit","common/controllers/interactive-component"],function(e){function t(e,t,n){r.call(this,"div",e,t,n),this.$element.append(e.content)}var n=e("common/inherit"),r=e("common/controllers/interactive-component");return n(t,r),t}),define("common/dispatch-support",[],function(){function e(e){return[].slice.call(e)}return function(){function t(e){var t,r;for(a=e,o=d3.dispatch.apply(null,a),t=0,r=a.length;r>t;t++)i[a[t]]=n(a[t])}function n(e){return function(){s?l.add(e):o[e].apply(o,arguments)}}function r(e){return function(){o[e].apply(o,arguments)}}var i,o,a,s=!1,l=d3.set();return i={on:r("on"),mixInto:function(e){e.on=i.on,e.suppressEvents=i.suppressEvents},addEventTypes:function(){arguments.length&&t(a.concat(e(arguments)))},startBatch:function(){s=!0},endBatch:function(){s=!1,i.flush()},flush:function(){l.forEach(function(e){o[e]()}),l=d3.set()},suppressEvents:function(e){s=!0,e(),s=!1,l=d3.set()}},t(e(arguments)),i}}),define("common/controllers/help-system",["require","common/markdown-to-html","common/dispatch-support"],function(e){var t=e("common/markdown-to-html"),n=e("common/dispatch-support"),r=["center bottom","left center","center top","right center"],i=["center top-5","right+5 center","center bottom+5","left-5 center"];return function(e,o){function a(){var n,a,s,u=e[h];l.focus(),l.html(t(u.text)),u.component?(n="model"===u.component?$("#model-container"):$("#"+u.component).closest(".component"),a=n.outerHeight()+10,s=parseFloat(l.css("font-size")),l.position({of:n,collision:"flipfit flipfit",within:o,my:"left-"+4*s+" top+"+s,at:"right bottom",using:function(e,t){var n,r,i=t.element.left,o=t.element.width,a=t.target.left,s=t.target.width;$(this).css(e),n=$("<div>").addClass("lab-help-arrow").addClass(t.vertical).appendTo(this),a>i&&(r=a-i+s/2,r=Math.max(.1*o,Math.min(.9*o,r)),n.css("left",r))}}),p.forEach(function(e,t){(1===t||3===t)&&e.css("height",a),e.position({of:n,collision:"none none",my:r[t],at:i[t]})})):(l.position({of:o,collision:"flipfit flipfit",within:o,my:"center center",at:"center center"}),p.forEach(function(e,t){e.position({of:o,collision:"none none",my:t?"left top":"center center",at:t?"right bottom":"center center"})}))}var s,l,u,c=new n("start","stop"),d=!1,h=-1,p=[];return s={start:function(){for(var e=0;4>e;e++)p.push($('<div class="lab-help-overlay lab-help-next"></div>').appendTo(o));u=$('<div class="lab-help-instructions"><span class="lab-help-prev btn"><</span><span class="lab-help-next">Click overlay to see next help tip</span><span class="lab-help-next btn">></span></div>').appendTo(o),o.on("click.lab-help-next",".lab-help-next",s.next),o.on("click.lab-help-prev",".lab-help-prev",s.prev),l=$('<div class="lab-help-tip lab-help-next" tabindex="-1"></div>').appendTo(o),l.on("keydown.lab-help",function(e){switch(e.keycode||e.which){case 37:s.prev();break;case 39:s.next()}e.preventDefault(),e.stopPropagation()}),h=-1,d=!0,s.next(),c.start()},stop:function(){l.remove(),u.remove(),p.forEach(function(e){e.remove()}),p.length=0,o.off("click.lab-help-next",".lab-help-next"),o.off("click.lab-help-prev",".lab-help-prev"),d=!1,c.stop()},next:function(){return h++,h>=e.length?(s.stop(),void 0):(a(),void 0)},prev:function(){return h--,0>h?(s.stop(),void 0):(a(),void 0)},isActive:function(){return d}},c.mixInto(s),s}}),define("common/views/tooltip",["require","common/benchmark/benchmark"],function(e){function t(e){function t(e){var t=o.css("font-size"),n=.35*+parseFloat(t),r=$(e).closest("[title], [aria-describedby]");a.css("font-size",t),a.is(":visible")||a.show(),a.position({of:r,collision:"flipfit flipfit",within:o,my:"center top+"+n,at:"center bottom",using:function(e,t){$(this).css(e),$("<div>").addClass("ui-tooltip-arrow").addClass(t.vertical).addClass(t.horizontal).appendTo(this)}})}function i(){a&&a.hide(),clearInterval(s),clearInterval(l),u=!1,a=null}if(!n.isMobile){var o=$("#responsive-content"),a=null,s=null,l=null,u=!1;e.tooltip({show:!1,hide:!1,open:function(e,n){var o=3*Math.min(500,Date.now()-r);null!==a&&i(),a=n.tooltip,t(e.originalEvent.target),a.hide(),s=setTimeout(function(){a.fadeIn(),u=!0},o),l=setTimeout(function(){a.fadeOut()},o+5e3)},close:function(e,t){a&&t.tooltip[0]===a[0]&&(u&&(r=Date.now()),i())}})}}var n=e("common/benchmark/benchmark"),r=0;return t}),define("common/cookies",[],function(){return{getItem:function(e){return unescape(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+escape(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null},setItem:function(e,t,n,r,i,o){if(!e||/^(?:expires|max\-age|path|domain|secure)$/i.test(e))return!1;var a="";if(n)switch(n.constructor){case Number:a=1/0===n?"; expires=Fri, 31 Dec 9999 23:59:59 GMT":"; max-age="+n;break;case String:a="; expires="+n;break;case Date:a="; expires="+n.toGMTString()}return document.cookie=escape(e)+"="+escape(t)+a+(i?"; domain="+i:"")+(r?"; path="+r:"")+(o?"; secure":""),!0},removeItem:function(e,t){return e&&this.hasItem(e)?(document.cookie=escape(e)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"+(t?"; path="+t:""),!0):!1},hasItem:function(e){return new RegExp("(?:^|;\\s*)"+escape(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(document.cookie)},keys:function(){for(var e=document.cookie.replace(/((?:^|\s*;)[^\=]+)(?=;|$)|^\s*|\s*(?:\=[^;]*)?(?:\1|$)/g,"").split(/\s*(?:\=[^;]*)?;\s*/),t=0;t<e.length;t++)e[t]=unescape(e[t]);return e}}}),define("common/controllers/setup-banner",["lab.config","common/controllers/text-controller","common/controllers/image-controller","common/controllers/div-controller","common/controllers/playback-controller"],function(){var e=require("lab.config"),t=require("common/controllers/text-controller"),n=require("common/controllers/image-controller"),r=require("common/controllers/div-controller"),i=require("common/controllers/playback-controller"),o=1.5,a=.65*o,s=o/10;return function(l,u,c,d,h,p){function f(e,o){var a;"text"===e.type?a=t:"image"===e.type?a=n:"div"===e.type?a=r:"playback"===e.type&&(a=i),y[e.id]=new a(e,l),b.push(o),x[o.id]=[e.id]}function m(){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement?!0:~$(".fullscreen").css("background-image").indexOf("exit")}var g,v,y={},b=[],x={},w=u.about||u.subtitle;return b.push({id:"top-bar",top:"0",left:"0",height:o+"em","padding-top":s+"em","padding-bottom":s+"em",width:"container.width",aboveOthers:!0}),b.push({id:"bottom-bar",bottom:"container.height",left:"0",width:"container.width",height:"2.5em",belowOthers:!0}),h.update(u),f({type:"text",id:"about-link",text:"About",onClick:function(){w?h.open():d.open()},tooltip:"Instructions"},{id:"banner-right",fontScale:a,top:"0",height:o+"em","padding-top":s+"em","padding-bottom":s+"em",right:"interactive.width","padding-left":"1em","padding-right":"0.75em",align:"right",aboveOthers:!0}),e.sharing&&(p.update(u),f({type:"text",id:"share-link",text:"Share",onClick:function(){p.open()},tooltip:"Share using e-mail, IM or embed in website"},{id:"banner-middle",fontScale:a,top:"0",height:o+"em","padding-top":s+"em","padding-bottom":s+"em",right:"banner-right.left","padding-right":"1em",align:"right",aboveOthers:!0})),l.helpSystem&&(f({type:"div",id:"help-icon",content:'<i class="icon-question-sign"></i>',onClick:function(){l.helpSystem.isActive()?l.helpSystem.stop():l.helpSystem.start()},tooltip:"Show help tips"},{id:"banner-help",fontScale:a,top:"0",height:o+"em","padding-top":s+"em","padding-bottom":s+"em",left:"0.7em","padding-right":"1em",align:"left",aboveOthers:!0}),l.helpSystem.on("start.icon",function(){var e=$("#help-icon > i");e.addClass("icon-remove-sign active"),e.removeClass("icon-question-sign")}),l.helpSystem.on("stop.icon",function(){var e=$("#help-icon > i");e.addClass("icon-question-sign"),e.removeClass("icon-remove-sign active")})),d.update(u),f({type:"div",id:"credits-link",height:"2.5em",width:"8.1em",classes:["credits"],tooltip:"Learn more about The Concord Consortium",onClick:function(){d.open()}},{id:"banner-bottom-left",bottom:"container.height",left:"0","padding-left":"0.3em",align:"left",belowOthers:!0}),g=document.body,v=g.requestFullScreen||g.webkitRequestFullScreen||g.mozRequestFullScreen||g.msRequestFullScreen,document.cancelFullscreenMethod=document.cancelFullScreen||document.webkitCancelFullScreen||document.mozCancelFullScreen||document.msCancelFullScreen,v&&f({type:"div",id:"fullsize-link",height:"2.5em",width:"2.5em",classes:["fullscreen"],tooltip:"Toggle full-screen",onClick:function(){m()?document.cancelFullscreenMethod():v.call(g)}},{id:"banner-bottom-right",bottom:"container.height",right:"container.width",align:"left","padding-left":"1em",belowOthers:!0}),f({type:"playback",id:"playback"},{id:"interactive-playback-container",bottom:"container.height",left:"container.width/2 - interactive-playback-container.width/2",height:"banner-bottom-left.height",belowOthers:!0}),{components:y,template:b,layout:x}}}),define("common/controllers/about-dialog",["require","common/markdown-to-html","common/inherit","common/controllers/basic-dialog"],function(e){function t(){i.call(this,{dialogClass:"about-dialog"})}var n=e("common/markdown-to-html"),r=e("common/inherit"),i=e("common/controllers/basic-dialog");return r(t,i),t.prototype.update=function(e){var t=$("<div>");this.set("title","About: "+e.title),e.subtitle&&t.append(n(e.subtitle)),t.append(n(e.about)),this.setContent(t)},t}),define("text!common/controllers/share-dialog.tpl",[],function(){return"<div>\n  <h2>\n    Paste this\n    <a class='opens-in-new-window' href='{{embeddableSharingUrl}}' target='_blank'>link</a>\n    in email or IM.\n  </h2>\n  <textarea>{{embeddableSharingUrl}}</textarea>\n  <h2>Paste HTML to embed in website or blog.</h2>\n  <p>Select Size:\n    <select id='iframe-size'>\n      <option value='smaller'>30% smaller</option>\n      <option selected value='actual'>actual</option>\n      <option value='larger'>50% larger</option>\n    </select>\n  </p>\n  <textarea id='share-iframe-content'></textarea>\n  {{> copyright}}\n</div>\n"}),define("text!common/controllers/copyright.tpl",[],function(){return'<div class="copyright-section"><strong>Copyright  2013&nbsp;</strong><a class="opens-in-new-window" href="http://concord.org" id="share-license-link" target="_blank">The Concord Consortium</a>. All rights reserved. The software is licensed under&nbsp;<a class="opens-in-new-window" href="http://opensource.org/licenses/BSD-2-Clause" id="share-license-link" target="_blank">Simplified BSD</a>, <a class="opens-in-new-window" href="http://opensource.org/licenses/MIT" id="share-license-link" target="_blank">MIT</a> or <a class="opens-in-new-window" href="http://opensource.org/licenses/Apache-2.0" id="share-license-link" target="_blank">Apache 2.0</a> licenses. Please provide attribution to the Concord Consortium and the URL&nbsp;<a class="opens-in-new-window" href="http://concord.org/" id="share-license-link" target="_blank">http://concord.org</a>.</div>'}),define("common/controllers/share-dialog",["require","lab.config","mustache","common/inherit","common/controllers/basic-dialog","text!common/controllers/share-dialog.tpl","text!common/controllers/copyright.tpl"],function(e){function t(){var e=l.hash,t=l.href.match(/(.*?\/\/.*?)\//)[1],i=l.pathname.replace(/\/[^\/]+$/,"/embeddable.html");o.call(this,{dialogClass:"share-dialog"}),this._view={},this._view.embeddableSharingUrl=n.homeForSharing?n.homeForSharing+n.homeEmbeddablePath+e:t+i+e,this.setContent(r.render(a,this._view,{copyright:s})),this._$interactiveContainer=$("#responsive-content"),this._$iframeSize=this.$element.find("#iframe-size"),this._$iframeContent=this.$element.find("#share-iframe-content"),this._$iframeSize.on("change",$.proxy(this.updateIframeSize,this)),this.updateIframeSize()}var n=e("lab.config"),r=e("mustache"),i=e("common/inherit"),o=e("common/controllers/basic-dialog"),a=e("text!common/controllers/share-dialog.tpl"),s=e("text!common/controllers/copyright.tpl"),l=document.location,u=r.compile('<iframe width="{{width}}px" height="{{height}}px" frameborder="no" scrolling="no" allowfullscreen="true" webkitallowfullscreen="true" mozallowfullscreen="true" src="{{{embeddableSharingUrl}}}"></iframe>');return i(t,o),t.prototype.updateIframeSize=function(){var e=this._$interactiveContainer.innerWidth(),t=this._$interactiveContainer.innerHeight(),n=this._$iframeSize.val();switch(n){case"smaller":this._view.width=Math.floor(.7*e),this._view.height=Math.floor(.7*t);break;case"larger":this._view.width=Math.floor(1.5*e),this._view.height=Math.floor(1.5*t);break;default:this._view.width=e,this._view.height=t}this._$iframeContent.val(u(this._view))},t.prototype.update=function(e){this.set("title","Share: "+e.title)},t}),define("text!common/controllers/credits-dialog.tpl",[],function(){return'<div>\n  <p>\n    This interactive was created by the <a href="{{concordUrl}}" target="_blank">Concord Consortium</a>\n    using our <a href="{{nextGenUrl}}" target="_blank">Next-Generation Molecular Workbench</a> software,\n    with funding by a grant from <a href="http://www.google.org/" target="_blank">Google.org</a>.\n   </p>\n   {{#showShareable}}\n   <p>\n      Find a <a href="{{interactiveCreditsUrl}}" class="opens-in-new-window" target="_blank">shareable version</a>\n      of this interactive along with dozens of other open-source interactives for science, math and engineering at\n      <a href="{{concordUrl}}" class="opens-in-new-window" target="_blank">concord.org</a>.\n    </p>\n    {{/showShareable}}\n  {{> copyright}}\n</div>\n'}),define("common/controllers/credits-dialog",["require","lab.config","mustache","common/inherit","common/controllers/basic-dialog","text!common/controllers/credits-dialog.tpl","text!common/controllers/copyright.tpl"],function(e){function t(){o.call(this,{dialogClass:"credits-dialog"})}var n=e("lab.config"),r=e("mustache"),i=e("common/inherit"),o=e("common/controllers/basic-dialog"),a=e("text!common/controllers/credits-dialog.tpl"),s=e("text!common/controllers/copyright.tpl");
return i(t,o),t.prototype.update=function(e){var t,i={concordUrl:"http://concord.org",nextGenUrl:"http://mw.concord.org/nextgen/"},o=document.location.hash;this.set("title","Credits: "+e.title),i.interactiveCreditsUrl=n.homeForSharing?n.homeForSharing+n.homeEmbeddablePath+o:n.home+n.homeEmbeddablePath+o,n.utmCampaign&&(t="utm_source="+encodeURIComponent(e.title.replace(/ /gi,"+"))+"&utm_medium=embedded_interactive&utm_campaign="+n.utmCampaign,i.concordUrl+="?"+t,i.nextGenUrl+="?"+t,i.interactiveCreditsUrl+="?"+encodeURI("utm_source=embed_link&utm_medium=embedded_interactive&utm_campaign="+n.utmCampaign)),n.sharing||(i.showShareable=!0),this.setContent(r.render(a,i,{copyright:s}))},t}),define("common/layout/semantic-layout-config",[],function(){return{iterationsLimit:35,minModelWidth:150,minFontSize:.65,canonicalFontSize:.9,canonicalWidth:565,containerColors:["rgba(0,0,255,0.1)","rgba(255,0,0,0.1)","rgba(0,255,0,0.1)","rgba(255,255,0,0.1)","rgba(0,255,255,0.1)","rgba(255,255,128,0.1)","rgba(128,255,0,0.1)","rgba(255,128,0,0.1)"]}}),define("common/layout/semantic-layout",["require","lab.config","common/layout/semantic-layout-config","arrays","common/console","common/alert"],function(require){var labConfig=require("lab.config"),layoutConfig=require("common/layout/semantic-layout-config"),arrays=require("arrays"),console=require("common/console"),alert=require("common/alert");return function SemanticLayout($interactiveContainer){function reset(){modelWidth=layoutConfig.minModelWidth,modelTop=0,modelLeft=0,topBoundary=0,leftBoundary=0,bottomBarWidth=0}function getDimensionOfContainer(e,t){var n=e.position();switch(t){case"top":return n.top;case"bottom":return n.top+e.outerHeight();case"left":return n.left;case"right":return n.left+e.outerWidth();case"height":return e.outerHeight();case"width":return e.outerWidth()}}function setFontSize(){var e,t,n=layoutConfig.canonicalWidth,r=n/aspectRatio;e=Math.min($interactiveContainer.width()/n,$interactiveContainer.height()/r),padding=10*e,t=layoutConfig.canonicalFontSize*fontScale*e,t<layoutConfig.minFontSize&&(t=layoutConfig.minFontSize),$("#responsive-content").css("font-size",t+"em"),fontSizeChanged=!0}function setupBackground(){var e,t,n,r=layoutConfig.containerColors;for(t=0,n=containerSpecList.length;n>t;t++)e=containerSpecList[t].id,$containerByID[e].css("background",labConfig.authoring?r[t%r.length]:"")}function createContainers(){var e,t,n,r,i;for($interactiveContainer.empty(),$containerByID={},containerSpecByID={},r=0,i=containerSpecList.length;i>r;r++){e=containerSpecList[r],t=e.id,containerSpecByID[t]=e,$containerByID[t]=$("<div id='"+t+"'>").appendTo($interactiveContainer),$containerByID[t].css({display:"inline-block",position:"absolute"}),void 0===e.width&&$containerByID[t].css("white-space","nowrap");for(n in e)e.hasOwnProperty(n)&&(/^padding-/.test(n)?$containerByID[t].css(n,e[n]):"align"===n?$containerByID[t].css("text-align",e[n]):"min-width"===n?$containerByID[t].css("min-width",e[n]):"fontScale"===n&&$containerByID[t].css("font-size",e[n]+"em"))}}function placeComponentsInContainers(){var e,t,n,r,i,o,a,s,l,u,c,d,h,p,f,m;l=$.extend({},componentByID);for(t in containersContent)if(containersContent.hasOwnProperty(t))if($containerByID[t])if(n=containersContent[t],arrays.isArray(n))for(arrays.isArray(n[0])||(n=[n]),h=0,p=n.length;p>h;h++)for(r=n[h],i=$('<div class="interactive-row"/>'),i.css("width","100%"),1===p&&i.css("height","100%"),$containerByID[t].append(i),f=0,m=r.length;m>f;f++)e=r[f],void 0!==l[e]?(i.append(l[e].getViewContainer()),delete l[e]):alert("Incorrect layout definition. Component with ID '"+e+"'' is not defined.");else u="Incorrect layout definition for '"+t+"' container. It should specify an array of components or an array of arrays of components (multiple rows).",alert(u);else u="Incorrect layout definition - '"+t+"' container does not exist.",alert(u);s=containerSpecByID.bottom||containerSpecList[containerSpecList.length-1],o=$containerByID[s.id].children(),i=o.last(),i.length||(i=$('<div class="interactive-row"/>'),$containerByID[s.id].append(i));for(e in l)l.hasOwnProperty(e)&&i.append(l[e].getViewContainer());for(c=0,d=containerSpecList.length;d>c;c++)a=$containerByID[containerSpecList[c].id].children().children(),a.length>1&&a.addClass("component-spacing")}function positionContainers(){var e,t,n,r,i,o,a,s,l,u;for($modelContainer.css({width:modelWidth,height:modelController.getHeightForWidth(modelWidth,fontSizeChanged),left:modelLeft,top:modelTop}),fontSizeChanged=!1,s=0,l=containerSpecList.length;l>s;s++)e=containerSpecList[s],t=$containerByID[e.id],e.left||e.right||(e.left="0"),e.top||e.bottom||(e.top="0"),e.left&&(n=parseDimension(e.left),t.css("left",n)),e.top&&(r=parseDimension(e.top),t.css("top",r)),e.height&&t.css("height",parseDimension(e.height)),e.width&&t.css("width",parseDimension(e.width)),e.right&&(i=parseDimension(e.right),e.left?t.css("width",i-n):(n=i-t.outerWidth(),t.css("left",n))),e.bottom&&(o=parseDimension(e.bottom),e.top?t.css("height",o-r):(r=o-t.outerHeight(),t.css("top",r))),e.aboveOthers&&(o=getDimensionOfContainer(t,"bottom")+padding,o>topBoundary&&(topBoundary=o)),e.belowOthers&&(a=getDimensionOfContainer(t,"height")+padding,a>bottomBarWidth&&(bottomBarWidth=a));leftBoundary=padding;for(u in $containerByID)$containerByID.hasOwnProperty(u)&&(containerSpecByID[u]&&containerSpecByID[u].aboveOthers||containerSpecByID[u]&&containerSpecByID[u].belowOthers||(t=$containerByID[u],r=getDimensionOfContainer(t,"top"),t.css("top",r+topBoundary),n=getDimensionOfContainer(t,"left"),t.css("left",n+leftBoundary)))}function resizeModelContainer(){var e,t,n,r,i,o,a,s=-1/0,l=-1/0,u=1/0,c=1/0;for(e in $containerByID)$containerByID.hasOwnProperty(e)&&(containerSpecByID[e]&&containerSpecByID[e].aboveOthers||containerSpecByID[e]&&containerSpecByID[e].belowOthers||(t=$containerByID[e],n=getDimensionOfContainer(t,"right"),n>s&&(s=n),r=getDimensionOfContainer(t,"bottom"),r>l&&(l=r),o=getDimensionOfContainer(t,"left"),u>o&&(u=o),i=getDimensionOfContainer(t,"top"),c>i&&(c=i)));return availableWidth+2>=s&&availableHeight-bottomBarWidth+2>=l&&(Math.abs(availableWidth-s)<2||Math.abs(availableHeight-bottomBarWidth-l)<2)&&Math.abs(u-leftBoundary)<2&&Math.abs(c-topBoundary)<2?!0:(a=Math.min(availableWidth/s,(availableHeight-bottomBarWidth)/l),isNaN(a)||(modelWidth*=a),modelWidth<layoutConfig.minModelWidth&&(modelWidth=layoutConfig.minModelWidth),modelLeft-=u-leftBoundary,modelTop-=c-topBoundary,!1)}function parseDimension(dim){var vars,i,ii,value;if("number"==typeof dim||/^[0-9]+\.?[0-9]*(em)?$/.test(dim))return dim;for(vars=dim.match(/[a-zA-Z][a-zA-Z0-9\-]+\.[a-zA-Z]+/g),i=0,ii=vars.length;ii>i;i++)value=getDimension(vars[i]),dim=dim.replace(vars[i],value);return/^[^a-zA-Z]*$/.test(dim)?eval(dim):0}function getDimension(e){switch(e){case"container.width":return availableWidth;case"container.height":return availableHeight;case"interactive.left":return leftBoundary;case"interactive.top":return topBoundary;case"interactive.width":case"interactive.right":return availableWidth-leftBoundary;case"interactive.height":case"interactive.bottom":return availableHeight-topBoundary-bottomBarWidth;default:return e=e.split("."),getDimensionOfContainer($containerByID[e[0]],e[1])}}var layout,containerSpecList,containersContent,componentByID,modelController,aspectRatio,fontScale,containerSpecByID,$containerByID,$modelContainer,availableWidth,availableHeight,padding=10,fontSizeChanged=!1,modelWidth,modelTop,modelLeft,topBoundary,leftBoundary,bottomBarWidth;return layout={initialize:function(e,t,n,r,i){containerSpecList=e,containersContent=t,componentByID=n,aspectRatio=r,fontScale=i,createContainers(),placeComponentsInContainers(),modelController=null},setupModel:function(e){if(modelController=e,$containerByID.model){if($containerByID.model===modelController.getViewContainer())return;$containerByID.model.remove()}$modelContainer=modelController.getViewContainer(),$modelContainer.css({display:"inline-block",position:"absolute","z-index":"0"}),$modelContainer.appendTo($interactiveContainer),$containerByID.model=$modelContainer},isReady:function(){return modelController?!0:!1},layoutInteractive:function(){var e,t=layoutConfig.iterationsLimit;for(console.time("[layout] update"),reset(),availableWidth=$interactiveContainer.width(),availableHeight=$interactiveContainer.height(),modelWidth=availableWidth,setFontSize(),positionContainers();--t>0&&!resizeModelContainer();)positionContainers();modelController.resize();for(e in componentByID)componentByID.hasOwnProperty(e)&&void 0!==componentByID[e].resize&&componentByID[e].resize();return setupBackground(),console.timeEnd("[layout] update"),layoutConfig.iterationsLimit-t}}}}),define("common/layout/templates",[],function(){return{simple:[{id:"top",bottom:"model.top",width:"interactive.width"},{id:"right",top:"model.top",left:"model.right",height:"model.height","padding-left":"1em","padding-right":"0.5em"},{id:"bottom",top:"model.bottom",width:"interactive.width","padding-top":"0.5em"}],"narrow-right":[{id:"top",bottom:"model.top",width:"interactive.width"},{id:"right",top:"model.top",left:"model.right",height:"model.height","padding-left":"1em","padding-right":"0.5em",width:"model.width / 4","min-width":"6em"},{id:"bottom",top:"model.bottom",width:"interactive.width","padding-top":"0.5em"}],"wide-right":[{id:"top",bottom:"model.top",width:"interactive.width"},{id:"right",top:"model.top",left:"model.right",height:"model.height","padding-left":"1em","padding-right":"0.5em",width:"model.width","min-width":"6em"},{id:"bottom",top:"model.bottom",width:"interactive.width","padding-top":"0.5em"}],"left-right-bottom":[{id:"left",top:"model.top",height:"model.height",right:"model.left","padding-right":"0.5em"},{id:"right",top:"model.top",height:"model.height",left:"model.right","padding-left":"1em","padding-right":"0.5em"},{id:"bottom",top:"model.bottom",left:"model.left",width:"model.width"}]}}),define("common/performance",[],function(){var e,t,n=!1;return e="undefined"!=typeof performance&&"undefined"!=typeof performance.now?$.proxy(performance.now,performance):$.proxy(Date.now,Date),{now:e,collectData:function(e){n=e,n&&(t={})},enterScope:function(r){if(n){var i=t[r];void 0===i&&(i=t[r]={lastTime:0,timeSum:0,count:0}),i.lastTime=e()}},leaveScope:function(r){if(n){var i=t[r];void 0!==i&&(i.timeSum+=e()-i.lastTime,i.count+=1)}},getAvgTime:function(e){var n=t[e];return void 0!==n?n.timeSum/n.count:0},getAvgFreq:function(e){var n=t[e];return void 0!==n?1e3*n.count/n.timeSum:0}}}),define("common/controllers/model-controller",["require","lab.config","common/performance"],function(e){function t(e,o,a,s,l,u,c){function d(){r.enterScope("js-rendering"),g.modelContainer.update(),r.leaveScope("js-rendering")}function h(){v=new s(o,{waitForSetup:!0}),v.on("tick.modelController",d),v.on("reset.modelController",p)}function p(){x=x||t.RESET_CAUSE.RESET,b.repaint(),w.modelReset(x)}function f(){b=new l(v,g.modelUrl)}function m(n,r,i){v.willReset&&v.willReset(),e=n||e,o=r||o,h(),b.bindModel(v,e),i||w.modelLoaded(t.LOAD_CAUSE.RELOAD)}var g,v,y,b,x,w=d3.dispatch("modelLoaded","modelReset","modelSetupComplete");if(g={get type(){return s.type},get benchmarks(){return y},get modelUrl(){return e},get model(){return v},get modelContainer(){return b},on:function(e,t){w.on(e,t)},getViewContainer:function(){return g.modelContainer.$el},getHeightForWidth:function(e,t){return g.modelContainer.getHeightForWidth(e,t)},initializeView:function(){g.modelContainer.setup(),g.modelContainer.repaint()},resize:function(){g.modelContainer.resize()},repaint:function(){g.modelContainer.repaint()},updateView:function(){g.modelContainer.update()},reload:m,reset:function(e){v.stop(),x=e,v.reset(),x=void 0},state:function(){return v.serialize()},ScriptingAPI:u,enableKeyboardHandlers:function(){return v.get("enableKeyboardHandlers")},modelSetupComplete:function(){v.ready&&v.ready(),w.modelSetupComplete()}},"production"===n.environment)try{h()}catch(_){throw alert(_),new Error(_)}else h(),i.getModel=function(){return v};return y=new c(g),f(),g}var n=e("lab.config"),r=e("common/performance"),i=function(){return this}();return t.LOAD_CAUSE={RELOAD:"reload",INITIAL_LOAD:"initialLoad"},t.RESET_CAUSE={RESET:"reset"},t}),define("common/serialize",["require","arrays"],function(e){var t=e("arrays"),n=function(e){var r,i;if(t.isArray(e))for(r=0,i=e.length;i>r;r++)(1/0===e[r]||e[r]===-1/0)&&(e[r]=e[r].toString());else for(r in e)e.hasOwnProperty(r)&&((1/0===e[r]||e[r]===-1/0)&&(e[r]=e[r].toString()),("object"==typeof e[r]||t.isArray(e[r]))&&n(e[r]))};return function(e,r,i){var o,a,s={};for(o in e)e.hasOwnProperty(o)&&void 0!==r[o]&&e[o].serialize!==!1&&(a=r[o],s[o]=t.isArray(a)?t.copy(a,[],i):"object"==typeof a?$.extend(!0,{},a):a);return n(s),s}}),define("common/property-support",[],function(){function e(e,t,n){if(typeof n!==e)throw new TypeError(t+" must be a "+e+".")}function t(e){var t=[];return e.forEach(function(e){t.push(e)}),t}var n={get:{defaultValue:void 0,type:"function"},set:{defaultValue:void 0,type:"function"},validate:{defaultValue:void 0,type:"function"},beforeSetCallback:{defaultValue:void 0,type:"function"},afterSetCallback:{defaultValue:void 0,type:"function"},afterGetTransform:{defaultValue:void 0,type:"function"},beforeSetTransform:{defaultValue:void 0,type:"function"},writable:{defaultValue:!0,type:"boolean"},includeInHistoryState:{defaultValue:!1,type:"boolean"},invokeSetterAfterBulkRestore:{defaultValue:!0,type:"boolean"},type:{defaultValue:void 0,type:"propertyType"},description:{defaultValue:void 0}};return function(r){function i(){return k.filter(function(e){return x[e].observers.length>0})}function o(e){if(b.indexOf(e)<0)throw new TypeError(e+" is not a recognized property type.")}function a(t){var r={};return Object.keys(n).forEach(function(i){var a=n[i];if(void 0!==t[i])switch(r[i]=t[i],a.type){case"boolean":r[i]=!!r[i];break;case"function":e("function",i,t[i]);break;case"string":e("string",i,t[i]);break;case"propertyType":o(t[i])}else r[i]=a.defaultValue}),r}function s(e){var t=[];e.forEach(function(e){t.indexOf(e)<0&&(e(),t.push(e))})}function l(e){var t=[];T=!0,e(),T=!1,S.forEach(function(e){x[e].observers.forEach(function(e){t.push(e)})}),S=[],s(t)}function u(e){T?S.push(e):s(x[e].observers)}function c(e){s(x[e].propertyDescriptionObservers)}function d(e){var t=x[e];return t.descriptor.get?_?(t.hasCachedValue||(t.hasCachedValue=!0,t.cachedValue=t.descriptor.get()),t.cachedValue):t.descriptor.get():t.cachedValue}function h(e,t){var n=x[e];if(!n.descriptor.writable)throw new Error("Attempt to set read-only property "+e);n.descriptor.get&&!_?n.hasCachedValue=!1:(n.hasCachedValue=!0,n.cachedValue=t)}function p(e,t){var n=x[e];n.descriptor.description=t,c(e)}function f(e){w.all=void 0,e&&(w.byType[e]=void 0)}function m(e,t){var n=x[t];Object.defineProperty(e,t,{enumerable:!0,configurable:!1,get:function(){var e=d(t);return n.descriptor.afterGetTransform&&(e=n.descriptor.afterGetTransform(e)),e},set:function(e){n.descriptor.beforeSetCallback&&n.descriptor.beforeSetCallback(),n.descriptor.beforeSetTransform&&(e=n.descriptor.beforeSetTransform(e)),n.descriptor.validate&&(e=n.descriptor.validate(e)),h(t,e),n.descriptor.set&&n.descriptor.set(e),n.descriptor.afterSetCallback&&n.descriptor.afterSetCallback(),u(t)}})}function g(e){var t=e?w.byType[e]:w.all;return t||(t={},Object.keys(x).forEach(function(n){e&&e!==x[n].descriptor.type||m(t,n)}),Object.seal&&Object.seal(t),e?w.byType[e]=t:w.all=t),t}var v,y,b=r&&r.types&&t(r.types)||[],x={},w={all:void 0,byType:{}},_=!0,T=!1,A=d3.dispatch("beforeInvalidatingChange","afterInvalidatingChange","afterInvalidatingChangeSequence"),C=0,E=!1,S=[],k=[],P=[];return y={mixInto:function(e){Object.defineProperty(e,"properties",{configurable:!1,enumerable:!0,get:g}),e.propertiesOfType=function(e){return g(e)},e.set=function(t,n){var r;"string"==typeof t?e.properties[t]=n:(r=t,l(function(){Object.keys(r).forEach(function(t){e.properties[t]=r[t]})}))},e.get=function(t){return e.properties[t]},e.freeze=function(t){var n=e.getPropertyDescription(t);n.setFrozen(!0),p(t,n)},e.unfreeze=function(t){var n=e.getPropertyDescription(t);n.setFrozen(!1),p(t,n)},e.addObserver=function(e,t){if(x[e]){var n=x[e].observers;n.indexOf(t)<0&&n.push(t)}},e.removeObserver=function(e,t){var n=x[e].observers,r=n.indexOf(t);r>=0&&n.splice(r,1)},e.addPropertyDescriptionObserver=function(e,t){if(x[e]){var n=x[e].propertyDescriptionObservers;n.indexOf(t)<0&&n.push(t)}},e.removePropertyDescriptionObserver=function(e,t){var n=x[e].propertyDescriptionObservers,r=n.indexOf(t);r>=0&&n.splice(r,1)},e.getPropertyDescription=function(e){return x[e].descriptor.description},e.getPropertyType=function(e){return x[e].descriptor.type},e.getPropertyValidateFunc=function(e){return x[e].descriptor.validate},e.makeInvalidatingChange=function(e){y.invalidatingChangePreHook(),e(),y.invalidatingChangePostHook()},e.addPropertiesListener=function(t,n){"string"==typeof t?e.addObserver(t,n):t.forEach(function(t){e.addObserver(t,n)})}},defineProperty:function(e,t){t=a(t||{}),x[e]={descriptor:t,observers:[],propertyDescriptionObservers:[],hasCachedValue:!1,cachedValue:void 0,previousValue:void 0},t.get&&k.push(e),t.includeInHistoryState&&P.push(e),f(t.type)},setPropertyDescription:function(e,t){p(e,t)},deleteComputedPropertyCachedValues:function(){k.forEach(function(e){x[e].hasCachedValue=!1,x[e].cachedValue=void 0})},storeComputedProperties:function(){i().forEach(function(e){x[e].previousValue=d(e)})},notifyChangedComputedProperties:function(){l(function(){i().forEach(function(e){d(e)!==x[e].previousValue&&u(e),x[e].previousValue=void 0})})},notifyAllComputedProperties:function(){l(function(){i().forEach(function(e){u(e)})})},get properties(){return g()},propertiesOfType:function(e){return g(e)},get enableCaching(){return _},set enableCaching(e){_=!!e},get historyStateRawValues(){var e={};return P.forEach(function(t){e[t]=d(t)}),e},get rawValues(){var e={};return Object.keys(x).forEach(function(t){e[t]=d(t)}),e},setRawValues:function(e){l(function(){Object.keys(e).forEach(function(t){var n=x[t];n&&(d(t)!==e[t]&&u(t),h(t,e[t]),n.descriptor.invokeSetterAfterBulkRestore&&n.descriptor.set&&n.descriptor.set(d(t)))})})},invalidatingChangePreHook:function(){E&&v||(v=!0,0===C&&(y.storeComputedProperties(),y.deleteComputedPropertyCachedValues(),y.enableCaching=!1),C++,A.beforeInvalidatingChange())},invalidatingChangePostHook:function(){E||(C--,A.afterInvalidatingChange(),0===C&&(y.enableCaching=!0,y.notifyChangedComputedProperties(),A.afterInvalidatingChangeSequence()))},startBatch:function(){v=!1,E=!0},endBatch:function(){E=!1,v&&y.invalidatingChangePostHook()},on:function(e,t){A.on(e,t)}}}}),define("common/property-description",["require","underscore"],function(e){function t(e){return""===e}function n(e,t){var n;if(this._descriptionHash=t,this._label=t.label||"",this._unitName="",this._unitPluralName="",this._unitAbbreviation="",t.unitType){if(!(n=e.units[t.unitType]))throw new Error("PropertyDescription: couldn't find unitType "+t.unitType+" in the supplied units definition.");this._unitType=t.unitType,this._unitName=n.name,this._unitPluralName=n.pluralName,this._unitAbbreviation=n.symbol}t.unitName&&(this._unitName=t.unitName),t.unitPluralName&&(this._unitPluralName=t.unitPluralName),t.unitAbbreviation&&(this._unitAbbreviation=t.unitAbbreviation),this._min=t.min,this._max=t.max,this._frozen=t.frozen,this.setFormat(t.format)}var r=e("underscore");return n.prototype.getHash=function(){return r.extend(r.reject({unitName:this.getUnitName(),unitPluralName:this.getUnitPluralName(),unitAbbreviation:this.getUnitAbbreviation()},t),this._descriptionHash)},n.prototype.getLabel=function(){return this._label},n.prototype.getUnitType=function(){return this._unitType},n.prototype.getUnitName=function(){return this._unitName},n.prototype.getUnitPluralName=function(){return this._unitPluralName},n.prototype.getUnitAbbreviation=function(){return this._unitAbbreviation},n.prototype.getMin=function(){return this._min},n.prototype.getMax=function(){return this._max},n.prototype.getFrozen=function(){return this._frozen},n.prototype.setFrozen=function(e){this._frozen=e},n.prototype.setFormat=function(e){this._formatter=e?d3.format(e):function(e){return e}},n.prototype.format=function(e,t){t=t||{};var n,r,i,o=!0;return t.format?t.format===this._lastFormat?n=this._lastFormatter:(n=d3.format(t.format),this._lastFormat=t.format,this._lastFormatter=n):n=this._formatter,r=n(e),t&&null!=t.abbreviated&&(o=t.abbreviated),o?r+" "+this._unitAbbreviation:(i=1!==parseFloat(r),r+" "+(i?this._unitPluralName:this._unitName))},n}),define("common/parameter-support",["require","common/property-description"],function(e){var t=e("common/property-description");return function(e){var n=e.propertySupport,r=e.unitsDefinition||{};return{mixInto:function(e){e.defineParameter=function(i,o,a){var s={type:"parameter",includeInHistoryState:!0,invokeSetterAfterBulkRestore:!1,description:new t(r,o),beforeSetCallback:n.invalidatingChangePreHook,afterSetCallback:n.invalidatingChangePostHook};a&&(s.set=function(t){a.call(e,t)}),n.defineProperty(i,s)}}}}}),function(root){var CoffeeScript=function(){function require(e){return require[e]}return require["./helpers"]=new function(){var e=this;(function(){var t,n;e.starts=function(e,t,n){return t===e.substr(n,t.length)},e.ends=function(e,t,n){var r;return r=t.length,t===e.substr(e.length-r-(n||0),r)},e.compact=function(e){var t,n,r,i;for(i=[],n=0,r=e.length;r>n;n++)t=e[n],t&&i.push(t);return i},e.count=function(e,t){var n,r;if(n=r=0,!t.length)return 1/0;for(;r=1+e.indexOf(t,r);)n++;return n},e.merge=function(e,n){return t(t({},e),n)},t=e.extend=function(e,t){var n,r;for(n in t)r=t[n],e[n]=r;return e},e.flatten=n=function(e){var t,r,i,o;for(r=[],i=0,o=e.length;o>i;i++)t=e[i],t instanceof Array?r=r.concat(n(t)):r.push(t);return r},e.del=function(e,t){var n;return n=e[t],delete e[t],n},e.last=function(e,t){return e[e.length-(t||0)-1]}}).call(this)},require["./rewriter"]=new function(){var e=this;(function(){var t,n,r,i,o,a,s,l,u,c,d,h,p,f,m,g,v,y,b=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1},x=[].slice;for(e.Rewriter=function(){function e(){}return e.prototype.rewrite=function(e){return this.tokens=e,this.removeLeadingNewlines(),this.removeMidExpressionNewlines(),this.closeOpenCalls(),this.closeOpenIndexes(),this.addImplicitIndentation(),this.tagPostfixConditionals(),this.addImplicitBraces(),this.addImplicitParentheses(),this.tokens},e.prototype.scanTokens=function(e){var t,n,r;for(r=this.tokens,t=0;n=r[t];)t+=e.call(this,n,t,r);return!0},e.prototype.detectEnd=function(e,t,n){var o,a,s,l,u;for(s=this.tokens,o=0;a=s[e];){if(0===o&&t.call(this,a,e))return n.call(this,a,e);if(!a||0>o)return n.call(this,a,e-1);l=a[0],b.call(i,l)>=0?o+=1:(u=a[0],b.call(r,u)>=0&&(o-=1)),e+=1}return e-1},e.prototype.removeLeadingNewlines=function(){var e,t,n,r,i;for(i=this.tokens,e=n=0,r=i.length;r>n&&(t=i[e][0],"TERMINATOR"===t);e=++n);return e?this.tokens.splice(0,e):void 0},e.prototype.removeMidExpressionNewlines=function(){return this.scanTokens(function(e,t,r){var i;return"TERMINATOR"===e[0]&&(i=this.tag(t+1),b.call(n,i)>=0)?(r.splice(t,1),0):1})},e.prototype.closeOpenCalls=function(){var e,t;return t=function(e,t){var n;return")"===(n=e[0])||"CALL_END"===n||"OUTDENT"===e[0]&&")"===this.tag(t-1)},e=function(e,t){return this.tokens["OUTDENT"===e[0]?t-1:t][0]="CALL_END"},this.scanTokens(function(n,r){return"CALL_START"===n[0]&&this.detectEnd(r+1,t,e),1})},e.prototype.closeOpenIndexes=function(){var e,t;return t=function(e){var t;return"]"===(t=e[0])||"INDEX_END"===t},e=function(e){return e[0]="INDEX_END"},this.scanTokens(function(n,r){return"INDEX_START"===n[0]&&this.detectEnd(r+1,t,e),1})},e.prototype.addImplicitBraces=function(){var e,t,n,o,a,l,u,c;return o=[],a=null,c=null,n=!0,l=0,u=0,t=function(e,t){var r,i,o,a,l,h;return l=this.tokens.slice(t+1,t+3+1||9e9),r=l[0],a=l[1],o=l[2],"HERECOMMENT"===(null!=r?r[0]:void 0)?!1:(i=e[0],b.call(d,i)>=0&&(n=!1),("TERMINATOR"===i||"OUTDENT"===i||b.call(s,i)>=0&&n&&t-u!==1)&&(!c&&","!==this.tag(t-1)||":"!==(null!=a?a[0]:void 0)&&("@"!==(null!=r?r[0]:void 0)||":"!==(null!=o?o[0]:void 0)))||","===i&&r&&"IDENTIFIER"!==(h=r[0])&&"NUMBER"!==h&&"STRING"!==h&&"@"!==h&&"TERMINATOR"!==h&&"OUTDENT"!==h)},e=function(e,t){var n;return n=this.generate("}","}",e[2]),this.tokens.splice(t,0,n)},this.scanTokens(function(s,l,h){var p,f,m,g,v,y,x,w;if(x=g=s[0],b.call(i,x)>=0)return o.push(["INDENT"===g&&"{"===this.tag(l-1)?"{":g,l]),1;if(b.call(r,g)>=0)return a=o.pop(),1;if(":"!==g||":"!==(p=this.tag(l-2))&&"{"===(null!=(w=o[o.length-1])?w[0]:void 0))return 1;for(n=!0,u=l+1,o.push(["{"]),f="@"===p?l-2:l-1;"HERECOMMENT"===this.tag(f-2);)f-=2;return m=this.tag(f-1),c=!m||b.call(d,m)>=0,y=new String("{"),y.generated=!0,v=this.generate("{",y,s[2]),h.splice(f,0,v),this.detectEnd(l+2,t,e),2})},e.prototype.addImplicitParentheses=function(){var e,t,n,r,i;return n=i=r=!1,t=function(e,t){var n,a,l,u;return a=e[0],!i&&e.fromThen?!0:(("IF"===a||"ELSE"===a||"CATCH"===a||"->"===a||"=>"===a||"CLASS"===a)&&(i=!0),("IF"===a||"ELSE"===a||"SWITCH"===a||"TRY"===a||"="===a)&&(r=!0),"."!==a&&"?."!==a&&"::"!==a||"OUTDENT"!==this.tag(t-1)?!e.generated&&","!==this.tag(t-1)&&(b.call(s,a)>=0||"INDENT"===a&&!r)&&("INDENT"!==a||"CLASS"!==(l=this.tag(t-2))&&"EXTENDS"!==l&&(u=this.tag(t-1),b.call(o,u)<0)&&(!(n=this.tokens[t+1])||!n.generated||"{"!==n[0])):!0)},e=function(e,t){return this.tokens.splice(t,0,this.generate("CALL_END",")",e[2]))},this.scanTokens(function(o,s,c){var h,p,f,m,g,v,y,x;return g=o[0],("CLASS"===g||"IF"===g||"FOR"===g||"WHILE"===g)&&(n=!0),v=c.slice(s-1,s+1+1||9e9),m=v[0],p=v[1],f=v[2],h=!n&&"INDENT"===g&&f&&f.generated&&"{"===f[0]&&m&&(y=m[0],b.call(l,y)>=0),i=!1,r=!1,b.call(d,g)>=0&&(n=!1),m&&!m.spaced&&"?"===g&&(o.call=!0),o.fromThen?1:h||(null!=m?m.spaced:void 0)&&(m.call||(x=m[0],b.call(l,x)>=0))&&(b.call(a,g)>=0||!o.spaced&&!o.newLine&&b.call(u,g)>=0)?(c.splice(s,0,this.generate("CALL_START","(",o[2])),this.detectEnd(s+1,t,e),"?"===m[0]&&(m[0]="FUNC_EXIST"),2):1})},e.prototype.addImplicitIndentation=function(){var e,t,n,r,i;return i=n=r=null,t=function(e){var t;return";"!==e[1]&&(t=e[0],b.call(h,t)>=0)&&("ELSE"!==e[0]||"IF"===i||"THEN"===i)},e=function(e,t){return this.tokens.splice(","===this.tag(t-1)?t-1:t,0,r)},this.scanTokens(function(o,a,s){var l,u,c;return l=o[0],"TERMINATOR"===l&&"THEN"===this.tag(a+1)?(s.splice(a,1),0):"ELSE"===l&&"OUTDENT"!==this.tag(a-1)?(s.splice.apply(s,[a,0].concat(x.call(this.indentation(o)))),2):"CATCH"!==l||"OUTDENT"!==(u=this.tag(a+2))&&"TERMINATOR"!==u&&"FINALLY"!==u?b.call(p,l)>=0&&"INDENT"!==this.tag(a+1)&&("ELSE"!==l||"IF"!==this.tag(a+1))?(i=l,c=this.indentation(o,!0),n=c[0],r=c[1],"THEN"===i&&(n.fromThen=!0),s.splice(a+1,0,n),this.detectEnd(a+2,t,e),"THEN"===l&&s.splice(a,1),1):1:(s.splice.apply(s,[a+2,0].concat(x.call(this.indentation(o)))),4)})},e.prototype.tagPostfixConditionals=function(){var e,t,n;return n=null,t=function(e){var t;return"TERMINATOR"===(t=e[0])||"INDENT"===t},e=function(e){return"INDENT"!==e[0]||e.generated&&!e.fromThen?n[0]="POST_"+n[0]:void 0},this.scanTokens(function(r,i){return"IF"!==r[0]?1:(n=r,this.detectEnd(i+1,t,e),1)})},e.prototype.indentation=function(e,t){var n,r;return null==t&&(t=!1),n=["INDENT",2,e[2]],r=["OUTDENT",2,e[2]],t&&(n.generated=r.generated=!0),[n,r]},e.prototype.generate=function(e,t,n){var r;return r=[e,t,n],r.generated=!0,r},e.prototype.tag=function(e){var t;return null!=(t=this.tokens[e])?t[0]:void 0},e}(),t=[["(",")"],["[","]"],["{","}"],["INDENT","OUTDENT"],["CALL_START","CALL_END"],["PARAM_START","PARAM_END"],["INDEX_START","INDEX_END"]],e.INVERSES=c={},i=[],r=[],g=0,v=t.length;v>g;g++)y=t[g],f=y[0],m=y[1],i.push(c[m]=f),r.push(c[f]=m);n=["CATCH","WHEN","ELSE","FINALLY"].concat(r),l=["IDENTIFIER","SUPER",")","CALL_END","]","INDEX_END","@","THIS"],a=["IDENTIFIER","NUMBER","STRING","JS","REGEX","NEW","PARAM_START","CLASS","IF","TRY","SWITCH","THIS","BOOL","NULL","UNDEFINED","UNARY","SUPER","@","->","=>","[","(","{","--","++"],u=["+","-"],o=["->","=>","{","[",","],s=["POST_IF","FOR","WHILE","UNTIL","WHEN","BY","LOOP","TERMINATOR"],p=["ELSE","->","=>","TRY","FINALLY","THEN"],h=["TERMINATOR","CATCH","FINALLY","ELSE","OUTDENT","LEADING_WHEN"],d=["TERMINATOR","INDENT","OUTDENT"]}).call(this)},require["./lexer"]=new function(){var e=this;(function(){var t,n,r,i,o,a,s,l,u,c,d,h,p,f,m,g,v,y,b,x,w,_,T,A,C,E,S,k,P,R,O,M,N,I,L,B,D,F,V,G,$,U,j,q,W,H,z,X,Y=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};z=require("./rewriter"),L=z.Rewriter,v=z.INVERSES,X=require("./helpers"),j=X.count,H=X.starts,U=X.compact,W=X.last,e.Lexer=A=function(){function e(){}return e.prototype.tokenize=function(e,t){var n,r;for(null==t&&(t={}),$.test(e)&&(e="\n"+e),e=e.replace(/\r/g,"").replace(V,""),this.code=e,this.line=t.line||0,this.indent=0,this.indebt=0,this.outdebt=0,this.indents=[],this.ends=[],this.tokens=[],n=0;this.chunk=e.slice(n);)n+=this.identifierToken()||this.commentToken()||this.whitespaceToken()||this.lineToken()||this.heredocToken()||this.stringToken()||this.numberToken()||this.regexToken()||this.jsToken()||this.literalToken();return this.closeIndentation(),(r=this.ends.pop())&&this.error("missing "+r),t.rewrite===!1?this.tokens:(new L).rewrite(this.tokens)},e.prototype.identifierToken=function(){var e,t,n,r,s,l,u,c,d;return(s=m.exec(this.chunk))?(r=s[0],n=s[1],e=s[2],"own"===n&&"FOR"===this.tag()?(this.token("OWN",n),n.length):(t=e||(l=W(this.tokens))&&("."===(c=l[0])||"?."===c||"::"===c||!l.spaced&&"@"===l[0]),u="IDENTIFIER",!t&&(Y.call(x,n)>=0||Y.call(a,n)>=0)&&(u=n.toUpperCase(),"WHEN"===u&&(d=this.tag(),Y.call(w,d)>=0)?u="LEADING_WHEN":"FOR"===u?this.seenFor=!0:"UNLESS"===u?u="IF":Y.call(G,u)>=0?u="UNARY":Y.call(N,u)>=0&&("INSTANCEOF"!==u&&this.seenFor?(u="FOR"+u,this.seenFor=!1):(u="RELATION","!"===this.value()&&(this.tokens.pop(),n="!"+n)))),Y.call(b,n)>=0&&(t?(u="IDENTIFIER",n=new String(n),n.reserved=!0):Y.call(I,n)>=0&&this.error('reserved word "'+n+'"')),t||(Y.call(i,n)>=0&&(n=o[n]),u=function(){switch(n){case"!":return"UNARY";case"==":case"!=":return"COMPARE";case"&&":case"||":return"LOGIC";case"true":case"false":return"BOOL";case"break":case"continue":return"STATEMENT";default:return u}}()),this.token(u,n),e&&this.token(":",":"),r.length)):0},e.prototype.numberToken=function(){var e,t,n,r,i;return(n=R.exec(this.chunk))?(r=n[0],/^0[BOX]/.test(r)?this.error("radix prefix '"+r+"' must be lowercase"):/E/.test(r)&&!/^0x/.test(r)?this.error("exponential notation '"+r+"' must be indicated with a lowercase 'e'"):/^0\d*[89]/.test(r)?this.error("decimal literal '"+r+"' must not be prefixed with '0'"):/^0\d+/.test(r)&&this.error("octal literal '"+r+"' must be prefixed with '0o'"),t=r.length,(i=/^0o([0-7]+)/.exec(r))&&(r="0x"+parseInt(i[1],8).toString(16)),(e=/^0b([01]+)/.exec(r))&&(r="0x"+parseInt(e[1],2).toString(16)),this.token("NUMBER",r),t):0},e.prototype.stringToken=function(){var e,t,n;switch(this.chunk.charAt(0)){case"'":if(!(e=D.exec(this.chunk)))return 0;this.token("STRING",(n=e[0]).replace(E,"\\\n"));break;case'"':if(!(n=this.balancedString(this.chunk,'"')))return 0;0<n.indexOf("#{",1)?this.interpolateString(n.slice(1,-1)):this.token("STRING",this.escapeLines(n));break;default:return 0}return(t=/^(?:\\.|[^\\])*\\(?:0[0-7]|[1-7])/.test(n))&&this.error("octal escape sequences "+n+" are not allowed"),this.line+=j(n,"\n"),n.length},e.prototype.heredocToken=function(){var e,t,n,r;return(n=c.exec(this.chunk))?(t=n[0],r=t.charAt(0),e=this.sanitizeHeredoc(n[2],{quote:r,indent:null}),'"'===r&&0<=e.indexOf("#{")?this.interpolateString(e,{heredoc:!0}):this.token("STRING",this.makeString(e,r,!0)),this.line+=j(t,"\n"),t.length):0},e.prototype.commentToken=function(){var e,t,n;return(n=this.chunk.match(s))?(e=n[0],t=n[1],t&&this.token("HERECOMMENT",this.sanitizeHeredoc(t,{herecomment:!0,indent:Array(this.indent+1).join(" ")})),this.line+=j(e,"\n"),e.length):0
},e.prototype.jsToken=function(){var e,t;return"`"===this.chunk.charAt(0)&&(e=y.exec(this.chunk))?(this.token("JS",(t=e[0]).slice(1,-1)),t.length):0},e.prototype.regexToken=function(){var e,t,n,r,i,o,a;return"/"!==this.chunk.charAt(0)?0:(n=p.exec(this.chunk))?(t=this.heregexToken(n),this.line+=j(n[0],"\n"),t):(r=W(this.tokens),r&&(o=r[0],Y.call(r.spaced?k:P,o)>=0)?0:(n=M.exec(this.chunk))?(a=n,n=a[0],i=a[1],e=a[2],"/*"===i.slice(0,2)&&this.error("regular expressions cannot begin with `*`"),"//"===i&&(i="/(?:)/"),this.token("REGEX",""+i+e),n.length):0)},e.prototype.heregexToken=function(e){var t,n,r,i,o,a,s,l,u,c,d,h,p;if(r=e[0],t=e[1],n=e[2],0>t.indexOf("#{"))return i=t.replace(f,"").replace(/\//g,"\\/"),i.match(/^\*/)&&this.error("regular expressions cannot begin with `*`"),this.token("REGEX","/"+(i||"(?:)")+"/"+n),r.length;for(this.token("IDENTIFIER","RegExp"),this.tokens.push(["CALL_START","("]),a=[],c=this.interpolateString(t,{regex:!0}),l=0,u=c.length;u>l;l++){if(d=c[l],o=d[0],s=d[1],"TOKENS"===o)a.push.apply(a,s);else{if(!(s=s.replace(f,"")))continue;s=s.replace(/\\/g,"\\\\"),a.push(["STRING",this.makeString(s,'"',!0)])}a.push(["+","+"])}return a.pop(),"STRING"!==(null!=(h=a[0])?h[0]:void 0)&&this.tokens.push(["STRING",'""'],["+","+"]),(p=this.tokens).push.apply(p,a),n&&this.tokens.push([",",","],["STRING",'"'+n+'"']),this.token(")",")"),r.length},e.prototype.lineToken=function(){var e,t,n,r,i,o;if(!(n=S.exec(this.chunk)))return 0;if(t=n[0],this.line+=j(t,"\n"),this.seenFor=!1,i=W(this.tokens,1),o=t.length-1-t.lastIndexOf("\n"),r=this.unfinished(),o-this.indebt===this.indent)return r?this.suppressNewlines():this.newlineToken(),t.length;if(o>this.indent){if(r)return this.indebt=o-this.indent,this.suppressNewlines(),t.length;e=o-this.indent+this.outdebt,this.token("INDENT",e),this.indents.push(e),this.ends.push("OUTDENT"),this.outdebt=this.indebt=0}else this.indebt=0,this.outdentToken(this.indent-o,r);return this.indent=o,t.length},e.prototype.outdentToken=function(e,t){for(var n,r;e>0;)r=this.indents.length-1,void 0===this.indents[r]?e=0:this.indents[r]===this.outdebt?(e-=this.outdebt,this.outdebt=0):this.indents[r]<this.outdebt?(this.outdebt-=this.indents[r],e-=this.indents[r]):(n=this.indents.pop()-this.outdebt,e-=n,this.outdebt=0,this.pair("OUTDENT"),this.token("OUTDENT",n));for(n&&(this.outdebt-=e);";"===this.value();)this.tokens.pop();return"TERMINATOR"!==this.tag()&&!t&&this.token("TERMINATOR","\n"),this},e.prototype.whitespaceToken=function(){var e,t,n;return(e=$.exec(this.chunk))||(t="\n"===this.chunk.charAt(0))?(n=W(this.tokens),n&&(n[e?"spaced":"newLine"]=!0),e?e[0].length:0):0},e.prototype.newlineToken=function(){for(;";"===this.value();)this.tokens.pop();return"TERMINATOR"!==this.tag()&&this.token("TERMINATOR","\n"),this},e.prototype.suppressNewlines=function(){return"\\"===this.value()&&this.tokens.pop(),this},e.prototype.literalToken=function(){var e,t,i,o,a,s,c,d;if((e=O.exec(this.chunk))?(o=e[0],r.test(o)&&this.tagParameters()):o=this.chunk.charAt(0),i=o,t=W(this.tokens),"="===o&&t&&(!t[1].reserved&&(a=t[1],Y.call(b,a)>=0)&&this.error('reserved word "'+this.value()+"\" can't be assigned"),"||"===(s=t[1])||"&&"===s))return t[0]="COMPOUND_ASSIGN",t[1]+="=",o.length;if(";"===o)this.seenFor=!1,i="TERMINATOR";else if(Y.call(C,o)>=0)i="MATH";else if(Y.call(l,o)>=0)i="COMPARE";else if(Y.call(u,o)>=0)i="COMPOUND_ASSIGN";else if(Y.call(G,o)>=0)i="UNARY";else if(Y.call(B,o)>=0)i="SHIFT";else if(Y.call(T,o)>=0||"?"===o&&(null!=t?t.spaced:void 0))i="LOGIC";else if(t&&!t.spaced)if("("===o&&(c=t[0],Y.call(n,c)>=0))"?"===t[0]&&(t[0]="FUNC_EXIST"),i="CALL_START";else if("["===o&&(d=t[0],Y.call(g,d)>=0))switch(i="INDEX_START",t[0]){case"?":t[0]="INDEX_SOAK"}switch(o){case"(":case"{":case"[":this.ends.push(v[o]);break;case")":case"}":case"]":this.pair(o)}return this.token(i,o),o.length},e.prototype.sanitizeHeredoc=function(e,t){var n,r,i,o,a;if(i=t.indent,r=t.herecomment){if(d.test(e)&&this.error('block comment cannot contain "*/", starting'),e.indexOf("\n")<=0)return e}else for(;o=h.exec(e);)n=o[1],(null===i||0<(a=n.length)&&a<i.length)&&(i=n);return i&&(e=e.replace(RegExp("\\n"+i,"g"),"\n")),r||(e=e.replace(/^\n/,"")),e},e.prototype.tagParameters=function(){var e,t,n,r;if(")"!==this.tag())return this;for(t=[],r=this.tokens,e=r.length,r[--e][0]="PARAM_END";n=r[--e];)switch(n[0]){case")":t.push(n);break;case"(":case"CALL_START":if(!t.length)return"("===n[0]?(n[0]="PARAM_START",this):this;t.pop()}return this},e.prototype.closeIndentation=function(){return this.outdentToken(this.indent)},e.prototype.balancedString=function(e,t){var n,r,i,o,a,s,l,u;for(n=0,s=[t],r=l=1,u=e.length;u>=1?u>l:l>u;r=u>=1?++l:--l)if(n)--n;else{switch(i=e.charAt(r)){case"\\":++n;continue;case t:if(s.pop(),!s.length)return e.slice(0,r+1||9e9);t=s[s.length-1];continue}"}"!==t||'"'!==i&&"'"!==i?"}"===t&&"/"===i&&(o=p.exec(e.slice(r))||M.exec(e.slice(r)))?n+=o[0].length-1:"}"===t&&"{"===i?s.push(t="}"):'"'===t&&"#"===a&&"{"===i&&s.push(t="}"):s.push(t=i),a=i}return this.error("missing "+s.pop()+", starting")},e.prototype.interpolateString=function(t,n){var r,i,o,a,s,l,u,c,d,h,p,f,m,g,v,y,b,x;for(null==n&&(n={}),i=n.heredoc,h=n.regex,f=[],d=0,o=-1;u=t.charAt(o+=1);)"\\"!==u?"#"===u&&"{"===t.charAt(o+1)&&(r=this.balancedString(t.slice(o+1),"}"))&&(o>d&&f.push(["NEOSTRING",t.slice(d,o)]),a=r.slice(1,-1),a.length&&(c=(new e).tokenize(a,{line:this.line,rewrite:!1}),c.pop(),"TERMINATOR"===(null!=(y=c[0])?y[0]:void 0)&&c.shift(),(l=c.length)&&(l>1&&(c.unshift(["(","(",this.line]),c.push([")",")",this.line])),f.push(["TOKENS",c]))),o+=r.length,d=o+1):o+=1;if(o>d&&d<t.length&&f.push(["NEOSTRING",t.slice(d)]),h)return f;if(!f.length)return this.token("STRING",'""');for("NEOSTRING"!==f[0][0]&&f.unshift(["",""]),(s=f.length>1)&&this.token("(","("),o=g=0,v=f.length;v>g;o=++g)b=f[o],p=b[0],m=b[1],o&&this.token("+","+"),"TOKENS"===p?(x=this.tokens).push.apply(x,m):this.token("STRING",this.makeString(m,'"',i));return s&&this.token(")",")"),f},e.prototype.pair=function(e){var t,n;return e!==(n=W(this.ends))?("OUTDENT"!==n&&this.error("unmatched "+e),this.indent-=t=W(this.indents),this.outdentToken(t,!0),this.pair(e)):this.ends.pop()},e.prototype.token=function(e,t){return this.tokens.push([e,t,this.line])},e.prototype.tag=function(e,t){var n;return(n=W(this.tokens,e))&&(t?n[0]=t:n[0])},e.prototype.value=function(e,t){var n;return(n=W(this.tokens,e))&&(t?n[1]=t:n[1])},e.prototype.unfinished=function(){var e;return _.test(this.chunk)||"\\"===(e=this.tag())||"."===e||"?."===e||"UNARY"===e||"MATH"===e||"+"===e||"-"===e||"SHIFT"===e||"RELATION"===e||"COMPARE"===e||"LOGIC"===e||"THROW"===e||"EXTENDS"===e},e.prototype.escapeLines=function(e,t){return e.replace(E,t?"\\n":"")},e.prototype.makeString=function(e,t,n){return e?(e=e.replace(/\\([\s\S])/g,function(e,n){return"\n"===n||n===t?n:e}),e=e.replace(RegExp(""+t,"g"),"\\$&"),t+this.escapeLines(e,n)+t):t+t},e.prototype.error=function(e){throw SyntaxError(""+e+" on line "+(this.line+1))},e}(),x=["true","false","null","this","new","delete","typeof","in","instanceof","return","throw","break","continue","debugger","if","else","switch","for","while","do","try","catch","finally","class","extends","super"],a=["undefined","then","unless","until","loop","of","by","when"],o={and:"&&",or:"||",is:"==",isnt:"!=",not:"!",yes:"true",no:"false",on:"true",off:"false"},i=function(){var e;e=[];for(q in o)e.push(q);return e}(),a=a.concat(i),I=["case","default","function","var","void","with","const","let","enum","export","import","native","__hasProp","__extends","__slice","__bind","__indexOf","implements","interface","let","package","private","protected","public","static","yield"],F=["arguments","eval"],b=x.concat(I).concat(F),e.RESERVED=I.concat(x).concat(a).concat(F),e.STRICT_PROSCRIBED=F,m=/^([$A-Za-z_\x7f-\uffff][$\w\x7f-\uffff]*)([^\n\S]*:(?!:))?/,R=/^0b[01]+|^0o[0-7]+|^0x[\da-f]+|^\d*\.?\d+(?:e[+-]?\d+)?/i,c=/^("""|''')([\s\S]*?)(?:\n[^\n\S]*)?\1/,O=/^(?:[-=]>|[-+*\/%<>&|^!?=]=|>>>=?|([-+:])\1|([&|<>])\2=?|\?\.|\.{2,3})/,$=/^[^\n\S]+/,s=/^###([^#][\s\S]*?)(?:###[^\n\S]*|(?:###)?$)|^(?:\s*#(?!##[^#]).*)+/,r=/^[-=]>/,S=/^(?:\n[^\n\S]*)+/,D=/^'[^\\']*(?:\\.[^\\']*)*'/,y=/^`[^\\`]*(?:\\.[^\\`]*)*`/,M=/^(\/(?![\s=])[^[\/\n\\]*(?:(?:\\[\s\S]|\[[^\]\n\\]*(?:\\[\s\S][^\]\n\\]*)*])[^[\/\n\\]*)*\/)([imgy]{0,4})(?!\w)/,p=/^\/{3}([\s\S]+?)\/{3}([imgy]{0,4})(?!\w)/,f=/\s+(?:#.*)?/g,E=/\n/g,h=/\n+([^\n\S]*)/g,d=/\*\//,_=/^\s*(?:,|\??\.(?![.\d])|::)/,V=/\s+$/,u=["-=","+=","/=","*=","%=","||=","&&=","?=","<<=",">>=",">>>=","&=","^=","|="],G=["!","~","NEW","TYPEOF","DELETE","DO"],T=["&&","||","&","|","^"],B=["<<",">>",">>>"],l=["==","!=","<",">","<=",">="],C=["*","/","%"],N=["IN","OF","INSTANCEOF"],t=["TRUE","FALSE"],k=["NUMBER","REGEX","BOOL","NULL","UNDEFINED","++","--","]"],P=k.concat(")","}","THIS","IDENTIFIER","STRING"),n=["IDENTIFIER","STRING","REGEX",")","]","}","?","::","@","THIS","SUPER"],g=n.concat("NUMBER","BOOL","NULL","UNDEFINED"),w=["INDENT","OUTDENT","TERMINATOR"]}).call(this)},require["./parser"]=new function(){var e=this,t=function(){var e={trace:function(){},yy:{},symbols_:{error:2,Root:3,Body:4,Block:5,TERMINATOR:6,Line:7,Expression:8,Statement:9,Return:10,Comment:11,STATEMENT:12,Value:13,Invocation:14,Code:15,Operation:16,Assign:17,If:18,Try:19,While:20,For:21,Switch:22,Class:23,Throw:24,INDENT:25,OUTDENT:26,Identifier:27,IDENTIFIER:28,AlphaNumeric:29,NUMBER:30,STRING:31,Literal:32,JS:33,REGEX:34,DEBUGGER:35,UNDEFINED:36,NULL:37,BOOL:38,Assignable:39,"=":40,AssignObj:41,ObjAssignable:42,":":43,ThisProperty:44,RETURN:45,HERECOMMENT:46,PARAM_START:47,ParamList:48,PARAM_END:49,FuncGlyph:50,"->":51,"=>":52,OptComma:53,",":54,Param:55,ParamVar:56,"...":57,Array:58,Object:59,Splat:60,SimpleAssignable:61,Accessor:62,Parenthetical:63,Range:64,This:65,".":66,"?.":67,"::":68,Index:69,INDEX_START:70,IndexValue:71,INDEX_END:72,INDEX_SOAK:73,Slice:74,"{":75,AssignList:76,"}":77,CLASS:78,EXTENDS:79,OptFuncExist:80,Arguments:81,SUPER:82,FUNC_EXIST:83,CALL_START:84,CALL_END:85,ArgList:86,THIS:87,"@":88,"[":89,"]":90,RangeDots:91,"..":92,Arg:93,SimpleArgs:94,TRY:95,Catch:96,FINALLY:97,CATCH:98,THROW:99,"(":100,")":101,WhileSource:102,WHILE:103,WHEN:104,UNTIL:105,Loop:106,LOOP:107,ForBody:108,FOR:109,ForStart:110,ForSource:111,ForVariables:112,OWN:113,ForValue:114,FORIN:115,FOROF:116,BY:117,SWITCH:118,Whens:119,ELSE:120,When:121,LEADING_WHEN:122,IfBlock:123,IF:124,POST_IF:125,UNARY:126,"-":127,"+":128,"--":129,"++":130,"?":131,MATH:132,SHIFT:133,COMPARE:134,LOGIC:135,RELATION:136,COMPOUND_ASSIGN:137,$accept:0,$end:1},terminals_:{2:"error",6:"TERMINATOR",12:"STATEMENT",25:"INDENT",26:"OUTDENT",28:"IDENTIFIER",30:"NUMBER",31:"STRING",33:"JS",34:"REGEX",35:"DEBUGGER",36:"UNDEFINED",37:"NULL",38:"BOOL",40:"=",43:":",45:"RETURN",46:"HERECOMMENT",47:"PARAM_START",49:"PARAM_END",51:"->",52:"=>",54:",",57:"...",66:".",67:"?.",68:"::",70:"INDEX_START",72:"INDEX_END",73:"INDEX_SOAK",75:"{",77:"}",78:"CLASS",79:"EXTENDS",82:"SUPER",83:"FUNC_EXIST",84:"CALL_START",85:"CALL_END",87:"THIS",88:"@",89:"[",90:"]",92:"..",95:"TRY",97:"FINALLY",98:"CATCH",99:"THROW",100:"(",101:")",103:"WHILE",104:"WHEN",105:"UNTIL",107:"LOOP",109:"FOR",113:"OWN",115:"FORIN",116:"FOROF",117:"BY",118:"SWITCH",120:"ELSE",122:"LEADING_WHEN",124:"IF",125:"POST_IF",126:"UNARY",127:"-",128:"+",129:"--",130:"++",131:"?",132:"MATH",133:"SHIFT",134:"COMPARE",135:"LOGIC",136:"RELATION",137:"COMPOUND_ASSIGN"},productions_:[0,[3,0],[3,1],[3,2],[4,1],[4,3],[4,2],[7,1],[7,1],[9,1],[9,1],[9,1],[8,1],[8,1],[8,1],[8,1],[8,1],[8,1],[8,1],[8,1],[8,1],[8,1],[8,1],[8,1],[5,2],[5,3],[27,1],[29,1],[29,1],[32,1],[32,1],[32,1],[32,1],[32,1],[32,1],[32,1],[17,3],[17,4],[17,5],[41,1],[41,3],[41,5],[41,1],[42,1],[42,1],[42,1],[10,2],[10,1],[11,1],[15,5],[15,2],[50,1],[50,1],[53,0],[53,1],[48,0],[48,1],[48,3],[48,4],[48,6],[55,1],[55,2],[55,3],[56,1],[56,1],[56,1],[56,1],[60,2],[61,1],[61,2],[61,2],[61,1],[39,1],[39,1],[39,1],[13,1],[13,1],[13,1],[13,1],[13,1],[62,2],[62,2],[62,2],[62,1],[62,1],[69,3],[69,2],[71,1],[71,1],[59,4],[76,0],[76,1],[76,3],[76,4],[76,6],[23,1],[23,2],[23,3],[23,4],[23,2],[23,3],[23,4],[23,5],[14,3],[14,3],[14,1],[14,2],[80,0],[80,1],[81,2],[81,4],[65,1],[65,1],[44,2],[58,2],[58,4],[91,1],[91,1],[64,5],[74,3],[74,2],[74,2],[74,1],[86,1],[86,3],[86,4],[86,4],[86,6],[93,1],[93,1],[94,1],[94,3],[19,2],[19,3],[19,4],[19,5],[96,3],[24,2],[63,3],[63,5],[102,2],[102,4],[102,2],[102,4],[20,2],[20,2],[20,2],[20,1],[106,2],[106,2],[21,2],[21,2],[21,2],[108,2],[108,2],[110,2],[110,3],[114,1],[114,1],[114,1],[114,1],[112,1],[112,3],[111,2],[111,2],[111,4],[111,4],[111,4],[111,6],[111,6],[22,5],[22,7],[22,4],[22,6],[119,1],[119,2],[121,3],[121,4],[123,3],[123,5],[18,1],[18,3],[18,3],[18,3],[16,2],[16,2],[16,2],[16,2],[16,2],[16,2],[16,2],[16,2],[16,3],[16,3],[16,3],[16,3],[16,3],[16,3],[16,3],[16,3],[16,5],[16,3]],performAction:function(e,t,n,r,i,o){var a=o.length-1;switch(i){case 1:return this.$=new r.Block;case 2:return this.$=o[a];case 3:return this.$=o[a-1];case 4:this.$=r.Block.wrap([o[a]]);break;case 5:this.$=o[a-2].push(o[a]);break;case 6:this.$=o[a-1];break;case 7:this.$=o[a];break;case 8:this.$=o[a];break;case 9:this.$=o[a];break;case 10:this.$=o[a];break;case 11:this.$=new r.Literal(o[a]);break;case 12:this.$=o[a];break;case 13:this.$=o[a];break;case 14:this.$=o[a];break;case 15:this.$=o[a];break;case 16:this.$=o[a];break;case 17:this.$=o[a];break;case 18:this.$=o[a];break;case 19:this.$=o[a];break;case 20:this.$=o[a];break;case 21:this.$=o[a];break;case 22:this.$=o[a];break;case 23:this.$=o[a];break;case 24:this.$=new r.Block;break;case 25:this.$=o[a-1];break;case 26:this.$=new r.Literal(o[a]);break;case 27:this.$=new r.Literal(o[a]);break;case 28:this.$=new r.Literal(o[a]);break;case 29:this.$=o[a];break;case 30:this.$=new r.Literal(o[a]);break;case 31:this.$=new r.Literal(o[a]);break;case 32:this.$=new r.Literal(o[a]);break;case 33:this.$=new r.Undefined;break;case 34:this.$=new r.Null;break;case 35:this.$=new r.Bool(o[a]);break;case 36:this.$=new r.Assign(o[a-2],o[a]);break;case 37:this.$=new r.Assign(o[a-3],o[a]);break;case 38:this.$=new r.Assign(o[a-4],o[a-1]);break;case 39:this.$=new r.Value(o[a]);break;case 40:this.$=new r.Assign(new r.Value(o[a-2]),o[a],"object");break;case 41:this.$=new r.Assign(new r.Value(o[a-4]),o[a-1],"object");break;case 42:this.$=o[a];break;case 43:this.$=o[a];break;case 44:this.$=o[a];break;case 45:this.$=o[a];break;case 46:this.$=new r.Return(o[a]);break;case 47:this.$=new r.Return;break;case 48:this.$=new r.Comment(o[a]);break;case 49:this.$=new r.Code(o[a-3],o[a],o[a-1]);break;case 50:this.$=new r.Code([],o[a],o[a-1]);break;case 51:this.$="func";break;case 52:this.$="boundfunc";break;case 53:this.$=o[a];break;case 54:this.$=o[a];break;case 55:this.$=[];break;case 56:this.$=[o[a]];break;case 57:this.$=o[a-2].concat(o[a]);break;case 58:this.$=o[a-3].concat(o[a]);break;case 59:this.$=o[a-5].concat(o[a-2]);break;case 60:this.$=new r.Param(o[a]);break;case 61:this.$=new r.Param(o[a-1],null,!0);break;case 62:this.$=new r.Param(o[a-2],o[a]);break;case 63:this.$=o[a];break;case 64:this.$=o[a];break;case 65:this.$=o[a];break;case 66:this.$=o[a];break;case 67:this.$=new r.Splat(o[a-1]);break;case 68:this.$=new r.Value(o[a]);break;case 69:this.$=o[a-1].add(o[a]);break;case 70:this.$=new r.Value(o[a-1],[].concat(o[a]));break;case 71:this.$=o[a];break;case 72:this.$=o[a];break;case 73:this.$=new r.Value(o[a]);break;case 74:this.$=new r.Value(o[a]);break;case 75:this.$=o[a];break;case 76:this.$=new r.Value(o[a]);break;case 77:this.$=new r.Value(o[a]);break;case 78:this.$=new r.Value(o[a]);break;case 79:this.$=o[a];break;case 80:this.$=new r.Access(o[a]);break;case 81:this.$=new r.Access(o[a],"soak");break;case 82:this.$=[new r.Access(new r.Literal("prototype")),new r.Access(o[a])];break;case 83:this.$=new r.Access(new r.Literal("prototype"));break;case 84:this.$=o[a];break;case 85:this.$=o[a-1];break;case 86:this.$=r.extend(o[a],{soak:!0});break;case 87:this.$=new r.Index(o[a]);break;case 88:this.$=new r.Slice(o[a]);break;case 89:this.$=new r.Obj(o[a-2],o[a-3].generated);break;case 90:this.$=[];break;case 91:this.$=[o[a]];break;case 92:this.$=o[a-2].concat(o[a]);break;case 93:this.$=o[a-3].concat(o[a]);break;case 94:this.$=o[a-5].concat(o[a-2]);break;case 95:this.$=new r.Class;break;case 96:this.$=new r.Class(null,null,o[a]);break;case 97:this.$=new r.Class(null,o[a]);break;case 98:this.$=new r.Class(null,o[a-1],o[a]);break;case 99:this.$=new r.Class(o[a]);break;case 100:this.$=new r.Class(o[a-1],null,o[a]);break;case 101:this.$=new r.Class(o[a-2],o[a]);break;case 102:this.$=new r.Class(o[a-3],o[a-1],o[a]);break;case 103:this.$=new r.Call(o[a-2],o[a],o[a-1]);break;case 104:this.$=new r.Call(o[a-2],o[a],o[a-1]);break;case 105:this.$=new r.Call("super",[new r.Splat(new r.Literal("arguments"))]);break;case 106:this.$=new r.Call("super",o[a]);break;case 107:this.$=!1;break;case 108:this.$=!0;break;case 109:this.$=[];break;case 110:this.$=o[a-2];break;case 111:this.$=new r.Value(new r.Literal("this"));break;case 112:this.$=new r.Value(new r.Literal("this"));break;case 113:this.$=new r.Value(new r.Literal("this"),[new r.Access(o[a])],"this");break;case 114:this.$=new r.Arr([]);break;case 115:this.$=new r.Arr(o[a-2]);break;case 116:this.$="inclusive";break;case 117:this.$="exclusive";break;case 118:this.$=new r.Range(o[a-3],o[a-1],o[a-2]);break;case 119:this.$=new r.Range(o[a-2],o[a],o[a-1]);break;case 120:this.$=new r.Range(o[a-1],null,o[a]);break;case 121:this.$=new r.Range(null,o[a],o[a-1]);break;case 122:this.$=new r.Range(null,null,o[a]);break;case 123:this.$=[o[a]];break;case 124:this.$=o[a-2].concat(o[a]);break;case 125:this.$=o[a-3].concat(o[a]);break;case 126:this.$=o[a-2];break;case 127:this.$=o[a-5].concat(o[a-2]);break;case 128:this.$=o[a];break;case 129:this.$=o[a];break;case 130:this.$=o[a];break;case 131:this.$=[].concat(o[a-2],o[a]);break;case 132:this.$=new r.Try(o[a]);break;case 133:this.$=new r.Try(o[a-1],o[a][0],o[a][1]);break;case 134:this.$=new r.Try(o[a-2],null,null,o[a]);break;case 135:this.$=new r.Try(o[a-3],o[a-2][0],o[a-2][1],o[a]);break;case 136:this.$=[o[a-1],o[a]];break;case 137:this.$=new r.Throw(o[a]);break;case 138:this.$=new r.Parens(o[a-1]);break;case 139:this.$=new r.Parens(o[a-2]);break;case 140:this.$=new r.While(o[a]);break;case 141:this.$=new r.While(o[a-2],{guard:o[a]});break;case 142:this.$=new r.While(o[a],{invert:!0});break;case 143:this.$=new r.While(o[a-2],{invert:!0,guard:o[a]});break;case 144:this.$=o[a-1].addBody(o[a]);break;case 145:this.$=o[a].addBody(r.Block.wrap([o[a-1]]));break;case 146:this.$=o[a].addBody(r.Block.wrap([o[a-1]]));break;case 147:this.$=o[a];break;case 148:this.$=new r.While(new r.Literal("true")).addBody(o[a]);break;case 149:this.$=new r.While(new r.Literal("true")).addBody(r.Block.wrap([o[a]]));break;case 150:this.$=new r.For(o[a-1],o[a]);break;case 151:this.$=new r.For(o[a-1],o[a]);break;case 152:this.$=new r.For(o[a],o[a-1]);break;case 153:this.$={source:new r.Value(o[a])};break;case 154:this.$=function(){return o[a].own=o[a-1].own,o[a].name=o[a-1][0],o[a].index=o[a-1][1],o[a]}();break;case 155:this.$=o[a];break;case 156:this.$=function(){return o[a].own=!0,o[a]}();break;case 157:this.$=o[a];break;case 158:this.$=o[a];break;case 159:this.$=new r.Value(o[a]);break;case 160:this.$=new r.Value(o[a]);break;case 161:this.$=[o[a]];break;case 162:this.$=[o[a-2],o[a]];break;case 163:this.$={source:o[a]};break;case 164:this.$={source:o[a],object:!0};break;case 165:this.$={source:o[a-2],guard:o[a]};break;case 166:this.$={source:o[a-2],guard:o[a],object:!0};break;case 167:this.$={source:o[a-2],step:o[a]};break;case 168:this.$={source:o[a-4],guard:o[a-2],step:o[a]};break;case 169:this.$={source:o[a-4],step:o[a-2],guard:o[a]};break;case 170:this.$=new r.Switch(o[a-3],o[a-1]);break;case 171:this.$=new r.Switch(o[a-5],o[a-3],o[a-1]);break;case 172:this.$=new r.Switch(null,o[a-1]);break;case 173:this.$=new r.Switch(null,o[a-3],o[a-1]);break;case 174:this.$=o[a];break;case 175:this.$=o[a-1].concat(o[a]);break;case 176:this.$=[[o[a-1],o[a]]];break;case 177:this.$=[[o[a-2],o[a-1]]];break;case 178:this.$=new r.If(o[a-1],o[a],{type:o[a-2]});break;case 179:this.$=o[a-4].addElse(new r.If(o[a-1],o[a],{type:o[a-2]}));break;case 180:this.$=o[a];break;case 181:this.$=o[a-2].addElse(o[a]);break;case 182:this.$=new r.If(o[a],r.Block.wrap([o[a-2]]),{type:o[a-1],statement:!0});break;case 183:this.$=new r.If(o[a],r.Block.wrap([o[a-2]]),{type:o[a-1],statement:!0});break;case 184:this.$=new r.Op(o[a-1],o[a]);break;case 185:this.$=new r.Op("-",o[a]);break;case 186:this.$=new r.Op("+",o[a]);break;case 187:this.$=new r.Op("--",o[a]);break;case 188:this.$=new r.Op("++",o[a]);break;case 189:this.$=new r.Op("--",o[a-1],null,!0);break;case 190:this.$=new r.Op("++",o[a-1],null,!0);break;case 191:this.$=new r.Existence(o[a-1]);break;case 192:this.$=new r.Op("+",o[a-2],o[a]);break;case 193:this.$=new r.Op("-",o[a-2],o[a]);break;case 194:this.$=new r.Op(o[a-1],o[a-2],o[a]);break;case 195:this.$=new r.Op(o[a-1],o[a-2],o[a]);break;case 196:this.$=new r.Op(o[a-1],o[a-2],o[a]);break;case 197:this.$=new r.Op(o[a-1],o[a-2],o[a]);break;case 198:this.$=function(){return"!"===o[a-1].charAt(0)?new r.Op(o[a-1].slice(1),o[a-2],o[a]).invert():new r.Op(o[a-1],o[a-2],o[a])}();break;case 199:this.$=new r.Assign(o[a-2],o[a],o[a-1]);break;case 200:this.$=new r.Assign(o[a-4],o[a-1],o[a-3]);break;case 201:this.$=new r.Extends(o[a-2],o[a])}},table:[{1:[2,1],3:1,4:2,5:3,7:4,8:6,9:7,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,25:[1,5],27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{1:[3]},{1:[2,2],6:[1,74]},{6:[1,75]},{1:[2,4],6:[2,4],26:[2,4],101:[2,4]},{4:77,7:4,8:6,9:7,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,26:[1,76],27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{1:[2,7],6:[2,7],26:[2,7],101:[2,7],102:87,103:[1,65],105:[1,66],108:88,109:[1,68],110:69,125:[1,86],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{1:[2,8],6:[2,8],26:[2,8],101:[2,8],102:90,103:[1,65],105:[1,66],108:91,109:[1,68],110:69,125:[1,89]},{1:[2,12],6:[2,12],25:[2,12],26:[2,12],49:[2,12],54:[2,12],57:[2,12],62:93,66:[1,95],67:[1,96],68:[1,97],69:98,70:[1,99],72:[2,12],73:[1,100],77:[2,12],80:92,83:[1,94],84:[2,107],85:[2,12],90:[2,12],92:[2,12],101:[2,12],103:[2,12],104:[2,12],105:[2,12],109:[2,12],117:[2,12],125:[2,12],127:[2,12],128:[2,12],131:[2,12],132:[2,12],133:[2,12],134:[2,12],135:[2,12],136:[2,12]},{1:[2,13],6:[2,13],25:[2,13],26:[2,13],49:[2,13],54:[2,13],57:[2,13],62:102,66:[1,95],67:[1,96],68:[1,97],69:98,70:[1,99],72:[2,13],73:[1,100],77:[2,13],80:101,83:[1,94],84:[2,107],85:[2,13],90:[2,13],92:[2,13],101:[2,13],103:[2,13],104:[2,13],105:[2,13],109:[2,13],117:[2,13],125:[2,13],127:[2,13],128:[2,13],131:[2,13],132:[2,13],133:[2,13],134:[2,13],135:[2,13],136:[2,13]},{1:[2,14],6:[2,14],25:[2,14],26:[2,14],49:[2,14],54:[2,14],57:[2,14],72:[2,14],77:[2,14],85:[2,14],90:[2,14],92:[2,14],101:[2,14],103:[2,14],104:[2,14],105:[2,14],109:[2,14],117:[2,14],125:[2,14],127:[2,14],128:[2,14],131:[2,14],132:[2,14],133:[2,14],134:[2,14],135:[2,14],136:[2,14]},{1:[2,15],6:[2,15],25:[2,15],26:[2,15],49:[2,15],54:[2,15],57:[2,15],72:[2,15],77:[2,15],85:[2,15],90:[2,15],92:[2,15],101:[2,15],103:[2,15],104:[2,15],105:[2,15],109:[2,15],117:[2,15],125:[2,15],127:[2,15],128:[2,15],131:[2,15],132:[2,15],133:[2,15],134:[2,15],135:[2,15],136:[2,15]},{1:[2,16],6:[2,16],25:[2,16],26:[2,16],49:[2,16],54:[2,16],57:[2,16],72:[2,16],77:[2,16],85:[2,16],90:[2,16],92:[2,16],101:[2,16],103:[2,16],104:[2,16],105:[2,16],109:[2,16],117:[2,16],125:[2,16],127:[2,16],128:[2,16],131:[2,16],132:[2,16],133:[2,16],134:[2,16],135:[2,16],136:[2,16]},{1:[2,17],6:[2,17],25:[2,17],26:[2,17],49:[2,17],54:[2,17],57:[2,17],72:[2,17],77:[2,17],85:[2,17],90:[2,17],92:[2,17],101:[2,17],103:[2,17],104:[2,17],105:[2,17],109:[2,17],117:[2,17],125:[2,17],127:[2,17],128:[2,17],131:[2,17],132:[2,17],133:[2,17],134:[2,17],135:[2,17],136:[2,17]},{1:[2,18],6:[2,18],25:[2,18],26:[2,18],49:[2,18],54:[2,18],57:[2,18],72:[2,18],77:[2,18],85:[2,18],90:[2,18],92:[2,18],101:[2,18],103:[2,18],104:[2,18],105:[2,18],109:[2,18],117:[2,18],125:[2,18],127:[2,18],128:[2,18],131:[2,18],132:[2,18],133:[2,18],134:[2,18],135:[2,18],136:[2,18]},{1:[2,19],6:[2,19],25:[2,19],26:[2,19],49:[2,19],54:[2,19],57:[2,19],72:[2,19],77:[2,19],85:[2,19],90:[2,19],92:[2,19],101:[2,19],103:[2,19],104:[2,19],105:[2,19],109:[2,19],117:[2,19],125:[2,19],127:[2,19],128:[2,19],131:[2,19],132:[2,19],133:[2,19],134:[2,19],135:[2,19],136:[2,19]},{1:[2,20],6:[2,20],25:[2,20],26:[2,20],49:[2,20],54:[2,20],57:[2,20],72:[2,20],77:[2,20],85:[2,20],90:[2,20],92:[2,20],101:[2,20],103:[2,20],104:[2,20],105:[2,20],109:[2,20],117:[2,20],125:[2,20],127:[2,20],128:[2,20],131:[2,20],132:[2,20],133:[2,20],134:[2,20],135:[2,20],136:[2,20]},{1:[2,21],6:[2,21],25:[2,21],26:[2,21],49:[2,21],54:[2,21],57:[2,21],72:[2,21],77:[2,21],85:[2,21],90:[2,21],92:[2,21],101:[2,21],103:[2,21],104:[2,21],105:[2,21],109:[2,21],117:[2,21],125:[2,21],127:[2,21],128:[2,21],131:[2,21],132:[2,21],133:[2,21],134:[2,21],135:[2,21],136:[2,21]},{1:[2,22],6:[2,22],25:[2,22],26:[2,22],49:[2,22],54:[2,22],57:[2,22],72:[2,22],77:[2,22],85:[2,22],90:[2,22],92:[2,22],101:[2,22],103:[2,22],104:[2,22],105:[2,22],109:[2,22],117:[2,22],125:[2,22],127:[2,22],128:[2,22],131:[2,22],132:[2,22],133:[2,22],134:[2,22],135:[2,22],136:[2,22]},{1:[2,23],6:[2,23],25:[2,23],26:[2,23],49:[2,23],54:[2,23],57:[2,23],72:[2,23],77:[2,23],85:[2,23],90:[2,23],92:[2,23],101:[2,23],103:[2,23],104:[2,23],105:[2,23],109:[2,23],117:[2,23],125:[2,23],127:[2,23],128:[2,23],131:[2,23],132:[2,23],133:[2,23],134:[2,23],135:[2,23],136:[2,23]},{1:[2,9],6:[2,9],26:[2,9],101:[2,9],103:[2,9],105:[2,9],109:[2,9],125:[2,9]},{1:[2,10],6:[2,10],26:[2,10],101:[2,10],103:[2,10],105:[2,10],109:[2,10],125:[2,10]},{1:[2,11],6:[2,11],26:[2,11],101:[2,11],103:[2,11],105:[2,11],109:[2,11],125:[2,11]},{1:[2,75],6:[2,75],25:[2,75],26:[2,75],40:[1,103],49:[2,75],54:[2,75],57:[2,75],66:[2,75],67:[2,75],68:[2,75],70:[2,75],72:[2,75],73:[2,75],77:[2,75],83:[2,75],84:[2,75],85:[2,75],90:[2,75],92:[2,75],101:[2,75],103:[2,75],104:[2,75],105:[2,75],109:[2,75],117:[2,75],125:[2,75],127:[2,75],128:[2,75],131:[2,75],132:[2,75],133:[2,75],134:[2,75],135:[2,75],136:[2,75]},{1:[2,76],6:[2,76],25:[2,76],26:[2,76],49:[2,76],54:[2,76],57:[2,76],66:[2,76],67:[2,76],68:[2,76],70:[2,76],72:[2,76],73:[2,76],77:[2,76],83:[2,76],84:[2,76],85:[2,76],90:[2,76],92:[2,76],101:[2,76],103:[2,76],104:[2,76],105:[2,76],109:[2,76],117:[2,76],125:[2,76],127:[2,76],128:[2,76],131:[2,76],132:[2,76],133:[2,76],134:[2,76],135:[2,76],136:[2,76]},{1:[2,77],6:[2,77],25:[2,77],26:[2,77],49:[2,77],54:[2,77],57:[2,77],66:[2,77],67:[2,77],68:[2,77],70:[2,77],72:[2,77],73:[2,77],77:[2,77],83:[2,77],84:[2,77],85:[2,77],90:[2,77],92:[2,77],101:[2,77],103:[2,77],104:[2,77],105:[2,77],109:[2,77],117:[2,77],125:[2,77],127:[2,77],128:[2,77],131:[2,77],132:[2,77],133:[2,77],134:[2,77],135:[2,77],136:[2,77]},{1:[2,78],6:[2,78],25:[2,78],26:[2,78],49:[2,78],54:[2,78],57:[2,78],66:[2,78],67:[2,78],68:[2,78],70:[2,78],72:[2,78],73:[2,78],77:[2,78],83:[2,78],84:[2,78],85:[2,78],90:[2,78],92:[2,78],101:[2,78],103:[2,78],104:[2,78],105:[2,78],109:[2,78],117:[2,78],125:[2,78],127:[2,78],128:[2,78],131:[2,78],132:[2,78],133:[2,78],134:[2,78],135:[2,78],136:[2,78]},{1:[2,79],6:[2,79],25:[2,79],26:[2,79],49:[2,79],54:[2,79],57:[2,79],66:[2,79],67:[2,79],68:[2,79],70:[2,79],72:[2,79],73:[2,79],77:[2,79],83:[2,79],84:[2,79],85:[2,79],90:[2,79],92:[2,79],101:[2,79],103:[2,79],104:[2,79],105:[2,79],109:[2,79],117:[2,79],125:[2,79],127:[2,79],128:[2,79],131:[2,79],132:[2,79],133:[2,79],134:[2,79],135:[2,79],136:[2,79]},{1:[2,105],6:[2,105],25:[2,105],26:[2,105],49:[2,105],54:[2,105],57:[2,105],66:[2,105],67:[2,105],68:[2,105],70:[2,105],72:[2,105],73:[2,105],77:[2,105],81:104,83:[2,105],84:[1,105],85:[2,105],90:[2,105],92:[2,105],101:[2,105],103:[2,105],104:[2,105],105:[2,105],109:[2,105],117:[2,105],125:[2,105],127:[2,105],128:[2,105],131:[2,105],132:[2,105],133:[2,105],134:[2,105],135:[2,105],136:[2,105]},{6:[2,55],25:[2,55],27:109,28:[1,73],44:110,48:106,49:[2,55],54:[2,55],55:107,56:108,58:111,59:112,75:[1,70],88:[1,113],89:[1,114]},{5:115,25:[1,5]},{8:116,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{8:118,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{8:119,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{13:121,14:122,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:123,44:63,58:47,59:48,61:120,63:25,64:26,65:27,75:[1,70],82:[1,28],87:[1,58],88:[1,59],89:[1,57],100:[1,56]},{13:121,14:122,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:123,44:63,58:47,59:48,61:124,63:25,64:26,65:27,75:[1,70],82:[1,28],87:[1,58],88:[1,59],89:[1,57],100:[1,56]},{1:[2,72],6:[2,72],25:[2,72],26:[2,72],40:[2,72],49:[2,72],54:[2,72],57:[2,72],66:[2,72],67:[2,72],68:[2,72],70:[2,72],72:[2,72],73:[2,72],77:[2,72],79:[1,128],83:[2,72],84:[2,72],85:[2,72],90:[2,72],92:[2,72],101:[2,72],103:[2,72],104:[2,72],105:[2,72],109:[2,72],117:[2,72],125:[2,72],127:[2,72],128:[2,72],129:[1,125],130:[1,126],131:[2,72],132:[2,72],133:[2,72],134:[2,72],135:[2,72],136:[2,72],137:[1,127]},{1:[2,180],6:[2,180],25:[2,180],26:[2,180],49:[2,180],54:[2,180],57:[2,180],72:[2,180],77:[2,180],85:[2,180],90:[2,180],92:[2,180],101:[2,180],103:[2,180],104:[2,180],105:[2,180],109:[2,180],117:[2,180],120:[1,129],125:[2,180],127:[2,180],128:[2,180],131:[2,180],132:[2,180],133:[2,180],134:[2,180],135:[2,180],136:[2,180]},{5:130,25:[1,5]},{5:131,25:[1,5]},{1:[2,147],6:[2,147],25:[2,147],26:[2,147],49:[2,147],54:[2,147],57:[2,147],72:[2,147],77:[2,147],85:[2,147],90:[2,147],92:[2,147],101:[2,147],103:[2,147],104:[2,147],105:[2,147],109:[2,147],117:[2,147],125:[2,147],127:[2,147],128:[2,147],131:[2,147],132:[2,147],133:[2,147],134:[2,147],135:[2,147],136:[2,147]},{5:132,25:[1,5]},{8:133,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,25:[1,134],27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{1:[2,95],5:135,6:[2,95],13:121,14:122,25:[1,5],26:[2,95],27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:123,44:63,49:[2,95],54:[2,95],57:[2,95],58:47,59:48,61:137,63:25,64:26,65:27,72:[2,95],75:[1,70],77:[2,95],79:[1,136],82:[1,28],85:[2,95],87:[1,58],88:[1,59],89:[1,57],90:[2,95],92:[2,95],100:[1,56],101:[2,95],103:[2,95],104:[2,95],105:[2,95],109:[2,95],117:[2,95],125:[2,95],127:[2,95],128:[2,95],131:[2,95],132:[2,95],133:[2,95],134:[2,95],135:[2,95],136:[2,95]},{8:138,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{1:[2,47],6:[2,47],8:139,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,26:[2,47],27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],101:[2,47],102:39,103:[2,47],105:[2,47],106:40,107:[1,67],108:41,109:[2,47],110:69,118:[1,42],123:37,124:[1,64],125:[2,47],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{1:[2,48],6:[2,48],25:[2,48],26:[2,48],54:[2,48],77:[2,48],101:[2,48],103:[2,48],105:[2,48],109:[2,48],125:[2,48]},{1:[2,73],6:[2,73],25:[2,73],26:[2,73],40:[2,73],49:[2,73],54:[2,73],57:[2,73],66:[2,73],67:[2,73],68:[2,73],70:[2,73],72:[2,73],73:[2,73],77:[2,73],83:[2,73],84:[2,73],85:[2,73],90:[2,73],92:[2,73],101:[2,73],103:[2,73],104:[2,73],105:[2,73],109:[2,73],117:[2,73],125:[2,73],127:[2,73],128:[2,73],131:[2,73],132:[2,73],133:[2,73],134:[2,73],135:[2,73],136:[2,73]},{1:[2,74],6:[2,74],25:[2,74],26:[2,74],40:[2,74],49:[2,74],54:[2,74],57:[2,74],66:[2,74],67:[2,74],68:[2,74],70:[2,74],72:[2,74],73:[2,74],77:[2,74],83:[2,74],84:[2,74],85:[2,74],90:[2,74],92:[2,74],101:[2,74],103:[2,74],104:[2,74],105:[2,74],109:[2,74],117:[2,74],125:[2,74],127:[2,74],128:[2,74],131:[2,74],132:[2,74],133:[2,74],134:[2,74],135:[2,74],136:[2,74]},{1:[2,29],6:[2,29],25:[2,29],26:[2,29],49:[2,29],54:[2,29],57:[2,29],66:[2,29],67:[2,29],68:[2,29],70:[2,29],72:[2,29],73:[2,29],77:[2,29],83:[2,29],84:[2,29],85:[2,29],90:[2,29],92:[2,29],101:[2,29],103:[2,29],104:[2,29],105:[2,29],109:[2,29],117:[2,29],125:[2,29],127:[2,29],128:[2,29],131:[2,29],132:[2,29],133:[2,29],134:[2,29],135:[2,29],136:[2,29]},{1:[2,30],6:[2,30],25:[2,30],26:[2,30],49:[2,30],54:[2,30],57:[2,30],66:[2,30],67:[2,30],68:[2,30],70:[2,30],72:[2,30],73:[2,30],77:[2,30],83:[2,30],84:[2,30],85:[2,30],90:[2,30],92:[2,30],101:[2,30],103:[2,30],104:[2,30],105:[2,30],109:[2,30],117:[2,30],125:[2,30],127:[2,30],128:[2,30],131:[2,30],132:[2,30],133:[2,30],134:[2,30],135:[2,30],136:[2,30]},{1:[2,31],6:[2,31],25:[2,31],26:[2,31],49:[2,31],54:[2,31],57:[2,31],66:[2,31],67:[2,31],68:[2,31],70:[2,31],72:[2,31],73:[2,31],77:[2,31],83:[2,31],84:[2,31],85:[2,31],90:[2,31],92:[2,31],101:[2,31],103:[2,31],104:[2,31],105:[2,31],109:[2,31],117:[2,31],125:[2,31],127:[2,31],128:[2,31],131:[2,31],132:[2,31],133:[2,31],134:[2,31],135:[2,31],136:[2,31]},{1:[2,32],6:[2,32],25:[2,32],26:[2,32],49:[2,32],54:[2,32],57:[2,32],66:[2,32],67:[2,32],68:[2,32],70:[2,32],72:[2,32],73:[2,32],77:[2,32],83:[2,32],84:[2,32],85:[2,32],90:[2,32],92:[2,32],101:[2,32],103:[2,32],104:[2,32],105:[2,32],109:[2,32],117:[2,32],125:[2,32],127:[2,32],128:[2,32],131:[2,32],132:[2,32],133:[2,32],134:[2,32],135:[2,32],136:[2,32]},{1:[2,33],6:[2,33],25:[2,33],26:[2,33],49:[2,33],54:[2,33],57:[2,33],66:[2,33],67:[2,33],68:[2,33],70:[2,33],72:[2,33],73:[2,33],77:[2,33],83:[2,33],84:[2,33],85:[2,33],90:[2,33],92:[2,33],101:[2,33],103:[2,33],104:[2,33],105:[2,33],109:[2,33],117:[2,33],125:[2,33],127:[2,33],128:[2,33],131:[2,33],132:[2,33],133:[2,33],134:[2,33],135:[2,33],136:[2,33]},{1:[2,34],6:[2,34],25:[2,34],26:[2,34],49:[2,34],54:[2,34],57:[2,34],66:[2,34],67:[2,34],68:[2,34],70:[2,34],72:[2,34],73:[2,34],77:[2,34],83:[2,34],84:[2,34],85:[2,34],90:[2,34],92:[2,34],101:[2,34],103:[2,34],104:[2,34],105:[2,34],109:[2,34],117:[2,34],125:[2,34],127:[2,34],128:[2,34],131:[2,34],132:[2,34],133:[2,34],134:[2,34],135:[2,34],136:[2,34]},{1:[2,35],6:[2,35],25:[2,35],26:[2,35],49:[2,35],54:[2,35],57:[2,35],66:[2,35],67:[2,35],68:[2,35],70:[2,35],72:[2,35],73:[2,35],77:[2,35],83:[2,35],84:[2,35],85:[2,35],90:[2,35],92:[2,35],101:[2,35],103:[2,35],104:[2,35],105:[2,35],109:[2,35],117:[2,35],125:[2,35],127:[2,35],128:[2,35],131:[2,35],132:[2,35],133:[2,35],134:[2,35],135:[2,35],136:[2,35]},{4:140,7:4,8:6,9:7,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,25:[1,141],27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{8:142,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,25:[1,146],27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,60:147,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],86:144,87:[1,58],88:[1,59],89:[1,57],90:[1,143],93:145,95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{1:[2,111],6:[2,111],25:[2,111],26:[2,111],49:[2,111],54:[2,111],57:[2,111],66:[2,111],67:[2,111],68:[2,111],70:[2,111],72:[2,111],73:[2,111],77:[2,111],83:[2,111],84:[2,111],85:[2,111],90:[2,111],92:[2,111],101:[2,111],103:[2,111],104:[2,111],105:[2,111],109:[2,111],117:[2,111],125:[2,111],127:[2,111],128:[2,111],131:[2,111],132:[2,111],133:[2,111],134:[2,111],135:[2,111],136:[2,111]},{1:[2,112],6:[2,112],25:[2,112],26:[2,112],27:148,28:[1,73],49:[2,112],54:[2,112],57:[2,112],66:[2,112],67:[2,112],68:[2,112],70:[2,112],72:[2,112],73:[2,112],77:[2,112],83:[2,112],84:[2,112],85:[2,112],90:[2,112],92:[2,112],101:[2,112],103:[2,112],104:[2,112],105:[2,112],109:[2,112],117:[2,112],125:[2,112],127:[2,112],128:[2,112],131:[2,112],132:[2,112],133:[2,112],134:[2,112],135:[2,112],136:[2,112]},{25:[2,51]},{25:[2,52]},{1:[2,68],6:[2,68],25:[2,68],26:[2,68],40:[2,68],49:[2,68],54:[2,68],57:[2,68],66:[2,68],67:[2,68],68:[2,68],70:[2,68],72:[2,68],73:[2,68],77:[2,68],79:[2,68],83:[2,68],84:[2,68],85:[2,68],90:[2,68],92:[2,68],101:[2,68],103:[2,68],104:[2,68],105:[2,68],109:[2,68],117:[2,68],125:[2,68],127:[2,68],128:[2,68],129:[2,68],130:[2,68],131:[2,68],132:[2,68],133:[2,68],134:[2,68],135:[2,68],136:[2,68],137:[2,68]},{1:[2,71],6:[2,71],25:[2,71],26:[2,71],40:[2,71],49:[2,71],54:[2,71],57:[2,71],66:[2,71],67:[2,71],68:[2,71],70:[2,71],72:[2,71],73:[2,71],77:[2,71],79:[2,71],83:[2,71],84:[2,71],85:[2,71],90:[2,71],92:[2,71],101:[2,71],103:[2,71],104:[2,71],105:[2,71],109:[2,71],117:[2,71],125:[2,71],127:[2,71],128:[2,71],129:[2,71],130:[2,71],131:[2,71],132:[2,71],133:[2,71],134:[2,71],135:[2,71],136:[2,71],137:[2,71]},{8:149,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{8:150,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{8:151,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{5:152,8:153,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,25:[1,5],27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{27:158,28:[1,73],44:159,58:160,59:161,64:154,75:[1,70],88:[1,113],89:[1,57],112:155,113:[1,156],114:157},{111:162,115:[1,163],116:[1,164]},{6:[2,90],11:168,25:[2,90],27:169,28:[1,73],29:170,30:[1,71],31:[1,72],41:166,42:167,44:171,46:[1,46],54:[2,90],76:165,77:[2,90],88:[1,113]},{1:[2,27],6:[2,27],25:[2,27],26:[2,27],43:[2,27],49:[2,27],54:[2,27],57:[2,27],66:[2,27],67:[2,27],68:[2,27],70:[2,27],72:[2,27],73:[2,27],77:[2,27],83:[2,27],84:[2,27],85:[2,27],90:[2,27],92:[2,27],101:[2,27],103:[2,27],104:[2,27],105:[2,27],109:[2,27],117:[2,27],125:[2,27],127:[2,27],128:[2,27],131:[2,27],132:[2,27],133:[2,27],134:[2,27],135:[2,27],136:[2,27]},{1:[2,28],6:[2,28],25:[2,28],26:[2,28],43:[2,28],49:[2,28],54:[2,28],57:[2,28],66:[2,28],67:[2,28],68:[2,28],70:[2,28],72:[2,28],73:[2,28],77:[2,28],83:[2,28],84:[2,28],85:[2,28],90:[2,28],92:[2,28],101:[2,28],103:[2,28],104:[2,28],105:[2,28],109:[2,28],117:[2,28],125:[2,28],127:[2,28],128:[2,28],131:[2,28],132:[2,28],133:[2,28],134:[2,28],135:[2,28],136:[2,28]},{1:[2,26],6:[2,26],25:[2,26],26:[2,26],40:[2,26],43:[2,26],49:[2,26],54:[2,26],57:[2,26],66:[2,26],67:[2,26],68:[2,26],70:[2,26],72:[2,26],73:[2,26],77:[2,26],79:[2,26],83:[2,26],84:[2,26],85:[2,26],90:[2,26],92:[2,26],101:[2,26],103:[2,26],104:[2,26],105:[2,26],109:[2,26],115:[2,26],116:[2,26],117:[2,26],125:[2,26],127:[2,26],128:[2,26],129:[2,26],130:[2,26],131:[2,26],132:[2,26],133:[2,26],134:[2,26],135:[2,26],136:[2,26],137:[2,26]},{1:[2,6],6:[2,6],7:172,8:6,9:7,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,26:[2,6],27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],101:[2,6],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{1:[2,3]},{1:[2,24],6:[2,24],25:[2,24],26:[2,24],49:[2,24],54:[2,24],57:[2,24],72:[2,24],77:[2,24],85:[2,24],90:[2,24],92:[2,24],97:[2,24],98:[2,24],101:[2,24],103:[2,24],104:[2,24],105:[2,24],109:[2,24],117:[2,24],120:[2,24],122:[2,24],125:[2,24],127:[2,24],128:[2,24],131:[2,24],132:[2,24],133:[2,24],134:[2,24],135:[2,24],136:[2,24]},{6:[1,74],26:[1,173]},{1:[2,191],6:[2,191],25:[2,191],26:[2,191],49:[2,191],54:[2,191],57:[2,191],72:[2,191],77:[2,191],85:[2,191],90:[2,191],92:[2,191],101:[2,191],103:[2,191],104:[2,191],105:[2,191],109:[2,191],117:[2,191],125:[2,191],127:[2,191],128:[2,191],131:[2,191],132:[2,191],133:[2,191],134:[2,191],135:[2,191],136:[2,191]},{8:174,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{8:175,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{8:176,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{8:177,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{8:178,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{8:179,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{8:180,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{8:181,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{1:[2,146],6:[2,146],25:[2,146],26:[2,146],49:[2,146],54:[2,146],57:[2,146],72:[2,146],77:[2,146],85:[2,146],90:[2,146],92:[2,146],101:[2,146],103:[2,146],104:[2,146],105:[2,146],109:[2,146],117:[2,146],125:[2,146],127:[2,146],128:[2,146],131:[2,146],132:[2,146],133:[2,146],134:[2,146],135:[2,146],136:[2,146]},{1:[2,151],6:[2,151],25:[2,151],26:[2,151],49:[2,151],54:[2,151],57:[2,151],72:[2,151],77:[2,151],85:[2,151],90:[2,151],92:[2,151],101:[2,151],103:[2,151],104:[2,151],105:[2,151],109:[2,151],117:[2,151],125:[2,151],127:[2,151],128:[2,151],131:[2,151],132:[2,151],133:[2,151],134:[2,151],135:[2,151],136:[2,151]},{8:182,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{1:[2,145],6:[2,145],25:[2,145],26:[2,145],49:[2,145],54:[2,145],57:[2,145],72:[2,145],77:[2,145],85:[2,145],90:[2,145],92:[2,145],101:[2,145],103:[2,145],104:[2,145],105:[2,145],109:[2,145],117:[2,145],125:[2,145],127:[2,145],128:[2,145],131:[2,145],132:[2,145],133:[2,145],134:[2,145],135:[2,145],136:[2,145]},{1:[2,150],6:[2,150],25:[2,150],26:[2,150],49:[2,150],54:[2,150],57:[2,150],72:[2,150],77:[2,150],85:[2,150],90:[2,150],92:[2,150],101:[2,150],103:[2,150],104:[2,150],105:[2,150],109:[2,150],117:[2,150],125:[2,150],127:[2,150],128:[2,150],131:[2,150],132:[2,150],133:[2,150],134:[2,150],135:[2,150],136:[2,150]},{81:183,84:[1,105]},{1:[2,69],6:[2,69],25:[2,69],26:[2,69],40:[2,69],49:[2,69],54:[2,69],57:[2,69],66:[2,69],67:[2,69],68:[2,69],70:[2,69],72:[2,69],73:[2,69],77:[2,69],79:[2,69],83:[2,69],84:[2,69],85:[2,69],90:[2,69],92:[2,69],101:[2,69],103:[2,69],104:[2,69],105:[2,69],109:[2,69],117:[2,69],125:[2,69],127:[2,69],128:[2,69],129:[2,69],130:[2,69],131:[2,69],132:[2,69],133:[2,69],134:[2,69],135:[2,69],136:[2,69],137:[2,69]},{84:[2,108]},{27:184,28:[1,73]},{27:185,28:[1,73]},{1:[2,83],6:[2,83],25:[2,83],26:[2,83],27:186,28:[1,73],40:[2,83],49:[2,83],54:[2,83],57:[2,83],66:[2,83],67:[2,83],68:[2,83],70:[2,83],72:[2,83],73:[2,83],77:[2,83],79:[2,83],83:[2,83],84:[2,83],85:[2,83],90:[2,83],92:[2,83],101:[2,83],103:[2,83],104:[2,83],105:[2,83],109:[2,83],117:[2,83],125:[2,83],127:[2,83],128:[2,83],129:[2,83],130:[2,83],131:[2,83],132:[2,83],133:[2,83],134:[2,83],135:[2,83],136:[2,83],137:[2,83]},{1:[2,84],6:[2,84],25:[2,84],26:[2,84],40:[2,84],49:[2,84],54:[2,84],57:[2,84],66:[2,84],67:[2,84],68:[2,84],70:[2,84],72:[2,84],73:[2,84],77:[2,84],79:[2,84],83:[2,84],84:[2,84],85:[2,84],90:[2,84],92:[2,84],101:[2,84],103:[2,84],104:[2,84],105:[2,84],109:[2,84],117:[2,84],125:[2,84],127:[2,84],128:[2,84],129:[2,84],130:[2,84],131:[2,84],132:[2,84],133:[2,84],134:[2,84],135:[2,84],136:[2,84],137:[2,84]},{8:188,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],57:[1,192],58:47,59:48,61:36,63:25,64:26,65:27,71:187,74:189,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],91:190,92:[1,191],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{69:193,70:[1,99],73:[1,100]},{81:194,84:[1,105]},{1:[2,70],6:[2,70],25:[2,70],26:[2,70],40:[2,70],49:[2,70],54:[2,70],57:[2,70],66:[2,70],67:[2,70],68:[2,70],70:[2,70],72:[2,70],73:[2,70],77:[2,70],79:[2,70],83:[2,70],84:[2,70],85:[2,70],90:[2,70],92:[2,70],101:[2,70],103:[2,70],104:[2,70],105:[2,70],109:[2,70],117:[2,70],125:[2,70],127:[2,70],128:[2,70],129:[2,70],130:[2,70],131:[2,70],132:[2,70],133:[2,70],134:[2,70],135:[2,70],136:[2,70],137:[2,70]},{6:[1,196],8:195,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,25:[1,197],27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{1:[2,106],6:[2,106],25:[2,106],26:[2,106],49:[2,106],54:[2,106],57:[2,106],66:[2,106],67:[2,106],68:[2,106],70:[2,106],72:[2,106],73:[2,106],77:[2,106],83:[2,106],84:[2,106],85:[2,106],90:[2,106],92:[2,106],101:[2,106],103:[2,106],104:[2,106],105:[2,106],109:[2,106],117:[2,106],125:[2,106],127:[2,106],128:[2,106],131:[2,106],132:[2,106],133:[2,106],134:[2,106],135:[2,106],136:[2,106]},{8:200,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,25:[1,146],27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,60:147,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],85:[1,198],86:199,87:[1,58],88:[1,59],89:[1,57],93:145,95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{6:[2,53],25:[2,53],49:[1,201],53:203,54:[1,202]},{6:[2,56],25:[2,56],26:[2,56],49:[2,56],54:[2,56]},{6:[2,60],25:[2,60],26:[2,60],40:[1,205],49:[2,60],54:[2,60],57:[1,204]},{6:[2,63],25:[2,63],26:[2,63],40:[2,63],49:[2,63],54:[2,63],57:[2,63]},{6:[2,64],25:[2,64],26:[2,64],40:[2,64],49:[2,64],54:[2,64],57:[2,64]},{6:[2,65],25:[2,65],26:[2,65],40:[2,65],49:[2,65],54:[2,65],57:[2,65]},{6:[2,66],25:[2,66],26:[2,66],40:[2,66],49:[2,66],54:[2,66],57:[2,66]},{27:148,28:[1,73]},{8:200,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,25:[1,146],27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,60:147,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],86:144,87:[1,58],88:[1,59],89:[1,57],90:[1,143],93:145,95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{1:[2,50],6:[2,50],25:[2,50],26:[2,50],49:[2,50],54:[2,50],57:[2,50],72:[2,50],77:[2,50],85:[2,50],90:[2,50],92:[2,50],101:[2,50],103:[2,50],104:[2,50],105:[2,50],109:[2,50],117:[2,50],125:[2,50],127:[2,50],128:[2,50],131:[2,50],132:[2,50],133:[2,50],134:[2,50],135:[2,50],136:[2,50]},{1:[2,184],6:[2,184],25:[2,184],26:[2,184],49:[2,184],54:[2,184],57:[2,184],72:[2,184],77:[2,184],85:[2,184],90:[2,184],92:[2,184],101:[2,184],102:87,103:[2,184],104:[2,184],105:[2,184],108:88,109:[2,184],110:69,117:[2,184],125:[2,184],127:[2,184],128:[2,184],131:[1,78],132:[2,184],133:[2,184],134:[2,184],135:[2,184],136:[2,184]},{102:90,103:[1,65],105:[1,66],108:91,109:[1,68],110:69,125:[1,89]},{1:[2,185],6:[2,185],25:[2,185],26:[2,185],49:[2,185],54:[2,185],57:[2,185],72:[2,185],77:[2,185],85:[2,185],90:[2,185],92:[2,185],101:[2,185],102:87,103:[2,185],104:[2,185],105:[2,185],108:88,109:[2,185],110:69,117:[2,185],125:[2,185],127:[2,185],128:[2,185],131:[1,78],132:[2,185],133:[2,185],134:[2,185],135:[2,185],136:[2,185]},{1:[2,186],6:[2,186],25:[2,186],26:[2,186],49:[2,186],54:[2,186],57:[2,186],72:[2,186],77:[2,186],85:[2,186],90:[2,186],92:[2,186],101:[2,186],102:87,103:[2,186],104:[2,186],105:[2,186],108:88,109:[2,186],110:69,117:[2,186],125:[2,186],127:[2,186],128:[2,186],131:[1,78],132:[2,186],133:[2,186],134:[2,186],135:[2,186],136:[2,186]},{1:[2,187],6:[2,187],25:[2,187],26:[2,187],49:[2,187],54:[2,187],57:[2,187],66:[2,72],67:[2,72],68:[2,72],70:[2,72],72:[2,187],73:[2,72],77:[2,187],83:[2,72],84:[2,72],85:[2,187],90:[2,187],92:[2,187],101:[2,187],103:[2,187],104:[2,187],105:[2,187],109:[2,187],117:[2,187],125:[2,187],127:[2,187],128:[2,187],131:[2,187],132:[2,187],133:[2,187],134:[2,187],135:[2,187],136:[2,187]},{62:93,66:[1,95],67:[1,96],68:[1,97],69:98,70:[1,99],73:[1,100],80:92,83:[1,94],84:[2,107]},{62:102,66:[1,95],67:[1,96],68:[1,97],69:98,70:[1,99],73:[1,100],80:101,83:[1,94],84:[2,107]},{66:[2,75],67:[2,75],68:[2,75],70:[2,75],73:[2,75],83:[2,75],84:[2,75]},{1:[2,188],6:[2,188],25:[2,188],26:[2,188],49:[2,188],54:[2,188],57:[2,188],66:[2,72],67:[2,72],68:[2,72],70:[2,72],72:[2,188],73:[2,72],77:[2,188],83:[2,72],84:[2,72],85:[2,188],90:[2,188],92:[2,188],101:[2,188],103:[2,188],104:[2,188],105:[2,188],109:[2,188],117:[2,188],125:[2,188],127:[2,188],128:[2,188],131:[2,188],132:[2,188],133:[2,188],134:[2,188],135:[2,188],136:[2,188]},{1:[2,189],6:[2,189],25:[2,189],26:[2,189],49:[2,189],54:[2,189],57:[2,189],72:[2,189],77:[2,189],85:[2,189],90:[2,189],92:[2,189],101:[2,189],103:[2,189],104:[2,189],105:[2,189],109:[2,189],117:[2,189],125:[2,189],127:[2,189],128:[2,189],131:[2,189],132:[2,189],133:[2,189],134:[2,189],135:[2,189],136:[2,189]},{1:[2,190],6:[2,190],25:[2,190],26:[2,190],49:[2,190],54:[2,190],57:[2,190],72:[2,190],77:[2,190],85:[2,190],90:[2,190],92:[2,190],101:[2,190],103:[2,190],104:[2,190],105:[2,190],109:[2,190],117:[2,190],125:[2,190],127:[2,190],128:[2,190],131:[2,190],132:[2,190],133:[2,190],134:[2,190],135:[2,190],136:[2,190]},{8:206,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,25:[1,207],27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{8:208,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{5:209,25:[1,5],124:[1,210]},{1:[2,132],6:[2,132],25:[2,132],26:[2,132],49:[2,132],54:[2,132],57:[2,132],72:[2,132],77:[2,132],85:[2,132],90:[2,132],92:[2,132],96:211,97:[1,212],98:[1,213],101:[2,132],103:[2,132],104:[2,132],105:[2,132],109:[2,132],117:[2,132],125:[2,132],127:[2,132],128:[2,132],131:[2,132],132:[2,132],133:[2,132],134:[2,132],135:[2,132],136:[2,132]},{1:[2,144],6:[2,144],25:[2,144],26:[2,144],49:[2,144],54:[2,144],57:[2,144],72:[2,144],77:[2,144],85:[2,144],90:[2,144],92:[2,144],101:[2,144],103:[2,144],104:[2,144],105:[2,144],109:[2,144],117:[2,144],125:[2,144],127:[2,144],128:[2,144],131:[2,144],132:[2,144],133:[2,144],134:[2,144],135:[2,144],136:[2,144]},{1:[2,152],6:[2,152],25:[2,152],26:[2,152],49:[2,152],54:[2,152],57:[2,152],72:[2,152],77:[2,152],85:[2,152],90:[2,152],92:[2,152],101:[2,152],103:[2,152],104:[2,152],105:[2,152],109:[2,152],117:[2,152],125:[2,152],127:[2,152],128:[2,152],131:[2,152],132:[2,152],133:[2,152],134:[2,152],135:[2,152],136:[2,152]},{25:[1,214],102:87,103:[1,65],105:[1,66],108:88,109:[1,68],110:69,125:[1,86],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{119:215,121:216,122:[1,217]},{1:[2,96],6:[2,96],25:[2,96],26:[2,96],49:[2,96],54:[2,96],57:[2,96],72:[2,96],77:[2,96],85:[2,96],90:[2,96],92:[2,96],101:[2,96],103:[2,96],104:[2,96],105:[2,96],109:[2,96],117:[2,96],125:[2,96],127:[2,96],128:[2,96],131:[2,96],132:[2,96],133:[2,96],134:[2,96],135:[2,96],136:[2,96]},{8:218,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{1:[2,99],5:219,6:[2,99],25:[1,5],26:[2,99],49:[2,99],54:[2,99],57:[2,99],66:[2,72],67:[2,72],68:[2,72],70:[2,72],72:[2,99],73:[2,72],77:[2,99],79:[1,220],83:[2,72],84:[2,72],85:[2,99],90:[2,99],92:[2,99],101:[2,99],103:[2,99],104:[2,99],105:[2,99],109:[2,99],117:[2,99],125:[2,99],127:[2,99],128:[2,99],131:[2,99],132:[2,99],133:[2,99],134:[2,99],135:[2,99],136:[2,99]},{1:[2,137],6:[2,137],25:[2,137],26:[2,137],49:[2,137],54:[2,137],57:[2,137],72:[2,137],77:[2,137],85:[2,137],90:[2,137],92:[2,137],101:[2,137],102:87,103:[2,137],104:[2,137],105:[2,137],108:88,109:[2,137],110:69,117:[2,137],125:[2,137],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{1:[2,46],6:[2,46],26:[2,46],101:[2,46],102:87,103:[2,46],105:[2,46],108:88,109:[2,46],110:69,125:[2,46],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{6:[1,74],101:[1,221]},{4:222,7:4,8:6,9:7,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{6:[2,128],25:[2,128],54:[2,128],57:[1,224],90:[2,128],91:223,92:[1,191],102:87,103:[1,65],105:[1,66],108:88,109:[1,68],110:69,125:[1,86],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{1:[2,114],6:[2,114],25:[2,114],26:[2,114],40:[2,114],49:[2,114],54:[2,114],57:[2,114],66:[2,114],67:[2,114],68:[2,114],70:[2,114],72:[2,114],73:[2,114],77:[2,114],83:[2,114],84:[2,114],85:[2,114],90:[2,114],92:[2,114],101:[2,114],103:[2,114],104:[2,114],105:[2,114],109:[2,114],115:[2,114],116:[2,114],117:[2,114],125:[2,114],127:[2,114],128:[2,114],131:[2,114],132:[2,114],133:[2,114],134:[2,114],135:[2,114],136:[2,114]},{6:[2,53],25:[2,53],53:225,54:[1,226],90:[2,53]},{6:[2,123],25:[2,123],26:[2,123],54:[2,123],85:[2,123],90:[2,123]},{8:200,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,25:[1,146],27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,60:147,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],86:227,87:[1,58],88:[1,59],89:[1,57],93:145,95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{6:[2,129],25:[2,129],26:[2,129],54:[2,129],85:[2,129],90:[2,129]},{1:[2,113],6:[2,113],25:[2,113],26:[2,113],40:[2,113],43:[2,113],49:[2,113],54:[2,113],57:[2,113],66:[2,113],67:[2,113],68:[2,113],70:[2,113],72:[2,113],73:[2,113],77:[2,113],79:[2,113],83:[2,113],84:[2,113],85:[2,113],90:[2,113],92:[2,113],101:[2,113],103:[2,113],104:[2,113],105:[2,113],109:[2,113],115:[2,113],116:[2,113],117:[2,113],125:[2,113],127:[2,113],128:[2,113],129:[2,113],130:[2,113],131:[2,113],132:[2,113],133:[2,113],134:[2,113],135:[2,113],136:[2,113],137:[2,113]},{5:228,25:[1,5],102:87,103:[1,65],105:[1,66],108:88,109:[1,68],110:69,125:[1,86],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{1:[2,140],6:[2,140],25:[2,140],26:[2,140],49:[2,140],54:[2,140],57:[2,140],72:[2,140],77:[2,140],85:[2,140],90:[2,140],92:[2,140],101:[2,140],102:87,103:[1,65],104:[1,229],105:[1,66],108:88,109:[1,68],110:69,117:[2,140],125:[2,140],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{1:[2,142],6:[2,142],25:[2,142],26:[2,142],49:[2,142],54:[2,142],57:[2,142],72:[2,142],77:[2,142],85:[2,142],90:[2,142],92:[2,142],101:[2,142],102:87,103:[1,65],104:[1,230],105:[1,66],108:88,109:[1,68],110:69,117:[2,142],125:[2,142],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{1:[2,148],6:[2,148],25:[2,148],26:[2,148],49:[2,148],54:[2,148],57:[2,148],72:[2,148],77:[2,148],85:[2,148],90:[2,148],92:[2,148],101:[2,148],103:[2,148],104:[2,148],105:[2,148],109:[2,148],117:[2,148],125:[2,148],127:[2,148],128:[2,148],131:[2,148],132:[2,148],133:[2,148],134:[2,148],135:[2,148],136:[2,148]},{1:[2,149],6:[2,149],25:[2,149],26:[2,149],49:[2,149],54:[2,149],57:[2,149],72:[2,149],77:[2,149],85:[2,149],90:[2,149],92:[2,149],101:[2,149],102:87,103:[1,65],104:[2,149],105:[1,66],108:88,109:[1,68],110:69,117:[2,149],125:[2,149],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{1:[2,153],6:[2,153],25:[2,153],26:[2,153],49:[2,153],54:[2,153],57:[2,153],72:[2,153],77:[2,153],85:[2,153],90:[2,153],92:[2,153],101:[2,153],103:[2,153],104:[2,153],105:[2,153],109:[2,153],117:[2,153],125:[2,153],127:[2,153],128:[2,153],131:[2,153],132:[2,153],133:[2,153],134:[2,153],135:[2,153],136:[2,153]},{115:[2,155],116:[2,155]},{27:158,28:[1,73],44:159,58:160,59:161,75:[1,70],88:[1,113],89:[1,114],112:231,114:157},{54:[1,232],115:[2,161],116:[2,161]},{54:[2,157],115:[2,157],116:[2,157]},{54:[2,158],115:[2,158],116:[2,158]},{54:[2,159],115:[2,159],116:[2,159]},{54:[2,160],115:[2,160],116:[2,160]},{1:[2,154],6:[2,154],25:[2,154],26:[2,154],49:[2,154],54:[2,154],57:[2,154],72:[2,154],77:[2,154],85:[2,154],90:[2,154],92:[2,154],101:[2,154],103:[2,154],104:[2,154],105:[2,154],109:[2,154],117:[2,154],125:[2,154],127:[2,154],128:[2,154],131:[2,154],132:[2,154],133:[2,154],134:[2,154],135:[2,154],136:[2,154]},{8:233,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{8:234,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{6:[2,53],25:[2,53],53:235,54:[1,236],77:[2,53]},{6:[2,91],25:[2,91],26:[2,91],54:[2,91],77:[2,91]},{6:[2,39],25:[2,39],26:[2,39],43:[1,237],54:[2,39],77:[2,39]},{6:[2,42],25:[2,42],26:[2,42],54:[2,42],77:[2,42]},{6:[2,43],25:[2,43],26:[2,43],43:[2,43],54:[2,43],77:[2,43]},{6:[2,44],25:[2,44],26:[2,44],43:[2,44],54:[2,44],77:[2,44]},{6:[2,45],25:[2,45],26:[2,45],43:[2,45],54:[2,45],77:[2,45]},{1:[2,5],6:[2,5],26:[2,5],101:[2,5]},{1:[2,25],6:[2,25],25:[2,25],26:[2,25],49:[2,25],54:[2,25],57:[2,25],72:[2,25],77:[2,25],85:[2,25],90:[2,25],92:[2,25],97:[2,25],98:[2,25],101:[2,25],103:[2,25],104:[2,25],105:[2,25],109:[2,25],117:[2,25],120:[2,25],122:[2,25],125:[2,25],127:[2,25],128:[2,25],131:[2,25],132:[2,25],133:[2,25],134:[2,25],135:[2,25],136:[2,25]},{1:[2,192],6:[2,192],25:[2,192],26:[2,192],49:[2,192],54:[2,192],57:[2,192],72:[2,192],77:[2,192],85:[2,192],90:[2,192],92:[2,192],101:[2,192],102:87,103:[2,192],104:[2,192],105:[2,192],108:88,109:[2,192],110:69,117:[2,192],125:[2,192],127:[2,192],128:[2,192],131:[1,78],132:[1,81],133:[2,192],134:[2,192],135:[2,192],136:[2,192]},{1:[2,193],6:[2,193],25:[2,193],26:[2,193],49:[2,193],54:[2,193],57:[2,193],72:[2,193],77:[2,193],85:[2,193],90:[2,193],92:[2,193],101:[2,193],102:87,103:[2,193],104:[2,193],105:[2,193],108:88,109:[2,193],110:69,117:[2,193],125:[2,193],127:[2,193],128:[2,193],131:[1,78],132:[1,81],133:[2,193],134:[2,193],135:[2,193],136:[2,193]},{1:[2,194],6:[2,194],25:[2,194],26:[2,194],49:[2,194],54:[2,194],57:[2,194],72:[2,194],77:[2,194],85:[2,194],90:[2,194],92:[2,194],101:[2,194],102:87,103:[2,194],104:[2,194],105:[2,194],108:88,109:[2,194],110:69,117:[2,194],125:[2,194],127:[2,194],128:[2,194],131:[1,78],132:[2,194],133:[2,194],134:[2,194],135:[2,194],136:[2,194]},{1:[2,195],6:[2,195],25:[2,195],26:[2,195],49:[2,195],54:[2,195],57:[2,195],72:[2,195],77:[2,195],85:[2,195],90:[2,195],92:[2,195],101:[2,195],102:87,103:[2,195],104:[2,195],105:[2,195],108:88,109:[2,195],110:69,117:[2,195],125:[2,195],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[2,195],134:[2,195],135:[2,195],136:[2,195]},{1:[2,196],6:[2,196],25:[2,196],26:[2,196],49:[2,196],54:[2,196],57:[2,196],72:[2,196],77:[2,196],85:[2,196],90:[2,196],92:[2,196],101:[2,196],102:87,103:[2,196],104:[2,196],105:[2,196],108:88,109:[2,196],110:69,117:[2,196],125:[2,196],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[2,196],135:[2,196],136:[1,85]},{1:[2,197],6:[2,197],25:[2,197],26:[2,197],49:[2,197],54:[2,197],57:[2,197],72:[2,197],77:[2,197],85:[2,197],90:[2,197],92:[2,197],101:[2,197],102:87,103:[2,197],104:[2,197],105:[2,197],108:88,109:[2,197],110:69,117:[2,197],125:[2,197],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[2,197],136:[1,85]},{1:[2,198],6:[2,198],25:[2,198],26:[2,198],49:[2,198],54:[2,198],57:[2,198],72:[2,198],77:[2,198],85:[2,198],90:[2,198],92:[2,198],101:[2,198],102:87,103:[2,198],104:[2,198],105:[2,198],108:88,109:[2,198],110:69,117:[2,198],125:[2,198],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[2,198],135:[2,198],136:[2,198]},{1:[2,183],6:[2,183],25:[2,183],26:[2,183],49:[2,183],54:[2,183],57:[2,183],72:[2,183],77:[2,183],85:[2,183],90:[2,183],92:[2,183],101:[2,183],102:87,103:[1,65],104:[2,183],105:[1,66],108:88,109:[1,68],110:69,117:[2,183],125:[1,86],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{1:[2,182],6:[2,182],25:[2,182],26:[2,182],49:[2,182],54:[2,182],57:[2,182],72:[2,182],77:[2,182],85:[2,182],90:[2,182],92:[2,182],101:[2,182],102:87,103:[1,65],104:[2,182],105:[1,66],108:88,109:[1,68],110:69,117:[2,182],125:[1,86],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{1:[2,103],6:[2,103],25:[2,103],26:[2,103],49:[2,103],54:[2,103],57:[2,103],66:[2,103],67:[2,103],68:[2,103],70:[2,103],72:[2,103],73:[2,103],77:[2,103],83:[2,103],84:[2,103],85:[2,103],90:[2,103],92:[2,103],101:[2,103],103:[2,103],104:[2,103],105:[2,103],109:[2,103],117:[2,103],125:[2,103],127:[2,103],128:[2,103],131:[2,103],132:[2,103],133:[2,103],134:[2,103],135:[2,103],136:[2,103]},{1:[2,80],6:[2,80],25:[2,80],26:[2,80],40:[2,80],49:[2,80],54:[2,80],57:[2,80],66:[2,80],67:[2,80],68:[2,80],70:[2,80],72:[2,80],73:[2,80],77:[2,80],79:[2,80],83:[2,80],84:[2,80],85:[2,80],90:[2,80],92:[2,80],101:[2,80],103:[2,80],104:[2,80],105:[2,80],109:[2,80],117:[2,80],125:[2,80],127:[2,80],128:[2,80],129:[2,80],130:[2,80],131:[2,80],132:[2,80],133:[2,80],134:[2,80],135:[2,80],136:[2,80],137:[2,80]},{1:[2,81],6:[2,81],25:[2,81],26:[2,81],40:[2,81],49:[2,81],54:[2,81],57:[2,81],66:[2,81],67:[2,81],68:[2,81],70:[2,81],72:[2,81],73:[2,81],77:[2,81],79:[2,81],83:[2,81],84:[2,81],85:[2,81],90:[2,81],92:[2,81],101:[2,81],103:[2,81],104:[2,81],105:[2,81],109:[2,81],117:[2,81],125:[2,81],127:[2,81],128:[2,81],129:[2,81],130:[2,81],131:[2,81],132:[2,81],133:[2,81],134:[2,81],135:[2,81],136:[2,81],137:[2,81]},{1:[2,82],6:[2,82],25:[2,82],26:[2,82],40:[2,82],49:[2,82],54:[2,82],57:[2,82],66:[2,82],67:[2,82],68:[2,82],70:[2,82],72:[2,82],73:[2,82],77:[2,82],79:[2,82],83:[2,82],84:[2,82],85:[2,82],90:[2,82],92:[2,82],101:[2,82],103:[2,82],104:[2,82],105:[2,82],109:[2,82],117:[2,82],125:[2,82],127:[2,82],128:[2,82],129:[2,82],130:[2,82],131:[2,82],132:[2,82],133:[2,82],134:[2,82],135:[2,82],136:[2,82],137:[2,82]},{72:[1,238]},{57:[1,192],72:[2,87],91:239,92:[1,191],102:87,103:[1,65],105:[1,66],108:88,109:[1,68],110:69,125:[1,86],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{72:[2,88]},{8:240,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,72:[2,122],75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{12:[2,116],28:[2,116],30:[2,116],31:[2,116],33:[2,116],34:[2,116],35:[2,116],36:[2,116],37:[2,116],38:[2,116],45:[2,116],46:[2,116],47:[2,116],51:[2,116],52:[2,116],72:[2,116],75:[2,116],78:[2,116],82:[2,116],87:[2,116],88:[2,116],89:[2,116],95:[2,116],99:[2,116],100:[2,116],103:[2,116],105:[2,116],107:[2,116],109:[2,116],118:[2,116],124:[2,116],126:[2,116],127:[2,116],128:[2,116],129:[2,116],130:[2,116]},{12:[2,117],28:[2,117],30:[2,117],31:[2,117],33:[2,117],34:[2,117],35:[2,117],36:[2,117],37:[2,117],38:[2,117],45:[2,117],46:[2,117],47:[2,117],51:[2,117],52:[2,117],72:[2,117],75:[2,117],78:[2,117],82:[2,117],87:[2,117],88:[2,117],89:[2,117],95:[2,117],99:[2,117],100:[2,117],103:[2,117],105:[2,117],107:[2,117],109:[2,117],118:[2,117],124:[2,117],126:[2,117],127:[2,117],128:[2,117],129:[2,117],130:[2,117]},{1:[2,86],6:[2,86],25:[2,86],26:[2,86],40:[2,86],49:[2,86],54:[2,86],57:[2,86],66:[2,86],67:[2,86],68:[2,86],70:[2,86],72:[2,86],73:[2,86],77:[2,86],79:[2,86],83:[2,86],84:[2,86],85:[2,86],90:[2,86],92:[2,86],101:[2,86],103:[2,86],104:[2,86],105:[2,86],109:[2,86],117:[2,86],125:[2,86],127:[2,86],128:[2,86],129:[2,86],130:[2,86],131:[2,86],132:[2,86],133:[2,86],134:[2,86],135:[2,86],136:[2,86],137:[2,86]},{1:[2,104],6:[2,104],25:[2,104],26:[2,104],49:[2,104],54:[2,104],57:[2,104],66:[2,104],67:[2,104],68:[2,104],70:[2,104],72:[2,104],73:[2,104],77:[2,104],83:[2,104],84:[2,104],85:[2,104],90:[2,104],92:[2,104],101:[2,104],103:[2,104],104:[2,104],105:[2,104],109:[2,104],117:[2,104],125:[2,104],127:[2,104],128:[2,104],131:[2,104],132:[2,104],133:[2,104],134:[2,104],135:[2,104],136:[2,104]},{1:[2,36],6:[2,36],25:[2,36],26:[2,36],49:[2,36],54:[2,36],57:[2,36],72:[2,36],77:[2,36],85:[2,36],90:[2,36],92:[2,36],101:[2,36],102:87,103:[2,36],104:[2,36],105:[2,36],108:88,109:[2,36],110:69,117:[2,36],125:[2,36],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{8:241,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{8:242,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{1:[2,109],6:[2,109],25:[2,109],26:[2,109],49:[2,109],54:[2,109],57:[2,109],66:[2,109],67:[2,109],68:[2,109],70:[2,109],72:[2,109],73:[2,109],77:[2,109],83:[2,109],84:[2,109],85:[2,109],90:[2,109],92:[2,109],101:[2,109],103:[2,109],104:[2,109],105:[2,109],109:[2,109],117:[2,109],125:[2,109],127:[2,109],128:[2,109],131:[2,109],132:[2,109],133:[2,109],134:[2,109],135:[2,109],136:[2,109]},{6:[2,53],25:[2,53],53:243,54:[1,226],85:[2,53]},{6:[2,128],25:[2,128],26:[2,128],54:[2,128],57:[1,244],85:[2,128],90:[2,128],102:87,103:[1,65],105:[1,66],108:88,109:[1,68],110:69,125:[1,86],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{50:245,51:[1,60],52:[1,61]},{6:[2,54],25:[2,54],26:[2,54],27:109,28:[1,73],44:110,55:246,56:108,58:111,59:112,75:[1,70],88:[1,113],89:[1,114]},{6:[1,247],25:[1,248]},{6:[2,61],25:[2,61],26:[2,61],49:[2,61],54:[2,61]},{8:249,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{1:[2,199],6:[2,199],25:[2,199],26:[2,199],49:[2,199],54:[2,199],57:[2,199],72:[2,199],77:[2,199],85:[2,199],90:[2,199],92:[2,199],101:[2,199],102:87,103:[2,199],104:[2,199],105:[2,199],108:88,109:[2,199],110:69,117:[2,199],125:[2,199],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{8:250,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{1:[2,201],6:[2,201],25:[2,201],26:[2,201],49:[2,201],54:[2,201],57:[2,201],72:[2,201],77:[2,201],85:[2,201],90:[2,201],92:[2,201],101:[2,201],102:87,103:[2,201],104:[2,201],105:[2,201],108:88,109:[2,201],110:69,117:[2,201],125:[2,201],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{1:[2,181],6:[2,181],25:[2,181],26:[2,181],49:[2,181],54:[2,181],57:[2,181],72:[2,181],77:[2,181],85:[2,181],90:[2,181],92:[2,181],101:[2,181],103:[2,181],104:[2,181],105:[2,181],109:[2,181],117:[2,181],125:[2,181],127:[2,181],128:[2,181],131:[2,181],132:[2,181],133:[2,181],134:[2,181],135:[2,181],136:[2,181]},{8:251,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{1:[2,133],6:[2,133],25:[2,133],26:[2,133],49:[2,133],54:[2,133],57:[2,133],72:[2,133],77:[2,133],85:[2,133],90:[2,133],92:[2,133],97:[1,252],101:[2,133],103:[2,133],104:[2,133],105:[2,133],109:[2,133],117:[2,133],125:[2,133],127:[2,133],128:[2,133],131:[2,133],132:[2,133],133:[2,133],134:[2,133],135:[2,133],136:[2,133]},{5:253,25:[1,5]},{27:254,28:[1,73]},{119:255,121:216,122:[1,217]},{26:[1,256],120:[1,257],121:258,122:[1,217]},{26:[2,174],120:[2,174],122:[2,174]},{8:260,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],94:259,95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{1:[2,97],5:261,6:[2,97],25:[1,5],26:[2,97],49:[2,97],54:[2,97],57:[2,97],72:[2,97],77:[2,97],85:[2,97],90:[2,97],92:[2,97],101:[2,97],102:87,103:[1,65],104:[2,97],105:[1,66],108:88,109:[1,68],110:69,117:[2,97],125:[2,97],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{1:[2,100],6:[2,100],25:[2,100],26:[2,100],49:[2,100],54:[2,100],57:[2,100],72:[2,100],77:[2,100],85:[2,100],90:[2,100],92:[2,100],101:[2,100],103:[2,100],104:[2,100],105:[2,100],109:[2,100],117:[2,100],125:[2,100],127:[2,100],128:[2,100],131:[2,100],132:[2,100],133:[2,100],134:[2,100],135:[2,100],136:[2,100]},{8:262,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{1:[2,138],6:[2,138],25:[2,138],26:[2,138],49:[2,138],54:[2,138],57:[2,138],66:[2,138],67:[2,138],68:[2,138],70:[2,138],72:[2,138],73:[2,138],77:[2,138],83:[2,138],84:[2,138],85:[2,138],90:[2,138],92:[2,138],101:[2,138],103:[2,138],104:[2,138],105:[2,138],109:[2,138],117:[2,138],125:[2,138],127:[2,138],128:[2,138],131:[2,138],132:[2,138],133:[2,138],134:[2,138],135:[2,138],136:[2,138]},{6:[1,74],26:[1,263]},{8:264,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{6:[2,67],12:[2,117],25:[2,67],28:[2,117],30:[2,117],31:[2,117],33:[2,117],34:[2,117],35:[2,117],36:[2,117],37:[2,117],38:[2,117],45:[2,117],46:[2,117],47:[2,117],51:[2,117],52:[2,117],54:[2,67],75:[2,117],78:[2,117],82:[2,117],87:[2,117],88:[2,117],89:[2,117],90:[2,67],95:[2,117],99:[2,117],100:[2,117],103:[2,117],105:[2,117],107:[2,117],109:[2,117],118:[2,117],124:[2,117],126:[2,117],127:[2,117],128:[2,117],129:[2,117],130:[2,117]},{6:[1,266],25:[1,267],90:[1,265]},{6:[2,54],8:200,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,25:[2,54],26:[2,54],27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,60:147,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],85:[2,54],87:[1,58],88:[1,59],89:[1,57],90:[2,54],93:268,95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{6:[2,53],25:[2,53],26:[2,53],53:269,54:[1,226]},{1:[2,178],6:[2,178],25:[2,178],26:[2,178],49:[2,178],54:[2,178],57:[2,178],72:[2,178],77:[2,178],85:[2,178],90:[2,178],92:[2,178],101:[2,178],103:[2,178],104:[2,178],105:[2,178],109:[2,178],117:[2,178],120:[2,178],125:[2,178],127:[2,178],128:[2,178],131:[2,178],132:[2,178],133:[2,178],134:[2,178],135:[2,178],136:[2,178]},{8:270,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{8:271,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{115:[2,156],116:[2,156]},{27:158,28:[1,73],44:159,58:160,59:161,75:[1,70],88:[1,113],89:[1,114],114:272},{1:[2,163],6:[2,163],25:[2,163],26:[2,163],49:[2,163],54:[2,163],57:[2,163],72:[2,163],77:[2,163],85:[2,163],90:[2,163],92:[2,163],101:[2,163],102:87,103:[2,163],104:[1,273],105:[2,163],108:88,109:[2,163],110:69,117:[1,274],125:[2,163],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{1:[2,164],6:[2,164],25:[2,164],26:[2,164],49:[2,164],54:[2,164],57:[2,164],72:[2,164],77:[2,164],85:[2,164],90:[2,164],92:[2,164],101:[2,164],102:87,103:[2,164],104:[1,275],105:[2,164],108:88,109:[2,164],110:69,117:[2,164],125:[2,164],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{6:[1,277],25:[1,278],77:[1,276]},{6:[2,54],11:168,25:[2,54],26:[2,54],27:169,28:[1,73],29:170,30:[1,71],31:[1,72],41:279,42:167,44:171,46:[1,46],77:[2,54],88:[1,113]},{8:280,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,25:[1,281],27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{1:[2,85],6:[2,85],25:[2,85],26:[2,85],40:[2,85],49:[2,85],54:[2,85],57:[2,85],66:[2,85],67:[2,85],68:[2,85],70:[2,85],72:[2,85],73:[2,85],77:[2,85],79:[2,85],83:[2,85],84:[2,85],85:[2,85],90:[2,85],92:[2,85],101:[2,85],103:[2,85],104:[2,85],105:[2,85],109:[2,85],117:[2,85],125:[2,85],127:[2,85],128:[2,85],129:[2,85],130:[2,85],131:[2,85],132:[2,85],133:[2,85],134:[2,85],135:[2,85],136:[2,85],137:[2,85]},{8:282,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,72:[2,120],75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{72:[2,121],102:87,103:[1,65],105:[1,66],108:88,109:[1,68],110:69,125:[1,86],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{1:[2,37],6:[2,37],25:[2,37],26:[2,37],49:[2,37],54:[2,37],57:[2,37],72:[2,37],77:[2,37],85:[2,37],90:[2,37],92:[2,37],101:[2,37],102:87,103:[2,37],104:[2,37],105:[2,37],108:88,109:[2,37],110:69,117:[2,37],125:[2,37],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{26:[1,283],102:87,103:[1,65],105:[1,66],108:88,109:[1,68],110:69,125:[1,86],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{6:[1,266],25:[1,267],85:[1,284]},{6:[2,67],25:[2,67],26:[2,67],54:[2,67],85:[2,67],90:[2,67]},{5:285,25:[1,5]},{6:[2,57],25:[2,57],26:[2,57],49:[2,57],54:[2,57]},{27:109,28:[1,73],44:110,55:286,56:108,58:111,59:112,75:[1,70],88:[1,113],89:[1,114]},{6:[2,55],25:[2,55],26:[2,55],27:109,28:[1,73],44:110,48:287,54:[2,55],55:107,56:108,58:111,59:112,75:[1,70],88:[1,113],89:[1,114]},{6:[2,62],25:[2,62],26:[2,62],49:[2,62],54:[2,62],102:87,103:[1,65],105:[1,66],108:88,109:[1,68],110:69,125:[1,86],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{26:[1,288],102:87,103:[1,65],105:[1,66],108:88,109:[1,68],110:69,125:[1,86],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{5:289,25:[1,5],102:87,103:[1,65],105:[1,66],108:88,109:[1,68],110:69,125:[1,86],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{5:290,25:[1,5]},{1:[2,134],6:[2,134],25:[2,134],26:[2,134],49:[2,134],54:[2,134],57:[2,134],72:[2,134],77:[2,134],85:[2,134],90:[2,134],92:[2,134],101:[2,134],103:[2,134],104:[2,134],105:[2,134],109:[2,134],117:[2,134],125:[2,134],127:[2,134],128:[2,134],131:[2,134],132:[2,134],133:[2,134],134:[2,134],135:[2,134],136:[2,134]},{5:291,25:[1,5]},{26:[1,292],120:[1,293],121:258,122:[1,217]},{1:[2,172],6:[2,172],25:[2,172],26:[2,172],49:[2,172],54:[2,172],57:[2,172],72:[2,172],77:[2,172],85:[2,172],90:[2,172],92:[2,172],101:[2,172],103:[2,172],104:[2,172],105:[2,172],109:[2,172],117:[2,172],125:[2,172],127:[2,172],128:[2,172],131:[2,172],132:[2,172],133:[2,172],134:[2,172],135:[2,172],136:[2,172]},{5:294,25:[1,5]},{26:[2,175],120:[2,175],122:[2,175]},{5:295,25:[1,5],54:[1,296]},{25:[2,130],54:[2,130],102:87,103:[1,65],105:[1,66],108:88,109:[1,68],110:69,125:[1,86],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{1:[2,98],6:[2,98],25:[2,98],26:[2,98],49:[2,98],54:[2,98],57:[2,98],72:[2,98],77:[2,98],85:[2,98],90:[2,98],92:[2,98],101:[2,98],103:[2,98],104:[2,98],105:[2,98],109:[2,98],117:[2,98],125:[2,98],127:[2,98],128:[2,98],131:[2,98],132:[2,98],133:[2,98],134:[2,98],135:[2,98],136:[2,98]},{1:[2,101],5:297,6:[2,101],25:[1,5],26:[2,101],49:[2,101],54:[2,101],57:[2,101],72:[2,101],77:[2,101],85:[2,101],90:[2,101],92:[2,101],101:[2,101],102:87,103:[1,65],104:[2,101],105:[1,66],108:88,109:[1,68],110:69,117:[2,101],125:[2,101],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{101:[1,298]},{90:[1,299],102:87,103:[1,65],105:[1,66],108:88,109:[1,68],110:69,125:[1,86],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{1:[2,115],6:[2,115],25:[2,115],26:[2,115],40:[2,115],49:[2,115],54:[2,115],57:[2,115],66:[2,115],67:[2,115],68:[2,115],70:[2,115],72:[2,115],73:[2,115],77:[2,115],83:[2,115],84:[2,115],85:[2,115],90:[2,115],92:[2,115],101:[2,115],103:[2,115],104:[2,115],105:[2,115],109:[2,115],115:[2,115],116:[2,115],117:[2,115],125:[2,115],127:[2,115],128:[2,115],131:[2,115],132:[2,115],133:[2,115],134:[2,115],135:[2,115],136:[2,115]},{8:200,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,60:147,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],93:300,95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{8:200,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,25:[1,146],27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,60:147,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],86:301,87:[1,58],88:[1,59],89:[1,57],93:145,95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{6:[2,124],25:[2,124],26:[2,124],54:[2,124],85:[2,124],90:[2,124]},{6:[1,266],25:[1,267],26:[1,302]},{1:[2,141],6:[2,141],25:[2,141],26:[2,141],49:[2,141],54:[2,141],57:[2,141],72:[2,141],77:[2,141],85:[2,141],90:[2,141],92:[2,141],101:[2,141],102:87,103:[1,65],104:[2,141],105:[1,66],108:88,109:[1,68],110:69,117:[2,141],125:[2,141],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{1:[2,143],6:[2,143],25:[2,143],26:[2,143],49:[2,143],54:[2,143],57:[2,143],72:[2,143],77:[2,143],85:[2,143],90:[2,143],92:[2,143],101:[2,143],102:87,103:[1,65],104:[2,143],105:[1,66],108:88,109:[1,68],110:69,117:[2,143],125:[2,143],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{115:[2,162],116:[2,162]},{8:303,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{8:304,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{8:305,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{1:[2,89],6:[2,89],25:[2,89],26:[2,89],40:[2,89],49:[2,89],54:[2,89],57:[2,89],66:[2,89],67:[2,89],68:[2,89],70:[2,89],72:[2,89],73:[2,89],77:[2,89],83:[2,89],84:[2,89],85:[2,89],90:[2,89],92:[2,89],101:[2,89],103:[2,89],104:[2,89],105:[2,89],109:[2,89],115:[2,89],116:[2,89],117:[2,89],125:[2,89],127:[2,89],128:[2,89],131:[2,89],132:[2,89],133:[2,89],134:[2,89],135:[2,89],136:[2,89]},{11:168,27:169,28:[1,73],29:170,30:[1,71],31:[1,72],41:306,42:167,44:171,46:[1,46],88:[1,113]},{6:[2,90],11:168,25:[2,90],26:[2,90],27:169,28:[1,73],29:170,30:[1,71],31:[1,72],41:166,42:167,44:171,46:[1,46],54:[2,90],76:307,88:[1,113]},{6:[2,92],25:[2,92],26:[2,92],54:[2,92],77:[2,92]},{6:[2,40],25:[2,40],26:[2,40],54:[2,40],77:[2,40],102:87,103:[1,65],105:[1,66],108:88,109:[1,68],110:69,125:[1,86],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{8:308,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{72:[2,119],102:87,103:[1,65],105:[1,66],108:88,109:[1,68],110:69,125:[1,86],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{1:[2,38],6:[2,38],25:[2,38],26:[2,38],49:[2,38],54:[2,38],57:[2,38],72:[2,38],77:[2,38],85:[2,38],90:[2,38],92:[2,38],101:[2,38],103:[2,38],104:[2,38],105:[2,38],109:[2,38],117:[2,38],125:[2,38],127:[2,38],128:[2,38],131:[2,38],132:[2,38],133:[2,38],134:[2,38],135:[2,38],136:[2,38]},{1:[2,110],6:[2,110],25:[2,110],26:[2,110],49:[2,110],54:[2,110],57:[2,110],66:[2,110],67:[2,110],68:[2,110],70:[2,110],72:[2,110],73:[2,110],77:[2,110],83:[2,110],84:[2,110],85:[2,110],90:[2,110],92:[2,110],101:[2,110],103:[2,110],104:[2,110],105:[2,110],109:[2,110],117:[2,110],125:[2,110],127:[2,110],128:[2,110],131:[2,110],132:[2,110],133:[2,110],134:[2,110],135:[2,110],136:[2,110]},{1:[2,49],6:[2,49],25:[2,49],26:[2,49],49:[2,49],54:[2,49],57:[2,49],72:[2,49],77:[2,49],85:[2,49],90:[2,49],92:[2,49],101:[2,49],103:[2,49],104:[2,49],105:[2,49],109:[2,49],117:[2,49],125:[2,49],127:[2,49],128:[2,49],131:[2,49],132:[2,49],133:[2,49],134:[2,49],135:[2,49],136:[2,49]},{6:[2,58],25:[2,58],26:[2,58],49:[2,58],54:[2,58]},{6:[2,53],25:[2,53],26:[2,53],53:309,54:[1,202]},{1:[2,200],6:[2,200],25:[2,200],26:[2,200],49:[2,200],54:[2,200],57:[2,200],72:[2,200],77:[2,200],85:[2,200],90:[2,200],92:[2,200],101:[2,200],103:[2,200],104:[2,200],105:[2,200],109:[2,200],117:[2,200],125:[2,200],127:[2,200],128:[2,200],131:[2,200],132:[2,200],133:[2,200],134:[2,200],135:[2,200],136:[2,200]},{1:[2,179],6:[2,179],25:[2,179],26:[2,179],49:[2,179],54:[2,179],57:[2,179],72:[2,179],77:[2,179],85:[2,179],90:[2,179],92:[2,179],101:[2,179],103:[2,179],104:[2,179],105:[2,179],109:[2,179],117:[2,179],120:[2,179],125:[2,179],127:[2,179],128:[2,179],131:[2,179],132:[2,179],133:[2,179],134:[2,179],135:[2,179],136:[2,179]},{1:[2,135],6:[2,135],25:[2,135],26:[2,135],49:[2,135],54:[2,135],57:[2,135],72:[2,135],77:[2,135],85:[2,135],90:[2,135],92:[2,135],101:[2,135],103:[2,135],104:[2,135],105:[2,135],109:[2,135],117:[2,135],125:[2,135],127:[2,135],128:[2,135],131:[2,135],132:[2,135],133:[2,135],134:[2,135],135:[2,135],136:[2,135]},{1:[2,136],6:[2,136],25:[2,136],26:[2,136],49:[2,136],54:[2,136],57:[2,136],72:[2,136],77:[2,136],85:[2,136],90:[2,136],92:[2,136],97:[2,136],101:[2,136],103:[2,136],104:[2,136],105:[2,136],109:[2,136],117:[2,136],125:[2,136],127:[2,136],128:[2,136],131:[2,136],132:[2,136],133:[2,136],134:[2,136],135:[2,136],136:[2,136]},{1:[2,170],6:[2,170],25:[2,170],26:[2,170],49:[2,170],54:[2,170],57:[2,170],72:[2,170],77:[2,170],85:[2,170],90:[2,170],92:[2,170],101:[2,170],103:[2,170],104:[2,170],105:[2,170],109:[2,170],117:[2,170],125:[2,170],127:[2,170],128:[2,170],131:[2,170],132:[2,170],133:[2,170],134:[2,170],135:[2,170],136:[2,170]},{5:310,25:[1,5]},{26:[1,311]},{6:[1,312],26:[2,176],120:[2,176],122:[2,176]},{8:313,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{1:[2,102],6:[2,102],25:[2,102],26:[2,102],49:[2,102],54:[2,102],57:[2,102],72:[2,102],77:[2,102],85:[2,102],90:[2,102],92:[2,102],101:[2,102],103:[2,102],104:[2,102],105:[2,102],109:[2,102],117:[2,102],125:[2,102],127:[2,102],128:[2,102],131:[2,102],132:[2,102],133:[2,102],134:[2,102],135:[2,102],136:[2,102]},{1:[2,139],6:[2,139],25:[2,139],26:[2,139],49:[2,139],54:[2,139],57:[2,139],66:[2,139],67:[2,139],68:[2,139],70:[2,139],72:[2,139],73:[2,139],77:[2,139],83:[2,139],84:[2,139],85:[2,139],90:[2,139],92:[2,139],101:[2,139],103:[2,139],104:[2,139],105:[2,139],109:[2,139],117:[2,139],125:[2,139],127:[2,139],128:[2,139],131:[2,139],132:[2,139],133:[2,139],134:[2,139],135:[2,139],136:[2,139]},{1:[2,118],6:[2,118],25:[2,118],26:[2,118],49:[2,118],54:[2,118],57:[2,118],66:[2,118],67:[2,118],68:[2,118],70:[2,118],72:[2,118],73:[2,118],77:[2,118],83:[2,118],84:[2,118],85:[2,118],90:[2,118],92:[2,118],101:[2,118],103:[2,118],104:[2,118],105:[2,118],109:[2,118],117:[2,118],125:[2,118],127:[2,118],128:[2,118],131:[2,118],132:[2,118],133:[2,118],134:[2,118],135:[2,118],136:[2,118]},{6:[2,125],25:[2,125],26:[2,125],54:[2,125],85:[2,125],90:[2,125]},{6:[2,53],25:[2,53],26:[2,53],53:314,54:[1,226]},{6:[2,126],25:[2,126],26:[2,126],54:[2,126],85:[2,126],90:[2,126]},{1:[2,165],6:[2,165],25:[2,165],26:[2,165],49:[2,165],54:[2,165],57:[2,165],72:[2,165],77:[2,165],85:[2,165],90:[2,165],92:[2,165],101:[2,165],102:87,103:[2,165],104:[2,165],105:[2,165],108:88,109:[2,165],110:69,117:[1,315],125:[2,165],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{1:[2,167],6:[2,167],25:[2,167],26:[2,167],49:[2,167],54:[2,167],57:[2,167],72:[2,167],77:[2,167],85:[2,167],90:[2,167],92:[2,167],101:[2,167],102:87,103:[2,167],104:[1,316],105:[2,167],108:88,109:[2,167],110:69,117:[2,167],125:[2,167],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{1:[2,166],6:[2,166],25:[2,166],26:[2,166],49:[2,166],54:[2,166],57:[2,166],72:[2,166],77:[2,166],85:[2,166],90:[2,166],92:[2,166],101:[2,166],102:87,103:[2,166],104:[2,166],105:[2,166],108:88,109:[2,166],110:69,117:[2,166],125:[2,166],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{6:[2,93],25:[2,93],26:[2,93],54:[2,93],77:[2,93]},{6:[2,53],25:[2,53],26:[2,53],53:317,54:[1,236]},{26:[1,318],102:87,103:[1,65],105:[1,66],108:88,109:[1,68],110:69,125:[1,86],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{6:[1,247],25:[1,248],26:[1,319]},{26:[1,320]},{1:[2,173],6:[2,173],25:[2,173],26:[2,173],49:[2,173],54:[2,173],57:[2,173],72:[2,173],77:[2,173],85:[2,173],90:[2,173],92:[2,173],101:[2,173],103:[2,173],104:[2,173],105:[2,173],109:[2,173],117:[2,173],125:[2,173],127:[2,173],128:[2,173],131:[2,173],132:[2,173],133:[2,173],134:[2,173],135:[2,173],136:[2,173]},{26:[2,177],120:[2,177],122:[2,177]},{25:[2,131],54:[2,131],102:87,103:[1,65],105:[1,66],108:88,109:[1,68],110:69,125:[1,86],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{6:[1,266],25:[1,267],26:[1,321]},{8:322,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{8:323,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{6:[1,277],25:[1,278],26:[1,324]},{6:[2,41],25:[2,41],26:[2,41],54:[2,41],77:[2,41]},{6:[2,59],25:[2,59],26:[2,59],49:[2,59],54:[2,59]},{1:[2,171],6:[2,171],25:[2,171],26:[2,171],49:[2,171],54:[2,171],57:[2,171],72:[2,171],77:[2,171],85:[2,171],90:[2,171],92:[2,171],101:[2,171],103:[2,171],104:[2,171],105:[2,171],109:[2,171],117:[2,171],125:[2,171],127:[2,171],128:[2,171],131:[2,171],132:[2,171],133:[2,171],134:[2,171],135:[2,171],136:[2,171]},{6:[2,127],25:[2,127],26:[2,127],54:[2,127],85:[2,127],90:[2,127]},{1:[2,168],6:[2,168],25:[2,168],26:[2,168],49:[2,168],54:[2,168],57:[2,168],72:[2,168],77:[2,168],85:[2,168],90:[2,168],92:[2,168],101:[2,168],102:87,103:[2,168],104:[2,168],105:[2,168],108:88,109:[2,168],110:69,117:[2,168],125:[2,168],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{1:[2,169],6:[2,169],25:[2,169],26:[2,169],49:[2,169],54:[2,169],57:[2,169],72:[2,169],77:[2,169],85:[2,169],90:[2,169],92:[2,169],101:[2,169],102:87,103:[2,169],104:[2,169],105:[2,169],108:88,109:[2,169],110:69,117:[2,169],125:[2,169],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{6:[2,94],25:[2,94],26:[2,94],54:[2,94],77:[2,94]}],defaultActions:{60:[2,51],61:[2,52],75:[2,3],94:[2,108],189:[2,88]},parseError:function(e){throw new Error(e)
},parse:function(e){function t(){var e;return e=r.lexer.lex()||1,"number"!=typeof e&&(e=r.symbols_[e]||e),e}function n(e){i.length=i.length-2*e,o.length=o.length-e,a.length=a.length-e}var r=this,i=[0],o=[null],a=[],s=this.table,l="",u=0,c=0,d=0,h=2,p=1;this.lexer.setInput(e),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,"undefined"==typeof this.lexer.yylloc&&(this.lexer.yylloc={});var f=this.lexer.yylloc;a.push(f),"function"==typeof this.yy.parseError&&(this.parseError=this.yy.parseError);for(var m,g,v,y,b,x,w,_,T,A={};;){if(v=i[i.length-1],this.defaultActions[v]?y=this.defaultActions[v]:(null==m&&(m=t()),y=s[v]&&s[v][m]),"undefined"==typeof y||!y.length||!y[0]){if(!d){T=[];for(x in s[v])this.terminals_[x]&&x>2&&T.push("'"+this.terminals_[x]+"'");var C="";C=this.lexer.showPosition?"Parse error on line "+(u+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+T.join(", ")+", got '"+this.terminals_[m]+"'":"Parse error on line "+(u+1)+": Unexpected "+(1==m?"end of input":"'"+(this.terminals_[m]||m)+"'"),this.parseError(C,{text:this.lexer.match,token:this.terminals_[m]||m,line:this.lexer.yylineno,loc:f,expected:T})}if(3==d){if(m==p)throw new Error(C||"Parsing halted.");c=this.lexer.yyleng,l=this.lexer.yytext,u=this.lexer.yylineno,f=this.lexer.yylloc,m=t()}for(;!(h.toString()in s[v]);){if(0==v)throw new Error(C||"Parsing halted.");n(1),v=i[i.length-1]}g=m,m=h,v=i[i.length-1],y=s[v]&&s[v][h],d=3}if(y[0]instanceof Array&&y.length>1)throw new Error("Parse Error: multiple actions possible at state: "+v+", token: "+m);switch(y[0]){case 1:i.push(m),o.push(this.lexer.yytext),a.push(this.lexer.yylloc),i.push(y[1]),m=null,g?(m=g,g=null):(c=this.lexer.yyleng,l=this.lexer.yytext,u=this.lexer.yylineno,f=this.lexer.yylloc,d>0&&d--);break;case 2:if(w=this.productions_[y[1]][1],A.$=o[o.length-w],A._$={first_line:a[a.length-(w||1)].first_line,last_line:a[a.length-1].last_line,first_column:a[a.length-(w||1)].first_column,last_column:a[a.length-1].last_column},b=this.performAction.call(A,l,c,u,this.yy,y[1],o,a),"undefined"!=typeof b)return b;w&&(i=i.slice(0,-1*w*2),o=o.slice(0,-1*w),a=a.slice(0,-1*w)),i.push(this.productions_[y[1]][0]),o.push(A.$),a.push(A._$),_=s[i[i.length-2]][i[i.length-1]],i.push(_);break;case 3:return!0}}return!0}};return e}();"undefined"!=typeof require&&"undefined"!=typeof e&&(e.parser=t,e.parse=function(){return t.parse.apply(t,arguments)},e.main=function(t){if(!t[1])throw new Error("Usage: "+t[0]+" FILE");if("undefined"!=typeof process)var n=require("fs").readFileSync(require("path").join(process.cwd(),t[1]),"utf8");else var r=require("file").path(require("file").cwd()),n=r.join(t[1]).read({charset:"utf-8"});return e.parser.parse(n)},"undefined"!=typeof module&&require.main===module&&e.main("undefined"!=typeof process?process.argv.slice(1):require("system").args))},require["./scope"]=new function(){var e=this;(function(){var t,n,r,i;i=require("./helpers"),n=i.extend,r=i.last,e.Scope=t=function(){function e(t,n,r){this.parent=t,this.expressions=n,this.method=r,this.variables=[{name:"arguments",type:"arguments"}],this.positions={},this.parent||(e.root=this)}return e.root=null,e.prototype.add=function(e,t,n){return this.shared&&!n?this.parent.add(e,t,n):Object.prototype.hasOwnProperty.call(this.positions,e)?this.variables[this.positions[e]].type=t:this.positions[e]=this.variables.push({name:e,type:t})-1},e.prototype.namedMethod=function(){return this.method.name||!this.parent?this.method:this.parent.namedMethod()},e.prototype.find=function(e){return this.check(e)?!0:(this.add(e,"var"),!1)},e.prototype.parameter=function(e){return this.shared&&this.parent.check(e,!0)?void 0:this.add(e,"param")},e.prototype.check=function(e){var t;return!!(this.type(e)||(null!=(t=this.parent)?t.check(e):void 0))},e.prototype.temporary=function(e,t){return e.length>1?"_"+e+(t>1?t-1:""):"_"+(t+parseInt(e,36)).toString(36).replace(/\d/g,"a")},e.prototype.type=function(e){var t,n,r,i;for(i=this.variables,n=0,r=i.length;r>n;n++)if(t=i[n],t.name===e)return t.type;return null},e.prototype.freeVariable=function(e,t){var n,r;for(null==t&&(t=!0),n=0;this.check(r=this.temporary(e,n));)n++;return t&&this.add(r,"var",!0),r},e.prototype.assign=function(e,t){return this.add(e,{value:t,assigned:!0},!0),this.hasAssignments=!0},e.prototype.hasDeclarations=function(){return!!this.declaredVariables().length},e.prototype.declaredVariables=function(){var e,t,n,r,i,o;for(e=[],t=[],o=this.variables,r=0,i=o.length;i>r;r++)n=o[r],"var"===n.type&&("_"===n.name.charAt(0)?t:e).push(n.name);return e.sort().concat(t.sort())},e.prototype.assignedVariables=function(){var e,t,n,r,i;for(r=this.variables,i=[],t=0,n=r.length;n>t;t++)e=r[t],e.type.assigned&&i.push(""+e.name+" = "+e.type.value);return i},e}()}).call(this)},require["./nodes"]=new function(){var e=this;(function(){var t,n,r,i,o,a,s,l,u,c,d,h,p,f,m,g,v,y,b,x,w,_,T,A,C,E,S,k,P,R,O,M,N,I,L,B,D,F,V,G,$,U,j,q,W,H,z,X,Y,K,J,Z,Q,et,tt,nt,rt,it,ot,at,st,lt,ut,ct={}.hasOwnProperty,dt=function(e,t){function n(){this.constructor=e}for(var r in t)ct.call(t,r)&&(e[r]=t[r]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},ht=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};V=require("./scope").Scope,lt=require("./lexer"),I=lt.RESERVED,F=lt.STRICT_PROSCRIBED,ut=require("./helpers"),J=ut.compact,tt=ut.flatten,et=ut.extend,rt=ut.merge,Z=ut.del,ot=ut.starts,Q=ut.ends,nt=ut.last,e.extend=et,K=function(){return!0},P=function(){return!1},q=function(){return this},k=function(){return this.negated=!this.negated,this},e.Base=i=function(){function e(){}return e.prototype.compile=function(e,t){var n;return e=et({},e),t&&(e.level=t),n=this.unfoldSoak(e)||this,n.tab=e.indent,e.level!==C&&n.isStatement(e)?n.compileClosure(e):n.compileNode(e)},e.prototype.compileClosure=function(e){if(this.jumps())throw SyntaxError("cannot use a pure statement in an expression.");return e.sharedScope=!0,l.wrap(this).compileNode(e)},e.prototype.cache=function(e,t,n){var i,o;return this.isComplex()?(i=new E(n||e.scope.freeVariable("ref")),o=new r(i,this),t?[o.compile(e,t),i.value]:[o,i]):(i=t?this.compile(e,t):this,[i,i])},e.prototype.compileLoopReference=function(e,t){var n,r;return n=r=this.compile(e,_),+n>-1/0&&1/0>+n||f.test(n)&&e.scope.check(n,!0)||(n=""+(r=e.scope.freeVariable(t))+" = "+n),[n,r]},e.prototype.makeReturn=function(e){var t;return t=this.unwrapAll(),e?new a(new E(""+e+".push"),[t]):new B(t)},e.prototype.contains=function(e){var t;return t=!1,this.traverseChildren(!1,function(n){return e(n)?(t=!0,!1):void 0}),t},e.prototype.containsType=function(e){return this instanceof e||this.contains(function(t){return t instanceof e})},e.prototype.lastNonComment=function(e){var t;for(t=e.length;t--;)if(!(e[t]instanceof c))return e[t];return null},e.prototype.toString=function(e,t){var n;return null==e&&(e=""),null==t&&(t=this.constructor.name),n="\n"+e+t,this.soak&&(n+="?"),this.eachChild(function(t){return n+=t.toString(e+j)}),n},e.prototype.eachChild=function(e){var t,n,r,i,o,a,s,l;if(!this.children)return this;for(s=this.children,r=0,o=s.length;o>r;r++)if(t=s[r],this[t])for(l=tt([this[t]]),i=0,a=l.length;a>i;i++)if(n=l[i],e(n)===!1)return this;return this},e.prototype.traverseChildren=function(e,t){return this.eachChild(function(n){return t(n)===!1?!1:n.traverseChildren(e,t)})},e.prototype.invert=function(){return new O("!",this)},e.prototype.unwrapAll=function(){var e;for(e=this;e!==(e=e.unwrap());)continue;return e},e.prototype.children=[],e.prototype.isStatement=P,e.prototype.jumps=P,e.prototype.isComplex=K,e.prototype.isChainable=P,e.prototype.isAssignable=P,e.prototype.unwrap=q,e.prototype.unfoldSoak=P,e.prototype.assigns=P,e}(),e.Block=o=function(e){function t(e){this.expressions=J(tt(e||[]))}return dt(t,e),t.prototype.children=["expressions"],t.prototype.push=function(e){return this.expressions.push(e),this},t.prototype.pop=function(){return this.expressions.pop()},t.prototype.unshift=function(e){return this.expressions.unshift(e),this},t.prototype.unwrap=function(){return 1===this.expressions.length?this.expressions[0]:this},t.prototype.isEmpty=function(){return!this.expressions.length},t.prototype.isStatement=function(e){var t,n,r,i;for(i=this.expressions,n=0,r=i.length;r>n;n++)if(t=i[n],t.isStatement(e))return!0;return!1},t.prototype.jumps=function(e){var t,n,r,i;for(i=this.expressions,n=0,r=i.length;r>n;n++)if(t=i[n],t.jumps(e))return t},t.prototype.makeReturn=function(e){var t,n;for(n=this.expressions.length;n--;)if(t=this.expressions[n],!(t instanceof c)){this.expressions[n]=t.makeReturn(e),t instanceof B&&!t.expression&&this.expressions.splice(n,1);break}return this},t.prototype.compile=function(e,n){return null==e&&(e={}),e.scope?t.__super__.compile.call(this,e,n):this.compileRoot(e)},t.prototype.compileNode=function(e){var n,r,i,o,a,s,l;for(this.tab=e.indent,o=e.level===C,r=[],l=this.expressions,a=0,s=l.length;s>a;a++)i=l[a],i=i.unwrapAll(),i=i.unfoldSoak(e)||i,i instanceof t?r.push(i.compileNode(e)):o?(i.front=!0,n=i.compile(e),i.isStatement(e)||(n=""+this.tab+n+";",i instanceof E&&(n=""+n+"\n")),r.push(n)):r.push(i.compile(e,_));return o?this.spaced?"\n"+r.join("\n\n")+"\n":r.join("\n"):(n=r.join(", ")||"void 0",r.length>1&&e.level>=_?"("+n+")":n)},t.prototype.compileRoot=function(e){var t,n,r,i,o,a;return e.indent=e.bare?"":j,e.scope=new V(null,this,null),e.level=C,this.spaced=!0,i="",e.bare||(o=function(){var e,t,i,o;for(i=this.expressions,o=[],r=e=0,t=i.length;t>e&&(n=i[r],n.unwrap()instanceof c);r=++e)o.push(n);return o}.call(this),a=this.expressions.slice(o.length),this.expressions=o,o.length&&(i=""+this.compileNode(rt(e,{indent:""}))+"\n"),this.expressions=a),t=this.compileWithDeclarations(e),e.bare?t:""+i+"(function() {\n"+t+"\n}).call(this);\n"},t.prototype.compileWithDeclarations=function(e){var t,n,r,i,o,a,s,l,u,d,h,p,f,m;for(n=a="",p=this.expressions,o=d=0,h=p.length;h>d&&(i=p[o],i=i.unwrap(),i instanceof c||i instanceof E);o=++d);return e=rt(e,{level:C}),o&&(s=this.expressions.splice(o,9e9),f=[this.spaced,!1],u=f[0],this.spaced=f[1],m=[this.compileNode(e),u],n=m[0],this.spaced=m[1],this.expressions=s),a=this.compileNode(e),l=e.scope,l.expressions===this&&(r=e.scope.hasDeclarations(),t=l.hasAssignments,(r||t)&&(o&&(n+="\n"),n+=""+this.tab+"var ",r&&(n+=l.declaredVariables().join(", ")),t&&(r&&(n+=",\n"+(this.tab+j)),n+=l.assignedVariables().join(",\n"+(this.tab+j))),n+=";\n")),n+a},t.wrap=function(e){return 1===e.length&&e[0]instanceof t?e[0]:new t(e)},t}(i),e.Literal=E=function(e){function t(e){this.value=e}return dt(t,e),t.prototype.makeReturn=function(){return this.isStatement()?this:t.__super__.makeReturn.apply(this,arguments)},t.prototype.isAssignable=function(){return f.test(this.value)},t.prototype.isStatement=function(){var e;return"break"===(e=this.value)||"continue"===e||"debugger"===e},t.prototype.isComplex=P,t.prototype.assigns=function(e){return e===this.value},t.prototype.jumps=function(e){return"break"!==this.value||(null!=e?e.loop:void 0)||(null!=e?e.block:void 0)?"continue"!==this.value||(null!=e?e.loop:0)?void 0:this:this},t.prototype.compileNode=function(e){var t,n;return t="this"===this.value?(null!=(n=e.scope.method)?n.bound:void 0)?e.scope.method.context:this.value:this.value.reserved?'"'+this.value+'"':this.value,this.isStatement()?""+this.tab+t+";":t},t.prototype.toString=function(){return' "'+this.value+'"'},t}(i),e.Undefined=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return dt(t,e),t.prototype.isAssignable=P,t.prototype.isComplex=P,t.prototype.compileNode=function(e){return e.level>=x?"(void 0)":"void 0"},t}(i),e.Null=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return dt(t,e),t.prototype.isAssignable=P,t.prototype.isComplex=P,t.prototype.compileNode=function(){return"null"},t}(i),e.Bool=function(e){function t(e){this.val=e}return dt(t,e),t.prototype.isAssignable=P,t.prototype.isComplex=P,t.prototype.compileNode=function(){return this.val},t}(i),e.Return=B=function(e){function t(e){e&&!e.unwrap().isUndefined&&(this.expression=e)}return dt(t,e),t.prototype.children=["expression"],t.prototype.isStatement=K,t.prototype.makeReturn=q,t.prototype.jumps=q,t.prototype.compile=function(e,n){var r,i;return r=null!=(i=this.expression)?i.makeReturn():void 0,!r||r instanceof t?t.__super__.compile.call(this,e,n):r.compile(e,n)},t.prototype.compileNode=function(e){return this.tab+("return"+[this.expression?" "+this.expression.compile(e,A):void 0]+";")},t}(i),e.Value=X=function(e){function t(e,n,r){return!n&&e instanceof t?e:(this.base=e,this.properties=n||[],r&&(this[r]=!0),this)}return dt(t,e),t.prototype.children=["base","properties"],t.prototype.add=function(e){return this.properties=this.properties.concat(e),this},t.prototype.hasProperties=function(){return!!this.properties.length},t.prototype.isArray=function(){return!this.properties.length&&this.base instanceof n},t.prototype.isComplex=function(){return this.hasProperties()||this.base.isComplex()},t.prototype.isAssignable=function(){return this.hasProperties()||this.base.isAssignable()},t.prototype.isSimpleNumber=function(){return this.base instanceof E&&D.test(this.base.value)},t.prototype.isString=function(){return this.base instanceof E&&g.test(this.base.value)},t.prototype.isAtomic=function(){var e,t,n,r;for(r=this.properties.concat(this.base),t=0,n=r.length;n>t;t++)if(e=r[t],e.soak||e instanceof a)return!1;return!0},t.prototype.isStatement=function(e){return!this.properties.length&&this.base.isStatement(e)},t.prototype.assigns=function(e){return!this.properties.length&&this.base.assigns(e)},t.prototype.jumps=function(e){return!this.properties.length&&this.base.jumps(e)},t.prototype.isObject=function(e){return this.properties.length?!1:this.base instanceof R&&(!e||this.base.generated)},t.prototype.isSplice=function(){return nt(this.properties)instanceof G},t.prototype.unwrap=function(){return this.properties.length?this:this.base},t.prototype.cacheReference=function(e){var n,i,o,a;return o=nt(this.properties),this.properties.length<2&&!this.base.isComplex()&&(null!=o?!o.isComplex():!0)?[this,this]:(n=new t(this.base,this.properties.slice(0,-1)),n.isComplex()&&(i=new E(e.scope.freeVariable("base")),n=new t(new N(new r(i,n)))),o?(o.isComplex()&&(a=new E(e.scope.freeVariable("name")),o=new b(new r(a,o.index)),a=new b(a)),[n.add(o),new t(i||n.base,[a||o])]):[n,i])},t.prototype.compileNode=function(e){var t,n,r,i,o;for(this.base.front=this.front,r=this.properties,t=this.base.compile(e,r.length?x:null),(this.base instanceof N||r.length)&&D.test(t)&&(t=""+t+"."),i=0,o=r.length;o>i;i++)n=r[i],t+=n.compile(e);return t},t.prototype.unfoldSoak=function(e){var n,i=this;return null!=this.unfoldedSoak?this.unfoldedSoak:(n=function(){var n,o,a,s,l,u,c,h,p;if(a=i.base.unfoldSoak(e))return Array.prototype.push.apply(a.body.properties,i.properties),a;for(p=i.properties,o=c=0,h=p.length;h>c;o=++c)if(s=p[o],s.soak)return s.soak=!1,n=new t(i.base,i.properties.slice(0,o)),u=new t(i.base,i.properties.slice(o)),n.isComplex()&&(l=new E(e.scope.freeVariable("ref")),n=new N(new r(l,n)),u.base=l),new v(new d(n),u,{soak:!0});return null}(),this.unfoldedSoak=n||!1)},t}(i),e.Comment=c=function(e){function t(e){this.comment=e}return dt(t,e),t.prototype.isStatement=K,t.prototype.makeReturn=q,t.prototype.compileNode=function(e,t){var n;return n="/*"+it(this.comment,this.tab)+("\n"+this.tab+"*/\n"),(t||e.level)===C&&(n=e.indent+n),n},t}(i),e.Call=a=function(e){function n(e,t,n){this.args=null!=t?t:[],this.soak=n,this.isNew=!1,this.isSuper="super"===e,this.variable=this.isSuper?null:e}return dt(n,e),n.prototype.children=["variable","args"],n.prototype.newInstance=function(){var e,t;return e=(null!=(t=this.variable)?t.base:void 0)||this.variable,e instanceof n&&!e.isNew?e.newInstance():this.isNew=!0,this},n.prototype.superReference=function(e){var n,r,i;if(r=e.scope.namedMethod(),!r)throw SyntaxError("cannot call super outside of a function.");if(i=r.name,null==i)throw SyntaxError("cannot call super on an anonymous function.");return r.klass?(n=[new t(new E("__super__"))],r["static"]&&n.push(new t(new E("constructor"))),n.push(new t(new E(i))),new X(new E(r.klass),n).compile(e)):""+i+".__super__.constructor"},n.prototype.superThis=function(e){var t;return t=e.scope.method,t&&!t.klass&&t.context||"this"},n.prototype.unfoldSoak=function(e){var t,r,i,o,a,s,l,u,c;if(this.soak){if(this.variable){if(r=at(e,this,"variable"))return r;u=new X(this.variable).cacheReference(e),i=u[0],a=u[1]}else i=new E(this.superReference(e)),a=new X(i);return a=new n(a,this.args),a.isNew=this.isNew,i=new E("typeof "+i.compile(e)+' === "function"'),new v(i,new X(a),{soak:!0})}for(t=this,o=[];;)if(t.variable instanceof n)o.push(t),t=t.variable;else{if(!(t.variable instanceof X))break;if(o.push(t),!((t=t.variable.base)instanceof n))break}for(c=o.reverse(),s=0,l=c.length;l>s;s++)t=c[s],r&&(t.variable instanceof n?t.variable=r:t.variable.base=r),r=at(e,t,"variable");return r},n.prototype.filterImplicitObjects=function(e){var t,n,i,o,a,s,l,u,d,h;for(n=[],s=0,u=e.length;u>s;s++)if(t=e[s],("function"==typeof t.isObject?t.isObject():void 0)&&t.base.generated)for(i=null,h=t.base.properties,l=0,d=h.length;d>l;l++)o=h[l],o instanceof r||o instanceof c?(i||n.push(i=new R(a=[],!0)),a.push(o)):(n.push(o),i=null);else n.push(t);return n},n.prototype.compileNode=function(e){var t,n,r,i;return null!=(i=this.variable)&&(i.front=this.front),(r=$.compileSplattedArray(e,this.args,!0))?this.compileSplat(e,r):(n=this.filterImplicitObjects(this.args),n=function(){var r,i,o;for(o=[],r=0,i=n.length;i>r;r++)t=n[r],o.push(t.compile(e,_));return o}().join(", "),this.isSuper?this.superReference(e)+(".call("+this.superThis(e)+(n&&", "+n)+")"):(this.isNew?"new ":"")+this.variable.compile(e,x)+("("+n+")"))},n.prototype.compileSuper=function(e,t){return""+this.superReference(t)+".call("+this.superThis(t)+(e.length?", ":"")+e+")"},n.prototype.compileSplat=function(e,t){var n,r,i,o,a;return this.isSuper?""+this.superReference(e)+".apply("+this.superThis(e)+", "+t+")":this.isNew?(i=this.tab+j,"(function(func, args, ctor) {\n"+i+"ctor.prototype = func.prototype;\n"+i+"var child = new ctor, result = func.apply(child, args), t = typeof result;\n"+i+'return t == "object" || t == "function" ? result || child : child;\n'+this.tab+"})("+this.variable.compile(e,_)+", "+t+", function(){})"):(n=new X(this.variable),(o=n.properties.pop())&&n.isComplex()?(a=e.scope.freeVariable("ref"),r="("+a+" = "+n.compile(e,_)+")"+o.compile(e)):(r=n.compile(e,x),D.test(r)&&(r="("+r+")"),o?(a=r,r+=o.compile(e)):a="null"),""+r+".apply("+a+", "+t+")")},n}(i),e.Extends=h=function(e){function t(e,t){this.child=e,this.parent=t}return dt(t,e),t.prototype.children=["child","parent"],t.prototype.compile=function(e){return new a(new X(new E(st("extends"))),[this.child,this.parent]).compile(e)},t}(i),e.Access=t=function(e){function t(e,t){this.name=e,this.name.asKey=!0,this.soak="soak"===t}return dt(t,e),t.prototype.children=["name"],t.prototype.compile=function(e){var t;return t=this.name.compile(e),f.test(t)?"."+t:"["+t+"]"},t.prototype.isComplex=P,t}(i),e.Index=b=function(e){function t(e){this.index=e}return dt(t,e),t.prototype.children=["index"],t.prototype.compile=function(e){return"["+this.index.compile(e,A)+"]"},t.prototype.isComplex=function(){return this.index.isComplex()},t}(i),e.Range=L=function(e){function t(e,t,n){this.from=e,this.to=t,this.exclusive="exclusive"===n,this.equals=this.exclusive?"":"="}return dt(t,e),t.prototype.children=["from","to"],t.prototype.compileVariables=function(e){var t,n,r,i,o;return e=rt(e,{top:!0}),n=this.from.cache(e,_),this.fromC=n[0],this.fromVar=n[1],r=this.to.cache(e,_),this.toC=r[0],this.toVar=r[1],(t=Z(e,"step"))&&(i=t.cache(e,_),this.step=i[0],this.stepVar=i[1]),o=[this.fromVar.match(D),this.toVar.match(D)],this.fromNum=o[0],this.toNum=o[1],this.stepVar?this.stepNum=this.stepVar.match(D):void 0},t.prototype.compileNode=function(e){var t,n,r,i,o,a,s,l,u,c,d,h,p,f;return this.fromVar||this.compileVariables(e),e.index?(s=this.fromNum&&this.toNum,o=Z(e,"index"),a=Z(e,"name"),u=a&&a!==o,h=""+o+" = "+this.fromC,this.toC!==this.toVar&&(h+=", "+this.toC),this.step!==this.stepVar&&(h+=", "+this.step),p=[""+o+" <"+this.equals,""+o+" >"+this.equals],l=p[0],i=p[1],n=this.stepNum?+this.stepNum>0?""+l+" "+this.toVar:""+i+" "+this.toVar:s?(f=[+this.fromNum,+this.toNum],r=f[0],d=f[1],d>=r?""+l+" "+d:""+i+" "+d):(t=""+this.fromVar+" <= "+this.toVar,""+t+" ? "+l+" "+this.toVar+" : "+i+" "+this.toVar),c=this.stepVar?""+o+" += "+this.stepVar:s?u?d>=r?"++"+o:"--"+o:d>=r?""+o+"++":""+o+"--":u?""+t+" ? ++"+o+" : --"+o:""+t+" ? "+o+"++ : "+o+"--",u&&(h=""+a+" = "+h),u&&(c=""+a+" = "+c),""+h+"; "+n+"; "+c):this.compileArray(e)},t.prototype.compileArray=function(e){var t,n,r,i,o,a,s,l,u,c,d,h,p;return this.fromNum&&this.toNum&&Math.abs(this.fromNum-this.toNum)<=20?(u=function(){p=[];for(var e=h=+this.fromNum,t=+this.toNum;t>=h?t>=e:e>=t;t>=h?e++:e--)p.push(e);return p}.apply(this),this.exclusive&&u.pop(),"["+u.join(", ")+"]"):(a=this.tab+j,o=e.scope.freeVariable("i"),c=e.scope.freeVariable("results"),l="\n"+a+c+" = [];",this.fromNum&&this.toNum?(e.index=o,n=this.compileNode(e)):(d=""+o+" = "+this.fromC+(this.toC!==this.toVar?", "+this.toC:""),r=""+this.fromVar+" <= "+this.toVar,n="var "+d+"; "+r+" ? "+o+" <"+this.equals+" "+this.toVar+" : "+o+" >"+this.equals+" "+this.toVar+"; "+r+" ? "+o+"++ : "+o+"--"),s="{ "+c+".push("+o+"); }\n"+a+"return "+c+";\n"+e.indent,i=function(e){return null!=e?e.contains(function(e){return e instanceof E&&"arguments"===e.value&&!e.asKey}):void 0},(i(this.from)||i(this.to))&&(t=", arguments"),"(function() {"+l+"\n"+a+"for ("+n+")"+s+"}).apply(this"+(null!=t?t:"")+")")},t}(i),e.Slice=G=function(e){function t(e){this.range=e,t.__super__.constructor.call(this)}return dt(t,e),t.prototype.children=["range"],t.prototype.compileNode=function(e){var t,n,r,i,o,a;return a=this.range,i=a.to,n=a.from,r=n&&n.compile(e,A)||"0",t=i&&i.compile(e,A),i&&(!!this.range.exclusive||-1!==+t)&&(o=", "+(this.range.exclusive?t:D.test(t)?""+(+t+1):(t=i.compile(e,x),""+t+" + 1 || 9e9"))),".slice("+r+(o||"")+")"},t}(i),e.Obj=R=function(e){function t(e,t){this.generated=null!=t?t:!1,this.objects=this.properties=e||[]}return dt(t,e),t.prototype.children=["properties"],t.prototype.compileNode=function(e){var t,n,i,o,a,s,l,u,d,h,p,f,m,g,v,y;for(p=this.properties,h=[],y=this.properties,f=0,g=y.length;g>f;f++)if(u=y[f],u.isComplex()&&(u=u.variable),null!=u){if(d=u.unwrapAll().value.toString(),ht.call(h,d)>=0)throw SyntaxError('multiple object literal properties named "'+d+'"');h.push(d)}if(!p.length)return this.front?"({})":"{}";if(this.generated)for(m=0,v=p.length;v>m;m++)if(s=p[m],s instanceof X)throw new Error("cannot have an implicit value in an implicit object");return n=e.indent+=j,a=this.lastNonComment(this.properties),p=function(){var s,l,d;for(d=[],t=s=0,l=p.length;l>s;t=++s)u=p[t],o=t===p.length-1?"":u===a||u instanceof c?"\n":",\n",i=u instanceof c?"":n,u instanceof X&&u["this"]&&(u=new r(u.properties[0].name,u,"object")),u instanceof c||(u instanceof r||(u=new r(u,u,"object")),(u.variable.base||u.variable).asKey=!0),d.push(i+u.compile(e,C)+o);return d}(),p=p.join(""),l="{"+(p&&"\n"+p+"\n"+this.tab)+"}",this.front?"("+l+")":l},t.prototype.assigns=function(e){var t,n,r,i;for(i=this.properties,n=0,r=i.length;r>n;n++)if(t=i[n],t.assigns(e))return!0;return!1},t}(i),e.Arr=n=function(e){function t(e){this.objects=e||[]}return dt(t,e),t.prototype.children=["objects"],t.prototype.filterImplicitObjects=a.prototype.filterImplicitObjects,t.prototype.compileNode=function(e){var t,n,r;return this.objects.length?(e.indent+=j,r=this.filterImplicitObjects(this.objects),(t=$.compileSplattedArray(e,r))?t:(t=function(){var t,i,o;for(o=[],t=0,i=r.length;i>t;t++)n=r[t],o.push(n.compile(e,_));return o}().join(", "),t.indexOf("\n")>=0?"[\n"+e.indent+t+"\n"+this.tab+"]":"["+t+"]")):"[]"},t.prototype.assigns=function(e){var t,n,r,i;for(i=this.objects,n=0,r=i.length;r>n;n++)if(t=i[n],t.assigns(e))return!0;return!1},t}(i),e.Class=s=function(e){function n(e,t,n){this.variable=e,this.parent=t,this.body=null!=n?n:new o,this.boundFuncs=[],this.body.classBody=!0}return dt(n,e),n.prototype.children=["variable","parent","body"],n.prototype.determineName=function(){var e,n;if(!this.variable)return null;if(e=(n=nt(this.variable.properties))?n instanceof t&&n.name.value:this.variable.base.value,ht.call(F,e)>=0)throw SyntaxError("variable name may not be "+e);return e&&(e=f.test(e)&&e)},n.prototype.setContext=function(e){return this.body.traverseChildren(!1,function(t){return t.classBody?!1:t instanceof E&&"this"===t.value?t.value=e:t instanceof u&&(t.klass=e,t.bound)?t.context=e:void 0})},n.prototype.addBoundFunctions=function(e){var n,r,i,o,a,s;if(this.boundFuncs.length){for(a=this.boundFuncs,s=[],i=0,o=a.length;o>i;i++)n=a[i],r=new X(new E("this"),[new t(n)]).compile(e),s.push(this.ctor.body.unshift(new E(""+r+" = "+st("bind")+"("+r+", this)")));return s}},n.prototype.addProperties=function(e,n,i){var o,a,s,l,c;return c=e.base.properties.slice(0),s=function(){var e;for(e=[];o=c.shift();){if(o instanceof r)if(a=o.variable.base,delete o.context,l=o.value,"constructor"===a.value){if(this.ctor)throw new Error("cannot define more than one constructor in a class");if(l.bound)throw new Error("cannot define a constructor as a bound function");l instanceof u?o=this.ctor=l:(this.externalCtor=i.scope.freeVariable("class"),o=new r(new E(this.externalCtor),l))}else o.variable["this"]?(l["static"]=!0,l.bound&&(l.context=n)):(o.variable=new X(new E(n),[new t(new E("prototype")),new t(a)]),l instanceof u&&l.bound&&(this.boundFuncs.push(a),l.bound=!1));e.push(o)}return e}.call(this),J(s)},n.prototype.walkBody=function(e,t){var r=this;return this.traverseChildren(!1,function(i){var a,s,l,u,c,d;if(i instanceof n)return!1;if(i instanceof o){for(d=a=i.expressions,s=u=0,c=d.length;c>u;s=++u)l=d[s],l instanceof X&&l.isObject(!0)&&(a[s]=r.addProperties(l,e,t));return i.expressions=a=tt(a)}})},n.prototype.hoistDirectivePrologue=function(){var e,t,n;for(t=0,e=this.body.expressions;(n=e[t])&&n instanceof c||n instanceof X&&n.isString();)++t;return this.directives=e.splice(0,t)},n.prototype.ensureConstructor=function(e){return this.ctor||(this.ctor=new u,this.parent&&this.ctor.body.push(new E(""+e+".__super__.constructor.apply(this, arguments)")),this.externalCtor&&this.ctor.body.push(new E(""+this.externalCtor+".apply(this, arguments)")),this.ctor.body.makeReturn(),this.body.expressions.unshift(this.ctor)),this.ctor.ctor=this.ctor.name=e,this.ctor.klass=null,this.ctor.noReturn=!0},n.prototype.compileNode=function(e){var t,n,i,o,a,s,c;return n=this.determineName(),a=n||"_Class",a.reserved&&(a="_"+a),o=new E(a),this.hoistDirectivePrologue(),this.setContext(a),this.walkBody(a,e),this.ensureConstructor(a),this.body.spaced=!0,this.ctor instanceof u||this.body.expressions.unshift(this.ctor),this.body.expressions.push(o),(c=this.body.expressions).unshift.apply(c,this.directives),this.addBoundFunctions(e),t=l.wrap(this.body),this.parent&&(this.superClass=new E(e.scope.freeVariable("super",!1)),this.body.expressions.unshift(new h(o,this.superClass)),t.args.push(this.parent),s=t.variable.params||t.variable.base.params,s.push(new M(this.superClass))),i=new N(t,!0),this.variable&&(i=new r(this.variable,i)),i.compile(e)},n}(i),e.Assign=r=function(e){function n(e,t,n,r){var i,o,a;if(this.variable=e,this.value=t,this.context=n,this.param=r&&r.param,this.subpattern=r&&r.subpattern,a=o=this.variable.unwrapAll().value,i=ht.call(F,a)>=0,i&&"object"!==this.context)throw SyntaxError('variable name may not be "'+o+'"')}return dt(n,e),n.prototype.children=["variable","value"],n.prototype.isStatement=function(e){return(null!=e?e.level:void 0)===C&&null!=this.context&&ht.call(this.context,"?")>=0},n.prototype.assigns=function(e){return this["object"===this.context?"value":"variable"].assigns(e)},n.prototype.unfoldSoak=function(e){return at(e,this,"variable")},n.prototype.compileNode=function(e){var t,n,r,i,o,a,s,l,c;if(t=this.variable instanceof X){if(this.variable.isArray()||this.variable.isObject())return this.compilePatternMatch(e);if(this.variable.isSplice())return this.compileSplice(e);if("||="===(a=this.context)||"&&="===a||"?="===a)return this.compileConditional(e)}if(r=this.variable.compile(e,_),!this.context){if(!(o=this.variable.unwrapAll()).isAssignable())throw SyntaxError('"'+this.variable.compile(e)+'" cannot be assigned.');("function"==typeof o.hasProperties?o.hasProperties():0)||(this.param?e.scope.add(r,"var"):e.scope.find(r))}return this.value instanceof u&&(n=S.exec(r))&&(n[1]&&(this.value.klass=n[1]),this.value.name=null!=(s=null!=(l=null!=(c=n[2])?c:n[3])?l:n[4])?s:n[5]),i=this.value.compile(e,_),"object"===this.context?""+r+": "+i:(i=r+(" "+(this.context||"=")+" ")+i,e.level<=_?i:"("+i+")")},n.prototype.compilePatternMatch=function(e){var r,i,o,a,s,l,u,c,d,h,p,m,g,v,y,x,w,A,S,k,P,R,O,M,L,B,D;if(y=e.level===C,w=this.value,h=this.variable.base.objects,!(p=h.length))return o=w.compile(e),e.level>=T?"("+o+")":o;if(l=this.variable.isObject(),y&&1===p&&!((d=h[0])instanceof $)){if(d instanceof n?(P=d,R=P.variable,s=R.base,d=P.value):d.base instanceof N?(O=new X(d.unwrapAll()).cacheReference(e),d=O[0],s=O[1]):s=l?d["this"]?d.properties[0].name:d:new E(0),r=f.test(s.unwrap().value||0),w=new X(w),w.properties.push(new(r?t:b)(s)),M=d.unwrap().value,ht.call(I,M)>=0)throw new SyntaxError("assignment to a reserved word: "+d.compile(e)+" = "+w.compile(e));return new n(d,w,null,{param:this.param}).compile(e,C)}for(A=w.compile(e,_),i=[],v=!1,(!f.test(A)||this.variable.assigns(A))&&(i.push(""+(m=e.scope.freeVariable("ref"))+" = "+A),A=m),a=S=0,k=h.length;k>S;a=++S){if(d=h[a],s=a,l&&(d instanceof n?(L=d,B=L.variable,s=B.base,d=L.value):d.base instanceof N?(D=new X(d.unwrapAll()).cacheReference(e),d=D[0],s=D[1]):s=d["this"]?d.properties[0].name:d),!v&&d instanceof $)c=d.name.unwrap().value,d=d.unwrap(),x=""+p+" <= "+A+".length ? "+st("slice")+".call("+A+", "+a,(g=p-a-1)?(u=e.scope.freeVariable("i"),x+=", "+u+" = "+A+".length - "+g+") : ("+u+" = "+a+", [])"):x+=") : []",x=new E(x),v=""+u+"++";else{if(c=d.unwrap().value,d instanceof $)throw d=d.name.compile(e),new SyntaxError("multiple splats are disallowed in an assignment: "+d+"...");"number"==typeof s?(s=new E(v||s),r=!1):r=l&&f.test(s.unwrap().value||0),x=new X(new E(A),[new(r?t:b)(s)])}if(null!=c&&ht.call(I,c)>=0)throw new SyntaxError("assignment to a reserved word: "+d.compile(e)+" = "+x.compile(e));i.push(new n(d,x,null,{param:this.param,subpattern:!0}).compile(e,_))}return!y&&!this.subpattern&&i.push(A),o=i.join(", "),e.level<_?o:"("+o+")"},n.prototype.compileConditional=function(e){var t,r,i;if(i=this.variable.cacheReference(e),t=i[0],r=i[1],!t.properties.length&&t.base instanceof E&&"this"!==t.base.value&&!e.scope.check(t.base.value))throw new Error('the variable "'+t.base.value+"\" can't be assigned with "+this.context+" because it has not been defined.");return ht.call(this.context,"?")>=0&&(e.isExistentialEquals=!0),new O(this.context.slice(0,-1),t,new n(r,this.value,"=")).compile(e)},n.prototype.compileSplice=function(e){var t,n,r,i,o,a,s,l,u,c,d,h;return c=this.variable.properties.pop().range,r=c.from,s=c.to,n=c.exclusive,a=this.variable.compile(e),d=(null!=r?r.cache(e,T):void 0)||["0","0"],i=d[0],o=d[1],s?(null!=r?r.isSimpleNumber():void 0)&&s.isSimpleNumber()?(s=+s.compile(e)-+o,n||(s+=1)):(s=s.compile(e,x)+" - "+o,n||(s+=" + 1")):s="9e9",h=this.value.cache(e,_),l=h[0],u=h[1],t="[].splice.apply("+a+", ["+i+", "+s+"].concat("+l+")), "+u,e.level>C?"("+t+")":t},n}(i),e.Code=u=function(e){function t(e,t,n){this.params=e||[],this.body=t||new o,this.bound="boundfunc"===n,this.bound&&(this.context="_this")}return dt(t,e),t.prototype.children=["params","body"],t.prototype.isStatement=function(){return!!this.ctor
},t.prototype.jumps=P,t.prototype.compileNode=function(e){var t,i,o,a,s,l,u,c,d,h,p,f,m,g,y,b,w,_,T,A,C,S,k,P,R,M,N,I,L,B,D,F,G;for(e.scope=new V(e.scope,this.body,this),e.scope.shared=Z(e,"sharedScope"),e.indent+=j,delete e.bare,delete e.isExistentialEquals,d=[],i=[],N=this.paramNames(),y=0,T=N.length;T>y;y++)l=N[y],e.scope.check(l)||e.scope.parameter(l);for(I=this.params,b=0,A=I.length;A>b;b++)if(c=I[b],c.splat){for(L=this.params,w=0,C=L.length;C>w;w++)u=L[w].name,u["this"]&&(u=u.properties[0].name),u.value&&e.scope.add(u.value,"var",!0);p=new r(new X(new n(function(){var t,n,r,i;for(r=this.params,i=[],t=0,n=r.length;n>t;t++)u=r[t],i.push(u.asReference(e));return i}.call(this))),new X(new E("arguments")));break}for(B=this.params,_=0,S=B.length;S>_;_++)c=B[_],c.isComplex()?(m=h=c.asReference(e),c.value&&(m=new O("?",h,c.value)),i.push(new r(new X(c.name),m,"=",{param:!0}))):(h=c,c.value&&(s=new E(h.name.value+" == null"),m=new r(new X(c.name),c.value,"="),i.push(new v(s,m)))),p||d.push(h);for(g=this.body.isEmpty(),p&&i.unshift(p),i.length&&(D=this.body.expressions).unshift.apply(D,i),o=R=0,k=d.length;k>R;o=++R)u=d[o],e.scope.parameter(d[o]=u.compile(e));for(f=[],F=this.paramNames(),M=0,P=F.length;P>M;M++){if(l=F[M],ht.call(f,l)>=0)throw SyntaxError("multiple parameters named '"+l+"'");f.push(l)}return!g&&!this.noReturn&&this.body.makeReturn(),this.bound&&((null!=(G=e.scope.parent.method)?G.bound:void 0)?this.bound=this.context=e.scope.parent.method.context:this["static"]||e.scope.parent.assign("_this","this")),a=e.indent,t="function",this.ctor&&(t+=" "+this.name),t+="("+d.join(", ")+") {",this.body.isEmpty()||(t+="\n"+this.body.compileWithDeclarations(e)+"\n"+this.tab),t+="}",this.ctor?this.tab+t:this.front||e.level>=x?"("+t+")":t},t.prototype.paramNames=function(){var e,t,n,r,i;for(e=[],i=this.params,n=0,r=i.length;r>n;n++)t=i[n],e.push.apply(e,t.names());return e},t.prototype.traverseChildren=function(e,n){return e?t.__super__.traverseChildren.call(this,e,n):void 0},t}(i),e.Param=M=function(e){function t(e,t,n){var r;if(this.name=e,this.value=t,this.splat=n,r=e=this.name.unwrapAll().value,ht.call(F,r)>=0)throw SyntaxError('parameter name "'+e+'" is not allowed')}return dt(t,e),t.prototype.children=["name","value"],t.prototype.compile=function(e){return this.name.compile(e,_)},t.prototype.asReference=function(e){var t;return this.reference?this.reference:(t=this.name,t["this"]?(t=t.properties[0].name,t.value.reserved&&(t=new E(e.scope.freeVariable(t.value)))):t.isComplex()&&(t=new E(e.scope.freeVariable("arg"))),t=new X(t),this.splat&&(t=new $(t)),this.reference=t)},t.prototype.isComplex=function(){return this.name.isComplex()},t.prototype.names=function(e){var t,n,i,o,a,s;if(null==e&&(e=this.name),t=function(e){var t;return t=e.properties[0].name.value,t.reserved?[]:[t]},e instanceof E)return[e.value];if(e instanceof X)return t(e);for(n=[],s=e.objects,o=0,a=s.length;a>o;o++)if(i=s[o],i instanceof r)n.push(i.value.unwrap().value);else if(i instanceof $)n.push(i.name.unwrap().value);else{if(!(i instanceof X))throw SyntaxError("illegal parameter "+i.compile());i.isArray()||i.isObject()?n.push.apply(n,this.names(i.base)):i["this"]?n.push.apply(n,t(i)):n.push(i.base.value)}return n},t}(i),e.Splat=$=function(e){function t(e){this.name=e.compile?e:new E(e)}return dt(t,e),t.prototype.children=["name"],t.prototype.isAssignable=K,t.prototype.assigns=function(e){return this.name.assigns(e)},t.prototype.compile=function(e){return null!=this.index?this.compileParam(e):this.name.compile(e)},t.prototype.unwrap=function(){return this.name},t.compileSplattedArray=function(e,n,r){var i,o,a,s,l,u,c,d;for(l=-1;(u=n[++l])&&!(u instanceof t);)continue;if(l>=n.length)return"";if(1===n.length)return a=n[0].compile(e,_),r?a:""+st("slice")+".call("+a+")";for(i=n.slice(l),s=c=0,d=i.length;d>c;s=++c)u=i[s],a=u.compile(e,_),i[s]=u instanceof t?""+st("slice")+".call("+a+")":"["+a+"]";return 0===l?i[0]+(".concat("+i.slice(1).join(", ")+")"):(o=function(){var t,r,i,o;for(i=n.slice(0,l),o=[],t=0,r=i.length;r>t;t++)u=i[t],o.push(u.compile(e,_));return o}(),"["+o.join(", ")+"].concat("+i.join(", ")+")")},t}(i),e.While=Y=function(e){function t(e,t){this.condition=(null!=t?t.invert:void 0)?e.invert():e,this.guard=null!=t?t.guard:void 0}return dt(t,e),t.prototype.children=["condition","guard","body"],t.prototype.isStatement=K,t.prototype.makeReturn=function(e){return e?t.__super__.makeReturn.apply(this,arguments):(this.returns=!this.jumps({loop:!0}),this)},t.prototype.addBody=function(e){return this.body=e,this},t.prototype.jumps=function(){var e,t,n,r;if(e=this.body.expressions,!e.length)return!1;for(n=0,r=e.length;r>n;n++)if(t=e[n],t.jumps({loop:!0}))return t;return!1},t.prototype.compileNode=function(e){var t,n,r,i;return e.indent+=j,i="",t=this.body,t.isEmpty()?t="":(this.returns&&(t.makeReturn(r=e.scope.freeVariable("results")),i=""+this.tab+r+" = [];\n"),this.guard&&(t.expressions.length>1?t.expressions.unshift(new v(new N(this.guard).invert(),new E("continue"))):this.guard&&(t=o.wrap([new v(this.guard,t)]))),t="\n"+t.compile(e,C)+"\n"+this.tab),n=i+this.tab+("while ("+this.condition.compile(e,A)+") {"+t+"}"),this.returns&&(n+="\n"+this.tab+"return "+r+";"),n},t}(i),e.Op=O=function(e){function t(e,t,r,i){if("in"===e)return new y(t,r);if("do"===e)return this.generateDo(t);if("new"===e){if(t instanceof a&&!t["do"]&&!t.isNew)return t.newInstance();(t instanceof u&&t.bound||t["do"])&&(t=new N(t))}return this.operator=n[e]||e,this.first=t,this.second=r,this.flip=!!i,this}var n,i;return dt(t,e),n={"==":"===","!=":"!==",of:"in"},i={"!==":"===","===":"!=="},t.prototype.children=["first","second"],t.prototype.isSimpleNumber=P,t.prototype.isUnary=function(){return!this.second},t.prototype.isComplex=function(){var e;return!this.isUnary()||"+"!==(e=this.operator)&&"-"!==e||this.first.isComplex()},t.prototype.isChainable=function(){var e;return"<"===(e=this.operator)||">"===e||">="===e||"<="===e||"==="===e||"!=="===e},t.prototype.invert=function(){var e,n,r,o,a;if(this.isChainable()&&this.first.isChainable()){for(e=!0,n=this;n&&n.operator;)e&&(e=n.operator in i),n=n.first;if(!e)return new N(this).invert();for(n=this;n&&n.operator;)n.invert=!n.invert,n.operator=i[n.operator],n=n.first;return this}return(o=i[this.operator])?(this.operator=o,this.first.unwrap()instanceof t&&this.first.invert(),this):this.second?new N(this).invert():"!"===this.operator&&(r=this.first.unwrap())instanceof t&&("!"===(a=r.operator)||"in"===a||"instanceof"===a)?r:new t("!",this)},t.prototype.unfoldSoak=function(e){var t;return("++"===(t=this.operator)||"--"===t||"delete"===t)&&at(e,this,"first")},t.prototype.generateDo=function(e){var t,n,i,o,s,l,c,d;for(o=[],n=e instanceof r&&(s=e.value.unwrap())instanceof u?s:e,d=n.params||[],l=0,c=d.length;c>l;l++)i=d[l],i.value?(o.push(i.value),delete i.value):o.push(i);return t=new a(e,o),t["do"]=!0,t},t.prototype.compileNode=function(e){var t,n,r,i;if(n=this.isChainable()&&this.first.isChainable(),n||(this.first.front=this.front),"delete"===this.operator&&e.scope.check(this.first.unwrapAll().value))throw SyntaxError("delete operand may not be argument or var");if(("--"===(r=this.operator)||"++"===r)&&(i=this.first.unwrapAll().value,ht.call(F,i)>=0))throw SyntaxError("prefix increment/decrement may not have eval or arguments operand");return this.isUnary()?this.compileUnary(e):n?this.compileChain(e):"?"===this.operator?this.compileExistence(e):(t=this.first.compile(e,T)+" "+this.operator+" "+this.second.compile(e,T),e.level<=T?t:"("+t+")")},t.prototype.compileChain=function(e){var t,n,r,i;return i=this.first.second.cache(e),this.first.second=i[0],r=i[1],n=this.first.compile(e,T),t=""+n+" "+(this.invert?"&&":"||")+" "+r.compile(e)+" "+this.operator+" "+this.second.compile(e,T),"("+t+")"},t.prototype.compileExistence=function(e){var t,n;return this.first.isComplex()?(n=new E(e.scope.freeVariable("ref")),t=new N(new r(n,this.first))):(t=this.first,n=t),new v(new d(t),n,{type:"if"}).addElse(this.second).compile(e)},t.prototype.compileUnary=function(e){var n,r,i;return e.level>=x?new N(this).compile(e):(r=[n=this.operator],i="+"===n||"-"===n,("new"===n||"typeof"===n||"delete"===n||i&&this.first instanceof t&&this.first.operator===n)&&r.push(" "),(i&&this.first instanceof t||"new"===n&&this.first.isStatement(e))&&(this.first=new N(this.first)),r.push(this.first.compile(e,T)),this.flip&&r.reverse(),r.join(""))},t.prototype.toString=function(e){return t.__super__.toString.call(this,e,this.constructor.name+" "+this.operator)},t}(i),e.In=y=function(e){function t(e,t){this.object=e,this.array=t}return dt(t,e),t.prototype.children=["object","array"],t.prototype.invert=k,t.prototype.compileNode=function(e){var t,n,r,i,o;if(this.array instanceof X&&this.array.isArray()){for(o=this.array.base.objects,r=0,i=o.length;i>r;r++)if(n=o[r],n instanceof $){t=!0;break}if(!t)return this.compileOrTest(e)}return this.compileLoopTest(e)},t.prototype.compileOrTest=function(e){var t,n,r,i,o,a,s,l,u;return 0===this.array.base.objects.length?""+!!this.negated:(l=this.object.cache(e,T),a=l[0],o=l[1],u=this.negated?[" !== "," && "]:[" === "," || "],t=u[0],n=u[1],s=function(){var n,s,l,u;for(l=this.array.base.objects,u=[],r=n=0,s=l.length;s>n;r=++n)i=l[r],u.push((r?o:a)+t+i.compile(e,x));return u}.call(this),s=s.join(n),e.level<T?s:"("+s+")")},t.prototype.compileLoopTest=function(e){var t,n,r,i;return i=this.object.cache(e,_),r=i[0],n=i[1],t=st("indexOf")+(".call("+this.array.compile(e,_)+", "+n+") ")+(this.negated?"< 0":">= 0"),r===n?t:(t=r+", "+t,e.level<_?t:"("+t+")")},t.prototype.toString=function(e){return t.__super__.toString.call(this,e,this.constructor.name+(this.negated?"!":""))},t}(i),e.Try=H=function(e){function t(e,t,n,r){this.attempt=e,this.error=t,this.recovery=n,this.ensure=r}return dt(t,e),t.prototype.children=["attempt","recovery","ensure"],t.prototype.isStatement=K,t.prototype.jumps=function(e){var t;return this.attempt.jumps(e)||(null!=(t=this.recovery)?t.jumps(e):void 0)},t.prototype.makeReturn=function(e){return this.attempt&&(this.attempt=this.attempt.makeReturn(e)),this.recovery&&(this.recovery=this.recovery.makeReturn(e)),this},t.prototype.compileNode=function(e){var t,n,r,i;return e.indent+=j,r=this.error?" ("+this.error.compile(e)+") ":" ",i=this.attempt.compile(e,C),t=function(){var t;if(this.recovery){if(t=this.error.value,ht.call(F,t)>=0)throw SyntaxError('catch variable may not be "'+this.error.value+'"');return e.scope.check(this.error.value)||e.scope.add(this.error.value,"param")," catch"+r+"{\n"+this.recovery.compile(e,C)+"\n"+this.tab+"}"}return this.ensure||this.recovery?void 0:" catch (_error) {}"}.call(this),n=this.ensure?" finally {\n"+this.ensure.compile(e,C)+"\n"+this.tab+"}":"",""+this.tab+"try {\n"+i+"\n"+this.tab+"}"+(t||"")+n},t}(i),e.Throw=W=function(e){function t(e){this.expression=e}return dt(t,e),t.prototype.children=["expression"],t.prototype.isStatement=K,t.prototype.jumps=P,t.prototype.makeReturn=q,t.prototype.compileNode=function(e){return this.tab+("throw "+this.expression.compile(e)+";")},t}(i),e.Existence=d=function(e){function t(e){this.expression=e}return dt(t,e),t.prototype.children=["expression"],t.prototype.invert=k,t.prototype.compileNode=function(e){var t,n,r,i;return this.expression.front=this.front,r=this.expression.compile(e,T),f.test(r)&&!e.scope.check(r)?(i=this.negated?["===","||"]:["!==","&&"],t=i[0],n=i[1],r="typeof "+r+" "+t+' "undefined" '+n+" "+r+" "+t+" null"):r=""+r+" "+(this.negated?"==":"!=")+" null",e.level<=w?r:"("+r+")"},t}(i),e.Parens=N=function(e){function t(e){this.body=e}return dt(t,e),t.prototype.children=["body"],t.prototype.unwrap=function(){return this.body},t.prototype.isComplex=function(){return this.body.isComplex()},t.prototype.compileNode=function(e){var t,n,r;return r=this.body.unwrap(),r instanceof X&&r.isAtomic()?(r.front=this.front,r.compile(e)):(n=r.compile(e,A),t=e.level<T&&(r instanceof O||r instanceof a||r instanceof p&&r.returns),t?n:"("+n+")")},t}(i),e.For=p=function(e){function t(e,t){var n;if(this.source=t.source,this.guard=t.guard,this.step=t.step,this.name=t.name,this.index=t.index,this.body=o.wrap([e]),this.own=!!t.own,this.object=!!t.object,this.object&&(n=[this.index,this.name],this.name=n[0],this.index=n[1]),this.index instanceof X)throw SyntaxError("index cannot be a pattern matching expression");if(this.range=this.source instanceof X&&this.source.base instanceof L&&!this.source.properties.length,this.pattern=this.name instanceof X,this.range&&this.index)throw SyntaxError("indexes do not apply to range loops");if(this.range&&this.pattern)throw SyntaxError("cannot pattern match over range loops");this.returns=!1}return dt(t,e),t.prototype.children=["body","source","guard","step"],t.prototype.compileNode=function(e){var t,n,i,a,s,l,u,c,d,h,p,m,g,y,b,x,w,A,S,k,P,R,O,M,I;return t=o.wrap([this.body]),p=null!=(I=nt(t.expressions))?I.jumps():void 0,p&&p instanceof B&&(this.returns=!1),k=this.range?this.source.base:this.source,S=e.scope,g=this.name&&this.name.compile(e,_),u=this.index&&this.index.compile(e,_),g&&!this.pattern&&S.find(g),u&&S.find(u),this.returns&&(A=S.freeVariable("results")),c=this.object&&u||S.freeVariable("i"),d=this.range&&g||u||c,h=d!==c?""+d+" = ":"",this.step&&!this.range&&(R=S.freeVariable("step")),this.pattern&&(g=c),M="",s="",n="",l=this.tab+j,this.range?i=k.compile(rt(e,{index:c,name:g,step:this.step})):(O=this.source.compile(e,_),(g||this.own)&&!f.test(O)&&(n=""+this.tab+(b=S.freeVariable("ref"))+" = "+O+";\n",O=b),g&&!this.pattern&&(y=""+g+" = "+O+"["+d+"]"),this.object||(m=S.freeVariable("len"),a=""+h+c+" = 0, "+m+" = "+O+".length",this.step&&(a+=", "+R+" = "+this.step.compile(e,T)),P=""+h+(this.step?""+c+" += "+R:d!==c?"++"+c:""+c+"++"),i=""+a+"; "+c+" < "+m+"; "+P)),this.returns&&(x=""+this.tab+A+" = [];\n",w="\n"+this.tab+"return "+A+";",t.makeReturn(A)),this.guard&&(t.expressions.length>1?t.expressions.unshift(new v(new N(this.guard).invert(),new E("continue"))):this.guard&&(t=o.wrap([new v(this.guard,t)]))),this.pattern&&t.expressions.unshift(new r(this.name,new E(""+O+"["+d+"]"))),n+=this.pluckDirectCall(e,t),y&&(M="\n"+l+y+";"),this.object&&(i=""+d+" in "+O,this.own&&(s="\n"+l+"if (!"+st("hasProp")+".call("+O+", "+d+")) continue;")),t=t.compile(rt(e,{indent:l}),C),t&&(t="\n"+t+"\n"),""+n+(x||"")+this.tab+"for ("+i+") {"+s+M+t+this.tab+"}"+(w||"")},t.prototype.pluckDirectCall=function(e,t){var n,i,o,s,l,c,d,h,p,f,m,g,v,y,b;for(i="",f=t.expressions,l=h=0,p=f.length;p>h;l=++h)o=f[l],o=o.unwrapAll(),o instanceof a&&(d=o.variable.unwrapAll(),(d instanceof u||d instanceof X&&(null!=(m=d.base)?m.unwrapAll():void 0)instanceof u&&1===d.properties.length&&("call"===(g=null!=(v=d.properties[0].name)?v.value:void 0)||"apply"===g))&&(s=(null!=(y=d.base)?y.unwrapAll():void 0)||d,c=new E(e.scope.freeVariable("fn")),n=new X(c),d.base&&(b=[n,d],d.base=b[0],n=b[1]),t.expressions[l]=new a(n,o.args),i+=this.tab+new r(c,s).compile(e,C)+";\n"));return i},t}(Y),e.Switch=U=function(e){function t(e,t,n){this.subject=e,this.cases=t,this.otherwise=n}return dt(t,e),t.prototype.children=["subject","cases","otherwise"],t.prototype.isStatement=K,t.prototype.jumps=function(e){var t,n,r,i,o,a,s;for(null==e&&(e={block:!0}),o=this.cases,r=0,i=o.length;i>r;r++)if(a=o[r],n=a[0],t=a[1],t.jumps(e))return t;return null!=(s=this.otherwise)?s.jumps(e):void 0},t.prototype.makeReturn=function(e){var t,n,r,i,a;for(i=this.cases,n=0,r=i.length;r>n;n++)t=i[n],t[1].makeReturn(e);return e&&(this.otherwise||(this.otherwise=new o([new E("void 0")]))),null!=(a=this.otherwise)&&a.makeReturn(e),this},t.prototype.compileNode=function(e){var t,n,r,i,o,a,s,l,u,c,d,h,p,f,m,g,v;for(l=e.indent+j,u=e.indent=l+j,r=this.tab+("switch ("+((null!=(f=this.subject)?f.compile(e,A):void 0)||!1)+") {\n"),m=this.cases,s=c=0,h=m.length;h>c;s=++c){for(g=m[s],o=g[0],t=g[1],v=tt([o]),d=0,p=v.length;p>d;d++)i=v[d],this.subject||(i=i.invert()),r+=l+("case "+i.compile(e,A)+":\n");if((n=t.compile(e,C))&&(r+=n+"\n"),s===this.cases.length-1&&!this.otherwise)break;a=this.lastNonComment(t.expressions),a instanceof B||a instanceof E&&a.jumps()&&"debugger"!==a.value||(r+=u+"break;\n")}return this.otherwise&&this.otherwise.expressions.length&&(r+=l+("default:\n"+this.otherwise.compile(e,C)+"\n")),r+this.tab+"}"},t}(i),e.If=v=function(e){function t(e,t,n){this.body=t,null==n&&(n={}),this.condition="unless"===n.type?e.invert():e,this.elseBody=null,this.isChain=!1,this.soak=n.soak}return dt(t,e),t.prototype.children=["condition","body","elseBody"],t.prototype.bodyNode=function(){var e;return null!=(e=this.body)?e.unwrap():void 0},t.prototype.elseBodyNode=function(){var e;return null!=(e=this.elseBody)?e.unwrap():void 0},t.prototype.addElse=function(e){return this.isChain?this.elseBodyNode().addElse(e):(this.isChain=e instanceof t,this.elseBody=this.ensureBlock(e)),this},t.prototype.isStatement=function(e){var t;return(null!=e?e.level:void 0)===C||this.bodyNode().isStatement(e)||(null!=(t=this.elseBodyNode())?t.isStatement(e):void 0)},t.prototype.jumps=function(e){var t;return this.body.jumps(e)||(null!=(t=this.elseBody)?t.jumps(e):void 0)},t.prototype.compileNode=function(e){return this.isStatement(e)?this.compileStatement(e):this.compileExpression(e)},t.prototype.makeReturn=function(e){return e&&(this.elseBody||(this.elseBody=new o([new E("void 0")]))),this.body&&(this.body=new o([this.body.makeReturn(e)])),this.elseBody&&(this.elseBody=new o([this.elseBody.makeReturn(e)])),this},t.prototype.ensureBlock=function(e){return e instanceof o?e:new o([e])},t.prototype.compileStatement=function(e){var n,r,i,o,a;return r=Z(e,"chainChild"),(o=Z(e,"isExistentialEquals"))?new t(this.condition.invert(),this.elseBodyNode(),{type:"if"}).compile(e):(i=this.condition.compile(e,A),e.indent+=j,n=this.ensureBlock(this.body),a="if ("+i+") {\n"+n.compile(e)+"\n"+this.tab+"}",r||(a=this.tab+a),this.elseBody?a+" else "+(this.isChain?(e.indent=this.tab,e.chainChild=!0,this.elseBody.unwrap().compile(e,C)):"{\n"+this.elseBody.compile(e,C)+"\n"+this.tab+"}"):a)},t.prototype.compileExpression=function(e){var t,n,r,i;return i=this.condition.compile(e,w),n=this.bodyNode().compile(e,_),t=this.elseBodyNode()?this.elseBodyNode().compile(e,_):"void 0",r=""+i+" ? "+n+" : "+t,e.level>=w?"("+r+")":r},t.prototype.unfoldSoak=function(){return this.soak&&this},t}(i),l={wrap:function(e,n,r){var i,s,l,c,d;return e.jumps()?e:(l=new u([],o.wrap([e])),i=[],((c=e.contains(this.literalArgs))||e.contains(this.literalThis))&&(d=new E(c?"apply":"call"),i=[new E("this")],c&&i.push(new E("arguments")),l=new X(l,[new t(d)])),l.noReturn=r,s=new a(l,i),n?o.wrap([s]):s)},literalArgs:function(e){return e instanceof E&&"arguments"===e.value&&!e.asKey},literalThis:function(e){return e instanceof E&&"this"===e.value&&!e.asKey||e instanceof u&&e.bound||e instanceof a&&e.isSuper}},at=function(e,t,n){var r;return(r=t[n].unfoldSoak(e))?(t[n]=r.body,r.body=new X(t),r):void 0},z={"extends":function(){return"function(child, parent) { for (var key in parent) { if ("+st("hasProp")+".call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; }"},bind:function(){return"function(fn, me){ return function(){ return fn.apply(me, arguments); }; }"},indexOf:function(){return"[].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; }"},hasProp:function(){return"{}.hasOwnProperty"},slice:function(){return"[].slice"}},C=1,A=2,_=3,w=4,T=5,x=6,j="  ",m="[$A-Za-z_\\x7f-\\uffff][$\\w\\x7f-\\uffff]*",f=RegExp("^"+m+"$"),D=/^[+-]?\d+$/,S=RegExp("^(?:("+m+")\\.prototype(?:\\.("+m+")|\\[(\"(?:[^\\\\\"\\r\\n]|\\\\.)*\"|'(?:[^\\\\'\\r\\n]|\\\\.)*')\\]|\\[(0x[\\da-fA-F]+|\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\]))|("+m+")$"),g=/^['"]/,st=function(e){var t;return t="__"+e,V.root.assign(t,z[e]()),t},it=function(e,t){return e=e.replace(/\n/g,"$&"+t),e.replace(/\s+$/,"")}}).call(this)},require["./coffee-script"]=new function(){var e=this;(function(){var t,n,r,i,o,a,s,l,u,c={}.hasOwnProperty;i=require("fs"),s=require("path"),u=require("./lexer"),t=u.Lexer,n=u.RESERVED,a=require("./parser").parser,l=require("vm"),require.extensions?require.extensions[".coffee"]=function(e,t){var n;return n=r(i.readFileSync(t,"utf8"),{filename:t}),e._compile(n,t)}:require.registerExtension&&require.registerExtension(".coffee",function(e){return r(e)}),e.VERSION="1.3.3",e.RESERVED=n,e.helpers=require("./helpers"),e.compile=r=function(t,n){var r,i,s;null==n&&(n={}),s=e.helpers.merge;try{if(i=a.parse(o.tokenize(t)).compile(n),!n.header)return i}catch(l){throw n.filename&&(l.message="In "+n.filename+", "+l.message),l}return r="Generated by CoffeeScript "+this.VERSION,"// "+r+"\n"+i},e.tokens=function(e,t){return o.tokenize(e,t)},e.nodes=function(e,t){return"string"==typeof e?a.parse(o.tokenize(e,t)):a.parse(e)},e.run=function(e,t){var n;return null==t&&(t={}),n=require.main,n.filename=process.argv[1]=t.filename?i.realpathSync(t.filename):".",n.moduleCache&&(n.moduleCache={}),n.paths=require("module")._nodeModulePaths(s.dirname(i.realpathSync(t.filename))),".coffee"!==s.extname(n.filename)||require.extensions?n._compile(r(e,t),n.filename):n._compile(e,n.filename)},e.eval=function(e,t){var n,i,o,a,u,d,h,p,f,m,g,v,y,b;if(null==t&&(t={}),e=e.trim()){if(i=l.Script){if(null!=t.sandbox){if(t.sandbox instanceof i.createContext().constructor)h=t.sandbox;else{h=i.createContext(),v=t.sandbox;for(a in v)c.call(v,a)&&(p=v[a],h[a]=p)}h.global=h.root=h.GLOBAL=h}else h=global;if(h.__filename=t.filename||"eval",h.__dirname=s.dirname(h.__filename),h===global&&!h.module&&!h.require){for(n=require("module"),h.module=g=new n(t.modulename||"eval"),h.require=b=function(e){return n._load(e,g,!0)},g.filename=h.__filename,y=Object.getOwnPropertyNames(require),f=0,m=y.length;m>f;f++)d=y[f],"paths"!==d&&(b[d]=require[d]);b.paths=g.paths=n._nodeModulePaths(process.cwd()),b.resolve=function(e){return n._resolveFilename(e,g)}}}u={};for(a in t)c.call(t,a)&&(p=t[a],u[a]=p);return u.bare=!0,o=r(e,u),h===global?l.runInThisContext(o):l.runInContext(o,h)}},o=new t,a.lexer={lex:function(){var e,t;return t=this.tokens[this.pos++]||[""],e=t[0],this.yytext=t[1],this.yylineno=t[2],e},setInput:function(e){return this.tokens=e,this.pos=0},upcomingInput:function(){return""}},a.yy=require("./nodes")}).call(this)},require["./browser"]=new function(){var exports=this;(function(){var CoffeeScript,runScripts;CoffeeScript=require("./coffee-script"),CoffeeScript.require=require,CoffeeScript.eval=function(code,options){var _ref;return null==options&&(options={}),null==(_ref=options.bare)&&(options.bare=!0),eval(CoffeeScript.compile(code,options))},CoffeeScript.run=function(e,t){return null==t&&(t={}),t.bare=!0,Function(CoffeeScript.compile(e,t))()},"undefined"!=typeof window&&null!==window&&(CoffeeScript.load=function(e,t){var n;return n=new(window.ActiveXObject||XMLHttpRequest)("Microsoft.XMLHTTP"),n.open("GET",e,!0),"overrideMimeType"in n&&n.overrideMimeType("text/plain"),n.onreadystatechange=function(){var r;if(4===n.readyState){if(0!==(r=n.status)&&200!==r)throw new Error("Could not load "+e);if(CoffeeScript.run(n.responseText),t)return t()}},n.send(null)},runScripts=function(){var e,t,n,r,i,o;return o=document.getElementsByTagName("script"),e=function(){var e,t,n;for(n=[],e=0,t=o.length;t>e;e++)i=o[e],"text/coffeescript"===i.type&&n.push(i);return n}(),n=0,r=e.length,(t=function(){var r;return r=e[n++],"text/coffeescript"===(null!=r?r.type:void 0)?r.src?CoffeeScript.load(r.src,t):(CoffeeScript.run(r.innerHTML),t()):void 0})(),null},window.addEventListener?addEventListener("DOMContentLoaded",runScripts,!1):attachEvent("onload",runScripts))}).call(this)},require["./coffee-script"]}();"function"==typeof define&&define.amd?define("coffee-script",[],function(){return CoffeeScript}):root.CoffeeScript=CoffeeScript}(this),define("cs",["coffee-script"],function(e){"use strict";var t,n,r=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],i=function(){throw new Error("Environment unsupported.")},o={};return"undefined"!=typeof process&&process.versions&&process.versions.node?(t=require.nodeRequire("fs"),i=function(e,n){n(t.readFileSync(e,"utf8"))}):"undefined"!=typeof window&&window.navigator&&window.document||"undefined"!=typeof importScripts?(n=function(){var e,t,n;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;for(t=0;3>t;t++){n=r[t];try{e=new ActiveXObject(n)}catch(i){}if(e){r=[n];break}}if(!e)throw new Error("getXhr(): XMLHttpRequest not available");return e},i=function(e,t){var r=n();r.open("GET",e,!0),r.onreadystatechange=function(){4===r.readyState&&t(r.responseText)},r.send(null)}):"undefined"!=typeof Packages&&(i=function(e,t){var n,r,i="utf-8",o=new java.io.File(e),a=java.lang.System.getProperty("line.separator"),s=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(o),i)),l="";try{for(n=new java.lang.StringBuffer,r=s.readLine(),r&&r.length()&&65279===r.charAt(0)&&(r=r.substring(1)),n.append(r);null!==(r=s.readLine());)n.append(a),n.append(r);l=String(n.toString())}finally{s.close()}t(l)}),{get:function(){return e},write:function(e,t,n){if(o.hasOwnProperty(t)){var r=o[t];n.asModule(e+"!"+t,r)}},version:"0.4.2",load:function(t,n,r,a){var s=n.toUrl(t+".coffee");i(s,function(i){try{i=e.compile(i,a.CoffeeScript)}catch(l){throw l.message="In "+s+", "+l.message,l}a.isBuild&&(o[t]=i),a.isBuild||(i+="\r\n//@ sourceURL="+s),r.fromText(t,i),n([t],function(e){r(e)})})}}}),function(){define("cs!common/filters/running-average-filter",["require"],function(){var e;return e=function(){function e(e){this.periodLength=e,this._value=[],this._time=[],this._idx=-1,this._maxBufferLength=this.periodLength}return e.prototype.addSample=function(e,t){var n;if(this._time[this._idx]===e)return this._value[this._idx]=t,void 0;if(this._time[this._idx]>e)throw new Error("RunningAverageFilter: cannot add sample with @_time less than previous sample.");for(this._idx++,this._value.push(t),this._time.push(e),n=[];this._value.length>this._maxBufferLength;)this._time.shift(),this._value.shift(),n.push(this._idx--);return n},e.prototype.calculate=function(){var e,t,n,r,i,o;for(t=Math.max(this._time[this._idx]-this.periodLength,0),o=0,i=0,e=this._idx;e>0&&this._time[e-1]>=t;)r=this._time[e]-this._time[e-1],i+=r,o+=r*(this._value[e-1]+this._value[e])/2,e--;return e>0&&this._time[e]>t&&this._time[e-1]<t&&(r=this._time[e]-t,i+=r,n=this._value[e-1]+(this._value[e]-this._value[e-1])*(t-this._time[e-1])/(this._time[e]-this._time[e-1]),o+=r*(this._value[e]+n)/2),i?o/i:this._value[0]||0},e.prototype.getCurrentBufferLength=function(){return this._value.length},e.prototype.setMaxBufferLength=function(e){return this._maxBufferLength=e},e.prototype.getCurrentTime=function(){return this._time[this._idx]},e.prototype.getCurrentStep=function(){return this._idx},e.prototype.setCurrentStep=function(e){if(-1>e||e>=this._value.length)throw new Error("RunningAverageFilter: cannot seek, location outside available range.");return this._idx=e},e.prototype.invalidate=function(e){return this._value.length=e+1,this._time.length=e+1,this._idx=e},e.prototype.reset=function(){return this._values.length=0,this._time=0,this._idx=0},e}()})}.call(this),function(){define("cs!common/filters/simple-period-filter",["require"],function(){var e;return e=function(){function e(){this._values=[],this._time=[],this._idx=-1,this._zero_crossing_buffer=[],this._period_buffer=[],this._maxBufferLength=8192}return e.prototype.addSample=function(e,t){var n,r;if(this._time[this._idx]===e)return this._values[this._idx]=t,void 0;if(this._time[this._idx]>e)return console.log("Error: RunningAverageFilter: cannot add sample with @_time less than previous sample."),void 0;for(this._idx++,this._values.push(t),this._time.push(e),this._values.length>1&&(n=this._values[this._values.length-2]);this._values.length>this._maxBufferLength;)this._time.shift(),this._values.shift(),this._idx--;if(0>n&&t>0||n>0&&0>t)for(this._zero_crossing_buffer.push(e),this._zero_crossing_buffer.length>1&&(r=this._zero_crossing_buffer[this._zero_crossing_buffer.length-2],this._period_buffer.push(e-r));this._zero_crossing_buffer.length>128;)this._zero_crossing_buffer.shift(),this._period_buffer.shift()},e.prototype.calculate=function(){var e,t;return this._period_buffer.length<1?0:1===this._period_buffer.length?2*this._period_buffer[0]:(t=this._period_buffer.reduce(function(e,t){return e+t}),e=t/this._period_buffer.length,2*e)},e.prototype.getCurrentBufferLength=function(){return this._values.length},e.prototype.setMaxBufferLength=function(e){return this._maxBufferLength=e},e.prototype.getCurrentTime=function(){return this._time[this._idx]},e.prototype.getCurrentStep=function(){return this._idx},e.prototype.setCurrentStep=function(e){if(-1>e||e>=this._values.length)throw new Error("SimplePeriodFilter: cannot seek, location outside available range.");return this._idx=e},e.prototype.invalidate=function(e){return e?(this._values.length=e+1,this._time.length=e+1,this._idx=e):this.reset()},e.prototype.reset=function(){this._values.length=0,this._time.length=0,this._idx=0,this._zero_crossing_buffer.length=0,this._period_buffer.length=0},e}()})}.call(this),define("common/output-support",["require","common/property-description","cs!common/filters/running-average-filter","cs!common/filters/simple-period-filter"],function(e){var t=e("common/property-description"),n=e("cs!common/filters/running-average-filter"),r=e("cs!common/filters/simple-period-filter");return function(e){function i(){u.forEach(function(e){e.addSample()})}function o(){u.forEach(function(e){e.reset()})}var a=e.propertySupport,s=e.unitsDefinition||{},l=e.tickHistory||null,u=[];return a.on("afterInvalidatingChange.output-support",i),{mixInto:function(e){e.defineOutput=function(e,n,r){a.defineProperty(e,{type:"output",writable:!1,get:r,includeInHistoryState:!1,description:new t(s,n)})},e.defineFilteredOutput=function(t,i,o,a,s){var c,d;if("RunningAverage"===a)c=new n(s);else{if("SimplePeriod"!==a)throw new Error("FilteredOutput: unknown filter type "+a+".");c=new r}if(d=e.properties[o],void 0===d||isNaN(Number(d)))throw new Error("FilteredOutput: property is not a valid numeric value or it is undefined.");c.addSample(e.properties.time,d),l?l.registerExternalObject({push:function(){c.addSample(e.properties.time,e.properties[o])},extract:function(e){c.setCurrentStep(e)},invalidate:function(e){c.invalidate(e)},setHistoryLength:function(e){c.setMaxBufferLength(e)},reset:function(){c.reset()}}):u.push({addSample:function(){c.addSample(e.properties.time,e.properties[o])}}),i.property=o,i.type=a,i.period=s,e.defineOutput(t,i,function(){return c.calculate()})},e.updateAllOutputProperties=function(){a.deleteComputedPropertyCachedValues(),a.notifyAllComputedProperties(),i()},e.resetAllOutputProperties=function(){o()}}}}}),define("common/playback-support",["require","common/console","common/performance"],function(e){var t=e("common/console"),n=e("common/performance");return function(e){function r(e){var t,n=o&&o.modelSampleRate||"default";"default"===n?d3.timer(e):t=window.setInterval(function(){e()&&window.clearInterval(t)},1e3/n)}var i=e&&e.dispatch||null,o=e&&e.properties||null,a=function(){if(i){if(i.on&&i.addEventTypes)return i.addEventTypes("play","stop","tickStart","tickEnd"),!0;throw new Error("[PlaybackSupport] Provided Dispatch object doesn't implement required interface!")}return!1}(),s=!0,l=!1,u=!1,c=!1;return{mixInto:function(e){"function"!=typeof e.tick&&(e.tick=function(){t.warn("[PlaybackSupport] .tick() method should be overwritten by target!")}),e.start=function(){return l=!1,u=!1,s?(s=!1,r(function(t){return a&&i.tickStart(),n.leaveScope("gap"),l?(s=!0,!0):u?(setTimeout(e.start,0),s=!0,!0):(n.enterScope("tick"),e.tick(t),n.leaveScope("tick"),n.enterScope("gap"),!1)
}),a&&i.play(),n.enterScope("gap"),e):e},e.restart=function(){return u=!0,e},e.stop=function(){return l=!0,a&&i.stop(),e},e.isStopped=function(){return s||l},e.on("play.playback-support",function(){c=!0}),e.on("reset.playback-support",function(){c=!1}),Object.defineProperty(e,"hasPlayed",{enumerable:!0,get:function(){return c}})}}}}),define("common/define-builtin-properties",["require","common/validator","common/property-description"],function(e){var t=e("common/validator"),n=e("common/property-description");return function(e){function r(e,r,l){var u,c,d,h;if("mainProperty"===r)u=o.mainProperties;else{if("viewOption"!==r)throw new Error(r+" is not a supported built-in property type");u=o.viewOptions}d=t.propertyChangeInvalidates(u[e]),c={type:r,writable:t.propertyIsWritable(u[e]),set:l,includeInHistoryState:!!u[e].storeInTickHistory,validate:function(n){return t.validateSingleProperty(u[e],e,n,!1)},beforeSetCallback:d?i.invalidatingChangePreHook:void 0,afterSetCallback:d?i.invalidatingChangePostHook:void 0},h=u[e].unitType,h&&(c.description=new n(a,{unitType:h}),s&&(c.beforeSetTransform=function(e){return s.translateToModelUnits(e,h)},c.afterGetTransform=function(e){return s.translateFromModelUnits(e,h)})),i.defineProperty(e,c)}var i=e.propertySupport,o=e.metadata,a=e.unitsDefinition||{},s=e.unitsTranslation||null,l=e.setters||{},u=e.initialProperties||null;!function(){var e,n;Object.keys(o.mainProperties).forEach(function(e){r(e,"mainProperty",l[e])}),Object.keys(o.viewOptions).forEach(function(e){r(e,"viewOption",l[e])}),u&&(e=t.validateCompleteness(o.mainProperties,u),i.setRawValues(e),n=t.validateCompleteness(o.viewOptions,u.viewOptions||{}),i.setRawValues(n))}()}}),define("common/lab-modeler-mixin",["require","common/property-support","common/parameter-support","common/output-support","common/dispatch-support","common/playback-support","common/define-builtin-properties"],function(e){var t=e("common/property-support"),n=e("common/parameter-support"),r=e("common/output-support"),i=e("common/dispatch-support"),o=e("common/playback-support"),a=e("common/define-builtin-properties");return function(e){var s,l=e.metadata,u=e.setters,c=e.unitsDefinition,d=e.unitsTranslation,h=e.initialProperties,p=e.tickHistory,f=new t({types:["output","parameter","mainProperty","viewOption"]}),m=new n({propertySupport:f,unitsDefinition:c}),g=new r({propertySupport:f,unitsDefinition:c,tickHistory:p}),v=new i,y=new o({dispatch:v,properties:f.properties}),b=!1;return v.addEventTypes("reset","stepForward","stepBack","seek","invalidation","willReset","ready"),s={mixInto:function(e){f.mixInto(e),m.mixInto(e),g.mixInto(e),v.mixInto(e),y.mixInto(e),e.willReset=function(){v.willReset()},e.ready=function(){if(b)throw new Error("ready() called on an already-ready model.");s.tickHistory&&(s.tickHistory.saveInitialState(),s.tickHistory.push()),f.invalidatingChangePreHook(),b=!0,f.invalidatingChangePostHook(),v.ready()},Object.defineProperty(e,"isReady",{enumerable:!0,get:function(){return b}}),l&&a({propertySupport:f,metadata:l,unitsDefinition:c,unitsTranslation:d,setters:u,initialProperties:h})},get propertySupport(){return f},get parameterSupport(){return m},get outputSupport(){return g},get dispatchSupport(){return v},get playbackSupport(){return y}}}}),define("common/models/tick-history",[],function(){return function(e,t,n){function r(){return{input:{},state:[],parameters:{}}}function i(){var e;for(d=[],h={length:0,maxSize:n,index:-1,counter:-1,startCounter:0},e=0;e<m.length;e++)m[e].reset&&m[e].reset()}function o(t){var n,r,i,o,a;if(g)t.input=e.getProperties();else{for(n=0;n<e.input.length;n++)r=e.input[n],t.input[r]=e.getRawPropertyValue(r);o=e.parameters;for(a in o)o.hasOwnProperty(a)&&o[a].isDefined&&(t.parameters[a]=e.getRawPropertyValue(a))}for(i=e.state,n=0;n<i.length;n++)t.state[n]=i[n].clone()}function a(){var e,t=r();for(o(t),d[h.index+1]=t,d.length>h.maxSize?(d.splice(0,1),h.startCounter++):h.index++,h.counter=h.index+h.startCounter,e=0;e<m.length;e++)m[e].push();s(),h.length=d.length}function s(){var e;for(d.length=h.index+1,h.length=d.length,e=0;e<m.length;e++)m[e].invalidate(h.index)}function l(t){var n,r;for(e.restoreProperties(t.input),g||e.restoreParameters(t.parameters),r=t.state,n=0;n<r.length;n++)e.state[n].restore(r[n]);for(n=0;n<m.length;n++)m[n].extract(h.index)}function u(e){if(0>e)throw new Error("TickHistory: extract index ["+e+"] less than 0");if(e>=d.length)throw new Error("TickHistory: extract index ["+e+"] greater than list.length: "+d.length);return e}var c,d,h,p={},f=1e3,m=[],g=!!e.getProperties;return p.isEmpty=function(){return 0===h.index},p.push=function(){a()},p.returnTick=function(e){var t;return t="number"==typeof e?e:h.index,u(t),d[t]},p.extract=function(e){var t;t="number"==typeof e?e:h.index,u(t),l(d[t])},p.saveInitialState=function(){c=r(),o(c)},p.restoreInitialState=function(){i(),l(c),a()},p.reset=i,p.decrementExtract=function(){h.counter>h.startCounter&&(h.index--,h.counter--,l(d[h.index]))},p.incrementExtract=function(){h.index++,h.counter++,l(d[h.index])},p.seekExtract=function(e){e<h.startCounter&&(e=h.startCounter),e>=h.startCounter+h.length&&(e=h.startCounter+h.length-1),h.counter=e,h.index=e-h.startCounter,l(d[h.index])},p.invalidateFollowingState=s,p.get=function(e){return h[e]},p.set=function(e,t){return h[e]=t},p.registerExternalObject=function(e){e.setHistoryLength(h.maxSize),m.push(e)},null==n&&(n=f),i(),p}}),define("common/array-types",["require","arrays"],function(e){var t=e("arrays"),n=function(){if("undefined"==typeof navigator)return!0;var e=/ AppleWebKit\/([0123456789.+]+) \(KHTML, like Gecko\) Version\/([0123456789.]+) (Safari)\/([0123456789.]+)/,t=navigator.userAgent.match(e);return!t||!t[3]}(),r=t.typed&&n;return{floatType:r?"Float64Array":"regular",int32Type:r?"Int32Array":"regular",int16Type:r?"Int16Array":"regular",int8Type:r?"Int8Array":"regular",uint16Type:r?"Uint16Array":"regular",uint8Type:r?"Uint8Array":"regular"}}),define("models/md2d/models/engine/constants/units",["require","exports","module"],function(e,t){var n,r,i,o=1.66054e-27,a=1.602177e-19,s=a,l=1e-15,u=1e-9,c=10,d=1e3,h={TIME:"time",LENGTH:"length",MASS:"mass",ENERGY:"energy",ENTROPY:"entropy",CHARGE:"charge",INVERSE_QUANTITY:"inverse quantity",FARADS_PER_METER:"farads per meter",METERS_PER_FARAD:"meters per farad",FORCE:"force",VELOCITY:"velocity",AREA:"area",PRESSURE:"pressure"};t.unit=n={FEMTOSECOND:{name:"femtosecond",value:1,type:h.TIME},SECOND:{name:"second",value:l,type:h.TIME},NANOMETER:{name:"nanometer",value:1,type:h.LENGTH},ANGSTROM:{name:"Angstrom",value:1*c,type:h.LENGTH},METER:{name:"meter",value:1*u,type:h.LENGTH},DALTON:{name:"Dalton",value:1,type:h.MASS},GRAM:{name:"gram",value:1*o*d,type:h.MASS},KILOGRAM:{name:"kilogram",value:1*o,type:h.MASS},MW_ENERGY_UNIT:{name:"MW Energy Unit (Dalton * nm^2 / fs^2)",value:1,type:h.ENERGY},JOULE:{name:"Joule",value:o*u*u*(1/l)*(1/l),type:h.ENERGY},EV:{name:"electron volt",value:o*u*u*(1/l)*(1/l)*(1/s),type:h.ENERGY},EV_PER_KELVIN:{name:"electron volts per Kelvin",value:1,type:h.ENTROPY},JOULES_PER_KELVIN:{name:"Joules per Kelvin",value:1*s,type:h.ENTROPY},ELEMENTARY_CHARGE:{name:"elementary charge",value:1,type:h.CHARGE},COULOMB:{name:"Coulomb",value:a,type:h.CHARGE},INVERSE_MOLE:{name:"inverse moles",value:1,type:h.INVERSE_QUANTITY},FARADS_PER_METER:{name:"Farads per meter",value:1,type:h.FARADS_PER_METER},METERS_PER_FARAD:{name:"meters per Farad",value:1,type:h.METERS_PER_FARAD},MW_FORCE_UNIT:{name:"MW force units (Dalton * nm / fs^2)",value:1,type:h.FORCE},NEWTON:{name:"Newton",value:1*o*u*(1/l)*(1/l),type:h.FORCE},EV_PER_NM:{name:"electron volts per nanometer",value:1*o*u*u*(1/l)*(1/l)*(1/s),type:h.FORCE},MW_VELOCITY_UNIT:{name:"MW velocity units (nm / fs)",value:1,type:h.VELOCITY},METERS_PER_SECOND:{name:"meters per second",value:1*u*(1/l),type:h.VELOCITY}},t.ratio=r=function(e,t){var n=function(e,t){if(e.type!==t.type)throw new Error("Attempt to convert incompatible type '"+e.name+"'' to '"+t.name+"'")};if(t.per)return n(e,t.per),e.value/t.per.value;if(t.as)return n(e,t.as),t.as.value/e.value;throw new Error("units.ratio() received arguments it couldn't understand.")},t.convert=i=function(e,t){var n=t&&t.from,i=t&&t.to;if(!n)throw new Error('units.convert() did not receive a "from" argument');if(!i)throw new Error('units.convert() did not receive a "to" argument');return e*r(i,{per:n})}}),define("models/md2d/models/engine/constants/index",["require","exports","module","./units"],function(e,t){var n,r,i=e("./units"),o=i.unit,a=i.ratio,s=i.convert,l={ELEMENTARY_CHARGE:{value:1,unit:o.ELEMENTARY_CHARGE},ATOMIC_MASS:{value:1,unit:o.DALTON},BOLTZMANN_CONSTANT:{value:1.380658e-23,unit:o.JOULES_PER_KELVIN},AVAGADRO_CONSTANT:{value:a(o.DALTON,{per:o.GRAM}),unit:o.INVERSE_MOLE},PERMITTIVITY_OF_FREE_SPACE:{value:8.854187e-12,unit:o.FARADS_PER_METER}};l.COULOMB_CONSTANT={value:1/(4*Math.PI*l.PERMITTIVITY_OF_FREE_SPACE.value),unit:o.METERS_PER_FARAD},t.unit=o,t.ratio=a,t.convert=s;for(n in l)l.hasOwnProperty(n)&&(r=l[n],t[n]=function(e){return{as:function(t){return i.convert(e.value,{from:e.unit,to:t})}}}(r))}),define("models/md2d/models/aminoacids-props",[],function(){return[{fullName:"Alanine",abbreviation:"Ala",symbol:"A",molWeight:89.09,charge:0,hydrophobicityRB:2.15,pK:0,surface:115,volume:88.6,solubility:16.65,hydrophobicity:1,property:"Total aliphatic; hydrophobic"},{fullName:"Arginine",abbreviation:"Arg",symbol:"R",molWeight:174.2,charge:1,hydrophobicityRB:2.23,pK:12,surface:225,volume:173.4,solubility:15,hydrophobicity:-2,property:"Acidic side chains; strongly polar; cationic"},{fullName:"Asparagine",abbreviation:"Asn",symbol:"N",molWeight:132.12,charge:0,hydrophobicityRB:1.05,pK:0,surface:160,volume:114.1,solubility:3.53,hydrophobicity:-1,property:"Strongly polar"},{fullName:"Asparticacid",abbreviation:"Asp",symbol:"D",molWeight:133.1,charge:-1,hydrophobicityRB:1.13,pK:4.4,surface:150,volume:111.1,solubility:.778,hydrophobicity:-2,property:"Acidic side chains; strongly polar; anionic"},{fullName:"Cysteine",abbreviation:"Cys",symbol:"C",molWeight:121.15,charge:0,hydrophobicityRB:1.2,pK:8.5,surface:135,volume:108.5,solubility:1e3,hydrophobicity:1,property:"Polar side chains; semipolar"},{fullName:"Glutamine",abbreviation:"Gln",symbol:"Q",molWeight:146.15,charge:0,hydrophobicityRB:1.65,pK:0,surface:180,volume:143.8,solubility:2.5,hydrophobicity:-1,property:"Strongly polar"},{fullName:"Glutamicacid",abbreviation:"Glu",symbol:"E",molWeight:147.13,charge:-1,hydrophobicityRB:1.73,pK:4.4,surface:190,volume:138.4,solubility:.864,hydrophobicity:-2,property:"Acidic side chains; strongly polar; anionic"},{fullName:"Glycine",abbreviation:"Gly",symbol:"G",molWeight:75.07,charge:0,hydrophobicityRB:1.18,pK:0,surface:75,volume:60.1,solubility:24.99,hydrophobicity:1,property:"Semipolar"},{fullName:"Histidine",abbreviation:"His",symbol:"H",molWeight:155.16,charge:1,hydrophobicityRB:2.45,pK:6.5,surface:195,volume:153.2,solubility:4.19,hydrophobicity:-2,property:"Basic side chains; strongly polar; cationic"},{fullName:"Isoleucine",abbreviation:"Ile",symbol:"I",molWeight:131.17,charge:0,hydrophobicityRB:3.88,pK:0,surface:175,volume:166.7,solubility:4.117,hydrophobicity:1,property:"Branched chain aliphatic; hydrophobic"},{fullName:"Leucine",abbreviation:"Leu",symbol:"L",molWeight:131.17,charge:0,hydrophobicityRB:4.1,pK:10,surface:170,volume:166.7,solubility:2.426,hydrophobicity:1,property:"Branched chain aliphatic; hydrophobic"},{fullName:"Lysine",abbreviation:"Lys",symbol:"K",molWeight:146.19,charge:1,hydrophobicityRB:3.05,pK:0,surface:200,volume:168.6,solubility:1e3,hydrophobicity:-2,property:"Acidic side chains; strongly polar; cationic"},{fullName:"Methionine",abbreviation:"Met",symbol:"M",molWeight:149.21,charge:0,hydrophobicityRB:3.43,pK:0,surface:185,volume:162.9,solubility:3.81,hydrophobicity:1,property:"Totally alyphatic"},{fullName:"Phenylalanine",abbreviation:"Phe",symbol:"F",molWeight:165.19,charge:0,hydrophobicityRB:3.46,pK:0,surface:210,volume:189.9,solubility:2.965,hydrophobicity:2,property:"Totally aromatic"},{fullName:"Proline",abbreviation:"Pro",symbol:"P",molWeight:115.13,charge:0,hydrophobicityRB:3.1,pK:0,surface:145,volume:112.7,solubility:162.3,hydrophobicity:1,property:"Totally alyphatic"},{fullName:"Serine",abbreviation:"Ser",symbol:"S",molWeight:105.09,charge:0,hydrophobicityRB:1.4,pK:0,surface:115,volume:89,solubility:5.023,hydrophobicity:-1,property:"Semipolar"},{fullName:"Threonine",abbreviation:"Thr",symbol:"T",molWeight:119.12,charge:0,hydrophobicityRB:2.25,pK:0,surface:140,volume:116.1,solubility:1e3,hydrophobicity:-1,property:"Semipolar"},{fullName:"Tryptophan",abbreviation:"Trp",symbol:"W",molWeight:204.23,charge:0,hydrophobicityRB:4.11,pK:0,surface:255,volume:227.8,solubility:1.136,hydrophobicity:2,property:"Totally aromatic"},{fullName:"Tyrosine",abbreviation:"Tyr",symbol:"Y",molWeight:181.19,charge:0,hydrophobicityRB:2.81,pK:10,surface:230,volume:193.6,solubility:.045,hydrophobicity:1,property:"Hydrophobic; total aromatic"},{fullName:"Valine",abbreviation:"Val",symbol:"V",molWeight:117.15,charge:0,hydrophobicityRB:3.38,pK:0,surface:155,volume:140,solubility:8.85,hydrophobicity:1,property:"Branched chain aliphatic; hydrophobic"}]}),function(){define("cs!models/md2d/models/aminoacids-helper",["require","models/md2d/models/aminoacids-props"],function(e){var t,n,r;return r=e("models/md2d/models/aminoacids-props"),t=5,n={UUU:"Phe",UUC:"Phe",UUA:"Leu",UUG:"Leu",CUU:"Leu",CUC:"Leu",CUA:"Leu",CUG:"Leu",AUU:"Ile",AUC:"Ile",AUA:"Ile",AUG:"Met",GUU:"Val",GUC:"Val",GUA:"Val",GUG:"Val",UCU:"Ser",UCC:"Ser",UCA:"Ser",UCG:"Ser",AGU:"Ser",AGC:"Ser",CCU:"Pro",CCC:"Pro",CCA:"Pro",CCG:"Pro",ACU:"Thr",ACC:"Thr",ACA:"Thr",ACG:"Thr",GCU:"Ala",GCC:"Ala",GCA:"Ala",GCG:"Ala",UAU:"Tyr",UAC:"Tyr",CAU:"His",CAC:"His",CAA:"Gln",CAG:"Gln",AAU:"Asn",AAC:"Asn",AAA:"Lys",AAG:"Lys",GAU:"Asp",GAC:"Asp",GAA:"Glu",GAG:"Glu",UGU:"Cys",UGC:"Cys",UGG:"Trp",CGU:"Arg",CGC:"Arg",CGA:"Arg",CGG:"Arg",AGA:"Arg",AGG:"Arg",GGU:"Gly",GGC:"Gly",GGA:"Gly",GGG:"Gly",UAA:"STOP",UAG:"STOP",UGA:"STOP"},{firstElementID:t,lastElementID:t+r.length-1,cysteineElement:9,abbrToElement:function(e){var t,n,i,o;for(n=i=0,o=r.length;o>i;n=++i)if(t=r[n],t.abbreviation===e)return n+this.firstElementID},getAminoAcidByElement:function(e){return r[e-this.firstElementID]},isAminoAcid:function(e){return e>=this.firstElementID&&e<=this.lastElementID},getPolarAminoAcids:function(){var e,t,n,r,i;for(r=["Asn","Gln","Ser","Thr"],i=[],t=0,n=r.length;n>t;t++)e=r[t],i.push(this.abbrToElement(e));return i},codonToAbbr:function(e){return 3!==e.length?"STOP":n[e]}}})}.call(this),define("models/md2d/models/engine/math/distributions",["require","exports","module"],function(e,t){t.normal=function(){var e=null;return function(t,n){null==t&&(t=0),null==n&&(n=1);var r,i,o,a,s;return e?(i=e,e=null,i):(a=Math.random(),s=Math.random(),o=2*Math.PI*a,r=Math.sqrt(-2*Math.log(s)),e=t+n*r*Math.sin(o),t+n*r*Math.cos(o))}}()}),define("models/md2d/models/engine/math/utils",["require","exports","module"],function(e,t){t.getWindowedAverager=function(e){null==e&&(e=1e3);var t=0,n=[],r=0;return function(i){return r-=n[t]||0,r+=i,n[t]=i,++t===e&&(t=0),n.length===e?r/e:0/0}}}),define("models/md2d/models/engine/math/minimizer",["require","exports","module","common/console"],function(e,t){var n=e("common/console");t.minimize=function(e,t,r){r=r||{},null==r.precision&&(r.precision=.01);var i,o,a,s,l,u,c,d,h,p,f=r.precision,m=r.bounds,g=r.maxiter||1e3,v=r.stopval||-1/0,y=r.maxstep||.01,b=r.eps||.01,x=t.length;for(u=y*y,i=[],h=0;x>h;h++)i[h]=t[h];o=e.apply(null,i),a=o[0],l=o[1],d=0;do{if(v>=a)break;if(d>g)return n.log("maxiter reached"),{error:"maxiter reached",f:a,iter:g,x:i};for(c=0,h=0;x>h;h++)c+=l[h]*l[h];if(b*b*c>u)for(p=Math.sqrt(u/c)/b,h=0;x>h;h++)l[h]=p*l[h];for(h=0;x>h;h++)i[h]-=b*l[h],m&&i[h]<m[h][0]&&(i[h]=m[h][0]),m&&i[h]>m[h][1]&&(i[h]=m[h][1]);s=a,o=e.apply(null,i),a=o[0],l=o[1],d++}while(Math.abs(a-s)>f);return[a,i]}}),define("models/md2d/models/engine/math/index",["require","exports","module","./distributions","./utils","./minimizer"],function(e,t){t.normal=e("./distributions").normal,t.getWindowedAverager=e("./utils").getWindowedAverager,t.minimize=e("./minimizer").minimize}),define("models/md2d/models/engine/potentials/coulomb",["require","exports","module","../constants/index"],function(e,t){{var n=e("../constants/index"),r=n.unit,i=.346,o=n.COULOMB_CONSTANT.as(n.unit.METERS_PER_FARAD),a=n.ratio(r.NANOMETER,{per:r.METER}),s=Math.pow(n.ratio(r.COULOMB,{per:r.ELEMENTARY_CHARGE}),2),l=n.ratio(r.EV,{per:r.JOULE}),u=n.ratio(r.MW_FORCE_UNIT,{per:r.NEWTON}),c=i*o*s*a*l,d=i*o*s*a*a*u,h=(t.potential=function(e,t,n,r,i){return i&&r>1&&1.2>e&&(r=1+(r-1)/(1+Math.exp(-12*e+7))),c*(t*n/e)/r},t.forceFromSquaredDistance=function(e,t,n,r,i){var o=Math.sqrt(e);return i&&r>1&&1.2>o&&(r=1+(r-1)/(1+Math.exp(-12*o+7))),-d*(t*n/e)/r});t.forceOverDistanceFromSquaredDistance=function(e,t,n,r,i){return h(e,t,n,r,i)/Math.sqrt(e)},t.force=function(e,t,n,r,i){return h(e*e,t,n,r,i)}}}),define("models/md2d/models/engine/potentials/lennard-jones",["require","exports","module","../constants/index"],function(e,t){var n=e("../constants/index"),r=n.unit,i=n.ratio(r.NANOMETER,{per:r.METER}),o=n.ratio(r.MW_FORCE_UNIT,{per:r.NEWTON});t.pairwiseEpsilon=function(e,t){return.5*(e+t)},t.pairwiseSigma=function(e,t){return Math.sqrt(e*t)},t.rmin=function(e){return Math.pow(2,1/6)*e},t.radius=function(e){return.5*e},t.newLJCalculator=function(e,a){var s,l,u,c,d,h,p,f,m=!1,g=function(e,f){s=e,l=f,u=t.rmin(l),null!=s&&null!=l&&(c=4*s*Math.pow(l,12),d=4*s*Math.pow(l,6),h=12*n.convert(c,{from:r.EV,to:r.JOULE})*i*o,p=6*n.convert(d,{from:r.EV,to:r.JOULE})*i*o),m&&"function"==typeof a&&a(v(),this)},v=function(){return{epsilon:s,sigma:l,rmin:u}},y=function(e){if(null==e||parseFloat(e)!==e)throw new Error("lennardJones: epsilon value "+e+" is invalid")},b=function(e){if(null==e||parseFloat(e)!==e||0>=e)throw new Error("lennardJones: sigma value "+e+" is invalid")};return y(e.epsilon),b(e.sigma),g(e.epsilon,e.sigma),m=!0,f={getCoefficients:v,setEpsilon:function(e){y(e),g(e,l)},setSigma:function(e){b(e),g(s,e)},potentialFromSquaredDistance:function(e){return e?c*Math.pow(e,-6)-d*Math.pow(e,-3):-1/0},potential:function(e){return f.potentialFromSquaredDistance(e*e)},forceOverDistanceFromSquaredDistance:function(e){var t=1/e,n=t*t*t,r=n*t,i=r*n;return h*i-p*r},force:function(e){return e*f.forceOverDistanceFromSquaredDistance(e*e)}}}}),define("models/md2d/models/engine/potentials/index",["require","exports","module","./coulomb","./lennard-jones"],function(e,t){t.coulomb=e("./coulomb"),t.lennardJones=e("./lennard-jones")}),define("models/md2d/models/metadata",[],function(){return{mainProperties:{type:{defaultValue:"md2d",immutable:!0},imagePath:{defaultValue:"",immutable:!0},minX:{serialize:!1},maxX:{serialize:!1},minY:{serialize:!1},maxY:{serialize:!1},width:{defaultValue:10,unitType:"length",immutable:!0},height:{defaultValue:10,unitType:"length",immutable:!0},unitsScheme:{defaultValue:"md2d"},lennardJonesForces:{defaultValue:!0,storeInTickHistory:!0},coulombForces:{defaultValue:!0,storeInTickHistory:!0},temperatureControl:{defaultValue:!1,storeInTickHistory:!0},targetTemperature:{defaultValue:300,unitType:"temperature",storeInTickHistory:!0},modelSampleRate:{defaultValue:"default"},gravitationalField:{defaultValue:!1,unitType:"acceleration",storeInTickHistory:!0},timeStep:{defaultValue:1,unitType:"time",storeInTickHistory:!0},dielectricConstant:{defaultValue:1},realisticDielectricEffect:{defaultValue:!0},solventForceFactor:{defaultValue:1.25},solventForceType:{defaultValue:0},additionalSolventForceMult:{defaultValue:4},additionalSolventForceThreshold:{defaultValue:10,unitType:"length"},polarAAEpsilon:{defaultValue:-2},viscosity:{defaultValue:1,storeInTickHistory:!0},timeStepsPerTick:{defaultValue:50,storeInTickHistory:!0},DNAState:{defaultValue:"dna"},DNA:{defaultValue:"",validate:function(e){if(/[agtc]/.test(e)&&(e=e.toUpperCase()),/[^AGTC]/.test(e))throw new Error("DNA code on sense strand can be defined using only A, G, T or C characters.");return e}},DNAMutations:{defaultValue:!0},useQuantumDynamics:{defaultValue:!1},useChemicalReactions:{defaultValue:!1}},viewOptions:{viewPortWidth:{unitType:"length",immutable:!0},viewPortHeight:{unitType:"length",immutable:!0},viewPortZoom:{defaultValue:1},viewPortX:{unitType:"length"},viewPortY:{unitType:"length"},viewPortDrag:{defaultValue:!1},backgroundColor:{defaultValue:"#eeeeee"},showClock:{defaultValue:!0,storeInTickHistory:!0},markColor:{defaultValue:"#f8b500"},keShading:{defaultValue:!1,storeInTickHistory:!0},chargeShading:{defaultValue:!1,storeInTickHistory:!0},useThreeLetterCode:{defaultValue:!0},aminoAcidColorScheme:{defaultValue:"hydrophobicity"},showChargeSymbols:{defaultValue:!0},showVDWLines:{defaultValue:!1,storeInTickHistory:!0},VDWLinesCutoff:{defaultValue:"medium"},showVelocityVectors:{defaultValue:!1,storeInTickHistory:!0},showForceVectors:{defaultValue:!1,storeInTickHistory:!0},showElectricField:{defaultValue:!1,storeInTickHistory:!0},electricFieldDensity:{defaultValue:18,storeInTickHistory:!0},electricFieldColor:{defaultValue:"auto"},showAtomTrace:{storeInTickHistory:!0,defaultValue:!1},atomTraceId:{storeInTickHistory:!0,defaultValue:0},images:{defaultValue:[]},imageMapping:{defaultValue:{}},textBoxes:{defaultValue:[]},xlabel:{defaultValue:!1},ylabel:{defaultValue:!1},xunits:{defaultValue:!1},yunits:{defaultValue:!1},controlButtons:{defaultValue:"play"},controlButtonStyle:{defaultValue:"video",serialize:!1},gridLines:{defaultValue:!1},atomNumbers:{defaultValue:!1},enableAtomTooltips:{defaultValue:!1},enableKeyboardHandlers:{defaultValue:!0},atomTraceColor:{defaultValue:"#6913c5"},velocityVectors:{defaultValue:{color:"#000",width:.01,length:2}},forceVectors:{defaultValue:{color:"#169C30",width:.01,length:2}},forceVectorsDirectionOnly:{defaultValue:!1}},atom:{x:{required:!0,unitType:"length"},y:{required:!0,unitType:"length"},element:{defaultValue:0},vx:{defaultValue:0,unitType:"velocity"},vy:{defaultValue:0,unitType:"velocity"},ax:{defaultValue:0,unitType:"acceleration",serialize:!1},ay:{defaultValue:0,unitType:"acceleration",serialize:!1},charge:{defaultValue:0,unitType:"charge"},friction:{defaultValue:0,unitType:"dampingCoefficient"},radical:{defaultValue:0},visible:{defaultValue:1},pinned:{defaultValue:0},marked:{defaultValue:0},draggable:{defaultValue:0},radius:{readOnly:!0,unitType:"length",serialize:!1},px:{readOnly:!0,unitType:"momentum",serialize:!1},py:{readOnly:!0,unitType:"momentum",serialize:!1},speed:{readOnly:!0,unitType:"velocity",serialize:!1},mass:{readOnly:!0,unitType:"mass",serialize:!1},excitation:{},sharedElectrons:{}},element:{mass:{defaultValue:120,unitType:"mass"},sigma:{defaultValue:.3,unitType:"length"},epsilon:{defaultValue:-.1,unitType:"energy"},radius:{unitType:"length",readOnly:!0,serialize:!1},color:{defaultValue:-855310}},pairwiseLJProperties:{element1:{defaultValue:0},element2:{defaultValue:0},sigma:{unitType:"length"},epsilon:{unitType:"energy"}},obstacle:{width:{unitType:"length",required:!0},height:{unitType:"length",required:!0},x:{defaultValue:0,unitType:"length"},y:{defaultValue:0,unitType:"length"},mass:{defaultValue:1/0,unitType:"mass"},vx:{defaultValue:0,unitType:"velocity"},vy:{defaultValue:0,unitType:"velocity"},externalAx:{defaultValue:0,unitType:"acceleration"},externalAy:{defaultValue:0,unitType:"accleration"},friction:{defaultValue:0,unitType:"inverseTime"},westProbe:{defaultValue:!1},westProbeValue:{unitType:"pressure",readOnly:!0,serialize:!1},northProbe:{defaultValue:!1},northProbeValue:{unitType:"pressure",readOnly:!0,serialize:!1},eastProbe:{defaultValue:!1},eastProbeValue:{unitType:"pressure",readOnly:!0,serialize:!1},southProbe:{defaultValue:!1},southProbeValue:{unitType:"pressure",readOnly:!0,serialize:!1},color:{defaultValue:"rgb(128,128,128)"},visible:{defaultValue:!0}},shape:{type:{defaultValue:"rectangle",required:!0},width:{unitType:"length",required:!0},height:{unitType:"length",required:!0},x:{defaultValue:0,unitType:"length"},y:{defaultValue:0,unitType:"length"},fence:{defaultValue:0},color:{defaultValue:"transparent"},lineColor:{defaultValue:"black"},lineDashes:{defaultValue:"none"},lineWeight:{defaultValue:1},layer:{defaultValue:1},layerPosition:{defaultValue:1},visible:{defaultValue:1}},line:{x1:{defaultValue:0,required:!0,unitType:"length"},y1:{defaultValue:0,required:!0,unitType:"length"},x2:{defaultValue:0,required:!0,unitType:"length"},y2:{defaultValue:0,required:!0,unitType:"length"},beginStyle:{defaultValue:"none"},endStyle:{defaultValue:"none"},fence:{defaultValue:0},lineColor:{defaultValue:"black"},lineDashes:{defaultValue:"none"},lineWeight:{defaultValue:1},layer:{defaultValue:1},layerPosition:{defaultValue:1},visible:{defaultValue:1}},radialBond:{atom1:{defaultValue:0},atom2:{defaultValue:0},length:{unitType:"length",required:!0},strength:{unitType:"stiffness",required:!0},type:{defaultValue:101}},angularBond:{atom1:{defaultValue:0},atom2:{defaultValue:0},atom3:{defaultValue:0},strength:{unitType:"rotationalStiffness",required:!0},angle:{unitType:"angle",required:!0}},restraint:{atomIndex:{required:!0},k:{defaultValue:2e3,unitType:"stiffness"},x0:{defaultValue:0,unitType:"length"},y0:{defaultValue:0,unitType:"length"}},electricField:{intensity:{defaultValue:.004},orientation:{defaultValue:"E"},shapeIdx:{defaultValue:null}},textBox:{text:{defaultValue:""},x:{defaultValue:0,unitType:"length"},y:{defaultValue:0,unitType:"length"},anchor:{defaultValue:"lower-left"},layer:{defaultValue:1},width:{},height:{},frame:{},color:{},calloutPoint:{},backgroundColor:{defaultValue:"white"},strokeWidthEms:{defaultValue:.03},strokeOpacity:{defaultValue:1},rotate:{defaultValue:0},fontSize:{defaultValue:.12},hostType:{},hostIndex:{},textAlign:{}},chemicalReactions:{valenceElectrons:{defaultValue:[1,1,7,7],immutable:!0},bondEnergy:{defaultValue:{"default":6,"0-0":4,"1-1":4,"2-2":4,"3-3":4},immutable:!0},activationEnergy:{defaultValue:{"default":.2},immutable:!0}},image:{imageUri:{required:!0},imageX:{defaultValue:0,required:!0},imageY:{defaultValue:0,required:!0},imageHostType:{defaultValue:""},imageHostIndex:{defaultValue:0},imageLayer:{defaultValue:1},imageLayerPosition:{defaultValue:1}},quantumDynamics:{elementEnergyLevels:{defaultValue:[]},photons:{defaultValue:{}},radiationlessEmissionProbability:{defaultValue:1},lightSource:{}},photon:{x:{serialize:!0},y:{serialize:!0},vx:{defaultValue:0,serialize:!0},vy:{defaultValue:0,serialize:!0},angularFrequency:{serialize:!0}}}}),function(){var e={}.hasOwnProperty;define("cs!models/md2d/models/engine/pairwise-lj-properties",["require","models/md2d/models/metadata","common/validator"],function(t){var n,r,i;return r=t("models/md2d/models/metadata"),i=t("common/validator"),n=function(){function t(e){this._engine=e,this._data={}}return t.prototype.registerChangeHooks=function(e,t){return this._changePreHook=e,this._changePostHook=t},t.prototype.set=function(t,n,o){var a;o=i.validate(r.pairwiseLJProperties,o),this._changePreHook(),null==this._data[t]&&(this._data[t]={}),null==this._data[n]&&(this._data[n]={}),null==this._data[t][n]&&(this._data[t][n]=this._data[n][t]={});for(a in o)e.call(o,a)&&(this._data[t][n][a]=o[a]);return this._engine.setPairwiseLJProperties(t,n),this._changePostHook()},t.prototype.remove=function(e,t){return this._changePreHook(),delete this._data[e][t],delete this._data[t][e],this._engine.setPairwiseLJProperties(e,t),this._changePostHook()},t.prototype.get=function(e,t){return this._data[e]&&this._data[e][t]?this._data[e][t]:void 0},t.prototype.deserialize=function(e){var t,n,o,a,s;for(a=0,s=e.length;s>a;a++)o=e[a],o=i.validateCompleteness(r.pairwiseLJProperties,o),t=o.element1,n=o.element2,delete o.element1,delete o.element2,this.set(t,n,o)},t.prototype.serialize=function(){var t,n,r,i,o,a;o=[],a=this._data;for(n in a)if(e.call(a,n)){t=a[n];for(r in t)e.call(t,r)&&r>n&&(i=this.get(n,r),i.element1=Number(n),i.element2=Number(r),o.push(i))}return o},t.prototype.clone=function(){return $.extend(!0,{},this._data)},t.prototype.restore=function(t){var n,r,i,o;this._data=t,o=this._data;for(r in o)if(e.call(o,r)){n=o[r];for(i in n)e.call(n,i)&&i>r&&this._engine.setPairwiseLJProperties(r,i)}},t}()})}.call(this),define("common/models/engines/clone-restore-wrapper",["require","arrays"],function(e){var t=e("arrays");return function(e,n){n=n||{};var r={clone:function(){var n,r={};for(n in e)e.hasOwnProperty(n)&&(r[n]=t.clone(e[n]));return r}};return r.restore=n.padArraysWithZeroes?function(n){var r,i,o,a;for(r in e)if(e.hasOwnProperty(r))for(i=e[r],t.copy(n[r],i),o=n[r].length,a=i.length;a>o;o++)i[o]=0}:function(n){var r;for(r in e)e.hasOwnProperty(r)&&t.copy(n[r],e[r])},r}}),define("models/md2d/models/engine/cell-list",[],function(){return function(e,t,n){var r,i,o,a,s,l=function(){var r;for(i=Math.ceil(e/n),o=Math.ceil(t/n),a=i*o,s=new Array(a),r=0;a>r;r++)s[r]=[]};return l(),r={reinitialize:function(r,i,o){var a=!1;void 0!==r&&r!==e&&(e=r,a=!0),void 0!==i&&i!==t&&(t=i,a=!0),void 0!==o&&o!==n&&(n=o,a=!0),a&&l()},addToCell:function(e,t,r){var o=Math.floor(r/n)*i+Math.floor(t/n);s[o].push(e)},getCell:function(e){return s[e]},getRowsNum:function(){return o},getColsNum:function(){return i},getNeighboringCells:function(e,t){var n=e*i+t,r=[];return i>t+1&&o>e+1&&r.push(s[n+i+1]),i>t+1&&r.push(s[n+1]),i>t+1&&e-1>=0&&r.push(s[n-i+1]),e-1>=0&&r.push(s[n-i]),r},clear:function(){var e;for(e=0;a>e;e++)s[e].length=0}}}}),define("models/md2d/models/engine/neighbor-list",["require","arrays","common/array-types"],function(e){var t=e("arrays"),n=e("common/array-types");return function(e,r){var i,o,a,s,l,u,c,d,h,p,f=function(){o=e+10,a=0,s=o*(o-1)/2,p=!0,l=t.create(s,0,n.int16Type),u=t.create(o,-1,n.int16Type),c=t.create(o,-1,n.int16Type),d=t.create(o,1/0,n.floatType),h=t.create(o,1/0,n.floatType)};return f(),i={reinitialize:function(t,n){e=t,r=n,p=!0,e>o&&f()},clear:function(){var t;for(a=0,t=0;e>t;t++)u[t]=c[t]=-1},getList:function(){return l},markNeighbors:function(e,t){u[e]<0&&(u[e]=a),l[a]=t,a++,c[e]=a},getStartIdxFor:function(e){return u[e]},getEndIdxFor:function(e){return c[e]},saveAtomPosition:function(e,t,n){d[e]=t,h[e]=n},invalidate:function(){p=!0},shouldUpdate:function(t,n){var i,o=-1/0,a=-1/0;if(p)return p=!1,!0;for(i=0;e>i;i++)Math.abs(t[i]-d[i])>o&&(o=Math.abs(t[i]-d[i])),Math.abs(n[i]-h[i])>a&&(a=Math.abs(n[i]-h[i]));return Math.sqrt(o*o+a*a)>r}}}}),define("common/models/plugin-controller",[],function(){return function(){var e=[];return{registerPlugin:function(t){e.push(t)},callPluginFunction:function(t,n,r){var i,o,a,s;for(i=0,o=e.length;o>i;i++)a=e[i][t],a&&(s=a.apply(e[i],n)),r&&r(s,i,e[i])}}}}),define("models/md2d/models/engine/utils",["require","arrays"],function(e){var t=e("arrays");return{extendArrays:function(e,n){var r,i;if(Array.isArray(e))for(r=0,i=e.length;i>r;r++)t.isArray(e[r])&&(e[r]=t.extend(e[r],n));else for(r in e)e.hasOwnProperty(r)&&t.isArray(e[r])&&(e[r]=t.extend(e[r],n))}}}),define("models/md2d/models/engine/md2d",["require","exports","module","arrays","common/array-types","common/console","./constants/index","cs!models/md2d/models/aminoacids-helper","./math/index","./potentials/index","./potentials/index","cs!./pairwise-lj-properties","common/models/engines/clone-restore-wrapper","./cell-list","./neighbor-list","common/models/plugin-controller","./utils"],function(e,t){var n=e("arrays"),r=e("common/array-types"),i=e("common/console"),o=e("./constants/index"),a=o.unit,s=e("cs!models/md2d/models/aminoacids-helper"),l=e("./math/index"),u=e("./potentials/index").coulomb,c=e("./potentials/index").lennardJones,d=e("cs!./pairwise-lj-properties"),h=e("common/models/engines/clone-restore-wrapper"),p=e("./cell-list"),f=e("./neighbor-list"),m=e("common/models/plugin-controller"),g=e("./utils"),v=o.BOLTZMANN_CONSTANT.as(a.JOULES_PER_KELVIN),y=function(e,t,n,r){return e*r-t*n
},b=function(e,t){return e*e+t*t},x=function(e,t){var n=e/t,r=o.convert(n,{from:a.MW_ENERGY_UNIT,to:a.JOULE});return r/v},w=function(e,t){var n=e*v,r=o.convert(n,{from:a.JOULE,to:a.MW_ENERGY_UNIT}),i=r*t;return i},_=function(e){var t=parseFloat(e);if(isNaN(t))throw new Error("md2d: requested temperature "+e+" could not be understood.");if(0>t)throw new Error("md2d: requested temperature "+t+" was less than zero");if(1/0===t)throw new Error("md2d: requested temperature was Infinity!")};t.createEngine=function(){var e,t,v,T,A,C,E,S,k,P,R,O,M,N,I,L,B,D,F,V,G,$,U,j,q,W,H,z,X,Y,K,J,Z,Q,et,tt,nt,rt,it,ot,at,st,lt,ut,ct,dt,ht,pt,ft,mt,gt,vt,yt,bt,xt,wt,_t,Tt,At,Ct,Et,St,kt,Pt,Rt,Ot,Mt,Nt,It,Lt,Bt,Dt,Ft,Vt,Gt,$t,Ut,jt,qt,Wt,Ht,zt,Xt,Yt,Kt,Jt,Zt,Qt,en,tn,nn,rn,on,an,sn,ln,un,cn,dn,hn,pn,fn,mn,gn,vn,yn,bn,xn,wn,_n,Tn,An,Cn,En,Sn,kn,Pn,Rn,On,Mn,Nn,In,Ln,Bn,Dn,Fn,Vn=!1,Gn=new m,$n=!1,Un=1,jn=!0,qn=0,Wn=!1,Hn=1,zn=25,Xn=3,Yn=!0,Kn=!1,Jn=1.67,Zn=!1,Qn=[10,10],er=0,tr=0,nr=10,rr=10,ir=0,or=0,ar=0,sr=[],lr=0,ur=!1,cr=0,dr=0,hr=0,pr=0,fr=0,mr=0,gr=0,vr=2,yr=[],br=2.5,xr=[],wr=[],_r=[],Tr=function(){Mr(0),Nr(0),Br(0),Ir(0),Lr(0),Dr(0),Fr(0),Vr(0),Gr(0),$r(0),Ur(0),K=new d(e),rt=[]},Ar=function(){throw new Error("md2d: Don't change the epsilon or sigma parameters of the LJ calculator being used by MD2D. Use the setElementProperties method instead.")},Cr=function(e,t){var n,r,i=W[e],o=W[t],a=H[e],s=H[t],l=K.get(e,t);n=l&&void 0!==l.epsilon?l.epsilon:c.pairwiseEpsilon(i,o),r=l&&void 0!==l.sigma?l.sigma:c.pairwiseSigma(a,s),yr[e][t]=yr[t][e]=vr*r*vr*r,xr[e][t]=xr[t][e]=br*r*br*r,wr[e][t]=wr[t][e]=c.newLJCalculator({epsilon:n,sigma:r},Ar)},Er=function(){var e,t,n,r,i=0;for(n=0;ar>n;n++)for(r=0;n>=r;r++)sr[n]&&sr[r]&&(e=K.get(n,r),t=e&&void 0!==e.sigma?e.sigma:c.pairwiseSigma(H[n],H[r]),br*t>i&&(i=br*t));return i||Math.max(Qn[0],Qn[1])},Sr=function(){var e,t,n,r,i=1/0;for(n=0;ar>n;n++)for(r=0;n>=r;r++)sr[n]&&sr[r]&&(e=K.get(n,r),t=e&&void 0!==e.sigma?e.sigma:c.pairwiseSigma(H[n],H[r]),i>(br-vr)*t&&(i=(br-vr)*t));return i},kr=function(){void 0===En?En=new p(Qn[0],Qn[1],Er()):En.reinitialize(Qn[0],Qn[1],Er())},Pr=function(){void 0===Sn?Sn=new f(or,Sr()):Sn.reinitialize(or,Sr())},Rr=function(){var e,t,n;for(rt=[],e=0;lr>e;e++)t=J[e],n=Z[e],rt[t]=rt[t]||[],rt[t][n]=!0,rt[n]=rt[n]||[],rt[n][t]=!0},Or={atoms:function(){C=j.radius,E=j.px,S=j.py,k=j.x,P=j.y,R=j.vx,O=j.vy,M=j.speed,N=j.ax,I=j.ay,L=j.charge,D=j.friction,F=j.radical,B=j.element,V=j.pinned,G=j.mass,$=j.hydrophobicity,U=j.visited},radialBonds:function(){J=nt.atom1,Z=nt.atom2,Q=nt.length,et=nt.strength,tt=nt.type},restraints:function(){it=lt.atomIndex,ot=lt.k,at=lt.x0,st=lt.y0},angularBonds:function(){ut=ft.atom1,ct=ft.atom2,dt=ft.atom3,ht=ft.angle,pt=ft.strength},elements:function(){q=Y.mass,W=Y.epsilon,H=Y.sigma,z=Y.radius,X=Y.color},obstacles:function(){mt=Dt.x,gt=Dt.y,vt=Dt.width,yt=Dt.height,At=Dt.mass,bt=Dt.vx,xt=Dt.vy,wt=Dt.externalAx,_t=Dt.externalAy,Tt=Dt.friction,Ct=Dt.westProbe,Et=Dt.northProbe,St=Dt.eastProbe,kt=Dt.southProbe,Nt=Dt.westProbeValue,It=Dt.northProbeValue,Lt=Dt.eastProbeValue,Bt=Dt.southProbeValue,Ot=Dt.xPrev,Mt=Dt.yPrev,Pt=Dt.color,Rt=Dt.visible},shapes:function(){Ft=Jt.type,Vt=Jt.x,Gt=Jt.y,$t=Jt.width,Ut=Jt.height,jt=Jt.fence,qt=Jt.color,Wt=Jt.lineColor,Ht=Jt.lineDashes,zt=Jt.lineWeight,Xt=Jt.layer,Yt=Jt.layerPosition,Kt=Jt.visible},lines:function(){Zt=hn.x1,Qt=hn.y1,en=hn.x2,tn=hn.y2,nn=hn.beginStyle,rn=hn.endStyle,on=hn.fence,an=hn.lineColor,sn=hn.lineDashes,ln=hn.lineWeight,un=hn.layer,cn=hn.layerPosition,dn=hn.visible},electricFields:function(){pn=gn.intensity,fn=gn.orientation,mn=gn.shapeIdx},springForces:function(){wn=Cn[0],_n=Cn[1],Tn=Cn[2],An=Cn[3]},vdwPairs:function(){bn=vn.atom1,xn=vn.atom2}},Mr=function(t){Y=e.elements={},Y.mass=n.create(t,0,r.floatType),Y.epsilon=n.create(t,0,r.floatType),Y.sigma=n.create(t,0,r.floatType),Y.radius=n.create(t,0,r.floatType),Y.color=n.create(t,0,r.int32Type),Or.elements()},Nr=function(e){j={},j.radius=n.create(e,0,r.floatType),j.px=n.create(e,0,r.floatType),j.py=n.create(e,0,r.floatType),j.x=n.create(e,0,r.floatType),j.y=n.create(e,0,r.floatType),j.vx=n.create(e,0,r.floatType),j.vy=n.create(e,0,r.floatType),j.speed=n.create(e,0,r.floatType),j.ax=n.create(e,0,r.floatType),j.ay=n.create(e,0,r.floatType),j.charge=n.create(e,0,r.floatType),j.friction=n.create(e,0,r.floatType),j.radical=n.create(e,0,r.uint8Type),j.element=n.create(e,0,r.uint8Type),j.pinned=n.create(e,0,r.uint8Type),j.mass=n.create(e,0,r.floatType),j.hydrophobicity=n.create(e,0,r.int8Type),j.visited=n.create(e,0,r.uint8Type),j.marked=n.create(e,0,r.uint8Type),j.visible=n.create(e,0,r.uint8Type),j.draggable=n.create(e,0,r.uint8Type),Or.atoms()},Ir=function(t){nt=e.radialBonds={},nt.atom1=n.create(t,0,r.uint16Type),nt.atom2=n.create(t,0,r.uint16Type),nt.length=n.create(t,0,r.floatType),nt.strength=n.create(t,0,r.floatType),nt.type=n.create(t,0,r.uint8Type),Or.radialBonds()},Lr=function(t){lt=e.restraints={},lt.atomIndex=n.create(t,0,r.uint16Type),lt.k=n.create(t,0,r.floatType),lt.x0=n.create(t,0,r.floatType),lt.y0=n.create(t,0,r.floatType),Or.restraints()},Br=function(t){ft=e.angularBonds={},ft.atom1=n.create(t,0,r.uint16Type),ft.atom2=n.create(t,0,r.uint16Type),ft.atom3=n.create(t,0,r.uint16Type),ft.angle=n.create(t,0,r.floatType),ft.strength=n.create(t,0,r.floatType),Or.angularBonds()},Dr=function(t){vn=e.vdwPairs={},vn.count=0,vn.atom1=n.create(t,0,r.uint16Type),vn.atom2=n.create(t,0,r.uint16Type)},Fr=function(t){Cn=e.springForces=[],Cn[0]=n.create(t,0,r.uint16Type),Cn[1]=n.create(t,0,r.floatType),Cn[2]=n.create(t,0,r.floatType),Cn[3]=n.create(t,0,r.floatType),Or.springForces()},Vr=function(t){Dt=e.obstacles={},Dt.x=n.create(t,0,r.floatType),Dt.y=n.create(t,0,r.floatType),Dt.width=n.create(t,0,r.floatType),Dt.height=n.create(t,0,r.floatType),Dt.mass=n.create(t,0,r.floatType),Dt.vx=n.create(t,0,r.floatType),Dt.vy=n.create(t,0,r.floatType),Dt.externalAx=n.create(t,0,r.floatType),Dt.externalAy=n.create(t,0,r.floatType),Dt.friction=n.create(t,0,r.floatType),Dt.westProbe=n.create(t,0,r.uint8Type),Dt.northProbe=n.create(t,0,r.uint8Type),Dt.eastProbe=n.create(t,0,r.uint8Type),Dt.southProbe=n.create(t,0,r.uint8Type),Dt.westProbeValue=n.create(t,0,r.floatType),Dt.northProbeValue=n.create(t,0,r.floatType),Dt.eastProbeValue=n.create(t,0,r.floatType),Dt.southProbeValue=n.create(t,0,r.floatType),Dt.xPrev=n.create(t,0,r.floatType),Dt.yPrev=n.create(t,0,r.floatType),Dt.color=[],Dt.visible=n.create(t,0,r.uint8Type),Or.obstacles()},Gr=function(t){Jt=e.shapes={},Jt.type=[],Jt.x=n.create(t,0,r.floatType),Jt.y=n.create(t,0,r.floatType),Jt.width=n.create(t,0,r.floatType),Jt.height=n.create(t,0,r.floatType),Jt.color=[],Jt.lineColor=[],Jt.lineDashes=[],Jt.lineWeight=n.create(t,0,r.floatType),Jt.layer=n.create(t,0,r.uint8Type),Jt.layerPosition=n.create(t,0,r.uint8Type),Jt.visible=n.create(t,0,r.uint8Type),Jt.fence=n.create(t,0,r.uint8Type),Or.shapes()},$r=function(t){hn=e.lines={},hn.x1=n.create(t,0,r.floatType),hn.y1=n.create(t,0,r.floatType),hn.x2=n.create(t,0,r.floatType),hn.y2=n.create(t,0,r.floatType),hn.beginStyle=[],hn.endStyle=[],hn.lineColor=[],hn.lineDashes=[],hn.lineWeight=n.create(t,0,r.floatType),hn.layer=n.create(t,0,r.uint8Type),hn.layerPosition=n.create(t,0,r.uint8Type),hn.visible=n.create(t,0,r.uint8Type),hn.fence=n.create(t,0,r.uint8Type),Or.lines()},Ur=function(t){gn=e.electricFields={},gn.intensity=n.create(t,0,r.floatType),gn.orientation=[],gn.shapeIdx=[],Or.electricFields()},jr=function(){var e,t=0;for(e=0;or>e;e++)t+=G[e]*(R[e]*R[e]+O[e]*O[e]);for(e=0;hr>e;e++)1/0!==At[e]&&(t+=At[e]*(bt[e]*bt[e]+xt[e]*xt[e]));return x(t/2,or)},qr=function(e){var t,n,r=0;for(t=0;t<e.length;t++)n=e[t],r+=G[n]*(R[n]*R[n]+O[n]*O[n]);return x(r/2,e.length)},Wr=function(e,t,n){R[e]+=t,O[e]+=n,E[e]=R[e]*G[e],S[e]=O[e]*G[e]},Hr=function(e,t){R[e]-=t*(P[e]-Rn),O[e]+=t*(k[e]-Pn),E[e]=R[e]*G[e],S[e]=O[e]*G[e]},zr=function(){for(var e=0;or>e;e++)Wr(e,-Nn,-In),Hr(e,-Dn)},Xr=function(){var t,n=0,r=0,i=0,o=0,a=e.getTotalMass();for(t=0;or>t;t++)n+=k[t],r+=P[t],i+=E[t],o+=S[t];Pn=n/or,Rn=r/or,On=i,Mn=o,Nn=i/a,In=o/a},Yr=function(){var e,t,n=0,r=0;for(t=0;or>t;t++)e=G[t],n+=e*y(k[t]-Pn,P[t]-Rn,R[t]-Nn,O[t]-In),r+=e*b(k[t]-Pn,P[t]-Rn);Ln=n,Bn=r,Dn=Ln/Bn},Kr=function(){Xr(),Yr()},Jr=function(e){var t=0,n=0,r=Qn[0],i=Qn[1],o=r-vt[e],a=i-yt[e];if(mt[e]<t){for(;mt[e]<t-r;)mt[e]+=r;mt[e]=t+(t-mt[e]),bt[e]*=-1}else if(mt[e]>o){for(;mt[e]>o+r;)mt[e]-=r;mt[e]=o-(mt[e]-o),bt[e]*=-1}if(gt[e]<n){for(;gt[e]<n-i;)gt[e]+=i;gt[e]=n+(n-gt[e]),xt[e]*=-1}else if(gt[e]>a){for(;gt[e]>a+r;)gt[e]-=r;gt[e]=a-(gt[e]-a),xt[e]*=-1}},Zr=function(e){var t=C[e],n=t,r=t,i=Qn[0],o=Qn[1],a=i-t,s=o-t;if(k[e]<n){for(;k[e]<n-i;)k[e]+=i;k[e]=n+(n-k[e]),R[e]*=-1,E[e]*=-1}else if(k[e]>a){for(;k[e]>a+i;)k[e]-=i;k[e]=a-(k[e]-a),R[e]*=-1,E[e]*=-1}if(P[e]<r){for(;P[e]<r-o;)P[e]+=o;P[e]=r+(r-P[e]),O[e]*=-1,S[e]*=-1}else if(P[e]>s){for(;P[e]>s+o;)P[e]-=o;P[e]=s-(P[e]-s),O[e]*=-1,S[e]*=-1}},Qr=function(e,t,n,r){if(!(1>hr)){var i,o,a,s,l,u,c,d,h,p,f,m,g,v,y,b,x,w,_,T;for(i=C[e],o=k[e],a=P[e],s=0;hr>s;s++)l=mt[s]-i,u=mt[s]+vt[s]+i,c=gt[s]+yt[s]+i,d=gt[s]-i,h=Ot[s]-i,p=Ot[s]+vt[s]+i,f=Mt[s]+yt[s]+i,m=Mt[s]-i,T=0,o>l&&u>o&&a>d&&c>a&&(h>=t?(k[e]=l-(o-l),T=1):t>=p?(k[e]=u+(u-o),T=2):m>=n?(P[e]=d-(a-d),T=-1):n>=f&&(P[e]=c+(c-a),T=-2)),w=At[s],0!==T&&(1/0!==w?(x=G[e],_=w+x,T>0?(g=R[e],y=bt[s],R[e]=(g*(x-w)+2*w*y)/_,bt[s]=(y*(w-x)+2*E[e])/_):(v=O[e],b=xt[s],O[e]=(v*(x-w)+2*w*b)/_,xt[s]=(b*(w-x)+2*S[e])/_)):T>0?R[e]*=-1:O[e]*=-1,r&&(Ct[s]&&1===T?Nt[s]+=G[e]*((g?g:-R[e])-R[e]):St[s]&&2===T?Lt[s]+=G[e]*(R[e]-(g?g:-R[e])):kt[s]&&-1===T?Bt[s]+=G[e]*((v?v:-O[e])-O[e]):Et[s]&&-2===T&&(It[s]+=G[e]*(O[e]-(v?v:-O[e])))))}},ei=function(e,t,n){if(!(1>pr)){var r,i,o,a,s,l,u,c,d,h,p,f,m,g,v,y,x,w,_,T,A,E,S,M,N,I,L,B,D,F,V,G,$,U,j,q;for(r=C[e],i=k[e],o=P[e],a=0;pr>a;a++)jt[a]&&("rectangle"===Ft[a]?(d=Vt[a]-r,h=Vt[a]+$t[a]+r,p=Gt[a]+Ut[a]+r,f=Gt[a]-r,s=Vt[a]+r,l=Vt[a]+$t[a]-r,u=Gt[a]+Ut[a]-r,c=Gt[a]+r,i>d&&h>i&&o>f&&p>o&&(d>=t?(k[e]=d-(i-d),R[e]*=-1):t>=h?(k[e]=h+(h-i),R[e]*=-1):f>=n?(P[e]=f-(o-f),O[e]*=-1):n>=p&&(P[e]=p+(p-o),O[e]*=-1)),t>s&&l>t&&n>c&&u>n&&(s>=i?(k[e]=s+(s-i),R[e]*=-1):i>=l&&(k[e]=l-(i-l),R[e]*=-1),c>=o?(P[e]=c+(c-o),O[e]*=-1):o>=u&&(P[e]=u-(o-u),O[e]*=-1))):"ellipse"===Ft[a]&&(A=$t[a]/2,E=Ut[a]/2,m=Vt[a]+A,g=Gt[a]+E,v=(i-m)/(A+r),y=(o-g)/(E+r),v*=v,y*=y,x=(t-m)/(A+r),w=(n-g)/(E+r),x*=x,w*=w,_=(A+r)/(A-r),T=(E+r)/(E-r),_*=_,T*=T,(1>=v+y&&x+w>1||v*_+y*T>=1&&1>x*_+w*T)&&($t[a]>Ut[a]?(S=Math.sqrt(A*A-E*E),M=Vt[a]+A+S,L=Vt[a]+A-S,N=B=Gt[a]+E):(S=Math.sqrt(E*E-A*A),M=L=Vt[a]+A,N=Gt[a]+E+S,B=Gt[a]+E-S),G=(i+t)/2,$=(o+n)/2,I=Math.sqrt(b(M-G,N-$)),D=Math.sqrt(b(L-G,L-G)),U=G-(M*D+L*I)/(I+D),j=$-(N*D+B*I)/(I+D),q=Math.sqrt(b(U,j)),U/=q,j/=q,k[e]=G-t-2*((G-t)*U+($-n)*j)*U+G,P[e]=$-n-2*((G-t)*U+($-n)*j)*j+$,F=R[e],V=O[e],R[e]=F-2*(F*U+V*j)*U,O[e]=V-2*(F*U+V*j)*j)))}},ti=function(e,t,n){if(!(1>fr)){var r,i,o,a,s,l,u,c,d,h,p,f,m,g,v,x;for(r=C[e],v=k[e],x=P[e],g=0;fr>g;g++)on[g]&&(s=y(t-Zt[g],n-Qt[g],v-Zt[g],x-Qt[g]),l=y(t-en[g],n-tn[g],v-en[g],x-tn[g]),0>s*l&&(i=Math.sqrt(b(Zt[g]-en[g],Qt[g]-tn[g])),o=y(en[g]-t,tn[g]-n,Zt[g]-t,Qt[g]-n),a=y(en[g]-v,tn[g]-x,Zt[g]-v,Qt[g]-x),(0>o&&a>-r*i||o>0&&r*i>a)&&o*s>0&&(u=(v+t)/2,c=(x+n)/2,d=tn[g]-Qt[g],h=-(en[g]-Zt[g]),p=Math.sqrt(b(d,h)),d/=p,h/=p,k[e]=u-t-2*((u-t)*d+(c-n)*h)*d+u,P[e]=c-n-2*((u-t)*d+(c-n)*h)*h+c,f=R[e],m=O[e],R[e]=f-2*(f*d+m*h)*d,O[e]=m-2*(f*d+m*h)*h)))}},ni=function(e,t){var n,r,i,o=B[e],a=B[t],s=k[t]-k[e],l=P[t]-P[e],u=b(s,l);kn&&u<xr[o][a]&&Sn.markNeighbors(e,t),rt&&rt[e]&&rt[e][t]||u<yr[o][a]&&(n=wr[o][a].forceOverDistanceFromSquaredDistance(u),r=n*s,i=n*l,N[e]+=r,I[e]+=i,N[t]-=r,I[t]-=i)},ri=function(){Yn&&(kn?(i.time("cell lists"),ii(),i.timeEnd("cell lists")):(i.time("neighbor list"),oi(),i.timeEnd("neighbor list")))},ii=function(){var e,t,n,r,i,o,a,s,l,u,c,d,h,p,f=En.getRowsNum(),m=En.getColsNum();for(e=0;f>e;e++)for(n=e*m,t=0;m>t;t++)for(r=n+t,i=En.getCell(r),p=En.getNeighboringCells(e,t),a=0,u=i.length;u>a;a++){for(l=i[a],s=0;a>s;s++)ni(l,i[s]);for(d=0,h=p.length;h>d;d++)for(o=p[d],s=0,c=o.length;c>s;s++)ni(l,o[s])}},oi=function(){var e,t,n,r,i=Sn.getList();for(e=0;or>e;e++)for(n=Sn.getStartIdxFor(e),r=Sn.getEndIdxFor(e);r>n;n++)t=i[n],ni(e,t)},ai=function(){if($n&&0!==Oi.length){var e,t,n,r,i,o,a,s,l,c,d,h,p;for(e=0,n=Oi.length;n>e;e++)for(d=Oi[e],c=L[d],p=rt&&rt[d],t=0;e>t;t++)h=Oi[t],p&&p[h]||(r=k[h]-k[d],i=P[h]-P[d],o=r*r+i*i,a=u.forceOverDistanceFromSquaredDistance(o,c,L[h],Un,jn),s=a*r,l=a*i,N[d]+=s,I[d]+=l,N[h]-=s,I[h]-=l)}},si=function(){if(v){var e,t;for(e=0;or>e;e++)t=v*D[e],N[e]+=-R[e]*t,I[e]+=-O[e]*t}},li=function(){if(!(1>lr)){var e,t,n,r,i,s,l,u,c,d,h,p;for(e=0;lr>e;e++)t=J[e],n=Z[e],r=k[n]-k[t],i=P[n]-P[t],s=r*r+i*i,l=Math.sqrt(s),u=et[e],c=Q[e],d=o.convert(u*(l-c),{from:a.EV_PER_NM,to:a.MW_FORCE_UNIT})/l,h=d*r,p=d*i,N[t]+=h,I[t]+=p,N[n]-=h,I[n]-=p}},ui=function(){if(!(1>dr)){var e,t,n,r,i,s,l,u,c,d,h,p,f,m,g,v,y,b,x,w,_,T,A;for(e=0;dr>e;e++)t=ut[e],n=ct[e],r=dt[e],m=ht[e],f=pt[e],i=k[t]-k[r],l=k[n]-k[r],s=P[t]-P[r],u=P[n]-P[r],c=i*i+s*s,d=l*l+u*u,h=Math.sqrt(c),p=Math.sqrt(d),v=(i*l+s*u)/(h*p),v>1?v=1:-1>v&&(v=-1),y=Math.sqrt(1-v*v),g=Math.acos(v),1e-4>y&&(y=1e-4),T=o.convert(f*(g-m)/(y*h),{from:a.EV_PER_NM,to:a.MW_FORCE_UNIT})/p,A=i*l+s*u,b=T*(l-A*i/c),x=T*(u-A*s/c),w=T*(i-A*l/d),_=T*(s-A*u/d),N[t]+=b,I[t]+=x,N[n]+=w,I[n]+=_,N[r]-=b+w,I[r]-=x+_}},ci=function(){if(!(1>cr)){var e,t,n,r,i,s,l,u,c,d;for(e=0;cr>e;e++)d=it[e],t=at[e]-k[d],n=st[e]-P[d],(0!==t||0!==n)&&(i=t*t+n*n,r=Math.sqrt(i),s=ot[e],l=o.convert(s*r,{from:a.EV_PER_NM,to:a.MW_FORCE_UNIT})/r,u=l*t,c=l*n,N[d]+=u,I[d]+=c)}},di=function(){if(!(1>gr)){var e,t,n,r,i,s,l,u,c,d;for(e=0;gr>e;e++)d=wn[e],t=_n[e]-k[d],n=Tn[e]-P[d],(0!==t||0!==n)&&(i=t*t+n*n,r=Math.sqrt(i),s=An[e],l=o.convert(s*r,{from:a.EV_PER_NM,to:a.MW_FORCE_UNIT})/r,u=l*t,c=l*n,N[d]+=u,I[d]+=c)}},hi=function(e){var t,n,r,i,o=0,a=0,s=0;for(r=0,i=e.length;i>r;r++)t=e[r],n=G[t],o+=k[t]*n,a+=P[t]*n,s+=n;return o/=s,a/=s,{x:o,y:a}},pi=function(){if(!(0===qn||0===Hn||2>or)){var t,n,r,i,o,a,s,l,u,c,d,h,p;for(d=0;or>d;d++)U[d]=0;for(i=6e-5*qn*Hn,d=0;or>d;d++)if(1!==U[d])for(t=e.getMoleculeAtoms(d),t.push(d),r=hi(t),h=0,p=t.length;p>h;h++)n=t[h],U[n]=1,0!==$[n]&&(o=k[n]-r.x,a=P[n]-r.y,s=Math.sqrt(o*o+a*a),s>0&&(c=$[n]*i,c>0&&Xn>s&&(c*=(1-zn)*s/Xn+zn),l=c*o/s,u=c*a/s,N[n]-=l,I[n]-=u))}},fi=function(){if(Zn){var e;for(e=0;or>e;e++)I[e]-=Zn}},mi=function(e,t,n){var r=Vt[e],i=Gt[e];return t>=r&&t<=r+$t[e]&&n>=i&&n<=i+Ut[e]},gi=function(e){var t=fn[e];return("N"===t||"E"===t?1:-1)*pn[e]},vi=function(){if(gn){var e,t,n,r,i,o;for(t=0;mr>t;t++)for(n=fn[t],r="N"===n||"S"===n,o=gi(t)/Un,i=mn[t],e=0;or>e;e++)(null==i||mi(i,k[e],P[e]))&&(r?I[e]+=o*L[e]/G[e]:N[e]+=o*L[e]/G[e])}},yi=function(){if(Wn){var e,t;for(e=0;or>e;e++)t=Math.min(1,2.2-P[e]),t>0&&(I[e]+=1e-4*t,N[e]-=3e-6)}},bi=function(){var e,t,r=s.cysteineElement;for(_r.length=0,t=0;or>t;t++)B[t]===r&&_r.push(t);for(t=0;lr>t;t++)B[J[t]]===r&&B[Z[t]]===r&&(e=_r.indexOf(J[t]),-1!==e&&n.remove(_r,e),e=_r.indexOf(Z[t]),-1!==e&&n.remove(_r,e))},xi=function(){var e,t;if(0!==or){for(e=0;or>e;e++)N[e]=I[e]=0;if(kn=Sn.shouldUpdate(k,P))for(En.clear(),Sn.clear(),e=0;or>e;e++)En.addToCell(e,k[e],P[e]),Sn.saveAtomPosition(e,k[e],P[e]);for(i.time("short-range forces"),ri(),i.timeEnd("short-range forces"),i.time("long-range forces"),ai(),i.timeEnd("long-range forces"),li(),ui(),ci(),di(),si(),pi(),e=0;or>e;e++)t=1/G[e],N[e]*=t,I[e]*=t;fi(),vi(),yi()}},wi=function(){var e,t;for(e=0;or>e;e++)t=G[e],R[e]+=.5*N[e]*T,E[e]=t*R[e],O[e]+=.5*I[e]*T,S[e]=t*O[e]},_i=function(){var e,t,n,r=100*Qn[0],i=100*Qn[1];for(n=0;or>n;n++){if(e=k[n],t=P[n],k[n]+=R[n]*T,P[n]+=O[n]*T,isNaN(k[n])||isNaN(P[n])||Math.abs(k[n])>r||Math.abs(P[n])>i)throw new Error("Model has diverged!");Zr(n),Qr(n,e,t,!0),ei(n,e,t),ti(n,e,t)}},Ti=function(){var e;for(e=0;or>e;e++)V[e]&&(R[e]=O[e]=N[e]=I[e]=0)},Ai=function(){var e;for(e=0;or>e;e++)M[e]=Math.sqrt(R[e]*R[e]+O[e]*O[e])},Ci=function(){var e,t,n,r,i,o,a,s;for(s=0;hr>s;s++)1/0!==At[s]&&(n=bt[s],r=xt[s],o=wt[s],a=_t[s],(n||r||o||a||Zn)&&(i=v*Tt[s],e=o-i*n,t=a-i*r-Zn,Ot[s]=mt[s],Mt[s]=gt[s],mt[s]+=n*T+.5*e*A,gt[s]+=r*T+.5*t*A,bt[s]+=e*T,xt[s]+=t*T,Jr(s)))},Ei=function(){var t,n,r,i,o,a,s,l;for(a=0;or>a;a++)U[a]=0;for(a=0;or>a;a++)if(1!==U[a]&&(t=e.getMoleculeAtoms(a),0!==t.length)){for(t.push(a),r=i=o=0,s=0,l=t.length;l>s;s++)n=t[s],U[n]=1,V[n]||(r+=R[n]*G[n],i+=O[n]*G[n],o+=G[n]);for(o=1/o,s=0,l=t.length;l>s;s++)n=t[s],V[n]||(R[n]-=r*o,O[n]-=i*o,E[n]=R[n]*G[n],S[n]=O[n]*G[n])}},Si=function(e,n){var r,i;if(null==e&&(e=t),Fn=jr(),0===Fn){for(i=0;or>i;i++)V[i]===!1&&(R[i]=.02*Math.random()-.01,O[i]=.02*Math.random()-.01);if(Fn=jr(),0===Fn)return}if(n||Kn&&Fn>0){for(r=Math.sqrt(e/Fn),i=0;or>i;i++)R[i]*=r,O[i]*=r,E[i]*=r,S[i]*=r;for(i=0;hr>i;i++)bt[i]*=r,xt[i]*=r;Fn=e}},ki=function(){var t,r,i,o,a,s,l,u;for(s=0,u=_r.length;u>s;s++)for(t=_r[s],l=s+1;u>l;l++)r=_r[l],i=k[t]-k[r],o=P[t]-P[r],a=i*i+o*o,.07>a&&(e.addRadialBond({atom1:t,atom2:r,length:Math.sqrt(a),strength:1e4,type:109}),n.remove(_r,s),n.remove(_r,l),u=_r.length,t=_r[s],l=s+1)},Pi=function(){var e;for(e=0;hr>e;e++)Et[e]&&(It[e]=0),kt[e]&&(Bt[e]=0),St[e]&&(Lt[e]=0),Ct[e]&&(Nt[e]=0)},Ri=function(e){var t,n;for(t=13888.89/e,n=0;hr>n;n++)Et[n]&&(It[n]*=t/vt[n]),kt[n]&&(Bt[n]*=t/vt[n]),St[n]&&(Lt[n]*=t/yt[n]),Ct[n]&&(Nt[n]*=t/yt[n])},Oi=[];return Oi.reset=function(){var e,t=0;for(e=0;or>e;e++)j.charge[e]&&(this[t++]=e);this.length=t},e={addPlugin:function(e){e.initialize&&e.initialize({atoms:j,elements:Y,radialBonds:nt}),Gn.registerPlugin(e)},useCoulombInteraction:function(e){$n=!!e},useLennardJonesInteraction:function(e){Yn=!!e},useThermostat:function(e){Kn=!!e},setVDWLinesRatio:function(e){"number"==typeof e&&0!==e&&(Jn=e)},setGravitationalField:function(e){Zn="number"==typeof e&&0!==e?e:!1},setTemperatureOfAtoms:function(t,n){var r,i,o,a,s,l,u,c,d,h=t.length;for(s=1e-4*(qr(t)||n),l=w(s,1),r=0;h>r;r++)i=t[r],V[i]||0!==R[i]||0!==O[i]||(o=Math.random()-.5,a=Math.random()-.5,c=Math.sqrt(2*l/G[i]/(o*o+a*a)),R[i]=o*c,O[i]=a*c);for(Fn=jr(),d=qr(t),u=Math.sqrt(n/d),r=0;h>r;r++)i=t[r],e.setAtomProperties(i,{vx:R[i]*u,vy:O[i]*u})},getTemperatureOfAtoms:function(e){return qr(e)},setTargetTemperature:function(e){_(e),t=e},setDielectricConstant:function(e){Un=e},setRealisticDielectricEffect:function(e){jn=e},setSolventForceType:function(e){qn=e},setDNAState:function(e){Wn=0===e.indexOf("translation:")},setSolventForceFactor:function(e){Hn=e},setAdditionalSolventForceMult:function(e){zn=e},setAdditionalSolventForceThreshold:function(e){Xn=e},setTime:function(e){ir=e},setDimensions:function(e){if(Vn)throw new Error("The molecular model's size has already been set, and cannot be reset.");er=e[0],tr=e[1],nr=e[2],rr=e[3],Qn=[nr-er,rr-tr],Vn=!0},getDimensions:function(){return[er,tr,nr,rr]},getLJCalculator:function(){return wr},setAtomProperties:function(t,n){var r,i,o,a=s.cysteineElement;if(void 0!==n.element){if(n.element<0||n.element>=ar)throw new Error("md2d: Unknown element "+n.element+", an atom can't be created.");if(B[t]===a&&n.element!==a)for(o=0;lr>o;o++)if((J[o]===t||Z[o]===t)&&109===tt[o]){e.removeRadialBond(o);break}sr[n.element]=!0,n.mass=q[n.element],n.radius=z[n.element],s.isAminoAcid(n.element)&&(i=s.getAminoAcidByElement(n.element),n.charge=i.charge,n.hydrophobicity=i.hydrophobicity)}!L[t]&&n.charge?Oi.push(t):L[t]&&0===n.charge&&Oi.splice(Oi.indexOf(t),1);for(r in n)n.hasOwnProperty(r)&&(j[r][t]=n[r]);E[t]=R[t]*G[t],S[t]=O[t]*G[t],M[t]=Math.sqrt(R[t]*R[t]+O[t]*O[t])},setRadialBondProperties:function(e,t){var n,r,i;r=J[e],i=Z[e],rt[r]&&rt[r][i]&&(rt[r][i]=!1),rt[i]&&rt[i][r]&&(rt[i][r]=!1);for(n in t)t.hasOwnProperty(n)&&(nt[n][e]=t[n]);r=J[e],i=Z[e],rt[r]||(rt[r]=[]),rt[r][i]=!0,rt[i]||(rt[i]=[]),rt[i][r]=!0},setAngularBondProperties:function(e,t){var n;for(n in t)t.hasOwnProperty(n)&&(ft[n][e]=t[n])},setRestraintProperties:function(e,t){var n;for(n in t)t.hasOwnProperty(n)&&(lt[n][e]=t[n])},setElementProperties:function(e,t){var n,r;if(null!=t.mass&&t.mass!==q[e])for(q[e]=t.mass,n=0;or>n;n++)B[n]===e&&(G[n]=t.mass);if(null!=t.sigma&&(H[e]=t.sigma,r=c.radius(t.sigma),z[e]!==r))for(z[e]=r,n=0;or>n;n++)B[n]===e&&(C[n]=r);for(null!=t.epsilon&&(W[e]=t.epsilon),null!=t.color&&(X[e]=t.color),n=0;ar>n;n++)Cr(e,n);kr(),Pr()},setPairwiseLJProperties:function(e,t){Cr(e,t),kr(),Pr()},setObstacleProperties:function(t,n){var r;if(!e.canPlaceObstacle(n.x,n.y,n.width,n.height,t))throw new Error("Obstacle can't be placed at "+n.x+", "+n.y);void 0!==n.x&&(n.xPrev=n.x),void 0!==n.y&&(n.yPrev=n.y),"string"==typeof n.mass&&(n.mass=parseFloat(n.mass));for(r in n)n.hasOwnProperty(r)&&(Dt[r][t]=n[r])},setShapeProperties:function(e,t){var n;for(n in t)t.hasOwnProperty(n)&&(Jt[n][e]=t[n])},setLineProperties:function(e,t){var n;for(n in t)t.hasOwnProperty(n)&&(hn[n][e]=t[n])},setElectricFieldProperties:function(e,t){var n;for(n in t)t.hasOwnProperty(n)&&(gn[n][e]=t[n])},addAtom:function(t){or+1>j.x.length&&(g.extendArrays(j,Math.round(1.5*or+10)),Or.atoms()),t.ax=t.ay=0,L[or]=0,e.setAtomProperties(or,t),or++,kr(),Pr()},removeAtom:function(t){var r,i,o,a,s,l;if(t>=or)throw new Error("Atom "+t+" doesn't exist, so it can't be removed.");for(r=0;lr>r;)J[r]===t||Z[r]===t?e.removeRadialBond(r):r++;for(r=Oi.indexOf(t),-1!==r&&n.remove(Oi,r),r=t;or>r;r++)for(o in j)j.hasOwnProperty(o)&&(j[o][r]=r===or-1?0:j[o][r+1]);for(or--,l=[Oi,J,Z,ut,ct,dt],a=0;a<l.length;a++)for(s=l[a],r=0,i=s.length;i>r;r++)s[r]>t&&s[r]--;Rr(),kr(),Pr(),Sn.invalidate(),xi()},addElement:function(e){var t;for(ar>=W.length&&(g.extendArrays(Y,ar+10),Or.elements()),q[ar]=e.mass,W[ar]=e.epsilon,H[ar]=e.sigma,z[ar]=c.radius(e.sigma),X[ar]=e.color,wr[ar]=[],yr[ar]=[],xr[ar]=[],t=0;ar>=t;t++)Cr(ar,t);ar++},addRadialBond:function(t){lr+1>J.length&&(g.extendArrays(nt,lr+10),Or.radialBonds()),lr++,e.setRadialBondProperties(lr-1,t),ur=!0},removeRadialBond:function(t){var n,r,i,o;if(t>=lr)throw new Error("Radial bond "+t+" doesn't exist, so it can't be removed.");for(i=J[t],o=Z[t],n=0;dr>n;)dt[n]===i||dt[n]===o?e.removeAngularBond(n):n++;for(n=t;lr>n;n++)for(r in nt)nt.hasOwnProperty(r)&&(nt[r][n]=n===lr-1?0:nt[r][n+1]);lr--,Rr(),ur=!0},addRestraint:function(t){cr+1>lt.atomIndex.length&&(g.extendArrays(lt,cr+10),Or.restraints()),cr++,e.setRestraintProperties(cr-1,t)},addAngularBond:function(t){dr+1>ft.atom1.length&&(g.extendArrays(ft,dr+10),Or.angularBonds()),dr++,e.setAngularBondProperties(dr-1,t)},removeAngularBond:function(e){var t,n;if(e>=dr)throw new Error("Angular bond "+e+" doesn't exist, so it can't be removed.");for(t=e;dr>t;t++)for(n in ft)ft.hasOwnProperty(n)&&(ft[n][t]=t===dr-1?0:ft[n][t+1]);dr--},addSpringForce:function(e,t,n,r){return gr+1>Cn[0].length&&(g.extendArrays(Cn,gr+1),Or.springForces()),wn[gr]=e,_n[gr]=t,Tn[gr]=n,An[gr]=r,gr++},updateSpringForce:function(e,t,n){_n[e]=t,Tn[e]=n},removeSpringForce:function(e){var t,n;if(e>=gr)throw new Error("Spring force "+e+" doesn't exist, so it can't be removed.");for(gr--,t=e;gr>t;t++)for(n=0;4>n;n++)Cn[n][t]=Cn[n][t+1]},springForceAtomIndex:function(e){return wn[e]},addObstacle:function(t){if(!e.canPlaceObstacle(t.x,t.y,t.width,t.height))throw new Error("Obstacle can't be placed at "+t.x+", "+t.y+".");hr+1>Dt.x.length&&(g.extendArrays(Dt,hr+1),Or.obstacles()),hr++,e.setObstacleProperties(hr-1,t)},removeObstacle:function(e){var t,n;if(e>=hr)throw new Error("Obstacle "+e+" doesn't exist, so it can't be removed.");for(hr--,t=e;hr>t;t++)for(n in Dt)Dt.hasOwnProperty(n)&&(Dt[n][t]=Dt[n][t+1]);g.extendArrays(Dt,hr),Or.obstacles()},addShape:function(t){pr+1>Jt.x.length&&(g.extendArrays(Jt,pr+1),Or.shapes()),pr++,e.setShapeProperties(pr-1,t)},removeShape:function(t){var n,r;if(t>=pr)throw new Error("Shape "+t+" doesn't exist, so it can't be removed.");for(n=0;mr>n;)mn[n]===t?e.removeElectricField(n):n++;for(pr--,n=t;pr>n;n++)for(r in Jt)Jt.hasOwnProperty(r)&&(Jt[r][n]=Jt[r][n+1]);for(n=0;mr>n;n++)mn[n]>t&&mn[n]--;g.extendArrays(Jt,pr),Or.shapes()},addLine:function(t){fr+1>hn.x1.length&&(g.extendArrays(hn,fr+1),Or.lines()),fr++,e.setLineProperties(fr-1,t)},removeLine:function(e){var t,n;if(e>=fr)throw new Error("Line "+e+" doesn't exist, so it can't be removed.");for(t=e;pr>t;t++)for(n in hn)hn.hasOwnProperty(n)&&(hn[n][t]=hn[n][t+1]);g.extendArrays(hn,pr),Or.lines()},addElectricField:function(t){mr+1>gn.intensity.length&&(g.extendArrays(gn,mr+1),Or.electricFields()),mr++,e.setElectricFieldProperties(mr-1,t)},removeElectricField:function(e){var t,n;if(e>=mr)throw new Error("Electric field "+e+" doesn't exist, so it can't be removed.");for(mr--,t=e;mr>t;t++)for(n in gn)gn.hasOwnProperty(n)&&(gn[n][t]=gn[n][t+1]);g.extendArrays(gn,mr),Or.electricFields()},atomInBounds:function(e,t,n){var r,i=C[n];if(i>e||e>Qn[0]-i||i>t||t>Qn[1]-i)return!1;for(r=0;hr>r;r++)if(e>mt[r]-i&&e<mt[r]+vt[r]+i&&t>gt[r]-i&&t<gt[r]+yt[r]+i)return!1;return!0},canPlaceAtom:function(t,n,r,i){var o,a,s,l,u,c,d,h;if(!e.atomInBounds(n,r,i))return!1;for(h=0;hr>h;h++)if(l=mt[h],u=gt[h],c=l+vt[h],d=u+yt[h],n>l&&c>n&&r>u&&d>r)return!1;return"number"==typeof i&&(o=k[i],a=P[i],k[i]=P[i]=1/0),s=e.newPotentialCalculator(t,0,!1)(n,r),"number"==typeof i&&(k[i]=o,P[i]=a),0>=s},canPlaceObstacle:function(e,t,n,r,i){var o,a,s,l,u,c,d=e+n,h=t+r;if(0>e||d>Qn[0]||0>t||h>Qn[0])return!1;for(c=0;or>c;c++)if(u=C[c],k[c]>e-u&&k[c]<d+u&&P[c]>t-u&&P[c]<h+u)return!1;for(c=0;hr>c;c++)if((void 0===i||i!==c)&&(o=mt[c],a=gt[c],s=o+vt[c],l=a+yt[c],d>o&&s>e&&h>a&&l>t))return!1;return!0},setupAtomsRandomly:function(t){var n,r,i,o,a,s,u,c,d=t.temperature||100,h=Math.floor(Math.sqrt(or)),p=Math.ceil(or/h);for(_(d),a=Qn[0]/(1+p),o=Qn[1]/(1+h),n=-1,r=1;h>=r;r++)for(i=1;p>=i&&(n++,n!==or);i++)s=l.normal(1,.25),u=2*Math.random()*Math.PI,c={element:Math.floor(Math.random()*t.userElements),x:i*a,y:r*o,vx:s*Math.cos(u),vy:s*Math.sin(u),charge:2*(n%2)-1},e.setAtomProperties(n,c);Kr(),zr(),Si(d,!0)},getVdwPairsArray:function(){var e,t,n,r,i,o,a,s,l,u,c,d,h,p,f,m=Jn*Jn;for(yn=0,e=0;or>e;e++)for(d=B[e],s=H[d],l=H[d],o=k[e],a=P[e],t=e+1;or>t;t++)0!==lr&&rt[e]&&rt[e][t]||(h=B[t],u=H[h],c=H[h],L[e]*L[t]<=0&&(n=k[t]-o,r=P[t]-a,i=n*n+r*r,p=.5*(s+u),p*=p,f=l*c,p*m>i&&f>0&&(yn+1>vn.atom1.length&&(g.extendArrays(vn,2*(yn+1)),Or.vdwPairs()),bn[yn]=e,xn[yn]=t,yn++)));return vn.count=yn,vn},integrate:function(e,t){var n,r,i=ir;for(void 0===e&&(e=100),void 0===t&&(t=1),T=t,A=T*T,ur=!1,bi(),0===ir&&xi(),n=Math.floor(e/T),Pi(),r=1;n>=r;r++)ir=i+r*T,wi(),_i(),xi(),Ti(),wi(),Ai(),Ci(),0===qn||Wn||Ei(),Gn.callPluginFunction("performActionWithinIntegrationLoop",[Sn,T,ir]),Si();Ri(e),ki()},updateParticlesAccelerations:xi,minimizeEnergy:function(){var e,t,n,r,i,o,a=.001,s=1e-4,l=3e3;for(xi(),Ti(),e=0,i=0;or>i;i++)e<Math.abs(N[i])&&(e=Math.abs(N[i])),e<Math.abs(I[i])&&(e=Math.abs(I[i]));for(o=0;e>s&&l>o;){for(o++,t=a/e,i=0;or>i;i++)n=k[i],r=P[i],k[i]+=N[i]*t,P[i]+=I[i]*t,Zr(i),Qr(i,n,r,!1),ei(i,n,r),ti(i,n,r);for(xi(),Ti(),e=0,i=0;or>i;i++)e<Math.abs(N[i])&&(e=Math.abs(N[i])),e<Math.abs(I[i])&&(e=Math.abs(I[i]))}},getRadialBondsForAtom:function(e){var t,n,r,i=[];for(t=0;lr>t;t++)n=J[t],r=Z[t],(e===n||e===r)&&i.push(t);return i},getAngularBondsForAtom:function(e){var t,n,r,i,o=[];for(t=0;dr>t;t++)n=ut[t],r=ct[t],i=dt[t],(e===n||e===r||e===i)&&o.push(t);return o},getTotalMass:function(){var e,t=0;for(e=0;or>e;e++)t+=G[e];return t},getRadiusOfElement:function(e){return z[e]},getNumberOfAtoms:function(){return or},getNumberOfElements:function(){return ar},getNumberOfObstacles:function(){return hr},getNumberOfShapes:function(){return pr},getNumberOfLines:function(){return fr},getNumberOfRadialBonds:function(){return lr},getNumberOfAngularBonds:function(){return dr},getNumberOfRestraints:function(){return cr},getNumberOfSpringForces:function(){return gr},getNumberOfElectricFields:function(){return mr},computeOutputState:function(e){var t,n,r,i,s,l,c,d,h,p,f,m,g,v,y,b,w,_,T,A,C,E,S,M,N,I,D;for(D=0,I=0,t=0;or>t;t++){for(Zn&&(N=G[t]*Zn*P[t],D+=o.convert(N,{from:a.MW_ENERGY_UNIT,to:a.EV})),r=0;mr>r;r++)if(w=mn[r],null==w||mi(w,k[t],P[t])){switch(M=L[t]*gi(r),fn[r]){case"N":case"S":M*=(null!=w?Gt[w]:tr)-P[t];break;case"W":case"E":M*=(null!=w?Vt[w]:er)-k[t]}D+=o.convert(M,{from:a.MW_ENERGY_UNIT,to:a.EV})}for(I+=.5*G[t]*(R[t]*R[t]+O[t]*O[t]),n=t+1;or>n;n++)h=k[n]-k[t],p=P[n]-P[t],_=h*h+p*p,Yn&&(D-=wr[B[t]][B[n]].potentialFromSquaredDistance(_)),$n&&Oi.length>0&&(D+=u.potential(Math.sqrt(_),L[t],L[n],Un,jn))}for(t=0;lr>t;t++)i=J[t],s=Z[t],c=B[i],d=B[s],h=k[s]-k[i],p=P[s]-P[i],_=h*h+p*p,C=et[t],E=Math.sqrt(_)-Q[t],D+=.5*C*E*E,Yn&&(D+=wr[c][d].potentialFromSquaredDistance(_)),$n&&L[i]&&L[s]&&(D-=u.potential(Math.sqrt(_),L[i],L[s],Un,jn));for(t=0;dr>t;t++)i=ut[t],s=ct[t],l=dt[t],f=k[i]-k[l],g=k[s]-k[l],m=P[i]-P[l],v=P[s]-P[l],T=Math.sqrt(f*f+m*m),A=Math.sqrt(g*g+v*v),y=(f*g+m*v)/(T*A),y>1?y=1:-1>y&&(y=-1),b=Math.acos(y),S=b-ht[t],D+=.5*pt[t]*S*S;for(t=0;cr>t;t++)i=it[t],c=B[i],h=at[t]-k[i],p=st[t]-P[i],_=h*h+p*p,C=ot[t],E=Math.sqrt(_),D+=.5*C*E*E;for(t=0;hr>t;t++)1/0!==At[t]&&(Zn&&(N=At[t]*Zn*gt[t],D+=o.convert(N,{from:a.MW_ENERGY_UNIT,to:a.EV})),I+=.5*At[t]*(bt[t]*bt[t]+xt[t]*xt[t]));Fn=x(I,or),e.time=ir,e.PE=D,e.KE=o.convert(I,{from:a.MW_ENERGY_UNIT,to:a.EV}),e.temperature=Fn,e.pCM=[On,Mn],e.CM=[Pn,Rn],e.vCM=[Nn,In],e.omega_CM=Dn,e.atoms=j,e.radialBonds=nt,Gn.callPluginFunction("processOutputState",[e])},newPotentialCalculator:function(e,t,n){return function(r,i){var s,l,c,d,h,p,f,m,g,v=0,y=0,b=0,x=wr[e];for(c=0;or>c;c++)d=r-k[c],h=i-P[c],p=d*d+h*h,m=0,Yn&&(g=x[B[c]],v+=-g.potentialFromSquaredDistance(p,e,B[c]),n&&(m+=g.forceOverDistanceFromSquaredDistance(p))),$n&&Oi.length>0&&t&&(f=Math.sqrt(p),v+=-u.potential(f,t,L[c],Un,jn),n&&(m+=u.forceOverDistanceFromSquaredDistance(p,t,L[c],Un,jn))),m&&(y+=m*d,b+=m*h);return n?(s=o.convert(y,{from:a.MW_FORCE_UNIT,to:a.EV_PER_NM}),l=o.convert(b,{from:a.MW_FORCE_UNIT,to:a.EV_PER_NM}),[v,[s,l]]):v}},findMinimumPELocation:function(t,n,r,i){var o=e.newPotentialCalculator(t,i,!0),a=z[t],s=l.minimize(o,[n,r],{bounds:[[a,Qn[0]-a],[a,Qn[1]-a]]});return s.error?!1:s[1]},findMinimumPESquaredLocation:function(t,n,r,i){var o=e.newPotentialCalculator(t,i,!0),a=function(e,t){var n,r,i;return n=o(e,t),r=n[0],i=n[1],i[0]*=2*r,i[1]*=2*r,[r*r,i]},s=z[t],u=l.minimize(a,[n,r],{bounds:[[s,Qn[0]-s],[s,Qn[1]-s]],stopval:1e-4,precision:1e-6});return u.error?!1:u[1]},atomsInMolecule:[],depth:0,getMoleculeAtoms:function(e){this.atomsInMolecule.push(e);var t,n,r,i=[],o=this.getBondedAtoms(e),a=this.depth;for(this.depth++,t=0,n=o.length;n>t;t++)r=o[t],~this.atomsInMolecule.indexOf(r)||(i=i.concat(this.getMoleculeAtoms(r)));return 0===a?(this.depth=0,this.atomsInMolecule=[]):i.push(e),i},getBondedAtoms:function(e){var t,n,r=[];if(nt)for(t=0,n=lr;n>t;t++)J[t]===e&&r.push(Z[t]),Z[t]===e&&r.push(J[t]);return r},getCoulombForceAt:function(e,t,n){if(n=n||{},!$n||0===Oi.length)return n.fx=n.fy=0,n;var r,i,s,l,c,d,h,p,f,m,g=0,v=0;for(r=0,i=Oi.length;i>r;r++)p=Oi[r],h=L[p],s=k[p]-e,l=P[p]-t,c=s*s+l*l,d=u.forceOverDistanceFromSquaredDistance(c,1,h,Un,jn),g+=d*s,v+=d*l;for(r=0;mr>r;r++)f=mn[r],(null==f||mi(f,e,t))&&(m=fn[r],"N"===m||"S"===m?v+=gi(r):g+=gi(r));return n.fx=o.convert(g,{from:a.MW_FORCE_UNIT,to:a.EV_PER_NM}),n.fy=o.convert(v,{from:a.MW_FORCE_UNIT,to:a.EV_PER_NM}),n},getAtomKineticEnergy:function(e){var t=.5*G[e]*(R[e]*R[e]+O[e]*O[e]);return o.convert(t,{from:a.MW_ENERGY_UNIT,to:a.EV})},getAtomNeighbors:function(e){var t,n,r=[],i=Sn.getList();for(t=Sn.getStartIdxFor(e),n=Sn.getEndIdxFor(e);n>t;t++)r.push(i[t]);return r},getNeighborList:function(){return Sn},setViscosity:function(e){v=e},get ljCalculator(){return wr},get radialBondsChanged(){return ur},atomsBonded:function(e,t){return!!(rt&&rt[e]&&rt[e][t])},getState:function(){var e=[new h(Y),new h(j),new h(Dt),new h(Jt),new h(hn),new h(nt),new h(ft),new h(lt),new h(Cn),K,{clone:function(){return{time:ir,N:or,N_elements:ar,N_obstacles:hr,N_shapes:pr,N_lines:fr,N_radialBonds:lr,N_angularBonds:dr,N_restraints:cr,N_springForces:gr}},restore:function(e){ir=e.time,or=e.N,ar=e.N_elements,pr=e.N_shapes,fr=e.N_lines,lr=e.N_radialBonds,dr=e.N_angularBonds,cr=e.N_restraints,gr=e.N_springForces,Sn.invalidate(),Oi.reset()
}}];return Gn.callPluginFunction("getState",[],function(t){e=e.concat(t)}),e},callPluginAccessor:function(e,t){var n;return t=t||[],Gn.callPluginFunction(e,t,function(e){n=e}),n}},Tr(),e.pairwiseLJProperties=K,e}}),define("models/md2d/models/unit-definitions/md2d",[],function(){return{name:"md2d",translated:!1,units:{length:{name:"nanometer",pluralName:"nanometers",symbol:"nm"},mass:{name:"atomic mass unit",pluralName:"atomic mass units",symbol:"amu"},time:{name:"femtosecond",pluralName:"femtoseconds",symbol:"fs",displayValue:{unitsPerBaseUnit:.001,pluralName:"picoseconds",name:"picosecond",symbol:"ps"}},inverseTime:{name:"1/femtosecond",pluralName:"1/femtoseconds",symbol:"1/fs"},velocity:{name:"nanometer per femtosecond",pluralName:"nanometers per second",symbol:"nm/s"},acceleration:{name:"nanometer per femtosecond squared",pluralName:"nanometers per femtosecond squared",symbol:"nm/fs"},momentum:{name:"amu nanometer per femtosecond",pluralName:"amu nanometers per femtosecond",symbol:"amunm/fs"},force:{name:"amu nanometer per femtosecond squared",pluralName:"amu nanometers per femtosecond squared",symbol:"amunm/fs"},energy:{name:"electron volt",pluralName:"electron volts",symbol:"eV"},dampingCoefficient:{name:"amu per femtosecond",pluralName:"amu per femtoseconds",symbol:"amu/fs"},stiffness:{name:"electron volt per nanometer squared",pluralName:"electron volts per nanometer squared",symbol:"eV/nm"},rotationalStiffness:{name:"electron volt per radian",pluralName:"electron volts per radian",symbol:"eV/rad"},charge:{name:"elementary charge",pluralName:"elementary charges",symbol:"e"},temperature:{name:"Kelvin",pluralName:"Kelvin",symbol:"K"},pressure:{name:"bar",pluralName:"bar",symbol:"bar"},angle:{name:"radian",pluralName:"radians",symbol:"rad"}}}}),define("models/md2d/models/unit-definitions/mks",[],function(){return{name:"mks",translated:!0,units:{length:{name:"meter",pluralName:"meters",symbol:"m",representationInMD2DUnits:1,valueInSIUnits:1},mass:{name:"kilogram",pluralName:"kilograms",symbol:"kg",representationInMD2DUnits:1,valueInSIUnits:1},time:{name:"second",pluralName:"seconds",symbol:"s",representationInMD2DUnits:1e4,valueInSIUnits:1},inverseTime:{name:"1/second",pluralName:"1/seconds",symbol:"1/s",valueInSIUnits:1},velocity:{name:"meter per second",pluralName:"meters per second",symbol:"m/s",valueInSIUnits:1},acceleration:{name:"meter per second squared",pluralName:"meters per second squared",symbol:"m/s",valueInSIUnits:1},force:{name:"Newton",pluralName:"Newtons",symbol:"N",valueInSIUnits:1},energy:{name:"Joule",pluralName:"Joules",symbol:"J",valueInSIUnits:1},dampingCoefficient:{name:"Newton second per meter",pluralName:"Newton seconds per meter",symbol:"Ns/m",valueInSIUnits:1},stiffness:{name:"Newton per meter",pluralName:"Newtons per meter",symbol:"N/m",valueInSIUnits:1},rotationalStiffness:{name:"Newton-meter per radian",pluralName:"Newton-meters per radian",symbol:"Nm/rad",valueInSIUnits:1},charge:{name:"Coulomb",pluralName:"Coulombs",symbol:"C",valueInSIUnits:1}}}}),define("models/md2d/models/unit-definitions/index",["require","models/md2d/models/unit-definitions/md2d","models/md2d/models/unit-definitions/mks","underscore"],function(e){var t={md2d:e("models/md2d/models/unit-definitions/md2d"),mks:e("models/md2d/models/unit-definitions/mks")},n=e("underscore");return{get:function(e){var r;return"md2d"===e?t.md2d:(r=n.extend({},t[e]),r.units=n.extend({},t.md2d.units,t[e].units),r)}}}),define("models/md2d/models/units-translation",["require","underscore","models/md2d/models/engine/constants/index","models/md2d/models/engine/potentials/coulomb"],function(e){var t=e("underscore"),n=e("models/md2d/models/engine/constants/index"),r=e("models/md2d/models/engine/potentials/coulomb"),i=n.COULOMB_CONSTANT.as(n.unit.METERS_PER_FARAD),o=["length","mass","time"];return function(e){var a,s={},l={};return t.each(o,function(t){var n=e.units[t];s[t]=n.valueInSIUnits/n.representationInMD2DUnits}),s.inverseTime=1/s.time,s.velocity=s.length/s.time,s.acceleration=s.velocity/s.time,s.force=s.mass*s.acceleration,s.energy=n.ratio(n.unit.MW_ENERGY_UNIT,{per:n.unit.EV}),s.energy*=s.force*s.length,s.dampingCoefficient=s.force/s.velocity,s.stiffness=s.energy/s.length/s.length,s.rotationalStiffness=s.energy/s.length,a=r.force(1,-1,1,1),s.charge=Math.sqrt(a*s.force*s.length*s.length/i),t.each(t.keys(s),function(t){l[t]=s[t]/e.units[t].valueInSIUnits}),{translateToModelUnits:function(e,t){return null==l[t]?e:e/l[t]},translateFromModelUnits:function(e,t){return null==l[t]?e:e*l[t]}}}}),function(){define("cs!models/md2d/models/solvent",["require"],function(){var e,t;return t={vacuum:{forceType:0,dielectricConstant:1,color:"#eee"},oil:{forceType:-1,dielectricConstant:10,color:"#f5f1dd"},water:{forceType:1,dielectricConstant:80,color:"#B8EBF0"}},e=function(){function e(e){var n,r,i;if(this.type=e,r=t[this.type],null==r)throw new Error("Solvent: unknown type. Use 'vacuum', 'oil' or 'water'.");for(n in r)i=r[n],this[n]=i}return e}()})}.call(this),define("models/md2d/views/nucleotide-paths",[],function(){return{outline:{A:"M20.7,0.4l-0.075-0.075C20.672,0.273,20.73,0.231,20.8,0.2             c0.122-0.049,0.247-0.058,0.375-0.025c0.031,0.002,0.064,0.011,0.1,0.025c0.151,0.054,0.26,0.154,0.325,0.3l6.35,14.15             c0.026,0.065,0.043,0.132,0.05,0.2c0.092,0.104,0.142,0.229,0.15,0.375c0.01,0.163-0.041,0.304-0.15,0.425l-9.025,9.85             c-1.65,1.667-3.292,3.55-4.925,5.65L0.2,15.65c-0.11-0.121-0.16-0.262-0.15-0.425c0.008-0.146,0.058-0.271,0.15-0.375             c0.005-0.068,0.021-0.134,0.05-0.2L6.6,0.5c0.074-0.146,0.19-0.246,0.35-0.3c0.151-0.064,0.301-0.064,0.45,0             c0.038,0.019,0.071,0.043,0.1,0.075C7.593,0.339,7.66,0.431,7.7,0.55c0.047,0.112-0.012,0.154-0.175,0.125             C7.461,0.656,7.386,0.63,7.3,0.6L1.65,15.125l12.4,13.625l12.6-13.725L20.7,0.4z",C:"M12.45,0c2.167,0.5,4.066,1.95,5.7,4.35             c2.033,2.967,3.05,6.533,3.05,10.7c0,3.8-0.867,7.117-2.6,9.95c-0.067,0.133-0.167,0.217-0.3,0.25c-0.133,0.067-0.267,0.067-0.4,0             c-0.133-0.033-0.233-0.117-0.3-0.25c-0.133-0.233-0.283-0.45-0.45-0.65V24.3c-1.8-2.667-3.983-4-6.55-4             c-2.567,0.034-4.767,1.383-6.6,4.05c-0.167,0.2-0.3,0.417-0.4,0.65c-0.1,0.133-0.217,0.217-0.35,0.25             c-0.133,0.067-0.267,0.067-0.4,0c-0.133-0.033-0.233-0.117-0.3-0.25C0.85,22.167,0,18.85,0,15.05c0-4.167,1-7.733,3-10.7             C4.633,1.95,6.55,0.5,8.75,0H12.45z M4,5.05V5C3.991,5.016,3.982,5.033,3.975,5.05C2.289,7.935,1.431,11.126,1.4,14.625             c-0.03,3.519,0.536,6.477,1.7,8.875c2.066-3.39,4.566-5.064,7.5-5.025c2.933,0.04,5.433,1.731,7.5,5.075             c1.088-2.518,1.605-5.559,1.55-9.125c-0.055-3.565-0.888-6.69-2.5-9.375V5c-1.8-2.397-3.983-3.589-6.55-3.575             C8.033,1.439,5.833,2.647,4,5.05z",G:"M8.75,0h3.675c2.191,0.504,4.1,1.963,5.725,4.375V4.35             c2.035,2.963,3.052,6.53,3.05,10.7c0.001,4.17-1.015,7.737-3.05,10.7v-0.025c-2.066,3.065-4.583,4.59-7.55,4.575             c-2.966,0.023-5.5-1.494-7.6-4.55v-0.025C0.999,22.77-0.001,19.211,0,15.05c-0.001-4.161,0.999-7.72,3-10.675V4.35             C4.647,1.953,6.564,0.503,8.75,0z M17.15,25.05c1.754-2.938,2.621-6.354,2.6-10.25c-0.022-3.895-0.889-7.145-2.6-9.75V5.025             c-1.8-2.269-3.984-3.402-6.55-3.4C8.033,1.63,5.833,2.771,4,5.05V5.025c-1.646,2.778-2.496,6.12-2.55,10.025             C1.396,18.955,2.246,22.297,4,25.075V25.05c1.583,2.593,3.667,3.985,6.25,4.175c2.583,0.189,4.883-1.194,6.9-4.15V25.05z",T:"M7.45,0.2H7.9C7.794,0.442,7.677,0.709,7.55,1             C6.388,3.721,4.504,8.396,1.9,15.025l6.9,8.35l1.025-1.35c1.258-1.424,2.55-2.816,3.875-4.175l0.025-0.025             c0.148-0.186,0.314-0.336,0.5-0.45c0.046-0.028,0.096-0.036,0.15-0.025c0.059,0.007,0.109,0.032,0.15,0.075l5.325,5.95l6.95-8.35             C24.252,8.584,22.369,3.909,21.15,1c-0.127-0.284-0.243-0.551-0.35-0.8h0.6h0.575c0.041,0.045,0.075,0.095,0.1,0.15l6.35,14.15             c0.028,0.066,0.053,0.133,0.075,0.2c0.087,0.129,0.137,0.279,0.15,0.45c0.01,0.238-0.065,0.447-0.225,0.625l-8.2,8.95             c-0.102,0.12-0.227,0.204-0.375,0.25c-0.167,0.043-0.334,0.043-0.5,0c-0.147-0.046-0.272-0.129-0.375-0.25l-4.675-5.1l-4.625,5.1             c-0.101,0.121-0.226,0.204-0.375,0.25c-0.167,0.043-0.334,0.043-0.5,0c-0.147-0.046-0.272-0.129-0.375-0.25l-8.15-8.95             c-0.16-0.178-0.235-0.387-0.225-0.625c0.014-0.168,0.063-0.318,0.15-0.45c0.019-0.066,0.044-0.133,0.075-0.2l6.35-14.15V0.325             C6.649,0.28,6.674,0.238,6.7,0.2H7.45z",U:"M20.8,0.2h0.6h0.575c0.041,0.045,0.075,0.095,0.1,0.15             l6.35,14.15c0.028,0.066,0.053,0.133,0.075,0.2c0.087,0.129,0.137,0.279,0.15,0.45c0.01,0.238-0.065,0.447-0.225,0.625l-8.2,8.95             c-0.102,0.12-0.227,0.204-0.375,0.25c-0.167,0.043-0.334,0.043-0.5,0c-0.147-0.046-0.272-0.129-0.375-0.25l-4.675-5.1l-4.625,5.1             c-0.101,0.121-0.226,0.204-0.375,0.25c-0.167,0.043-0.334,0.043-0.5,0c-0.147-0.046-0.272-0.129-0.375-0.25l-8.15-8.95             c-0.16-0.178-0.235-0.387-0.225-0.625c0.014-0.168,0.063-0.318,0.15-0.45c0.019-0.066,0.044-0.133,0.075-0.2l6.35-14.15V0.325             C6.649,0.28,6.674,0.238,6.7,0.2h0.75H7.9C7.794,0.442,7.677,0.709,7.55,1C6.388,3.721,4.504,8.396,1.9,15.025l6.9,8.35             l1.025-1.35c1.258-1.424,2.55-2.816,3.875-4.175l0.025-0.025c0.148-0.186,0.314-0.336,0.5-0.45             c0.046-0.028,0.096-0.036,0.15-0.025c0.059,0.007,0.109,0.032,0.15,0.075l5.325,5.95l6.95-8.35C24.252,8.584,22.369,3.909,21.15,1             C21.023,0.716,20.907,0.449,20.8,0.2z"},interior:{A:"M21.175,0.175C21.046,0.143,20.921,0.151,20.8,0.2             c-0.069,0.031-0.128,0.073-0.175,0.125c-0.055,0.054-0.097,0.121-0.125,0.2c-0.063,0.16,0.003,0.118,0.2-0.125l5.95,14.625             L14.05,28.75L1.65,15.125L7.3,0.6c0.086,0.03,0.161,0.056,0.225,0.075C7.688,0.704,7.747,0.662,7.7,0.55             C7.66,0.431,7.593,0.339,7.5,0.275L7.6,0.2c4.8-0.067,7.283-0.1,7.45-0.1l6.1,0.05L21.175,0.175z",C:"M3.975,5.05H4c1.833-2.402,4.033-3.611,6.6-3.625             C13.167,1.411,15.35,2.603,17.15,5v0.05c1.612,2.685,2.445,5.81,2.5,9.375c0.055,3.566-0.461,6.607-1.55,9.125             c-2.067-3.344-4.567-5.035-7.5-5.075c-2.934-0.04-5.434,1.635-7.5,5.025c-1.164-2.398-1.73-5.356-1.7-8.875             C1.431,11.126,2.289,7.935,3.975,5.05z",G:"M17.15,25.05v0.025c-2.017,2.956-4.317,4.339-6.9,4.15             C7.667,29.035,5.583,27.643,4,25.05v0.025c-1.754-2.778-2.604-6.12-2.55-10.025C1.504,11.145,2.354,7.803,4,5.025V5.05             c1.833-2.278,4.033-3.42,6.6-3.425c2.566-0.002,4.75,1.131,6.55,3.4V5.05c1.711,2.605,2.578,5.855,2.6,9.75             C19.771,18.695,18.904,22.112,17.15,25.05z",T:"M21.4,0.2h-0.6c0.107,0.249,0.223,0.516,0.35,0.8             c1.219,2.909,3.103,7.584,5.65,14.025l-6.95,8.35l-5.325-5.95c-0.041-0.042-0.091-0.067-0.15-0.075             c-0.054-0.011-0.104-0.003-0.15,0.025c-0.186,0.114-0.352,0.264-0.5,0.45L13.7,17.85c-1.325,1.358-2.617,2.75-3.875,4.175             L8.8,23.375l-6.9-8.35C4.504,8.396,6.388,3.721,7.55,1C7.677,0.709,7.794,0.442,7.9,0.2H7.45c0.133-0.067,0.333-0.1,0.6-0.1             c0.406,0,1.606-0.008,3.6-0.025l-1.375,0.05C17.28,0.048,20.955,0.056,21.3,0.15C21.334,0.164,21.368,0.181,21.4,0.2z",U:"M7.9,0.2l0.15-0.1c0.406,0,1.606-0.008,3.6-0.025l-1.375,0.05             c6.009-0.066,9.568-0.066,10.675,0L20.8,0.2c0.107,0.249,0.223,0.516,0.35,0.8c1.219,2.909,3.103,7.584,5.65,14.025l-6.95,8.35             l-5.325-5.95c-0.041-0.042-0.091-0.067-0.15-0.075c-0.054-0.011-0.104-0.003-0.15,0.025c-0.186,0.114-0.352,0.264-0.5,0.45             L13.7,17.85c-1.325,1.358-2.617,2.75-3.875,4.175L8.8,23.375l-6.9-8.35C4.504,8.396,6.388,3.721,7.55,1             C7.677,0.709,7.794,0.442,7.9,0.2z"},letter:{A:{1:"M12.85,12.55h2.6l-1.3-3.95L12.85,12.55z M13,6.25h2.4l3.55,10.1               h-2.3L16,14.3h-3.7l-0.7,2.05H9.4L13,6.25z",2:"M18.7,5.95l-3.55,10.1h-2.4l-3.6-10.1h2.2L12.05,8h3.7l0.65-2.05               H18.7z M12.6,9.75l1.3,3.95l1.3-3.95H12.6z"},C:{1:"M10.45,6.4c1.667,0,2.883,0.55,3.65,1.65               c0.433,0.633,0.667,1.267,0.7,1.9h-2.1c-0.133-0.5-0.3-0.867-0.5-1.1c-0.4-0.434-0.967-0.65-1.7-0.65S9.183,8.5,8.75,9.1               C8.317,9.733,8.1,10.617,8.1,11.75c0,1.1,0.217,1.933,0.65,2.5c0.467,0.567,1.05,0.85,1.75,0.85c0.733,0,1.283-0.233,1.65-0.7               c0.233-0.267,0.417-0.667,0.55-1.2h2.05c-0.167,1.1-0.617,2-1.35,2.7c-0.733,0.7-1.683,1.05-2.85,1.05               c-1.433,0-2.566-0.467-3.4-1.4c-0.8-0.933-1.2-2.216-1.2-3.85c0-1.767,0.466-3.117,1.4-4.05C8.15,6.817,9.183,6.4,10.45,6.4z",2:"M15,12.35c-0.033,0.633-0.267,1.267-0.7,1.9               c-0.767,1.1-1.983,1.65-3.65,1.65c-1.267,0-2.3-0.417-3.1-1.25c-0.933-0.933-1.4-2.283-1.4-4.05c0-1.633,0.4-2.917,1.2-3.85               c0.833-0.933,1.967-1.4,3.4-1.4c1.167,0,2.117,0.35,2.85,1.05c0.733,0.7,1.183,1.6,1.35,2.7H12.9               c-0.133-0.533-0.316-0.934-0.55-1.2c-0.367-0.467-0.917-0.7-1.65-0.7c-0.7,0-1.284,0.283-1.75,0.85               c-0.434,0.567-0.65,1.4-0.65,2.5c0,1.133,0.217,2.017,0.65,2.65c0.433,0.6,1.017,0.9,1.75,0.9c0.733,0,1.3-0.217,1.7-0.65               c0.2-0.233,0.367-0.6,0.5-1.1H15z"},G:{1:"M14.8,10.8h-2.05c-0.167-0.667-0.567-1.133-1.2-1.4               c-0.333-0.167-0.716-0.25-1.15-0.25c-0.8,0-1.467,0.3-2,0.9c-0.5,0.633-0.75,1.567-0.75,2.8s0.283,2.1,0.85,2.6               c0.567,0.533,1.2,0.8,1.9,0.8c0.7,0,1.283-0.217,1.75-0.65c0.434-0.4,0.717-0.934,0.85-1.6h-2.35v-1.65h4.2v5.4h-1.4l-0.2-1.25               c-0.4,0.467-0.767,0.8-1.1,1C11.583,17.833,10.9,18,10.1,18c-1.333,0-2.434-0.467-3.3-1.4c-0.867-0.9-1.3-2.167-1.3-3.8               s0.45-2.933,1.35-3.9c0.867-1,2.05-1.5,3.55-1.5c1.267,0,2.3,0.333,3.1,1C14.267,9.033,14.7,9.833,14.8,10.8z",2:"M10.65,9.65c-0.7,0-1.333,0.267-1.9,0.8               c-0.567,0.5-0.85,1.367-0.85,2.6c0,1.233,0.25,2.167,0.75,2.8c0.533,0.6,1.2,0.9,2,0.9c0.434,0,0.817-0.083,1.15-0.25               c0.633-0.267,1.034-0.733,1.2-1.4h2.05c-0.1,0.967-0.533,1.767-1.3,2.4c-0.8,0.667-1.833,1-3.1,1c-1.5,0-2.683-0.5-3.55-1.5               c-0.9-0.967-1.35-2.267-1.35-3.9s0.433-2.9,1.3-3.8c0.867-0.933,1.967-1.4,3.3-1.4c0.8,0,1.483,0.167,2.05,0.5               c0.333,0.2,0.7,0.533,1.1,1l0.2-1.25h1.4v5.4h-4.2V11.9h2.35c-0.133-0.667-0.417-1.2-0.85-1.6C11.933,9.867,11.35,9.65,10.65,9.65z"},T:{1:"M10.3,5 L18.45,5 L18.45,6.8 L15.4,6.8 L15.4,15.1 L13.3,15.1               L13.3,6.8 L10.3,6.8z",2:"M10.2,14.65 L10.2,12.85 L13.2,12.85 L13.2,4.55 L15.3,4.55               L15.3,12.85 L18.35,12.85 L18.35,14.65z"},U:{1:"M10.15,10.8V4.6h2.15v6.2c0,0.7,0.083,1.217,0.25,1.55               c0.267,0.566,0.817,0.85,1.65,0.85c0.867,0,1.417-0.284,1.65-0.85c0.167-0.333,0.25-0.85,0.25-1.55V4.6h2.15v6.2               c0,1.067-0.167,1.9-0.5,2.5c-0.633,1.1-1.817,1.65-3.55,1.65c-1.733,0-2.917-0.55-3.55-1.65C10.317,12.7,10.15,11.867,10.15,10.8z",2:"M12.45,8.4v6.2H10.3V8.4c0-1.066,0.167-1.9,0.5-2.5               c0.633-1.1,1.817-1.65,3.55-1.65S17.267,4.8,17.9,5.9c0.333,0.6,0.5,1.434,0.5,2.5v6.2h-2.15V8.4c0-0.7-0.083-1.217-0.25-1.55               C15.767,6.283,15.217,6,14.35,6c-0.833,0-1.383,0.283-1.65,0.85C12.533,7.183,12.45,7.7,12.45,8.4z"}}}}),define("models/md2d/views/nucleotides",["require","models/md2d/views/nucleotide-paths"],function(e){function t(){function e(e){var n,r;e?(n=Math.random()>=.5?.25*Math.PI:1.25*Math.PI,n+=Math.random()*Math.PI*.5,r=6*t.HEIGHT,v=r*Math.cos(n),y=r*Math.sin(n)):v=y=0}function a(e){return"translate("+l(v+t.WIDTH*e.idx)+" "+l(y)+")"}function s(t){t.each(function(t,s){var v,y,b,x,w,_,T,A,C,E,S=d3.select(this),k=h?.9*o.BACKB:0,P=l(k+.5*o.A),R=l(k+.97*o.A),O="function"==typeof u?u(t,s):u;"string"==typeof O&&(O=O.split(""),O.forEach(function(e,t){O[t]={id:t,idx:t,type:e}})),v=S.selectAll(".nucleotide").data(O,function(e){return e.id}),y=v.enter(),b=v.exit(),e(f),y=y.append("g").attr({transform:a}).style({opacity:f?0:1}),x=y.append("g").attr({"class":"scale",transform:"scale(1, "+(1===c?1:-1)+")"}),x.append("path").attr("class","bonds").style({"stroke-width":l(.01),stroke:"#fff"}),_=x.append("g").classed("nucleo-shape",!0).classed("clickable-nucleo",function(e){return"c"===e.region&&m}).on("click",function(){}),m&&_.append("image").attr({"class":"glow",y:l(k-.17*i.G_GLOW),preserveAspectRatio:"none"}),T=_.append("svg").attr({y:l(k),preserveAspectRatio:"none"}),T.append("path").attr({"class":"outline","fill-rule":"evenodd","clip-rule":"evenodd"}),T.append("path").attr({"class":"interior","fill-rule":"evenodd","clip-rule":"evenodd"}),T.append("path").attr({"class":"letter","fill-rule":"evenodd","clip-rule":"evenodd",d:function(e){return n.letter[e.type][c]}}),h&&(w=x.append("image").attr({"class":"backbone",x:0,y:0,width:l(i.BACKB),height:l(o.BACKB),preserveAspectRatio:"none","xlink:href":"resources/dna/Backbone_"+h+".svg"})),g&&(v=y),v.attr("class",function(e){var t="";switch(e.region){case"c":t="coding-region";break;case"j":t="junk-region";break;case"p":t="promoter-region";break;case"t":t="terminator-region"}return"nucleotide "+t}),v.select(".bonds").attr("d",function(e){return"C"===e.type||"G"===e.type?"M"+l(20*r)+" "+P+" L "+l(20*r)+" "+R+"M"+l(26*r)+" "+P+" L "+l(26*r)+" "+R+"M"+l(32*r)+" "+P+" L "+l(32*r)+" "+R:"M"+l(22*r)+" "+P+" L "+l(22*r)+" "+R+"M"+l(30*r)+" "+P+" L "+l(30*r)+" "+R}),v.select(".glow").attr({x:function(e){return l(i.BACKB)/2-l(i[e.type+"_GLOW"])/2},width:function(e){return l(i[e.type+"_GLOW"])},height:function(e){return l(o[e.type+"_GLOW"])},"xlink:href":function(e){return"resources/dna/NucleotideGlow_"+e.type+".svg"}}),A=v.select(".nucleo-shape > svg"),A.attr({"class":function(e){var t="type-"+e.type;return p&&p[e.idx]&&(t+=" stop-codon"),t},viewBox:function(e){return"0 0 "+i[e.type]/r+" "+o[e.type]/r},x:function(e){return l(i.BACKB)/2-l(i[e.type])/2},width:function(e){return l(i[e.type])},height:function(e){return l(o[e.type])}}),A.select("path.interior").attr("d",function(e){return n.interior[e.type]}),A.select("path.outline").attr("d",function(e){return n.outline[e.type]}),e(!1),C=d3.transition(v).attr("transform",a).style("opacity",1),C.select(".bonds").style("opacity",d),C.attrTween?(E="scale(1, "+(1===c?1:-1)+")",C.select("g.scale").attrTween("transform",function(e,t,n){return d3.interpolateString(n,E)}),C.select("path.letter").attrTween("d",function(e,t,r){return function(t){return.5>t?r:n.letter[e.type][c]}})):(v.select("g.scale").attr("transform","scale(1, "+(1===c?1:-1)+")"),v.select("path.letter").attr("d",function(e){return n.letter[e.type][c]})),e(!0),d3.transition(b).attr("transform",a).style("opacity",0).remove()})}var l=null,u="",c=1,d=1,h="DNA",p=null,f=!0,m=!1,g=!1,v=0,y=0;return s.sequence=function(e){return arguments.length?(u=e,s):u},s.model2px=function(e){return arguments.length?(l=e,s):l},s.direction=function(e){return arguments.length?(c=e,s):c},s.bonds=function(e){return arguments.length?(d=e,s):d},s.randomEnter=function(e){return arguments.length?(f=e,s):f},s.glow=function(e){return arguments.length?(m=e,s):m},s.backbone=function(e){return arguments.length?(h=e,s):h},s.stopCodonsHash=function(e){return arguments.length?(p=e,s):p},s.enterExitOnly=function(e){return arguments.length?(g=e,s):g},s}var n=e("models/md2d/views/nucleotide-paths"),r=.007,i={BACKB:52,A:28.151,C:21.2,G:21.2,T:28.651,U:28.651,A_GLOW:44.125,C_GLOW:37.2,G_GLOW:36.2,T_GLOW:45.566},o={BACKB:14,A:31.15,C:25.3,G:30.3,T:25.007,U:25.007,A_GLOW:44.55,C_GLOW:41.417,G_GLOW:45.3,T_GLOW:40.65};return function(){var e;for(e in i)i.hasOwnProperty(e)&&(i[e]*=r);for(e in o)o.hasOwnProperty(e)&&(o[e]*=r)}(),t.WIDTH=.92*i.BACKB,t.HEIGHT=.96*(.9*o.BACKB+o.A),t}),define("models/md2d/models/engine/genetic-engine",["require","cs!models/md2d/models/aminoacids-helper","common/alert","models/md2d/views/nucleotides"],function(e){function t(e){return e.replace(/A/g,"t").replace(/G/g,"c").replace(/T/g,"a").replace(/C/g,"g").toUpperCase()}function n(e){var t,n=["A","G","T","C"],r=n.length,i="";for(t=0;e>t;t++)i+=n[Math.floor(Math.random()*r)];return i}function r(){return c++}var i,o,a=e("cs!models/md2d/models/aminoacids-helper"),s=e("common/alert"),l=(e("models/md2d/views/nucleotides").WIDTH,["undefined","intro-cells","intro-zoom1","intro-zoom2","intro-zoom3","intro-polymerase","dna","transcription","transcription-end","after-transcription","before-translation","translation","translation-end"]),u={},c=0,d="TGACCTCTCCGCGCCATCTATAAACCGAAGCGCTAGCTACA",h="ACCACAGGCCGCCAGTTCCGCTGGCGGCATTTT",p=t(d),f=t(h),m="change";return function(){var e,r;for(e=0,r=l.length;r>e;e++)u[l[e]]=e;i=n(50),o=t(i)}(),function(e){var n,c,g,v=m,y=[],b="",x="",w=d3.dispatch("change","transition"),_=function(){for(var e=A(0),t="";e;)t+=e,e=A(t.length);return t},T=function(){var e,t,n;for(c={},g=null,t=0,n=x.length;n>t;t+=3)e=x.substr(t,3),"STOP"===a.codonToAbbr(e)&&(null===g&&(g=t/3),3===e.length&&(c[t]=c[t+1]=c[t+2]=!0));null===g&&(g=Math.floor(x.length/3))},A=function(e){if(e>=b.length)return null;switch(b[e]){case"A":return"U";case"G":return"C";case"T":return"A";case"C":return"G"}},C=function(e,t){var n,i,o;for(e.length=t.length,n=0,i=t.length;i>n;n++)o=e[n]||{},o.idx=n,o.type!==t[n]&&(o.type=t[n],o.id=r(),e[n]=o);return e},E=function(e,t,n){var a,s,l,u=n?o+p+t+f+o:i+d+t+h+i,c=i.length,m=c+d.length,g=m+t.length,v=g+h.length;for(e.length=u.length,a=0,s=u.length;s>a;a++)l=e[a]||{},l.idx=a,l.region=c>a?"j":m>a?"p":g>a?"c":v>a?"t":"j",l.type!==u[a]&&(l.type=u[a],l.id=r(),e[a]=l);return e},S=function(){var r=e.get("DNA");E(n.viewModel.DNA,r,!1),b=t(r),E(n.viewModel.DNAComp,b,!0),x=_(),T(),n.stateBefore("transcription:0")?C(n.viewModel.mRNA,""):"transcription"===n.state().name?C(n.viewModel.mRNA,x.substr(0,n.state().step)):n.stateAfter("transcription")&&C(n.viewModel.mRNA,x),"transition"!==v&&(n.stateBefore("translation:1")?k():n.stateEqual("translation-end")&&P())},k=function(){var t;if(t=e.getNumberOfAtoms(),t>0){for(e.startBatch();t>0;)e.removeAtom(t-1),t--;e.endBatch()}e.stop()},P=function(){for(var t=[],r=0,i=a.codonToAbbr(n.codon(0));"STOP"!==i;)t.push(i),i=a.codonToAbbr(n.codon(++r));n.generateProtein(t,void 0,2.3,.3),n.centerProtein(),e.start()},R=function(t){var r,i,o=t.name;return"transcription"===o?t.step<e.get("DNA").length-1?"transcription:"+(t.step+1):"transcription-end":"translation"===o?(i=a.codonToAbbr(n.codon(t.step)),"STOP"!==i?"translation:"+(t.step+1):"translation-end"):(r=l[u[t.name]+1],("transcription"===r||"translation"===r)&&(r+=":0"),r)},O=function(t){var n=t.name,r=t.step;return"transcription"===n&&r>0?"transcription:"+(r-1):"transcription-end"===n?"transcription:"+(e.get("DNA").length-1):"translation-end"===n||"translation"===n&&r>0?"translation:0":l[u[n]-1]},M=function(e,t){return e===t?0:(e=n.parseState(e),t=n.parseState(t),e.name===t.name?isNaN(e.step)||isNaN(t.step)?0:e.step<t.step?-1:1:u[e.name]<u[t.name]?-1:1)},N=function(e){"undefined"!=typeof e&&(y.length>0?y.push(e):(y.push(e),I(e)))},I=function(e){D("DNAState",e,"transition")},L=function(e){D("DNA",e,"transition")},B=function(t){y.length=0,e.cancelTransitions(),w.change(t)},D=function(t,n,r){v=r||m,e.properties[t]=n,v=m},F=function(){var t=e.get("DNAState");if("suppress"!==v)if(S(),"transition"===v)w.transition(t);else{if(n.stateAfter("translation:0")&&n.stateBefore("translation-end"))return s("'"+t+"' cannot be set explicitly. 'translation:0' should be set and then animation to '"+t+"' should be triggered."),D("DNAState","translation:0"),void 0;B()}},V=function(){if("suppress"!==v){if(n.stateAfter("translation:0")&&n.stateBefore("translation-end"))return D("DNAState","translation:0"),void 0;S(),"transition"===v?w.transition("dna-updated",!0):B(!0)}};return n={PRECODING_LEN:i.length+d.length,viewModel:{mRNA:[],DNA:[],DNAComp:[]},on:function(e,t){w.on(e,t)},mutate:function(r,i,o){var a=e.get("DNA"),s=r-n.PRECODING_LEN;if(0>s||s>=a.length)throw new Error("Mutation can be performed only on DNA coding region.");a=a.substr(0,s)+(o?t(i):i)+a.substr(s+1),D("DNA",a)},insert:function(i,o,a){var s={type:a?t(o):o,id:r(),region:"c"},l={type:a?o:t(o),id:r(),region:"c"},u={type:a?t(o):o,id:r(),region:"c"},c=e.get("DNA"),d=n.state(),h=i-n.PRECODING_LEN;if(0>h||h>=c.length)throw new Error("Mutation can be performed only on DNA coding region.");n.viewModel.DNA.splice(i,0,s),n.viewModel.DNAComp.splice(i,0,l),n.viewModel.mRNA.splice(h,0,u),c=c.substr(0,h)+s.type+c.substr(h),"transcription"===d.name&&h<d.step&&D("DNAState",d.name+":"+(d.step+1),"suppress"),L(c)},"delete":function(t){var r=e.get("DNA"),i=n.state(),o=t-n.PRECODING_LEN;if(0>o||o>=r.length)throw new Error("Mutation can be performed only on DNA coding region.");n.viewModel.DNA.splice(t,1),n.viewModel.DNAComp.splice(t,1),n.viewModel.mRNA.splice(o,1),r=r.substr(0,o)+r.substr(o+1),"transcription"===i.name&&o<i.step&&D("DNAState",O(i),"suppress"),L(r)},transitionToNextState:function(){n.stopTransition(),0===y.length&&N(R(n.lastState()))},stopTransition:function(){y.length>1&&(y.length=1)},jumpToNextState:function(){n.stateBefore("translation:0")?D("DNAState",R(n.state())):n.stateBefore("translation-end")&&D("DNAState","translation-end")},jumpToPrevState:function(){n.stateAfter("intro-cells")&&D("DNAState",O(n.state()))},transitionTo:function(e){for(;n.lastStateBefore(e);)N(R(n.lastState()))},transcribeStep:function(e){var t,r;if(t=n.state(),"dna"===t.name&&"undefined"==typeof e)n.transitionToNextState();else if("transcription"===t.name){if(r=A(t.step),e&&e.toUpperCase()!==r)return;n.transitionToNextState()}},state:function(){return n.parseState(e.get("DNAState"))},stateBefore:function(t){return-1===M(e.get("DNAState"),t)},stateEqual:function(t){return 0===M(e.get("DNAState"),t)},stateAfter:function(t){return 1===M(e.get("DNAState"),t)},lastState:function(){var e=y.length;return e>0?n.parseState(y[e-1]):n.state()},lastStateBefore:function(t){var n=y.length,r=n?y[n-1]:e.get("DNAState");return-1===M(r,t)?!0:!1},lastStateAfter:function(t){var n=y.length,r=n?y[n-1]:e.get("DNAState");return 1===M(r,t)?!0:!1},parseState:function(e){return e=e.split(":"),{name:e[0],step:Number(e[1])}},codon:function(e){return x.substr(3*e,3)},codonComplement:function(e){return n.codon(e).replace(/A/g,"u").replace(/G/g,"c").replace(/U/g,"a").replace(/C/g,"g").toUpperCase()},translationStepStarted:function(t,r,i,o,s,l){var u=a.codonToAbbr(n.codon(t)),c=a.abbrToElement(u);s+=.02*Math.random()-.01,e.addAtom({x:r,y:i,element:c,visible:!0,pinned:!0},{suppressCheck:!0}),e.atomTransition().id(t).duration(l).prop("x",o),e.atomTransition().id(t).duration(l).prop("y",s),e.start()},shiftAminoAcids:function(t,n,r){if(!(1>t)){var i,o,a;for(i=0;t>i;i++)o=e.getAtomProperties(i).x+n,a=e.getAtomProperties(i).y,e.atomTransition().id(i).duration(r).prop("x",o),e.atomTransition().id(i).duration(r).prop("y",a)}},centerProtein:function(t){e.batch(function(){var r,i,o,a=n.proteinCenterOfMass(),s=e.properties.viewPortX+e.properties.viewPortWidth/2-a.x,l=e.properties.viewPortY+e.properties.viewPortHeight/2-a.y,u=e.properties.minX+.1,c=e.properties.maxX-.1,d=e.properties.minY+.1,h=e.properties.maxY-.1,p=e.getNumberOfAtoms();for(r=0;p>r;r++)i=e.getAtomProperties(r).x,o=e.getAtomProperties(r).y,i+s>c&&(s=c-i),u>i+s&&(s=u-i),o+l>h&&(l=h-o),d>o+l&&(l=d-o);for(r=0;p>r;r++)i=e.getAtomProperties(r).x+s,o=e.getAtomProperties(r).y+l,t?(e.atomTransition().id(r).duration(t).prop("x",i),e.atomTransition().id(r).duration(t).prop("y",o)):e.setAtomProperties(r,{x:i,y:o})}),e.tickInPlace()},connectAminoAcid:function(t){if(!(1>t)){var n=e.getAtomProperties(t-1).radius,r=e.getAtomProperties(t).radius,i=1.25*(n+r);e.addRadialBond({atom1:t,atom2:t-1,length:i,strength:1e4}),e.setAtomProperties(t-1,{pinned:!1})}},translationCompleted:function(){var t=e.getNumberOfAtoms();t>0&&e.setAtomProperties(t-1,{pinned:!1})},transitionEnded:function(){y.shift(),y.length>0&&I(y[0])},stopCodonsHash:function(){return c},lastTranslationStep:function(){return g},proteinCenterOfMass:function(){var t,n,r=0,i=0,o=0,a=e.getNumberOfAtoms();if(0===a)return null;for(n=0,a=e.getNumberOfAtoms();a>n;n++)t=e.getAtomProperties(n),i+=t.x*t.mass,o+=t.y*t.mass,r+=t.mass;return i/=r,o/=r,{x:i,y:o}},generateProtein:function(t,n,r,i){n=t?t.length:n,r=r||0,i=i||0;var o=e.properties.minX,s=e.properties.minY+i,l=e.properties.maxX,u=e.properties.maxY-r,c=0;return k(),e.batch(function(){var r,i,d,h,p,f,m,g,v,y,b={suppressCheck:!0},x=l-o,w=u-s,_=a.lastElementID-a.firstElementID+1,T=.6,A=function(e){return e>w-T||T>e?.1:.02-.04*Math.random()},C=.3,E=function(e,t){return 0===t?e>.5*u?-.1:.1:i>u-C||C>i?0:t},S=function(){return Math.floor(_*Math.random())+a.firstElementID};for(r=o+.1,i=s+.1,d=0,h=0,p=t?a.abbrToElement(t[0]):S(),m=e.getElementProperties(p).radius,f={x:r,y:i,element:p,visible:!0},e.addAtom(f,b),c+=1,y=1;n>y;y++){if(r=f.x,i=f.y,d=A(i),h=E(i,h),r+=1.7*d,i+=1.7*h,r>x-.1)return;p=t?a.abbrToElement(t[y]):S(),f={x:r,y:i,element:p,visible:!0},e.addAtom(f,b),c+=1,g=m,m=e.getElementProperties(p).radius,v=1.25*(m+g),e.addRadialBond({atom1:y,atom2:y-1,length:v,strength:1e4})}}),e.batch(function(){var t,r=e.getAtomProperties(c-1).x,i=(r-o)/2,a=e.properties.viewPortX+e.properties.viewPortWidth/2,s=l-r,u=Math.max(0,Math.min(a-i,s));for(t=0;n>t;t++)e.setAtomProperties(t,{x:e.getAtomProperties(t).x+u})}),e.minimizeEnergy(),c}},e.addPropertiesListener(["DNA"],V),e.addPropertiesListener(["DNAState"],F),S(),n}}),define("models/md2d/models/performance-optimizer",[],function(){function e(e){this._model=e,this._initialTimeStep=this._model.get("timeStep"),this._maxTimeStep=2*this._initialTimeStep,this._targetProgressRate=this._initialTimeStep*this._model.get("timeStepsPerTick")*60,this.enabled=!1}var t=2.5;return e.prototype._assessPerformance=function(){if(this.enabled&&!this._model.isStopped()){var e=this._model.getSimulationProgressRate(),n=this._model.getFPS(),r=this._model.get("timeStep"),i=this._model.get("timeStepsPerTick"),o=this._model.get("temperatureControl")?2.5*this._maxTimeStep:this._maxTimeStep;e<.9*this._targetProgressRate?o>1.1*r?this._model.set("timeStep",1.1*r):n>t&&this._model.set("timeStepsPerTick",Math.round(1.1*i+.5)):e>1.1*this._targetProgressRate&&this._model.set("timeStepsPerTick",Math.round(.9*i-.5)),setTimeout($.proxy(this._assessPerformance,this),250)}},e.prototype.enable=function(){this.enabled||(this._model.start(),this.enabled=!0,this._model.set("timeStepsPerTick",5),setTimeout($.proxy(this._assessPerformance,this),250))},e.prototype.disable=function(){this.enabled=!1},e}),define("common/models/property-transition",[],function(){function e(){if(this.isFinished=!1,this._duration=0,this._easeFunc=d3.ease("cubic-in-out"),this._elapsedTime=0,this._id=null,this._propName=null,this._endValue=null,this._interpolator=null,null==this.getObjectProperties)throw new Error("getObjectProperties method must be implemented by descendant!");if(null==this.setObjectProperties)throw new Error("setObjectProperties method must be implemented by descendant!")}return e.prototype.id=function(e){return this._id=e,this},e.prototype.prop=function(e,t){return this._propName=e,this._endValue=t,this},e.prototype.duration=function(e){return this._duration=e,this},e.prototype.delay=function(e){return this._elapsedTime=-e,this},e.prototype.ease=function(e){return this._easeFunc=d3.ease(e),this},e.prototype.process=function(e){if(!this.isFinished&&!this._incompleteSpec()){var t,n;this._elapsedTime+=e,this._elapsedTime<0||(null==this._interpolator&&(this._interpolator=d3.interpolate(this.getObjectProperties(this._id)[this._propName],this._endValue)),t=Math.min(1,this._elapsedTime/this._duration),t=this._easeFunc(t),n={},n[this._propName]=this._interpolator(t),this.setObjectProperties(this._id,n),t>=1&&(this.isFinished=!0))}},e.prototype.getObjectProperties=null,e.prototype.setObjectProperties=null,e.prototype._incompleteSpec=function(){return null==this._id||null==this._propName||null==this._endValue},e}),define("models/md2d/models/atom-transition",["require","common/inherit","common/models/property-transition"],function(e){function t(e){r.call(this),this._model=e}var n=e("common/inherit"),r=e("common/models/property-transition");return n(t,r),t.prototype.setObjectProperties=function(e,t){this._model.setAtomProperties(e,t)
},t.prototype.getObjectProperties=function(e){return this._model.getAtomProperties(e)},t}),define("models/md2d/models/engine/plugins/quantum-dynamics",["require","common/models/engines/clone-restore-wrapper","../constants/index","../utils","arrays","common/array-types","models/md2d/models/metadata","common/validator"],function(e){var t=e("common/models/engines/clone-restore-wrapper"),n=e("../constants/index"),r=e("../utils"),i=n.convert(.2,{from:n.unit.EV,to:n.unit.MW_ENERGY_UNIT}),o=n.convert(.05,{from:n.unit.EV,to:n.unit.MW_ENERGY_UNIT}),a=.002,s=2*Math.PI,l=200,u=1/l,c=1,d=2;return function(n,h){var p,f,m,g,v,y,b,x,w,_,T,A,C,E=e("arrays"),S=e("common/array-types"),k=e("models/md2d/models/metadata"),P=e("common/validator"),R=P.validateCompleteness(k.quantumDynamics,h),O=R.elementEnergyLevels,M=R.radiationlessEmissionProbability,N=0,I=R.lightSource,L=n.getDimensions(),B=[],D=0,F=function(){var e=m.x.length;m.excitation=E.create(e,0,S.int8Type)},V=function(e){var t=0;e.x&&(t=10*Math.ceil(e.x.length/10)),v={id:E.create(t,0,S.uint16Type),x:E.create(t,0,S.floatType),y:E.create(t,0,S.floatType),vx:E.create(t,0,S.floatType),vy:E.create(t,0,S.floatType),angularFrequency:E.create(t,0,S.floatType)}},G=[],$=0,U=function(e){if(e&&e.x){["x","y","vx","vy","angularFrequency"].forEach(function(t){E.copy(e[t],v[t])});for(var t=0;t<v.x.length;t++)(v.vx[t]||v.vy[t])&&($++,v.id[t]=D++)}},j=function(){var e,t,r,i,o,a,s,l,u,d,h=n.getNumberOfAtoms();for(e=0,t=v.x.length;t>e;e++)if(v.vx[e]||v.vy[e])for(r=v.x[e],i=v.y[e],o=0;h>o&&(l=m.x[o]-r,u=m.y[o]-i,a=m.radius[o],s=a*a,!(s>l*l+u*u&&(d=q(e,o),d===c)));o++);},q=function(e,t){return Math.random()<N?d:W(e,t)?c:void 0},W=function(e,t){if(O){var n,r,a=O[m.element[t]],s=m.excitation[t],l=a[s],u=v.angularFrequency[e]*i;for(n=s+1,r=a.length;r>n;n++)if(Math.abs(a[n]-l-u)<o)return m.excitation[t]=n,B[t]=f,nt(e),!0;return!1}},H=function(e){var t,r,i,o,a,s,l,u,c,d,h,p,f,v,y,b,x,w=n.getNumberOfAtoms(),_=e.getList(),T=[];if(O){for(t=0;w>t;t++)for(c=m.x[t],d=m.y[t],i=e.getStartIdxFor(t),o=e.getEndIdxFor(t);o>i;i++)r=_[i],a=m.element[t],s=m.element[r],l=O[a],u=O[s],(l.length||u.length)&&(h=c-m.x[r],p=d-m.y[r],f=h*h+p*p,v=.55*(g.sigma[a]+g.sigma[s]),y=v*v,f>=y||(T[t]=r,G[t]!==r&&(b=z(t,r),b||(x=Z(t,r)),(b||x)&&(G[t]=r,G[r]=t))));for(t=0,o=G.length;o>t;t++)r=G[t],isNaN(r)||T[t]!==r&&T[r]!==t&&(delete G[t],delete G[r])}},z=function(e,t){var n,r;return y=e,b=t,r=Math.random()<.5?y:b,n=X(r),n||(n=X(y+b-r)),n},X=function(e){var t,n,r,i,o,a,s,l,u,c=O[m.element[e]];if(c){for(Y(),r=K(),t=m.excitation[e],n=c[t],l=t+1,u=c.length;u>l&&(i=c[l]-n,!(i>r));l++)o=l;return o?(o-=t,a=Math.ceil(Math.random()*o)+t,m.excitation[e]=a,B[e]=f,s=c[a]-n,J(s),!0):!1}},Y=function(){var e=m.x[b]-m.x[y],t=m.y[b]-m.y[y],n=1/Math.sqrt(e*e+t*t);A=e*n,C=t*n,x=m.vx[y]*A+m.vy[y]*C,_=m.vy[y]*A-m.vx[y]*C,w=m.vx[b]*A+m.vy[b]*C,T=m.vy[b]*A-m.vx[b]*C},K=function(){var e=w-x,t=m.mass[y],n=m.mass[b];return.5*e*e*t*n/(t+n)},J=function(e){var t=m.mass[y],n=m.mass[b],r=t*x*x+n*w*w-e,i=t*x+n*w,o=(i-Math.sqrt(n/t*(r*(t+n)-i*i)))/(t+n),a=(i+Math.sqrt(t/n*(r*(t+n)-i*i)))/(t+n);m.vx[y]=o*A-_*C,m.vy[y]=o*C+_*A,m.vx[b]=a*A-T*C,m.vy[b]=a*C+T*A},Z=function(e,t){var n,r=m.excitation[e],i=m.excitation[t];if(y=e,b=t,!r&&!i)return!1;if(r)if(i){if(n=Math.random()<.5?y:b,!Q(n)&&(n=y+b-n,!Q(n)))return!1}else{if(!Q(y))return!1;n=y}else{if(!Q(b))return!1;n=b}return et(n),!0},Q=function(e){return f>B[e]+l?!0:void 0},et=function(e){var t=O[m.element[e]],n=m.excitation[e],r=Math.floor(Math.random()*n),i=t[r]-t[n];m.excitation[e]=r,Math.random()<M?(Y(),J(i)):it(e,i)},tt=function(){var e,t=v.x.length;if($+1>t)return r.extendArrays(v,t+10),t;for(e=0;t>e;e++)if(!v.vx[e]&&!v.vy[e])return e},nt=function(e){$--,v.x[e]=v.y[e]=v.vx[e]=v.vy[e]=v.angularFrequency[e]=0},rt=function(e,t,n,r){var o=Math.cos(n),s=Math.sin(n),l=a*o,u=a*s,c=r/i,d=tt();$++,v.id[d]=D++,v.x[d]=e,v.y[d]=t,v.vx[d]=l,v.vy[d]=u,v.angularFrequency[d]=c},it=function(e,t){var n=Math.random()*s-Math.PI,r=Math.cos(n),i=Math.sin(n),o=g.sigma[m.element[e]],a=m.x[e]+.51*o*r,l=m.y[e]+.51*o*i;rt(a,l,n,t)},ot=function(e){var t,n,r,i;for(t=0,n=v.x.length;n>t;t++)(v.vx[t]||v.vy[t])&&(r=v.x[t]+=v.vx[t]*e,i=v.y[t]+=v.vy[t]*e,(r<L[0]||r>L[2]||i<L[1]||i>L[3])&&nt(t))},at=function(e){if(O)for(var t=0,r=n.getNumberOfAtoms();r>t;t++)st(t,e)},st=function(e,t){if(0!==m.excitation[e]&&!(Math.random()>t*u)){var n,r,i,o=Math.random(),a=Math.random(),s=m.excitation[e],l=1/s;for(i=0;s>i;i++)if(o>=i*l&&(i+1)*l>o&&a>M)return n=O[m.element[e]],r=n[s]-n[i],m.excitation[e]=i,it(e,r),void 0}},lt=function(){var e,t=L[0],n=L[1],r=L[2]-t,o=L[3]-n,a=I.angleOfIncidence,s=I.frequency*i,l=I.numberOfBeams,u=Math.abs(Math.sin(a)),c=Math.abs(Math.cos(a)),d=c*r>u*o?o/c:r/u,h=d/l,p=h/u,f=h/c,m=Math.floor(r/p),g=Math.floor(o/f);if(a>=0&&a<.5*Math.PI){for(e=1;m>=e;e++)rt(t+p*e,n,a,s);for(e=0;g>=e;e++)rt(t,n+o-f*e,a,s)}else if(0>a&&a>=-.5*Math.PI){for(e=1;m>=e;e++)rt(t+p*e,n+o,a,s);for(e=0;g>=e;e++)rt(t,n+f*e,a,s)}else if(a<Math.PI&&a>=.5*Math.PI){for(e=0;m>=e;e++)rt(t+r-p*e,n,a,s);for(e=1;g>=e;e++)rt(t+r,n+o-f*e,a,s)}else if(a>=-Math.PI&&a<-.5*Math.PI){for(e=0;m>=e;e++)rt(t+r-p*e,n+o,a,s);for(e=1;g>=e;e++)rt(t+r,n+f*e,a,s)}};return p={initialize:function(e){m=e.atoms,g=e.elements,F(),V(R.photons),U(R.photons)},performActionWithinIntegrationLoop:function(e,t,n){f=n,ot(t),j(),H(e),at(t),I.on&&n%I.radiationPeriod<t&&lt()},turnOnLightSource:function(){I.on=!0},turnOffLightSource:function(){I.on=!1},setLightSourceAngle:function(e){I.angleOfIncidence=e},setLightSourceFrequency:function(e){I.frequency=e},setLightSourcePeriod:function(e){I.radiationPeriod=e},setLightSourceNumber:function(e){I.numberOfBeams=e},getPhotons:function(){return v},getNumPhotons:function(){return $},getViewPhotons:function(){function e(e,t){var n=e.vx[t],r=e.vy[t],i=-180*Math.atan2(r,n)/Math.PI;return{id:e.id[t],x:e.x[t],y:e.y[t],vx:n,vy:r,angle:i,angularFrequency:e.angularFrequency[t]}}var t=[],n=[];return function(){var r,i,o,a=this.getPhotons(),s=0;for(t.length=this.getNumPhotons(),n.length=a.x.length,r=0,i=a.x.length;i>r;r++)a.vx[r]||a.vy[r]?(o=n[r],o&&o.id===a.id[r]?(o.x=a.x[r],o.y=a.y[r]):(o=e(a,r),n[r]=o),t[s++]=o):n[r]=null;return t}}(),getElementEnergyLevels:function(){return O},getRadiationlessEmissionProbability:function(){return M},getLightSource:function(){return I?I:void 0},getState:function(){return[new t(v,{padArraysWithZeroes:!0}),{clone:function(){return{numPhotons:$}},restore:function(e){$=e.numPhotons}}]}}}}),define("models/md2d/models/engine/plugins/chemical-reactions",["require","arrays","common/array-types","models/md2d/models/metadata","common/validator","models/md2d/models/engine/constants/index"],function(e){function t(e,t,n,r){return e*n+t*r}var n=.6,r={1:101,2:107,3:108};return function(i,o){function a(){var e=S.x.length;S.sharedElectrons=R.create(e,0,O.int8Type)}function s(e){var t=D[S.element[e]],n=S.sharedElectrons[e];return!(1===t&&1===n)&&8>t+n}function l(e){var t=D[S.element[e]];return 1===t?1-S.sharedElectrons[e]:Math.min(3,8-t-S.sharedElectrons[e])}function u(e,t){return n*(k.sigma[e]+k.sigma[t])}function c(e,t){return 2e4*Math.sqrt(k.epsilon[e]*k.epsilon[t])}function d(e,t){return Math.min(l(e),l(t))}function h(e){var t=P.type[e]-105;return 0>t?1:t}function p(e,t,n){switch(void 0===n&&(n=1),n){case 1:return F[e+"-"+t]||F[t+"-"+e]||F["default"];case 2:return F[e+"="+t]||F[t+"="+e]||2*p(e,t,1);case 3:return F[e+"=-"+t]||F[t+"=-"+e]||3*p(e,t,1)}}function f(e,t,n){return V[e+"+"+t+"-"+n]||V[t+"+"+n+"-"+t]||V["default"]}function m(e,t,n,r,i){var o=p(t,n,r),a=p(e,t,i);return a>o?f(e,t,n):f(e,t,n)+o-a}function g(){var e,t,n;for(t=0,n=i.getNumberOfAtoms();n>t;t++)S.sharedElectrons[t]=0;for(t=0,n=i.getNumberOfRadialBonds();n>t;t++)e=h(t),S.sharedElectrons[P.atom1[t]]+=e,S.sharedElectrons[P.atom2[t]]+=e}function v(){var e,t;for(G.length=0,e=0,t=i.getNumberOfRadialBonds();t>e;e++)G[P.atom1[e]]=G[P.atom2[e]]=e}function y(){var e,t,n,r,o,a,s,l,u,c,d,f,m;for(e=0,t=i.getNumberOfRadialBonds();t>e;++e)n=P.atom1[e],r=P.atom2[e],d=P.length[e],l=S.x[n]-S.x[r],u=S.y[n]-S.y[r],c=l*l+u*u,s=Math.sqrt(c)-d,s>0&&(s=.5*P.strength[e]*s*s,o=S.element[n],a=S.element[r],f=h(e),m=p(o,a,f),s>m&&(s-=m,s+=i.ljCalculator[o][a].potentialFromSquaredDistance(c),A(s,n,r)&&(i.removeRadialBond(e),S.sharedElectrons[n]-=f,S.sharedElectrons[r]-=f)))}function b(e){var t,r,o,a,s,l,u,c,d,h,p,f,m=i.getNumberOfAtoms(),g=e.getList();for(o=0;m>o;o++)for(s=S.element[o],u=S.x[o],c=S.y[o],t=e.getStartIdxFor(o),r=e.getEndIdxFor(o);r>t;t++)a=g[t],i.atomsBonded(o,a)||(l=S.element[a],d=u-S.x[a],h=c-S.y[a],p=d*d+h*h,f=n*(k.sigma[s]+k.sigma[l]),f*f>p&&w(o,a,d,h,p))}function x(e,n,r,i){return!(t(S.vx[e],S.vy[e],r,i)>=0&&t(S.vx[n],S.vy[n],r,i)<=0)}function w(e,t,n,r,i){var o,a;x(e,t,n,r)&&(o=s(e),a=s(t),o&&a?_(e,t,i):o&&void 0!==G[t]?T(e,t,G[t],n,r,i):a&&void 0!==G[e]&&T(t,e,G[e],n,r,i))}function _(e,t,n){var o,a,s,l=S.element[e],h=S.element[t],f=d(e,t),m=p(l,h,f);0>=m||(o=u(l,h),a=c(l,h),s=Math.sqrt(n)-o,s=-.5*a*s*s,s+=m,s-=i.ljCalculator[l][h].potentialFromSquaredDistance(n),A(s,e,t)&&(i.addRadialBond({atom1:e,atom2:t,length:o,strength:a,type:r[f]}),S.sharedElectrons[e]+=f,S.sharedElectrons[t]+=f))}function T(e,t,n,o,a,s){var d,f,g,v,y,b,x=P.atom1[n]!==t?P.atom1[n]:P.atom2[n],w=S.element[e],_=S.element[t],T=S.element[x],C=h(n),E=Math.min(l(e),l(t)+C),k=m(w,_,T,C,E),R=1/Math.sqrt(s),O=S.vx[e]-S.vx[t],M=S.vy[e]-S.vy[t],N=O*o*R+M*a*R,B=S.mass[e],D=S.mass[t],F=I.convert(B*D/(B+D)*N*N,{from:L.MW_ENERGY_UNIT,to:L.EV});F>k&&(d=u(w,_),f=c(w,_),g=P.length[n],v=P.strength[n],y=Math.sqrt(s)-d,b=-.5*f*y*y,b+=p(w,_,E),b-=i.ljCalculator[w][_].potentialFromSquaredDistance(s),o=S.x[t]-S.x[x],a=S.y[t]-S.y[x],s=o*o+a*a,y=Math.sqrt(s)-g,b-=-.5*v*y*y,b-=p(_,T,C),b+=i.ljCalculator[_][T].potentialFromSquaredDistance(s),A(b,e,t,x)&&(i.setRadialBondProperties(n,{atom1:e,atom2:t,length:d,strength:f,type:r[E]}),S.sharedElectrons[e]+=E,S.sharedElectrons[t]+=E-C,S.sharedElectrons[x]-=C,G[x]===n&&(G[x]=void 0),G[t]=void 0))}function A(e,t,n,r){var o,a=i.getAtomKineticEnergy(t)+i.getAtomKineticEnergy(n)+(void 0!==r?i.getAtomKineticEnergy(r):0),s=a+e;return 0>=s?!1:(o=Math.sqrt(s/a),S.vx[t]*=o,S.vy[t]*=o,S.vx[n]*=o,S.vy[n]*=o,S.px[t]*=o,S.py[t]*=o,S.px[n]*=o,S.py[n]*=o,void 0!==r&&(S.vx[r]*=o,S.vy[r]*=o,S.px[r]*=o,S.py[r]*=o),!0)}function C(){var e,t,n=0;for(e=0,t=i.getNumberOfRadialBonds();t>e;++e)n-=p(S.element[P.atom1[e]],S.element[P.atom2[e]],h(e));return n}var E,S,k,P,R=e("arrays"),O=e("common/array-types"),M=e("models/md2d/models/metadata"),N=e("common/validator"),I=e("models/md2d/models/engine/constants/index"),L=I.unit,B=N.validateCompleteness(M.chemicalReactions,o),D=B.valenceElectrons,F=B.bondEnergy,V=B.activationEnergy,G=[];return E={initialize:function(e){S=e.atoms,k=e.elements,P=e.radialBonds,a()},performActionWithinIntegrationLoop:function(e,t,n){n/t%50===0&&(g(),y(),v(),b(e))},getState:function(){return[]},processOutputState:function(e){e.PE+=C()}}}}),define("models/md2d/models/modeler",["require","common/performance","common/serialize","common/validator","common/lab-modeler-mixin","common/output-support","common/models/tick-history","models/md2d/models/engine/md2d","models/md2d/models/metadata","models/md2d/models/engine/constants/units","models/md2d/models/unit-definitions/index","models/md2d/models/units-translation","cs!models/md2d/models/solvent","models/md2d/models/aminoacids-props","cs!models/md2d/models/aminoacids-helper","models/md2d/models/engine/genetic-engine","models/md2d/models/performance-optimizer","models/md2d/models/atom-transition","underscore","models/md2d/models/engine/plugins/quantum-dynamics","models/md2d/models/engine/plugins/chemical-reactions"],function(e){var t=e("common/performance"),n=e("common/serialize"),r=e("common/validator"),i=e("common/lab-modeler-mixin"),o=e("common/output-support"),a=e("common/models/tick-history"),s=e("models/md2d/models/engine/md2d"),l=e("models/md2d/models/metadata"),u=e("models/md2d/models/engine/constants/units"),c=e("models/md2d/models/unit-definitions/index"),d=e("models/md2d/models/units-translation"),h=e("cs!models/md2d/models/solvent"),p=e("models/md2d/models/aminoacids-props"),f=e("cs!models/md2d/models/aminoacids-helper"),m=e("models/md2d/models/engine/genetic-engine"),g=e("models/md2d/models/performance-optimizer"),v=e("models/md2d/models/atom-transition"),y=e("underscore"),b=e("models/md2d/models/engine/plugins/quantum-dynamics"),x=e("models/md2d/models/engine/plugins/chemical-reactions"),w=0;return function(e,_){function T(e){var t,n;for(tt.startBatch(),t=0,n=ft.length;n>t;t++)ft[t].process(e);for(t=0;t<ft.length;)ft[t].isFinished?ft.splice(t,1):t++;tt.endBatch()}function A(e,t){e=y.extend({},e);for(var n in e)e.hasOwnProperty(n)&&(e[n]=t(n,e[n]));return e}function C(e,t){return ot?A(e,function(e,n){return ot.translateToModelUnits(n,t[e]&&t[e].unitType)}):e}function E(e,t){return ot?A(e,function(e,n){return ot.translateFromModelUnits(n,t[e]&&t[e].unitType)}):e}function S(){mt.updateParticlesAccelerations(),mt.computeOutputState(pt),Z=mt.callPluginAccessor("getViewPhotons"),k(pt.atoms),P(pt.radialBonds,pt.atoms),R()}function k(e){var t,n,r,i,o=mt.getNumberOfAtoms();for(gt.length=o,t=0,o;o>t;t++){gt[t]||(gt[t]={idx:t}),i=gt[t];for(n in e)e.hasOwnProperty(n)&&(i[n]=e[n][t]);i.aminoAcid=f.isAminoAcid(e.element[t]),i.aminoAcid&&(r=f.getAminoAcidByElement(e.element[t]),i.symbol=r.symbol,i.label=r.abbreviation)}}function P(e,t){var n,r,i,o=mt.getNumberOfRadialBonds();for(vt.length=o,i=0;o>i;i++){vt[i]||(vt[i]={idx:i}),n=vt[i];for(r in e)n[r]=e[r][i];n.x1=t.x[n.atom1],n.y1=t.y[n.atom1],n.x2=t.x[n.atom2],n.y2=t.y[n.atom2]}}function R(){if(yt.length&&tt.properties.showElectricField){var e,t,n;for(e=0,t=yt.length;t>e;e++)n=yt[e],mt.getCoulombForceAt(n.x,n.y,n)}}function O(){for(var e=mt.getNumberOfElements(),t=Math.floor(Math.random()*e);f.isAminoAcid(t);)t=Math.floor(Math.random()*e);return t}function M(){var e,t,n,r;for(n=mt.getNumberOfElements();n<=f.lastElementID;n++)tt.addElement({id:n});for(n=0,r=p.length;r>n;n++)e=18*Math.pow(p[n].volume/p[0].volume,.3333333333333),t=u.convert(e/10,{from:u.unit.ANGSTROM,to:u.unit.NANOMETER}),mt.setElementProperties(f.firstElementID+n,{mass:p[n].molWeight,sigma:t})}function N(e){var t=e.minX,n=e.minY,r=e.maxX,i=e.maxY;e.minX=null!=t?t:0,e.maxX=null!=r?r:e.width,e.minY=null!=n?n:0,e.maxY=null!=i?i:e.height}function I(e,t){mt.setDimensions([e.minX,e.minY,e.maxX,e.maxY]),t.quantumDynamics?(e.useQuantumDynamics=!0,mt.addPlugin(new b(mt,t.quantumDynamics))):e.useQuantumDynamics=!1,t.chemicalReactions?(e.useChemicalReactions=!0,mt.addPlugin(new x(mt,t.chemicalReactions))):e.useChemicalReactions=!1,q=mt.elements,Y=mt.radialBonds,K=mt.angularBonds,J=mt.restraints,W=mt.obstacles,H=mt.shapes,z=mt.lines,X=mt.electricFields}function L(e){var t={};return 0===e.length?{}:(Object.keys(e[0]).forEach(function(e){t[e]=[]}),e.forEach(function(e){Object.keys(e).forEach(function(n){t[n].push(e[n])})}),t)}function B(){var e=tt.getPhotons(),t={photons:n(l.photon,L(e),e.length),elementEnergyLevels:mt.callPluginAccessor("getElementEnergyLevels"),radiationlessEmissionProbability:mt.callPluginAccessor("getRadiationlessEmissionProbability"),lightSource:mt.callPluginAccessor("getLightSource")};return t.lightSource||delete t.lightSource,t}function D(){return{}}function F(){lt.invalidatingChangePreHook(),lt.invalidatingChangePostHook()}this.constructor.type="md2d",_=_||{};var V,G,$,U,j,q,W,H,z,X,Y,K,J,Z,Q,et,tt={},nt="md2dModel"+ ++w,rt={targetTemperature:function(e){mt.setTargetTemperature(e)},temperatureControl:function(e){mt.useThermostat(e)},lennardJonesForces:function(e){mt.useLennardJonesInteraction(e)},coulombForces:function(e){mt.useCoulombInteraction(e)},solventForceType:function(e){mt.setSolventForceType(e)},DNAState:function(e){mt.setDNAState(e)},solventForceFactor:function(e){mt.setSolventForceFactor(e)},additionalSolventForceMult:function(e){mt.setAdditionalSolventForceMult(e)},additionalSolventForceThreshold:function(e){mt.setAdditionalSolventForceThreshold(e)},dielectricConstant:function(e){mt.setDielectricConstant(e)},realisticDielectricEffect:function(e){mt.setRealisticDielectricEffect(e)},VDWLinesCutoff:function(e){var t=ut[e];t&&mt.setVDWLinesRatio(t)},gravitationalField:function(e){mt.setGravitationalField(e)},modelSampleRate:function(){tt.isStopped()||tt.restart()},viscosity:function(e){mt.setViscosity(e)},polarAAEpsilon:function(e){var t,n,r,i,o,a;for(t=f.getPolarAminoAcids(),i=0,a=t.length;a>i;i++)for(n=t[i],o=i+1;a>o;o++)r=t[o],mt.pairwiseLJProperties.set(n,r,{epsilon:e})},electricFieldDensity:function(e){if(yt.length=0,e)for(var t,n=0,r=0,i=tt.properties.width,o=tt.properties.height,a=tt.properties.width/e,s=o/a%1*a,l=r+.5*(s+(o>=a?a:0));o>l;){for(t=n+.5*a;i>t;)yt.push({x:t,y:l}),t+=a;l+=a}}},it=c.get(e.unitsScheme||"md2d"),ot=function(){var t=e.unitsScheme||"md2d";return"md2d"!==t?new d(it):void 0}(),at=new i({metadata:l,setters:rt,unitsDefinition:it,unitsTranslation:ot,initialProperties:e}),st=function(){var e=at.dispatchSupport;return e.addEventTypes("tick","addAtom","removeAtom","addRadialBond","removeRadialBond","addElectricField","removeElectricField","changeElectricField","removeAngularBond","textBoxesChanged","imagesChanged"),e}(),lt=at.propertySupport,ut={"short":1.33,medium:1.67,"long":2},ct=1e3,dt=!1,ht=[],pt=window.state={},ft=[],mt=function(){var e=s.createEngine();return e.pairwiseLJProperties.registerChangeHooks(lt.invalidatingChangePreHook,lt.invalidatingChangePostHook),e}(),gt=[],vt=[],yt=[],bt=null,xt=function(){var e=[{getNum:"getNumberOfAtoms",addEvent:"addAtom",removeEvent:"removeAtom"},{getNum:"getNumberOfRadialBonds",addEvent:"addRadialBond",removeEvent:"removeRadialBond"}];return function(t){var n,r,i;for(n=0;n<e.length;n++)r=e[n],r.num=mt[r.getNum]();for(t(),n=0;n<e.length;n++)r=e[n],i=mt[r.getNum](),i>r.num?st[r.addEvent]():i<r.num&&st[r.removeEvent]()}}();return tt.stepCounter=function(){return $.get("counter")},tt.stepStartCounter=function(){return $.get("startCounter")},tt.steps=function(){return $.get("length")},tt.isNewStep=function(){return dt},tt.seek=function(e){return arguments.length||(e=0),tt.isStopped()||tt.stop(),dt=!1,xt(function(){$.seekExtract(e),S(),tt.updateAllOutputProperties(),st.seek()}),$.get("counter")},tt.stepBack=function(e){return arguments.length||(e=1),tt.isStopped()||tt.stop(),dt=!1,xt(function(){var t,n;for(t=-1;++t<e;)n=$.get("index"),n>0&&($.decrementExtract(),S(),tt.updateAllOutputProperties(),st.stepBack())}),$.get("counter")},tt.stepForward=function(e){return arguments.length||(e=1),tt.isStopped()||tt.stop(),xt(function(){var t,n,r;for(t=-1;++t<e;)n=$.get("index"),r=$.get("length"),r-1>n?($.incrementExtract(),S(),tt.updateAllOutputProperties(),st.stepForward()):tt.tick()}),$.get("counter")},tt.createElements=function(e){var t,n,r,i;if(tt.startBatch(),void 0===e)return tt.addElement({id:0}),tt.endBatch(),void 0;for(t=0,n=e.mass.length;n>t;t++){i={};for(r in e)e.hasOwnProperty(r)&&(i[r]=e[r][t]);tt.addElement(i)}return tt.endBatch(),tt},tt.createAtoms=function(e){var t,n,r,i,o={suppressCheck:!0};for(st.willReset(),tt.startBatch(),n=e.x.length,t=0;n>t;t++){i={};for(r in e)e.hasOwnProperty(r)&&(i[r]=e[r][t]);tt.addAtom(i,o)}tt.endBatch(),st.reset()},tt.createRadialBonds=function(e){var t,n,r,i=e.strength.length;for(tt.startBatch(),t=0;i>t;t++){r={};for(n in e)e.hasOwnProperty(n)&&(r[n]=e[n][t]);tt.addRadialBond(r)}return tt.endBatch(),tt},tt.createAngularBonds=function(e){var t,n,r,i=e.strength.length;for(tt.startBatch(),t=0;i>t;t++){r={};for(n in e)e.hasOwnProperty(n)&&(r[n]=e[n][t]);tt.addAngularBond(r)}return tt.endBatch(),tt},tt.createRestraints=function(e){var t,n,r,i=e.atomIndex.length;for(t=0;i>t;t++){r={};for(n in e)e.hasOwnProperty(n)&&(r[n]=e[n][t]);tt.addRestraint(r)}return tt},tt.createObstacles=function(e){var t,n,r,i=e.x.length;for(t=0;i>t;t++){r={};for(n in e)e.hasOwnProperty(n)&&(r[n]=e[n][t]);tt.addObstacle(r)}return tt},tt.createShapes=function(e){var t,n,r,i=e.x.length;for(t=0;i>t;t++){r={};for(n in e)e.hasOwnProperty(n)&&(r[n]=e[n][t]);tt.addShape(r)}return tt},tt.createLines=function(e){var t,n,r,i=e.x1.length;for(t=0;i>t;t++){r={};for(n in e)e.hasOwnProperty(n)&&(r[n]=e[n][t]);tt.addLine(r)}return tt},tt.createElectricFields=function(e){return tt.batch(function(){var t,n,r,i=e.intensity.length;for(t=0;i>t;t++){r={};for(n in e)e.hasOwnProperty(n)&&(r[n]=e[n][t]);tt.addElectricField(r)}}),tt},tt.reset=function(){st.willReset(),lt.invalidatingChangePreHook(),mt.setTime(0),$.restoreInitialState(),lt.invalidatingChangePostHook(),tt.resetAllOutputProperties(),st.reset()},tt.getTotalMass=function(){return mt.getTotalMass()},tt.getAtomKineticEnergy=function(e){return mt.getAtomKineticEnergy(e)},tt.addRandomAtom=function(e,t){null==e&&(e=O()),null==t&&(t=0);var n,r,i,o=tt.get("width"),a=tt.get("height"),s=tt.get("minX"),l=tt.get("minY"),u=mt.getRadiusOfElement(e),c=0,d=10;do if(n=s+Math.random()*o-2*u,r=l+Math.random()*a-2*u,i=mt.findMinimumPELocation(e,n,r,0,0,t),i&&tt.addAtom({element:e,x:i[0],y:i[1],charge:t}))return!0;while(++c<d);return!1},tt.addAtom=function(e,t){var n,i=tt.get("minX"),o=tt.get("minY"),a=tt.get("maxX"),s=tt.get("maxY");return t=t||{},e=r.validateCompleteness(l.atom,e),n=mt.getRadiusOfElement(e.element),e.x<i+n&&(e.x=i+n),e.x>a-n&&(e.x=a-n),e.y<o+n&&(e.y=o+n),e.y>s-n&&(e.y=s-n),t.suppressCheck||mt.canPlaceAtom(e.element,e.x,e.y)?(lt.invalidatingChangePreHook(),mt.addAtom(e),lt.invalidatingChangePostHook(),st.addAtom(),!0):!1},tt.removeAtom=function(e){var t=mt.getNumberOfRadialBonds(),n=mt.getNumberOfAngularBonds();lt.invalidatingChangePreHook(),mt.removeAtom(e),gt.length=0,lt.invalidatingChangePostHook(),st.removeAtom(),mt.getNumberOfRadialBonds()!==t&&st.removeRadialBond(),mt.getNumberOfAngularBonds()!==n&&st.removeAngularBond()},tt.addElement=function(e){e=r.validateCompleteness(l.element,e),mt.addElement(e)},tt.addObstacle=function(e){var t;t=r.validateCompleteness(l.obstacle,e),lt.invalidatingChangePreHook(),mt.addObstacle(t),lt.invalidatingChangePostHook()},tt.removeObstacle=function(e){lt.invalidatingChangePreHook(),mt.removeObstacle(e),lt.invalidatingChangePostHook()},tt.addShape=function(e){var t;t=r.validateCompleteness(l.shape,e),lt.invalidatingChangePreHook(),mt.addShape(t),lt.invalidatingChangePostHook()},tt.removeShape=function(e){var t=mt.getNumberOfElectricFields();lt.invalidatingChangePreHook(),mt.removeShape(e),lt.invalidatingChangePostHook(),mt.getNumberOfElectricFields()!==t&&st.removeElectricField()},tt.addLine=function(e){var t;t=r.validateCompleteness(l.line,e),lt.invalidatingChangePreHook(),mt.addLine(t),lt.invalidatingChangePostHook()},tt.removeLine=function(e){lt.invalidatingChangePreHook(),mt.removeLine(e),lt.invalidatingChangePostHook()},tt.addElectricField=function(e){var t;t=r.validateCompleteness(l.electricField,e),lt.invalidatingChangePreHook(),mt.addElectricField(t),lt.invalidatingChangePostHook(),st.addElectricField()},tt.removeElectricField=function(e){lt.invalidatingChangePreHook(),mt.removeElectricField(e),lt.invalidatingChangePostHook(),st.removeElectricField()},tt.addRadialBond=function(e){e=r.validateCompleteness(l.radialBond,e),lt.invalidatingChangePreHook(),mt.addRadialBond(e),lt.invalidatingChangePostHook(),st.addRadialBond()},tt.removeRadialBond=function(e){lt.invalidatingChangePreHook(),mt.removeRadialBond(e),lt.invalidatingChangePostHook(),st.removeRadialBond()},tt.addAngularBond=function(e){e=r.validateCompleteness(l.angularBond,e),lt.invalidatingChangePreHook(),mt.addAngularBond(e),lt.invalidatingChangePostHook()},tt.removeAngularBond=function(e){lt.invalidatingChangePreHook(),mt.removeAngularBond(e),lt.invalidatingChangePostHook(),st.removeAngularBond()},tt.addRestraint=function(e){e=r.validateCompleteness(l.restraint,e),lt.invalidatingChangePreHook(),mt.addRestraint(e),lt.invalidatingChangePostHook()},tt.getMoleculeBoundingBox=function(e){var t,n,r,i,o,a,s,l=pt.atoms,u=-1/0,c=1/0,d=1/0,h=-1/0;for(t=mt.getMoleculeAtoms(e),t.push(e),n=0;n<t.length;n++)r=l.x[t[n]],i=l.y[t[n]],o=l.radius[t[n]],c>r-o&&(c=r-o),r+o>h&&(h=r+o),d>i-o&&(d=i-o),i+o>u&&(u=i+o);return a=l.x[e],s=l.y[e],{top:u-s,left:c-a,bottom:d-s,right:h-a}},tt.setTemperatureOfAtoms=function(e,t){lt.invalidatingChangePreHook(),mt.setTemperatureOfAtoms(e,t),lt.invalidatingChangePostHook()},tt.getTemperatureOfAtoms=function(e){return mt.getTemperatureOfAtoms(e)},tt.setAtomProperties=function(e,t,n,i){var o,a,s,u,c,d,h,p=pt.atoms;if(t=r.validate(l.atom,t),i&&(o=mt.getMoleculeAtoms(e),o.length>0))for(a="number"==typeof t.x?t.x-p.x[e]:0,s="number"==typeof t.y?t.y-p.y[e]:0,d=0,h=o.length;h>d;d++)if(u=p.x[o[d]]+a,c=p.y[o[d]]+s,!tt.setAtomProperties(o[d],{x:u,y:c},n,!1))return!1;if(n){var f="number"==typeof t.x?t.x:p.x[e],m="number"==typeof t.y?t.y:p.y[e],g="number"==typeof t.element?t.y:p.element[e];if(!mt.canPlaceAtom(g,f,m,e))return!1}return lt.invalidatingChangePreHook(),mt.setAtomProperties(e,C(t,l.atom)),lt.invalidatingChangePostHook(),!0},tt.getAtomProperties=function(e){var t,n=pt.atoms,r=l.atom,i={};for(t in r)r.hasOwnProperty(t)&&n[t]&&(i[t]=n[t][e]);return E(i,r)},tt.getRadialBondsForAtom=function(e){return mt.getRadialBondsForAtom(e)},tt.getAngularBondsForAtom=function(e){return mt.getAngularBondsForAtom(e)},tt.getMoleculeAtoms=function(e){return mt.getMoleculeAtoms(e)},tt.setElementProperties=function(e,t){if(t=r.validate(l.element,t),f.isAminoAcid(e))throw new Error("Elements: elements with ID "+e+" cannot be edited, as they define amino acids.");lt.invalidatingChangePreHook(),mt.setElementProperties(e,C(t,l.element)),lt.invalidatingChangePostHook()},tt.getElementProperties=function(e){var t,n=l.element,r={};for(t in n)n.hasOwnProperty(t)&&(r[t]=q[t][e]);return E(r,n)},tt.setObstacleProperties=function(e,t){t=r.validate(l.obstacle,t),lt.invalidatingChangePreHook(),mt.setObstacleProperties(e,C(t,l.obstacle)),lt.invalidatingChangePostHook()},tt.getObstacleProperties=function(e){var t,n=l.obstacle,r={};for(t in n)n.hasOwnProperty(t)&&(r[t]=W[t][e]);return E(r,n)},tt.setShapeProperties=function(e,t){t=r.validate(l.shape,t),lt.invalidatingChangePreHook(),mt.setShapeProperties(e,C(t,l.shape)),lt.invalidatingChangePostHook()},tt.getShapeProperties=function(e){var t,n=l.shape,r={};for(t in n)n.hasOwnProperty(t)&&(r[t]=H[t][e]);return E(r,n)},tt.setLineProperties=function(e,t){t=r.validate(l.line,t),lt.invalidatingChangePreHook(),mt.setLineProperties(e,C(t,l.line)),lt.invalidatingChangePostHook()},tt.getLineProperties=function(e){var t,n=l.line,r={};for(t in n)n.hasOwnProperty(t)&&(r[t]=z[t][e]);return E(r,n)},tt.setElectricFieldProperties=function(e,t){t=r.validate(l.electricField,t),lt.invalidatingChangePreHook(),mt.setElectricFieldProperties(e,C(t,l.electricField)),lt.invalidatingChangePostHook(),st.changeElectricField()},tt.getElectricFieldProperties=function(e){var t,n=l.electricField,r={};for(t in n)n.hasOwnProperty(t)&&(r[t]=X[t][e]);return E(r,n)},tt.setRadialBondProperties=function(e,t){t=r.validate(l.radialBond,t),lt.invalidatingChangePreHook(),mt.setRadialBondProperties(e,C(t,l.radialBond)),lt.invalidatingChangePostHook()},tt.getRadialBondProperties=function(e){var t,n=l.radialBond,r={};for(t in n)n.hasOwnProperty(t)&&(r[t]=Y[t][e]);return E(r,n)},tt.setRestraintProperties=function(e,t){t=r.validate(l.restraint,t),lt.invalidatingChangePreHook(),mt.setRestraintProperties(e,C(t,l.restraint)),lt.invalidatingChangePostHook()},tt.getRestraintProperties=function(e){var t,n=l.restraint,r={};for(t in n)n.hasOwnProperty(t)&&(r[t]=J[t][e]);return E(r,n)},tt.setAngularBondProperties=function(e,t){t=r.validate(l.angularBond,t),lt.invalidatingChangePreHook(),mt.setAngularBondProperties(e,C(t,l.angularBond)),lt.invalidatingChangePostHook()},tt.getAngularBondProperties=function(e){var t,n=l.angularBond,r={};for(t in n)n.hasOwnProperty(t)&&(r[t]=K[t][e]);return E(r,n)},tt.setSolvent=function(e){var t=new h(e),n={solventForceType:t.forceType,dielectricConstant:t.dielectricConstant,backgroundColor:t.color};tt.set(n)},tt.addSpringForce=function(e,t,n,r){return null==r&&(r=500),ot&&(r=ot.translateToModelUnits(r,"stiffness")),mt.addSpringForce(e,t,n,r)},tt.updateSpringForce=function(e,t,n){mt.updateSpringForce(e,t,n)},tt.removeSpringForce=function(e){mt.removeSpringForce(e)},tt.addTextBox=function(e){e=r.validateCompleteness(l.textBox,e),tt.get("textBoxes").push(e),st.textBoxesChanged()},tt.removeTextBox=function(e){var t=tt.get("textBoxes");if(!(e>=0&&e<t.length))throw new Error('Text box "'+e+'" does not exist, so it cannot be removed.');tt.set("textBoxes",t.slice(0,e).concat(t.slice(e+1))),st.textBoxesChanged()},tt.setTextBoxProperties=function(e,t){var n,i=tt.get("textBoxes")[e];if(!i)throw new Error('Text box "'+e+'" does not exist, so it cannot have properties set.');t=r.validate(l.textBox,t);for(n in t)t.hasOwnProperty(n)&&(i[n]=t[n]);st.textBoxesChanged()},tt.setImageProperties=function(e,t){var n,i=tt.get("images")[e];if(!i)throw new Error('Image "'+e+'" does not exist, so it cannot have properties set.');t=r.validate(l.image,t);for(n in t)t.hasOwnProperty(n)&&(i[n]=t[n]);st.imagesChanged()},tt.getTextBoxProperties=function(e){return tt.get("textBoxes")[e]},tt.getImageProperties=function(e){return tt.get("images")[e]},tt.liveDragStart=function(e,t,n){null==bt&&(null==t&&(t=pt.atoms.x[e]),null==n&&(n=pt.atoms.y[e]),Q=tt.getAtomProperties(e).friction,tt.setAtomProperties(e,{friction:tt.LIVE_DRAG_FRICTION}),bt=tt.addSpringForce(e,t,n,500))},tt.liveDrag=function(e,t){tt.updateSpringForce(bt,e,t)},tt.liveDragEnd=function(){var e=mt.springForceAtomIndex(bt);tt.setAtomProperties(e,{friction:Q}),tt.removeSpringForce(bt),bt=null},tt.getFPS=function(){for(var e=0,t=ht.length,n=-1;++n<t;)e+=ht[n];return e/=t,e?1/e*1e3:0},tt.getSimulationProgressRate=function(){return tt.getFPS()*tt.get("timeStep")*tt.get("timeStepsPerTick")},tt.get_elements=function(){return q},tt.getAtoms=function(){return gt},tt.getRadialBonds=function(){return vt},tt.getElectricField=function(){return yt},tt.getPhotons=function(){return Z},tt.turnOnLightSource=function(){mt.callPluginAccessor("turnOnLightSource")},tt.turnOffLightSource=function(){mt.callPluginAccessor("turnOffLightSource")},tt.setLightSourceAngle=function(e){mt.callPluginAccessor("setLightSourceAngle",[e])},tt.setLightSourceFrequency=function(e){mt.callPluginAccessor("setLightSourceFrequency",[e])},tt.setLightSourcePeriod=function(e){mt.callPluginAccessor("setLightSourcePeriod",[e])},tt.setLightSourceNumber=function(e){mt.callPluginAccessor("setLightSourceNumber",[e])},tt.getNumberOfAtoms=function(e){return e?gt.reduce(function(t,n){return e(n)?t+1:t},0):gt.length},tt.get_obstacles=function(){return W},tt.get_shapes=function(){return H},tt.get_lines=function(){return z},tt.getNumberOfElements=function(){return mt.getNumberOfElements()},tt.getNumberOfObstacles=function(){return mt.getNumberOfObstacles()},tt.getNumberOfShapes=function(){return mt.getNumberOfShapes()},tt.getNumberOfLines=function(){return mt.getNumberOfLines()},tt.getNumberOfRadialBonds=function(){return mt.getNumberOfRadialBonds()},tt.getNumberOfAngularBonds=function(){return mt.getNumberOfAngularBonds()},tt.getNumberOfSpringForces=function(){return mt.getNumberOfSpringForces()},tt.getNumberOfElectricFields=function(){return mt.getNumberOfElectricFields()},tt.getNumberOfTextBoxes=function(){return tt.get("textBoxes").length},tt.get_restraints=function(){return J},tt.getPairwiseLJProperties=function(){return mt.pairwiseLJProperties},tt.geneticEngine=function(){return U},tt.get_vdw_pairs=function(){return mt.getVdwPairsArray()},tt.tickInPlace=function(){return st.tick(),tt},tt.tick=function(){var e,n,r=tt.get("timeStep");ot&&(r=ot.translateToModelUnits(r,"time")),tt.isStopped()||(e=t.now(),G?(n=e-G,G=e,ht.push(n),ht.splice(0,ht.length-64),T(n)):G=e),t.enterScope("engine"),mt.integrate(tt.get("timeStepsPerTick")*r,r),t.leaveScope("engine"),S(),tt.updateAllOutputProperties(),$.push(),dt=!0,mt.radialBondsChanged&&st.addRadialBond(),st.tick()
},tt.minimizeEnergy=function(){return lt.invalidatingChangePreHook(),mt.minimizeEnergy(),lt.invalidatingChangePostHook(),st.tick(),tt},tt.dimensions=function(){return mt.getDimensions()},tt.format=function(e,t){t=t||{};var n=tt.getPropertyDescription(e);return n?n.format(tt.get(e),t):d3.format(t.format||"g")(tt.get(e))},tt.getUnitDefinition=function(e){return it.units[e]},tt.atomTransition=function(){var e=new v(tt);return ft.push(e),e},tt.cancelTransitions=function(){ft.length=0},tt.startBatch=function(){lt.startBatch(),st.startBatch()},tt.endBatch=function(){lt.endBatch(),st.endBatch()},tt.batch=function(e){tt.startBatch(),e(),tt.endBatch()},tt.serialize=function(){var e,t,r,i={},o=lt.rawValues,a=function(e,t){i.atoms[e].every(function(e){return e===t})&&delete i.atoms[e]};if(i=n(l.mainProperties,o),i.viewOptions=n(l.viewOptions,o),i.atoms=n(l.atom,pt.atoms,mt.getNumberOfAtoms()),mt.getNumberOfRadialBonds()&&(i.radialBonds=n(l.radialBond,Y,mt.getNumberOfRadialBonds())),mt.getNumberOfAngularBonds()&&(i.angularBonds=n(l.angularBond,K,mt.getNumberOfAngularBonds())),mt.getNumberOfObstacles())for(i.obstacles=n(l.obstacle,W,mt.getNumberOfObstacles()),t=0,r=i.obstacles.x.length;r>t;t++)i.obstacles.westProbe[t]=Boolean(i.obstacles.westProbe[t]),i.obstacles.northProbe[t]=Boolean(i.obstacles.northProbe[t]),i.obstacles.eastProbe[t]=Boolean(i.obstacles.eastProbe[t]),i.obstacles.southProbe[t]=Boolean(i.obstacles.southProbe[t]);for(mt.getNumberOfShapes()&&(i.shapes=n(l.shape,H,mt.getNumberOfShapes())),mt.getNumberOfLines()&&(i.lines=n(l.line,z,mt.getNumberOfLines())),mt.getNumberOfElectricFields()&&(i.electricFields=n(l.electricField,X,mt.getNumberOfElectricFields())),mt.getNumberOfRestraints()&&(i.restraints=n(l.restraint,J,mt.getNumberOfRestraints())),i.elements=n(l.element,q,5),i.pairwiseLJProperties=[],e=mt.pairwiseLJProperties.serialize(),t=0,r=e.length;r>t;t++)e[t].element1<=5&&e[t].element2<=5&&i.pairwiseLJProperties.push(e[t]);return i.temperatureControl===!1&&delete i.targetTemperature,i.viewOptions.showAtomTrace===!1&&delete i.viewOptions.atomTraceId,"default"===i.modelSampleRate&&delete i.modelSampleRate,tt.properties.useQuantumDynamics&&(i.quantumDynamics=B()),tt.properties.useChemicalReactions?i.chemicalReactions=D():delete i.atoms.radical,a("marked",l.atom.marked.defaultValue),a("visible",l.atom.visible.defaultValue),a("draggable",l.atom.draggable.defaultValue),i},tt.LIVE_DRAG_FRICTION=10,e.DNA&&(e.width=200,e.height=5,e.viewOptions=e.viewOptions||{},e.viewOptions.viewPortX=0,e.viewOptions.viewPortY=0,e.viewOptions.viewPortWidth=5,e.viewOptions.viewPortHeight=3),function(){if(e.viewOptions&&e.viewOptions.textBoxes){var t,n,i=e.viewOptions.textBoxes;for(t=0,n=i.length;n>t;t++)i[t]=r.validateCompleteness(l.textBox,i[t])}}(),et={quantumDynamics:e.quantumDynamics,chemicalReactions:e.chemicalReactions},j=e.elements,tt.createElements(j),M(),at.mixInto(tt),N(tt.properties),tt.on("stop.last-sample-time-reset",function(){G=null}),lt.on("afterInvalidatingChange.read-model-state",S),lt.on("afterInvalidatingChangeSequence.tick-history",function(){$&&$.invalidateFollowingState(),st.invalidation()}),I(tt.properties,et),U=new m(tt),tt.set({polarAAEpsilon:tt.get("polarAAEpsilon")}),e.atoms&&tt.createAtoms(e.atoms),e.radialBonds&&tt.createRadialBonds(e.radialBonds),e.angularBonds&&tt.createAngularBonds(e.angularBonds),e.restraints&&tt.createRestraints(e.restraints),e.obstacles&&tt.createObstacles(e.obstacles),e.shapes&&tt.createShapes(e.shapes),e.lines&&tt.createLines(e.lines),e.electricFields&&tt.createElectricFields(e.electricFields),e.pairwiseLJProperties&&mt.pairwiseLJProperties.deserialize(e.pairwiseLJProperties),$=new a({getProperties:function(){return lt.historyStateRawValues},restoreProperties:lt.setRawValues,state:mt.getState()},tt,ct),at.tickHistory=$,V=new o({propertySupport:lt,unitsDefinition:it,tickHistory:$}),V.mixInto(tt),dt=!0,tt.defineOutput("time",{label:"Time",unitType:"time",format:"f"},function(){var e=pt.time;return ot&&(e=ot.translateFromModelUnits(e,"time")),e}),tt.defineOutput("timePerTick",{label:"Model time per tick",unitType:"time",format:"f"},function(){return tt.get("timeStep")*tt.get("timeStepsPerTick")}),function(){var e;it.units.time.displayValue?e=it.units.time.displayValue:(e=y.extend({},it.units.time),e.unitsPerBaseUnit=1),tt.defineOutput("displayTime",{label:"Time",unitName:e.name,unitPluralName:e.pluralName,unitAbbreviation:e.symbol,format:".1f"},function(){return tt.get("time")*e.unitsPerBaseUnit}),tt.defineOutput("displayTimePerTick",{label:"Model time per tick",unitName:e.name,unitPluralName:e.pluralName,unitAbbreviation:e.symbol,format:".3f"},function(){return tt.get("timePerTick")*e.unitsPerBaseUnit})}(),tt.defineOutput("tickCounter",{label:"Tick Counter",unitType:"",format:"4g"},function(){return $.get("counter")}),tt.defineOutput("newStep",{label:"New Step",unitType:"",format:""},function(){return dt}),tt.defineOutput("kineticEnergy",{label:"Kinetic Energy",unitType:"energy",format:".4g"},function(){var e=pt.KE;return ot&&(e=ot.translateFromModelUnits(e,"energy")),e}),tt.defineOutput("potentialEnergy",{label:"Potential Energy",unitType:"energy",format:".4g"},function(){var e=pt.PE;return ot&&(e=ot.translateFromModelUnits(e,"energy")),e}),tt.defineOutput("totalEnergy",{label:"Total Energy",unitType:"energy",format:".4g"},function(){var e=pt.KE+pt.PE;return ot&&(e=ot.translateFromModelUnits(e,"energy")),e}),tt.defineOutput("temperature",{label:"Temperature",unitType:"temperature",format:"f"},function(){var e=pt.temperature;return ot&&(e=ot.translateFromModelUnits(e,"temperature")),e}),tt.on("play.model",F),tt.on("stop.model",F),tt.defineOutput("isPlayable",{label:"Playable"},function(){return tt.isReady&&tt.isStopped()}),tt.defineOutput("hasPlayed",{label:"has Played"},function(){return tt.hasPlayed}),tt.defineOutput("isStopped",{label:"Stopped?"},function(){return tt.isStopped()}),S(),tt.updateAllOutputProperties(),_.waitForSetup||tt.ready(),tt.performanceOptimizer=new g(tt),tt.namespace=nt,tt}}),define("common/views/tab-index",[],function(){var e=0;return function(){return e++}}),define("common/feature-tests",[],function(){var e={};return{get cssPointerEvents(){return void 0===e.cssPointerEvents&&(e.cssPointerEvents=function(){var e,t,n,r;switch(e=$("<div class='supported'>").css({position:"fixed",left:0,top:0,width:"10px",height:"10px"}).appendTo("body"),t=$("<div class='unsupported'>").css({position:"fixed",left:0,top:0,width:"10px",height:"10px","pointer-events":"none"}).appendTo("body"),n=$("<svg class='unsupported'>").css({position:"fixed",left:0,top:0,width:"10px",height:"10px","pointer-events":"none"}).appendTo("body"),r=document.elementFromPoint(5,5).className,n.remove(),t.remove(),e.remove(),r){case"supported":return!0;case"unsupported":return!1;default:return console.warn("CSS pointer-events feature test failed"),!1}}()),e.cssPointerEvents}}}),define("common/views/hit-testing-helper",["require","common/feature-tests"],function(e){var t=e("common/feature-tests"),n=["mousedown","mouseup","contextmenu"];return function(e){function r(e,t){var n=document.createEvent("MouseEvent");return n.initMouseEvent(e.type,e.bubbles,e.cancelable,e.view,e.detail,e.screenX,e.screenY,e.clientX,e.clientY,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,e.button,e.relatedTarget),n.target=t,n}function i(e,t){var n=document.createEvent("MouseEvent");return n.initMouseEvent("click",!0,e.cancelable,e.view,e.detail,e.screenX,e.screenY,e.clientX,e.clientY,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,e.button,e.relatedTarget),n.target=t,n}function o(e){var t=d[e];h[e]=t.style[v],t.style[v]=y}function a(e){for(var t=e;t>=0;t--)d[t].style[v]=h[t]}function s(e){h=[];var t,n,i,s,l,u;f=null;for(var p=0,g=d.length;g>p;p++)if(t=d[p],p>0&&o(p-1),"canvas"===t.tagName.toLowerCase()){if(c.hitTestCallback=function(e){s=e,e||(i.stopPropagation(),i.preventDefault())},c.mouseupCallback=function(e){l=e},i=r(e,t),t.dispatchEvent(i),l&&(f=t),s)return a(p-1),m=i.defaultPrevented,t}else if(u=t.style.backgroundColor,t.style.backgroundColor="rgba(0,0,0,0)",n=document.elementFromPoint(e.clientX,e.clientY),t.style.backgroundColor=u,n!==t)return a(p-1),i=r(e,n),n.dispatchEvent(i),m=i.defaultPrevented,n;a(d.length-2)}function l(e){function t(e,t){var n=document.createEvent("MouseEvent");return n.initMouseEvent(t,!0,!0,window,1,e.screenX,e.screenY,e.clientX,e.clientY,!1,!1,!1,!1,0,null),n}function n(e){return Math.abs(e.screenX-o)>10||Math.abs(e.screenY-a)>10}function r(n){var r=n.changedTouches[0];n.touches.length>1||r.target!==e||(g=!1,o=r.screenX,a=r.screenY,s=r.identifier,e.dispatchEvent(t(r,"mousedown")),m&&n.preventDefault(),n.stopPropagation())}function i(e){if(null!==s){if("touchmove"===e.type&&e.touches.length>1)return g=!0,e.stopPropagation(),void 0;var r,i,o,a;for(r=0,i=e.changedTouches.length;i>r;r++)if(o=e.changedTouches[r],o.identifier===s)return 1===i&&e.stopPropagation(),a=document.elementFromPoint(o.clientX,o.clientY)||window,"touchmove"===e.type?(g||(g=n(o)),a.dispatchEvent(t(o,"mousemove"))):"touchend"===e.type?(a.dispatchEvent(t(o,"mouseup")),s=null):"touchcancel"===e.type&&(g=!0,a.dispatchEvent(t(o,"mouseup")),s=null),("touchend"===e.type||m)&&e.preventDefault(),void 0}}var o,a,s=null;window.addEventListener("touchstart",r,!0),["touchmove","touchend","touchcancel"].forEach(function(e){window.addEventListener(e,i,!0)})}function u(){d=[e],n.forEach(function(t){window.addEventListener(t,function(t){var n;t.target===e&&(t.stopPropagation(),"mousedown"!==t.type&&t.preventDefault(),n=s(t),"mousedown"===t.type?p=n:"mouseup"===t.type&&(n&&n===p&&"canvas"!==n.tagName.toLowerCase()&&!g&&n.dispatchEvent(i(t),n),f&&!g&&f.dispatchEvent(i(t),f)))},!0)}),window.addEventListener("click",function(t){t.target===e&&(t.stopPropagation(),t.preventDefault())},!0),l(e)}var c,d,h,p,f,m,g,v=t.cssPointerEvents?"pointerEvents":"visibility",y=t.cssPointerEvents?"none":"hidden";return c={passMouseMove:function(e,t){function n(e,t,n,r){var i=document.createEvent("MouseEvent");return i.initMouseEvent(t,e.bubbles,e.cancelable,e.view,e.detail,e.screenX,e.screenY,e.clientX,e.clientY,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,e.button,r),i.target=n,i}var i;window.addEventListener("mousemove",function(o){if(!o.synthetic){var a,s;a=o.target===e?t:o.target,a!==i&&(a===t?t.dispatchEvent(n(o,"mouseover",t,i)):i===t&&t.dispatchEvent(n(o,"mouseout",t,a))),o.stopPropagation(),o.preventDefault(),s=r(o,a),s.synthetic=!0,a.dispatchEvent(s),m=s.defaultPrevented,i=a}},!0)},addLayer:function(e){d.splice(1,0,e)},hitTestCallback:function(){},mouseupCallback:function(){}},u(),c}}),function(){function e(){return i.Matrix="undefined"!=typeof Float32Array?Float32Array:Array,i.Matrix}function t(e){return[(e>>16&255)/255,(e>>8&255)/255,(255&e)/255]}function t(e){return[(e>>16&255)/255,(e>>8&255)/255,(255&e)/255]}var n=this,i=i||{};i.Point=function(e,t){this.x=e||0,this.y=t||0},i.Point.prototype.clone=function(){return new i.Point(this.x,this.y)},i.Point.prototype.constructor=i.Point,i.Rectangle=function(e,t,n,r){this.x=e||0,this.y=t||0,this.width=n||0,this.height=r||0},i.Rectangle.prototype.clone=function(){return new i.Rectangle(this.x,this.y,this.width,this.height)},i.Rectangle.prototype.contains=function(e,t){if(this.width<=0||this.height<=0)return!1;var n=this.x;if(e>=n&&e<=n+this.width){var r=this.y;if(t>=r&&t<=r+this.height)return!0}return!1},i.Rectangle.prototype.constructor=i.Rectangle,i.Polygon=function(e){if(e instanceof Array||(e=Array.prototype.slice.call(arguments)),"number"==typeof e[0]){for(var t=[],n=0,r=e.length;r>n;n+=2)t.push(new i.Point(e[n],e[n+1]));e=t}this.points=e},i.Polygon.prototype.clone=function(){for(var e=[],t=0;t<this.points.length;t++)e.push(this.points[t].clone());return new i.Polygon(e)},i.Polygon.prototype.contains=function(e,t){for(var n=!1,r=0,i=this.points.length-1;r<this.points.length;i=r++){var o=this.points[r].x,a=this.points[r].y,s=this.points[i].x,l=this.points[i].y,u=a>t!=l>t&&(s-o)*(t-a)/(l-a)+o>e;u&&(n=!n)}return n},i.Polygon.prototype.constructor=i.Polygon,i.Circle=function(e,t,n){this.x=e||0,this.y=t||0,this.radius=n||0},i.Circle.prototype.clone=function(){return new i.Circle(this.x,this.y,this.radius)},i.Circle.prototype.contains=function(e,t){if(this.radius<=0)return!1;var n=this.x-e,r=this.y-t,i=this.radius*this.radius;return n*=n,r*=r,i>=n+r},i.Circle.prototype.constructor=i.Circle,i.Ellipse=function(e,t,n,r){this.x=e||0,this.y=t||0,this.width=n||0,this.height=r||0},i.Ellipse.prototype.clone=function(){return new i.Ellipse(this.x,this.y,this.width,this.height)},i.Ellipse.prototype.contains=function(e,t){if(this.width<=0||this.height<=0)return!1;var n=(e-this.x)/this.width-.5,r=(t-this.y)/this.height-.5;return n*=n,r*=r,.25>n+r},i.Ellipse.getBounds=function(){return new i.Rectangle(this.x,this.y,this.width,this.height)},i.Ellipse.prototype.constructor=i.Ellipse,e(),i.mat3={},i.mat3.create=function(){var e=new i.Matrix(9);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},i.mat3.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},i.mat4={},i.mat4.create=function(){var e=new i.Matrix(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},i.mat3.multiply=function(e,t,n){n||(n=e);var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],l=e[5],u=e[6],c=e[7],d=e[8],h=t[0],p=t[1],f=t[2],m=t[3],g=t[4],v=t[5],y=t[6],b=t[7],x=t[8];return n[0]=h*r+p*a+f*u,n[1]=h*i+p*s+f*c,n[2]=h*o+p*l+f*d,n[3]=m*r+g*a+v*u,n[4]=m*i+g*s+v*c,n[5]=m*o+g*l+v*d,n[6]=y*r+b*a+x*u,n[7]=y*i+b*s+x*c,n[8]=y*o+b*l+x*d,n},i.mat3.clone=function(e){var t=new i.Matrix(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},i.mat3.transpose=function(e,t){if(!t||e===t){var n=e[1],r=e[2],i=e[5];return e[1]=e[3],e[2]=e[6],e[3]=n,e[5]=e[7],e[6]=r,e[7]=i,e}return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],t},i.mat3.toMat4=function(e,t){return t||(t=i.mat4.create()),t[15]=1,t[14]=0,t[13]=0,t[12]=0,t[11]=0,t[10]=e[8],t[9]=e[7],t[8]=e[6],t[7]=0,t[6]=e[5],t[5]=e[4],t[4]=e[3],t[3]=0,t[2]=e[2],t[1]=e[1],t[0]=e[0],t},i.mat4.create=function(){var e=new i.Matrix(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},i.mat4.transpose=function(e,t){if(!t||e===t){var n=e[1],r=e[2],i=e[3],o=e[6],a=e[7],s=e[11];return e[1]=e[4],e[2]=e[8],e[3]=e[12],e[4]=n,e[6]=e[9],e[7]=e[13],e[8]=r,e[9]=o,e[11]=e[14],e[12]=i,e[13]=a,e[14]=s,e}return t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15],t},i.mat4.multiply=function(e,t,n){n||(n=e);var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],l=e[5],u=e[6],c=e[7],d=e[8],h=e[9],p=e[10],f=e[11],m=e[12],g=e[13],v=e[14],y=e[15],b=t[0],x=t[1],w=t[2],_=t[3];return n[0]=b*r+x*s+w*d+_*m,n[1]=b*i+x*l+w*h+_*g,n[2]=b*o+x*u+w*p+_*v,n[3]=b*a+x*c+w*f+_*y,b=t[4],x=t[5],w=t[6],_=t[7],n[4]=b*r+x*s+w*d+_*m,n[5]=b*i+x*l+w*h+_*g,n[6]=b*o+x*u+w*p+_*v,n[7]=b*a+x*c+w*f+_*y,b=t[8],x=t[9],w=t[10],_=t[11],n[8]=b*r+x*s+w*d+_*m,n[9]=b*i+x*l+w*h+_*g,n[10]=b*o+x*u+w*p+_*v,n[11]=b*a+x*c+w*f+_*y,b=t[12],x=t[13],w=t[14],_=t[15],n[12]=b*r+x*s+w*d+_*m,n[13]=b*i+x*l+w*h+_*g,n[14]=b*o+x*u+w*p+_*v,n[15]=b*a+x*c+w*f+_*y,n},i.DisplayObject=function(){this.last=this,this.first=this,this.position=new i.Point,this.scale=new i.Point(1,1),this.pivot=new i.Point(0,0),this.rotation=0,this.alpha=1,this.visible=!0,this.hitArea=null,this.buttonMode=!1,this.renderable=!1,this.parent=null,this.stage=null,this.worldAlpha=1,this._interactive=!1,this.worldTransform=i.mat3.create(),this.localTransform=i.mat3.create(),this.color=[],this.dynamic=!0,this._sr=0,this._cr=1},i.DisplayObject.prototype.constructor=i.DisplayObject,i.DisplayObject.prototype.setInteractive=function(e){this.interactive=e},Object.defineProperty(i.DisplayObject.prototype,"interactive",{get:function(){return this._interactive},set:function(e){this._interactive=e,this.stage&&(this.stage.dirty=!0)}}),Object.defineProperty(i.DisplayObject.prototype,"mask",{get:function(){return this._mask},set:function(e){this._mask=e,e?this.addFilter(e):this.removeFilter()}}),i.DisplayObject.prototype.addFilter=function(e){if(!this.filter){this.filter=!0;var t=new i.FilterBlock,n=new i.FilterBlock;t.mask=e,n.mask=e,t.first=t.last=this,n.first=n.last=this,t.open=!0;var r,o,a=t,s=t;o=this.first._iPrev,o?(r=o._iNext,a._iPrev=o,o._iNext=a):r=this,r&&(r._iPrev=s,s._iNext=r);var a=n,s=n,r=null,o=null;o=this.last,r=o._iNext,r&&(r._iPrev=s,s._iNext=r),a._iPrev=o,o._iNext=a;for(var l=this,u=this.last;l;)l.last==u&&(l.last=n),l=l.parent;this.first=t,this.__renderGroup&&this.__renderGroup.addFilterBlocks(t,n),e.renderable=!1}},i.DisplayObject.prototype.removeFilter=function(){if(this.filter){this.filter=!1;var e=this.first,t=e._iNext,n=e._iPrev;t&&(t._iPrev=n),n&&(n._iNext=t),this.first=e._iNext;var r=this.last,t=r._iNext,n=r._iPrev;t&&(t._iPrev=n),n._iNext=t;for(var i=r._iPrev,o=this;o.last==r&&(o.last=i,o=o.parent););var a=e.mask;a.renderable=!0,this.__renderGroup&&this.__renderGroup.removeFilterBlocks(e,r)}},i.DisplayObject.prototype.updateTransform=function(){this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation));var e=this.localTransform,t=this.parent.worldTransform,n=this.worldTransform;e[0]=this._cr*this.scale.x,e[1]=-this._sr*this.scale.y,e[3]=this._sr*this.scale.x,e[4]=this._cr*this.scale.y;var r=this.pivot.x,o=this.pivot.y,a=e[0],s=e[1],l=this.position.x-e[0]*r-o*e[1],u=e[3],c=e[4],d=this.position.y-e[4]*o-r*e[3],h=t[0],p=t[1],f=t[2],m=t[3],g=t[4],v=t[5];e[2]=l,e[5]=d,n[0]=h*a+p*u,n[1]=h*s+p*c,n[2]=h*l+p*d+f,n[3]=m*a+g*u,n[4]=m*s+g*c,n[5]=m*l+g*d+v,this.worldAlpha=this.alpha*this.parent.worldAlpha,this.vcount=i.visibleCount},i.visibleCount=0,i.DisplayObjectContainer=function(){i.DisplayObject.call(this),this.children=[]},i.DisplayObjectContainer.prototype=Object.create(i.DisplayObject.prototype),i.DisplayObjectContainer.prototype.constructor=i.DisplayObjectContainer,i.DisplayObjectContainer.prototype.addChild=function(e){if(void 0!=e.parent&&e.parent.removeChild(e),e.parent=this,this.children.push(e),this.stage){var t=e;do t.interactive&&(this.stage.dirty=!0),t.stage=this.stage,t=t._iNext;while(t)}var n,r,i=e.first,o=e.last;r=this.filter?this.last._iPrev:this.last,n=r._iNext;for(var a=this,s=r;a;)a.last==s&&(a.last=e.last),a=a.parent;n&&(n._iPrev=o,o._iNext=n),i._iPrev=r,r._iNext=i,this.__renderGroup&&(e.__renderGroup&&e.__renderGroup.removeDisplayObjectAndChildren(e),this.__renderGroup.addDisplayObjectAndChildren(e))},i.DisplayObjectContainer.prototype.addChildAt=function(e,t){if(!(t>=0&&t<=this.children.length))throw new Error(e+" The index "+t+" supplied is out of bounds "+this.children.length);if(void 0!=e.parent&&e.parent.removeChild(e),e.parent=this,this.stage){var n=e;do n.interactive&&(this.stage.dirty=!0),n.stage=this.stage,n=n._iNext;while(n)}var r,i,o=e.first,a=e.last;if(t==this.children.length){i=this.last;for(var s=this,l=this.last;s;)s.last==l&&(s.last=e.last),s=s.parent}else i=0==t?this:this.children[t-1].last;r=i._iNext,r&&(r._iPrev=a,a._iNext=r),o._iPrev=i,i._iNext=o,this.children.splice(t,0,e),this.__renderGroup&&(e.__renderGroup&&e.__renderGroup.removeDisplayObjectAndChildren(e),this.__renderGroup.addDisplayObjectAndChildren(e))},i.DisplayObjectContainer.prototype.swapChildren=function(){},i.DisplayObjectContainer.prototype.getChildAt=function(e){if(e>=0&&e<this.children.length)return this.children[e];throw new Error(child+" Both the supplied DisplayObjects must be a child of the caller "+this)},i.DisplayObjectContainer.prototype.removeChild=function(e){var t=this.children.indexOf(e);if(-1===t)throw new Error(e+" The supplied DisplayObject must be a child of the caller "+this);var n=e.first,r=e.last,i=r._iNext,o=n._iPrev;if(i&&(i._iPrev=o),o._iNext=i,this.last==r)for(var a=n._iPrev,s=this;s.last==r.last&&(s.last=a,s=s.parent););if(r._iNext=null,n._iPrev=null,this.stage){var l=e;do l.interactive&&(this.stage.dirty=!0),l.stage=null,l=l._iNext;while(l)}e.__renderGroup&&e.__renderGroup.removeDisplayObjectAndChildren(e),e.parent=void 0,this.children.splice(t,1)},i.DisplayObjectContainer.prototype.updateTransform=function(){if(this.visible){i.DisplayObject.prototype.updateTransform.call(this);for(var e=0,t=this.children.length;t>e;e++)this.children[e].updateTransform()}},i.blendModes={},i.blendModes.NORMAL=0,i.blendModes.SCREEN=1,i.Sprite=function(e){i.DisplayObjectContainer.call(this),this.anchor=new i.Point,this.texture=e,this.blendMode=i.blendModes.NORMAL,this._width=0,this._height=0,e.baseTexture.hasLoaded?this.updateFrame=!0:(this.onTextureUpdateBind=this.onTextureUpdate.bind(this),this.texture.addEventListener("update",this.onTextureUpdateBind)),this.renderable=!0},i.Sprite.prototype=Object.create(i.DisplayObjectContainer.prototype),i.Sprite.prototype.constructor=i.Sprite,Object.defineProperty(i.Sprite.prototype,"width",{get:function(){return this.scale.x*this.texture.frame.width},set:function(e){this.scale.x=e/this.texture.frame.width,this._width=e}}),Object.defineProperty(i.Sprite.prototype,"height",{get:function(){return this.scale.y*this.texture.frame.height},set:function(e){this.scale.y=e/this.texture.frame.height,this._height=e}}),i.Sprite.prototype.setTexture=function(e){this.texture.baseTexture!=e.baseTexture?(this.textureChange=!0,this.texture=e,this.__renderGroup&&this.__renderGroup.updateTexture(this)):this.texture=e,this.updateFrame=!0},i.Sprite.prototype.onTextureUpdate=function(){this._width&&(this.scale.x=this._width/this.texture.frame.width),this._height&&(this.scale.y=this._height/this.texture.frame.height),this.updateFrame=!0},i.Sprite.fromFrame=function(e){var t=i.TextureCache[e];if(!t)throw new Error("The frameId '"+e+"' does not exist in the texture cache"+this);return new i.Sprite(t)},i.Sprite.fromImage=function(e){var t=i.Texture.fromImage(e);return new i.Sprite(t)},i.MovieClip=function(e){i.Sprite.call(this,e[0]),this.textures=e,this.animationSpeed=1,this.loop=!0,this.onComplete=null,this.currentFrame=0,this.playing=!1},i.MovieClip.prototype=Object.create(i.Sprite.prototype),i.MovieClip.prototype.constructor=i.MovieClip,i.MovieClip.prototype.stop=function(){this.playing=!1},i.MovieClip.prototype.play=function(){this.playing=!0},i.MovieClip.prototype.gotoAndStop=function(e){this.playing=!1,this.currentFrame=e;var t=this.currentFrame+.5|0;this.setTexture(this.textures[t%this.textures.length])},i.MovieClip.prototype.gotoAndPlay=function(e){this.currentFrame=e,this.playing=!0},i.MovieClip.prototype.updateTransform=function(){if(i.Sprite.prototype.updateTransform.call(this),this.playing){this.currentFrame+=this.animationSpeed;var e=this.currentFrame+.5|0;this.loop||e<this.textures.length?this.setTexture(this.textures[e%this.textures.length]):e>=this.textures.length&&(this.gotoAndStop(this.textures.length-1),this.onComplete&&this.onComplete())}},i.FilterBlock=function(e){this.graphics=e,this.visible=!0,this.renderable=!0},i.Text=function(e,t){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),i.Sprite.call(this,i.Texture.fromCanvas(this.canvas)),this.setText(e),this.setStyle(t),this.updateText(),this.dirty=!1},i.Text.prototype=Object.create(i.Sprite.prototype),i.Text.prototype.constructor=i.Text,i.Text.prototype.setStyle=function(e){e=e||{},e.font=e.font||"bold 20pt Arial",e.fill=e.fill||"black",e.align=e.align||"left",e.stroke=e.stroke||"black",e.strokeThickness=e.strokeThickness||0,e.wordWrap=e.wordWrap||!1,e.wordWrapWidth=e.wordWrapWidth||100,this.style=e,this.dirty=!0},i.Sprite.prototype.setText=function(e){this.text=e.toString()||" ",this.dirty=!0},i.Text.prototype.updateText=function(){this.context.font=this.style.font;var e=this.text;this.style.wordWrap&&(e=this.wordWrap(this.text));for(var t=e.split(/(?:\r\n|\r|\n)/),n=[],r=0,o=0;o<t.length;o++){var a=this.context.measureText(t[o]).width;n[o]=a,r=Math.max(r,a)}this.canvas.width=r+this.style.strokeThickness;var s=this.determineFontHeight("font: "+this.style.font+";")+this.style.strokeThickness;for(this.canvas.height=s*t.length,this.context.fillStyle=this.style.fill,this.context.font=this.style.font,this.context.strokeStyle=this.style.stroke,this.context.lineWidth=this.style.strokeThickness,this.context.textBaseline="top",o=0;o<t.length;o++){var l=new i.Point(this.style.strokeThickness/2,this.style.strokeThickness/2+o*s);"right"==this.style.align?l.x+=r-n[o]:"center"==this.style.align&&(l.x+=(r-n[o])/2),this.style.stroke&&this.style.strokeThickness&&this.context.strokeText(t[o],l.x,l.y),this.style.fill&&this.context.fillText(t[o],l.x,l.y)}this.updateTexture()},i.Text.prototype.updateTexture=function(){this.texture.baseTexture.width=this.canvas.width,this.texture.baseTexture.height=this.canvas.height,this.texture.frame.width=this.canvas.width,this.texture.frame.height=this.canvas.height,this._width=this.canvas.width,this._height=this.canvas.height,i.texturesToUpdate.push(this.texture.baseTexture)},i.Text.prototype.updateTransform=function(){this.dirty&&(this.updateText(),this.dirty=!1),i.Sprite.prototype.updateTransform.call(this)},i.Text.prototype.determineFontHeight=function(e){var t=i.Text.heightCache[e];if(!t){var n=document.getElementsByTagName("body")[0],r=document.createElement("div"),o=document.createTextNode("M");r.appendChild(o),r.setAttribute("style",e+";position:absolute;top:0;left:0"),n.appendChild(r),t=r.offsetHeight,i.Text.heightCache[e]=t,n.removeChild(r)}return t},i.Text.prototype.wordWrap=function(e){for(var t=function(e,t,n,r,i){var o=Math.floor((r-n)/2)+n;return o==n?1:e.measureText(t.substring(0,o)).width<=i?e.measureText(t.substring(0,o+1)).width>i?o:arguments.callee(e,t,o,r,i):arguments.callee(e,t,n,o,i)},n=function(e,n,r){if(e.measureText(n).width<=r||n.length<1)return n;var i=t(e,n,0,n.length,r);return n.substring(0,i)+"\n"+arguments.callee(e,n.substring(i),r)},r="",i=e.split("\n"),o=0;o<i.length;o++)r+=n(this.context,i[o],this.style.wordWrapWidth)+"\n";return r},i.Text.prototype.destroy=function(e){e&&this.texture.destroy()},i.Text.heightCache={},i.BitmapText=function(e,t){i.DisplayObjectContainer.call(this),this.setText(e),this.setStyle(t),this.updateText(),this.dirty=!1},i.BitmapText.prototype=Object.create(i.DisplayObjectContainer.prototype),i.BitmapText.prototype.constructor=i.BitmapText,i.BitmapText.prototype.setText=function(e){this.text=e||" ",this.dirty=!0},i.BitmapText.prototype.setStyle=function(e){e=e||{},e.align=e.align||"left",this.style=e;var t=e.font.split(" ");this.fontName=t[t.length-1],this.fontSize=t.length>=2?parseInt(t[t.length-2],10):i.BitmapText.fonts[this.fontName].size,this.dirty=!0},i.BitmapText.prototype.updateText=function(){for(var e=i.BitmapText.fonts[this.fontName],t=new i.Point,n=null,r=[],o=0,a=[],s=0,l=this.fontSize/e.size,u=0;u<this.text.length;u++){var c=this.text.charCodeAt(u);if(/(?:\r\n|\r|\n)/.test(this.text.charAt(u)))a.push(t.x),o=Math.max(o,t.x),s++,t.x=0,t.y+=e.lineHeight,n=null;else{var d=e.chars[c];d&&(n&&d[n]&&(t.x+=d.kerning[n]),r.push({texture:d.texture,line:s,charCode:c,position:new i.Point(t.x+d.xOffset,t.y+d.yOffset)}),t.x+=d.xAdvance,n=c)}}a.push(t.x),o=Math.max(o,t.x);var h=[];for(u=0;s>=u;u++){var p=0;"right"==this.style.align?p=o-a[u]:"center"==this.style.align&&(p=(o-a[u])/2),h.push(p)}for(u=0;u<r.length;u++){var f=new i.Sprite(r[u].texture);f.position.x=(r[u].position.x+h[r[u].line])*l,f.position.y=r[u].position.y*l,f.scale.x=f.scale.y=l,this.addChild(f)}this.width=t.x*l,this.height=(t.y+e.lineHeight)*l},i.BitmapText.prototype.updateTransform=function(){if(this.dirty){for(;this.children.length>0;)this.removeChild(this.getChildAt(0));this.updateText(),this.dirty=!1}i.DisplayObjectContainer.prototype.updateTransform.call(this)},i.BitmapText.fonts={},i.InteractionManager=function(e){this.stage=e,this.mouse=new i.InteractionData,this.touchs={},this.tempPoint=new i.Point,this.mouseoverEnabled=!0,this.pool=[],this.interactiveItems=[],this.last=0},i.InteractionManager.prototype.constructor=i.InteractionManager,i.InteractionManager.prototype.collectInteractiveSprite=function(e,t){for(var n=e.children,r=n.length,i=r-1;i>=0;i--){var o=n[i];o.interactive?(t.interactiveChildren=!0,this.interactiveItems.push(o),o.children.length>0&&this.collectInteractiveSprite(o,o)):(o.__iParent=null,o.children.length>0&&this.collectInteractiveSprite(o,t))}},i.InteractionManager.prototype.setTarget=function(e){window.navigator.msPointerEnabled&&(e.view.style["-ms-content-zooming"]="none",e.view.style["-ms-touch-action"]="none"),this.target=e,e.view.addEventListener("mousemove",this.onMouseMove.bind(this),!0),e.view.addEventListener("mousedown",this.onMouseDown.bind(this),!0),document.body.addEventListener("mouseup",this.onMouseUp.bind(this),!0),e.view.addEventListener("mouseout",this.onMouseOut.bind(this),!0),e.view.addEventListener("touchstart",this.onTouchStart.bind(this),!0),e.view.addEventListener("touchend",this.onTouchEnd.bind(this),!0),e.view.addEventListener("touchmove",this.onTouchMove.bind(this),!0)},i.InteractionManager.prototype.update=function(){if(this.target){var e=Date.now(),t=e-this.last;if(t=30*t/1e3,!(1>t)){if(this.last=e,this.dirty){this.dirty=!1;for(var n=this.interactiveItems.length,r=0;n>r;r++)this.interactiveItems[r].interactiveChildren=!1;this.interactiveItems=[],this.stage.interactive&&this.interactiveItems.push(this.stage),this.collectInteractiveSprite(this.stage,this.stage)}var i=this.interactiveItems.length;this.target.view.style.cursor="default";for(var r=0;i>r;r++){var o=this.interactiveItems[r];(o.mouseover||o.mouseout||o.buttonMode)&&(o.__hit=this.hitTest(o,this.mouse),this.mouse.target=o,o.__hit?(o.buttonMode&&(this.target.view.style.cursor="pointer"),o.__isOver||(o.mouseover&&o.mouseover(this.mouse),o.__isOver=!0)):o.__isOver&&(o.mouseout&&o.mouseout(this.mouse),o.__isOver=!1))}}}},i.InteractionManager.prototype.onMouseMove=function(e){this.mouse.originalEvent=e||window.event;var t=this.target.view.getBoundingClientRect();this.mouse.global.x=(e.clientX-t.left)*(this.target.width/t.width),this.mouse.global.y=(e.clientY-t.top)*(this.target.height/t.height);for(var n=this.interactiveItems.length,r=(this.mouse.global,0);n>r;r++){var i=this.interactiveItems[r];i.mousemove&&i.mousemove(this.mouse)}},i.InteractionManager.prototype.onMouseDown=function(e){this.mouse.originalEvent=e||window.event;for(var t=this.interactiveItems.length,n=(this.mouse.global,this.stage,0);t>n;n++){var r=this.interactiveItems[n];if((r.mousedown||r.click)&&(r.__mouseIsDown=!0,r.__hit=this.hitTest(r,this.mouse),r.__hit&&(r.mousedown&&r.mousedown(this.mouse),r.__isDown=!0,!r.interactiveChildren)))break}},i.InteractionManager.prototype.onMouseOut=function(){var e=this.interactiveItems.length;this.target.view.style.cursor="default";for(var t=0;e>t;t++){var n=this.interactiveItems[t];n.__isOver&&(this.mouse.target=n,n.mouseout&&n.mouseout(this.mouse),n.__isOver=!1)}},i.InteractionManager.prototype.onMouseUp=function(e){this.mouse.originalEvent=e||window.event;for(var t=(this.mouse.global,this.interactiveItems.length),n=!1,r=0;t>r;r++){var i=this.interactiveItems[r];(i.mouseup||i.mouseupoutside||i.click)&&(i.__hit=this.hitTest(i,this.mouse),i.__hit&&!n?(i.mouseup&&i.mouseup(this.mouse),i.__isDown&&i.click&&i.click(this.mouse),i.interactiveChildren||(n=!0)):i.__isDown&&i.mouseupoutside&&i.mouseupoutside(this.mouse),i.__isDown=!1)}},i.InteractionManager.prototype.hitTest=function(e,t){var n=t.global;if(e.vcount!==i.visibleCount)return!1;var r=e instanceof i.Sprite,o=e.worldTransform,a=o[0],s=o[1],l=o[2],u=o[3],c=o[4],d=o[5],h=1/(a*c+s*-u),p=c*h*n.x+-s*h*n.y+(d*s-l*c)*h,f=a*h*n.y+-u*h*n.x+(-d*a+l*u)*h;if(t.target=e,e.hitArea&&e.hitArea.contains)return e.hitArea.contains(p,f)?(t.target=e,!0):!1;
if(r){var m,g=e.texture.frame.width,v=e.texture.frame.height,y=-g*e.anchor.x;if(p>y&&y+g>p&&(m=-v*e.anchor.y,f>m&&m+v>f))return t.target=e,!0}for(var b=e.children.length,x=0;b>x;x++){var w=e.children[x],_=this.hitTest(w,t);if(_)return t.target=e,!0}return!1},i.InteractionManager.prototype.onTouchMove=function(e){for(var t=this.target.view.getBoundingClientRect(),n=e.changedTouches,r=0;r<n.length;r++){var i=n[r],o=this.touchs[i.identifier];o.originalEvent=e||window.event,o.global.x=(i.clientX-t.left)*(this.target.width/t.width),o.global.y=(i.clientY-t.top)*(this.target.height/t.height)}for(var a=this.interactiveItems.length,r=0;a>r;r++){var s=this.interactiveItems[r];s.touchmove&&s.touchmove(o)}},i.InteractionManager.prototype.onTouchStart=function(e){for(var t=this.target.view.getBoundingClientRect(),n=e.changedTouches,r=0;r<n.length;r++){var o=n[r],a=this.pool.pop();a||(a=new i.InteractionData),a.originalEvent=e||window.event,this.touchs[o.identifier]=a,a.global.x=(o.clientX-t.left)*(this.target.width/t.width),a.global.y=(o.clientY-t.top)*(this.target.height/t.height);for(var s=this.interactiveItems.length,l=0;s>l;l++){var u=this.interactiveItems[l];if((u.touchstart||u.tap)&&(u.__hit=this.hitTest(u,a),u.__hit&&(u.touchstart&&u.touchstart(a),u.__isDown=!0,u.__touchData=a,!u.interactiveChildren)))break}}},i.InteractionManager.prototype.onTouchEnd=function(e){for(var t=this.target.view.getBoundingClientRect(),n=e.changedTouches,r=0;r<n.length;r++){var i=n[r],o=this.touchs[i.identifier],a=!1;o.global.x=(i.clientX-t.left)*(this.target.width/t.width),o.global.y=(i.clientY-t.top)*(this.target.height/t.height);for(var s=this.interactiveItems.length,l=0;s>l;l++){var u=this.interactiveItems[l],c=u.__touchData;u.__hit=this.hitTest(u,o),c==o&&(o.originalEvent=e||window.event,(u.touchend||u.tap)&&(u.__hit&&!a?(u.touchend&&u.touchend(o),u.__isDown&&u.tap&&u.tap(o),u.interactiveChildren||(a=!0)):u.__isDown&&u.touchendoutside&&u.touchendoutside(o),u.__isDown=!1),u.__touchData=null)}this.pool.push(o),this.touchs[i.identifier]=null}},i.InteractionData=function(){this.global=new i.Point,this.local=new i.Point,this.target,this.originalEvent},i.InteractionData.prototype.getLocalPosition=function(e){var t=e.worldTransform,n=this.global,r=t[0],o=t[1],a=t[2],s=t[3],l=t[4],u=t[5],c=1/(r*l+o*-s);return new i.Point(l*c*n.x+-o*c*n.y+(u*o-a*l)*c,r*c*n.y+-s*c*n.x+(-u*r+a*s)*c)},i.InteractionData.prototype.constructor=i.InteractionData,i.Stage=function(e,t){i.DisplayObjectContainer.call(this),this.worldTransform=i.mat3.create(),this.interactive=t,this.interactionManager=new i.InteractionManager(this),this.dirty=!0,this.__childrenAdded=[],this.__childrenRemoved=[],this.stage=this,this.stage.hitArea=new i.Rectangle(0,0,1e5,1e5),this.setBackgroundColor(e),this.worldVisible=!0},i.Stage.prototype=Object.create(i.DisplayObjectContainer.prototype),i.Stage.prototype.constructor=i.Stage,i.Stage.prototype.updateTransform=function(){this.worldAlpha=1,this.vcount=i.visibleCount;for(var e=0,t=this.children.length;t>e;e++)this.children[e].updateTransform();this.dirty&&(this.dirty=!1,this.interactionManager.dirty=!0),this.interactive&&this.interactionManager.update()},i.Stage.prototype.setBackgroundColor=function(e){this.backgroundColor=e||0,this.backgroundColorSplit=t(this.backgroundColor);var n=this.backgroundColor.toString(16);n="000000".substr(0,6-n.length)+n,this.backgroundColorString="#"+n},i.Stage.prototype.getMousePosition=function(){return this.interactionManager.mouse.global};for(var o=0,s=["ms","moz","webkit","o"],l=0;l<s.length&&!window.requestAnimationFrame;++l)window.requestAnimationFrame=window[s[l]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[s[l]+"CancelAnimationFrame"]||window[s[l]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e){var t=(new Date).getTime(),n=Math.max(0,16-(t-o)),r=window.setTimeout(function(){e(t+n)},n);return o=t+n,r}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)}),window.requestAnimFrame=window.requestAnimationFrame,"function"!=typeof Function.prototype.bind&&(Function.prototype.bind=function(){var e=Array.prototype.slice;return function(t){function n(){var o=i.concat(e.call(arguments));r.apply(this instanceof n?this:t,o)}var r=this,i=e.call(arguments,1);if("function"!=typeof r)throw new TypeError;return n.prototype=function o(e){return e&&(o.prototype=e),this instanceof o?void 0:new o}(r.prototype),n}}());var u=i.AjaxRequest=function(){var e=["Msxml2.XMLHTTP","Microsoft.XMLHTTP"];if(!window.ActiveXObject)return window.XMLHttpRequest?new XMLHttpRequest:!1;for(var t=0;t<e.length;t++)try{return new ActiveXObject(e[t])}catch(n){}};i.runList=function(e){console.log(">>>>>>>>>"),console.log("_");var t=0,n=e.first;for(console.log(n);n._iNext;)if(t++,n=n._iNext,console.log(n),t>100){console.log("BREAK");break}},i.EventTarget=function(){var e={};this.addEventListener=this.on=function(t,n){void 0===e[t]&&(e[t]=[]),-1===e[t].indexOf(n)&&e[t].push(n)},this.dispatchEvent=this.emit=function(t){for(var n in e[t.type])e[t.type][n](t)},this.removeEventListener=this.off=function(t,n){var r=e[t].indexOf(n);-1!==r&&e[t].splice(r,1)}},i.autoDetectRenderer=function(e,t,n,r,o){e||(e=800),t||(t=600);var a=function(){try{return!!window.WebGLRenderingContext&&!!document.createElement("canvas").getContext("experimental-webgl")}catch(e){return!1}}();return a?new i.WebGLRenderer(e,t,n,r,o):new i.CanvasRenderer(e,t,n,r)},i.PolyK={},i.PolyK.Triangulate=function(e){var t=!0,n=e.length>>1;if(3>n)return[];for(var r=[],o=[],a=0;n>a;a++)o.push(a);for(var a=0,s=n;s>3;){var l=o[(a+0)%s],u=o[(a+1)%s],c=o[(a+2)%s],d=e[2*l],h=e[2*l+1],p=e[2*u],f=e[2*u+1],m=e[2*c],g=e[2*c+1],v=!1;if(i.PolyK._convex(d,h,p,f,m,g,t)){v=!0;for(var y=0;s>y;y++){var b=o[y];if(b!=l&&b!=u&&b!=c&&i.PolyK._PointInTriangle(e[2*b],e[2*b+1],d,h,p,f,m,g)){v=!1;break}}}if(v)r.push(l,u,c),o.splice((a+1)%s,1),s--,a=0;else if(a++>3*s){if(!t)return console.log("PIXI Warning: shape too complex to fill"),[];var r=[];o=[];for(var a=0;n>a;a++)o.push(a);a=0,s=n,t=!1}}return r.push(o[0],o[1],o[2]),r},i.PolyK._PointInTriangle=function(e,t,n,r,i,o,a,s){var l=a-n,u=s-r,c=i-n,d=o-r,h=e-n,p=t-r,f=l*l+u*u,m=l*c+u*d,g=l*h+u*p,v=c*c+d*d,y=c*h+d*p,b=1/(f*v-m*m),x=(v*g-m*y)*b,w=(f*y-m*g)*b;return x>=0&&w>=0&&1>x+w},i.PolyK._convex=function(e,t,n,r,i,o,a){return(t-r)*(i-n)+(n-e)*(o-r)>=0==a},i.shaderFragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying float vColor;","uniform sampler2D uSampler;","void main(void) {","gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y));","gl_FragColor = gl_FragColor * vColor;","}"],i.shaderVertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute float aColor;","uniform vec2 projectionVector;","varying vec2 vTextureCoord;","varying float vColor;","void main(void) {","gl_Position = vec4( aVertexPosition.x / projectionVector.x -1.0, aVertexPosition.y / -projectionVector.y + 1.0 , 0.0, 1.0);","vTextureCoord = aTextureCoord;","vColor = aColor;","}"],i.stripShaderFragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying float vColor;","uniform float alpha;","uniform sampler2D uSampler;","void main(void) {","gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y));","gl_FragColor = gl_FragColor * alpha;","}"],i.stripShaderVertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute float aColor;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","varying vec2 vTextureCoord;","varying float vColor;","void main(void) {","vec3 v = translationMatrix * vec3(aVertexPosition, 1.0);","gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","vTextureCoord = aTextureCoord;","vColor = aColor;","}"],i.primitiveShaderFragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","gl_FragColor = vColor;","}"],i.primitiveShaderVertexSrc=["attribute vec2 aVertexPosition;","attribute vec4 aColor;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform float alpha;","varying vec4 vColor;","void main(void) {","vec3 v = translationMatrix * vec3(aVertexPosition, 1.0);","gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","vColor = aColor  * alpha;","}"],i.initPrimitiveShader=function(){var e=i.gl,t=i.compileProgram(i.primitiveShaderVertexSrc,i.primitiveShaderFragmentSrc);e.useProgram(t),t.vertexPositionAttribute=e.getAttribLocation(t,"aVertexPosition"),t.colorAttribute=e.getAttribLocation(t,"aColor"),t.projectionVector=e.getUniformLocation(t,"projectionVector"),t.translationMatrix=e.getUniformLocation(t,"translationMatrix"),t.alpha=e.getUniformLocation(t,"alpha"),i.primitiveProgram=t},i.initDefaultShader=function(){var e=this.gl,t=i.compileProgram(i.shaderVertexSrc,i.shaderFragmentSrc);e.useProgram(t),t.vertexPositionAttribute=e.getAttribLocation(t,"aVertexPosition"),t.projectionVector=e.getUniformLocation(t,"projectionVector"),t.textureCoordAttribute=e.getAttribLocation(t,"aTextureCoord"),t.colorAttribute=e.getAttribLocation(t,"aColor"),t.samplerUniform=e.getUniformLocation(t,"uSampler"),i.shaderProgram=t},i.initDefaultStripShader=function(){var e=this.gl,t=i.compileProgram(i.stripShaderVertexSrc,i.stripShaderFragmentSrc);e.useProgram(t),t.vertexPositionAttribute=e.getAttribLocation(t,"aVertexPosition"),t.projectionVector=e.getUniformLocation(t,"projectionVector"),t.textureCoordAttribute=e.getAttribLocation(t,"aTextureCoord"),t.translationMatrix=e.getUniformLocation(t,"translationMatrix"),t.alpha=e.getUniformLocation(t,"alpha"),t.colorAttribute=e.getAttribLocation(t,"aColor"),t.projectionVector=e.getUniformLocation(t,"projectionVector"),t.samplerUniform=e.getUniformLocation(t,"uSampler"),i.stripShaderProgram=t},i.CompileVertexShader=function(e,t){return i._CompileShader(e,t,e.VERTEX_SHADER)},i.CompileFragmentShader=function(e,t){return i._CompileShader(e,t,e.FRAGMENT_SHADER)},i._CompileShader=function(e,t,n){var r=t.join("\n"),i=e.createShader(n);return e.shaderSource(i,r),e.compileShader(i),e.getShaderParameter(i,e.COMPILE_STATUS)?i:(alert(e.getShaderInfoLog(i)),null)},i.compileProgram=function(e,t){var n=i.gl,r=i.CompileFragmentShader(n,t),o=i.CompileVertexShader(n,e),a=n.createProgram();return n.attachShader(a,o),n.attachShader(a,r),n.linkProgram(a),n.getProgramParameter(a,n.LINK_STATUS)||alert("Could not initialise shaders"),a},i.activateDefaultShader=function(){var e=i.gl,t=i.shaderProgram;e.useProgram(t),e.enableVertexAttribArray(t.vertexPositionAttribute),e.enableVertexAttribArray(t.textureCoordAttribute),e.enableVertexAttribArray(t.colorAttribute)},i.activatePrimitiveShader=function(){var e=i.gl;e.disableVertexAttribArray(i.shaderProgram.textureCoordAttribute),e.disableVertexAttribArray(i.shaderProgram.colorAttribute),e.useProgram(i.primitiveProgram),e.enableVertexAttribArray(i.primitiveProgram.vertexPositionAttribute),e.enableVertexAttribArray(i.primitiveProgram.colorAttribute)},i.WebGLGraphics=function(){},i.WebGLGraphics.renderGraphics=function(e,t){var n=i.gl;e._webGL||(e._webGL={points:[],indices:[],lastIndex:0,buffer:n.createBuffer(),indexBuffer:n.createBuffer()}),e.dirty&&(e.dirty=!1,e.clearDirty&&(e.clearDirty=!1,e._webGL.lastIndex=0,e._webGL.points=[],e._webGL.indices=[]),i.WebGLGraphics.updateGraphics(e)),i.activatePrimitiveShader();var r=i.mat3.clone(e.worldTransform);i.mat3.transpose(r),n.blendFunc(n.ONE,n.ONE_MINUS_SRC_ALPHA),n.uniformMatrix3fv(i.primitiveProgram.translationMatrix,!1,r),n.uniform2f(i.primitiveProgram.projectionVector,t.x,t.y),n.uniform1f(i.primitiveProgram.alpha,e.worldAlpha),n.bindBuffer(n.ARRAY_BUFFER,e._webGL.buffer),n.vertexAttribPointer(i.shaderProgram.vertexPositionAttribute,2,n.FLOAT,!1,0,0),n.vertexAttribPointer(i.primitiveProgram.vertexPositionAttribute,2,n.FLOAT,!1,24,0),n.vertexAttribPointer(i.primitiveProgram.colorAttribute,4,n.FLOAT,!1,24,8),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e._webGL.indexBuffer),n.drawElements(n.TRIANGLE_STRIP,e._webGL.indices.length,n.UNSIGNED_SHORT,0),i.activateDefaultShader()},i.WebGLGraphics.updateGraphics=function(e){for(var t=e._webGL.lastIndex;t<e.graphicsData.length;t++){var n=e.graphicsData[t];n.type==i.Graphics.POLY?(n.fill&&n.points.length>3&&i.WebGLGraphics.buildPoly(n,e._webGL),n.lineWidth>0&&i.WebGLGraphics.buildLine(n,e._webGL)):n.type==i.Graphics.RECT?i.WebGLGraphics.buildRectangle(n,e._webGL):(n.type==i.Graphics.CIRC||n.type==i.Graphics.ELIP)&&i.WebGLGraphics.buildCircle(n,e._webGL)}e._webGL.lastIndex=e.graphicsData.length;var r=i.gl;e._webGL.glPoints=new Float32Array(e._webGL.points),r.bindBuffer(r.ARRAY_BUFFER,e._webGL.buffer),r.bufferData(r.ARRAY_BUFFER,e._webGL.glPoints,r.STATIC_DRAW),e._webGL.glIndicies=new Uint16Array(e._webGL.indices),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,e._webGL.indexBuffer),r.bufferData(r.ELEMENT_ARRAY_BUFFER,e._webGL.glIndicies,r.STATIC_DRAW)},i.WebGLGraphics.buildRectangle=function(e,n){var r=e.points,o=r[0],a=r[1],s=r[2],l=r[3];if(e.fill){var u=t(e.fillColor),c=e.fillAlpha,d=u[0]*c,h=u[1]*c,p=u[2]*c,f=n.points,m=n.indices,g=f.length/6;f.push(o,a),f.push(d,h,p,c),f.push(o+s,a),f.push(d,h,p,c),f.push(o,a+l),f.push(d,h,p,c),f.push(o+s,a+l),f.push(d,h,p,c),m.push(g,g,g+1,g+2,g+3,g+3)}e.lineWidth&&(e.points=[o,a,o+s,a,o+s,a+l,o,a+l,o,a],i.WebGLGraphics.buildLine(e,n))},i.WebGLGraphics.buildCircle=function(e,n){var r=e.points,o=r[0],a=r[1],s=r[2],l=r[3],u=40,c=2*Math.PI/u;if(e.fill){var d=t(e.fillColor),h=e.fillAlpha,p=d[0]*h,f=d[1]*h,m=d[2]*h,g=n.points,v=n.indices,y=g.length/6;v.push(y);for(var b=0;u+1>b;b++)g.push(o,a,p,f,m,h),g.push(o+Math.sin(c*b)*s,a+Math.cos(c*b)*l,p,f,m,h),v.push(y++,y++);v.push(y-1)}if(e.lineWidth){e.points=[];for(var b=0;u+1>b;b++)e.points.push(o+Math.sin(c*b)*s,a+Math.cos(c*b)*l);i.WebGLGraphics.buildLine(e,n)}},i.WebGLGraphics.buildLine=function(e,n){var r=e.points;if(0!=r.length){var o=new i.Point(r[0],r[1]),a=new i.Point(r[r.length-2],r[r.length-1]);if(o.x==a.x&&o.y==a.y){r.pop(),r.pop(),a=new i.Point(r[r.length-2],r[r.length-1]);var s=a.x+.5*(o.x-a.x),l=a.y+.5*(o.y-a.y);r.unshift(s,l),r.push(s,l)}var u,c,d,h,p,f,m,g,v,y,b,x,w,_,T,A,C,E,S,k,P,R=n.points,O=n.indices,M=r.length/2,N=r.length,I=R.length/6,L=e.lineWidth/2,B=t(e.lineColor),D=e.lineAlpha,F=B[0]*D,V=B[1]*D,G=B[2]*D;u=r[0],c=r[1],d=r[2],h=r[3],m=-(c-h),g=u-d,P=Math.sqrt(m*m+g*g),m/=P,g/=P,m*=L,g*=L,R.push(u-m,c-g,F,V,G,D),R.push(u+m,c+g,F,V,G,D);for(var $=1;M-1>$;$++)u=r[2*($-1)],c=r[2*($-1)+1],d=r[2*$],h=r[2*$+1],p=r[2*($+1)],f=r[2*($+1)+1],m=-(c-h),g=u-d,P=Math.sqrt(m*m+g*g),m/=P,g/=P,m*=L,g*=L,v=-(h-f),y=d-p,P=Math.sqrt(v*v+y*y),v/=P,y/=P,v*=L,y*=L,w=-g+c-(-g+h),_=-m+d-(-m+u),T=(-m+u)*(-g+h)-(-m+d)*(-g+c),A=-y+f-(-y+h),C=-v+d-(-v+p),E=(-v+p)*(-y+h)-(-v+d)*(-y+f),S=w*C-A*_,0==S&&(S+=1),px=(_*E-C*T)/S,py=(A*T-w*E)/S,k=(px-d)*(px-d)+(py-h)+(py-h),k>19600?(b=m-v,x=g-y,P=Math.sqrt(b*b+x*x),b/=P,x/=P,b*=L,x*=L,R.push(d-b,h-x),R.push(F,V,G,D),R.push(d+b,h+x),R.push(F,V,G,D),R.push(d-b,h-x),R.push(F,V,G,D),N++):(R.push(px,py),R.push(F,V,G,D),R.push(d-(px-d),h-(py-h)),R.push(F,V,G,D));u=r[2*(M-2)],c=r[2*(M-2)+1],d=r[2*(M-1)],h=r[2*(M-1)+1],m=-(c-h),g=u-d,P=Math.sqrt(m*m+g*g),m/=P,g/=P,m*=L,g*=L,R.push(d-m,h-g),R.push(F,V,G,D),R.push(d+m,h+g),R.push(F,V,G,D),O.push(I);for(var $=0;N>$;$++)O.push(I++);O.push(I-1)}},i.WebGLGraphics.buildPoly=function(e,n){var r=e.points;if(!(r.length<6)){for(var o=n.points,a=n.indices,s=r.length/2,l=t(e.fillColor),u=e.fillAlpha,c=l[0]*u,d=l[1]*u,h=l[2]*u,p=i.PolyK.Triangulate(r),f=o.length/6,m=0;m<p.length;m+=3)a.push(p[m]+f),a.push(p[m]+f),a.push(p[m+1]+f),a.push(p[m+2]+f),a.push(p[m+2]+f);for(var m=0;s>m;m++)o.push(r[2*m],r[2*m+1],c,d,h,u)}},i._defaultFrame=new i.Rectangle(0,0,1,1),i.gl,i.WebGLRenderer=function(e,t,n,r,o){this.transparent=!!r,this.width=e||800,this.height=t||600,this.view=n||document.createElement("canvas"),this.view.width=this.width,this.view.height=this.height;var a=this;this.view.addEventListener("webglcontextlost",function(e){a.handleContextLost(e)},!1),this.view.addEventListener("webglcontextrestored",function(e){a.handleContextRestored(e)},!1),this.batchs=[];try{i.gl=this.gl=this.view.getContext("experimental-webgl",{alpha:this.transparent,antialias:!!o,premultipliedAlpha:!0,stencil:!0})}catch(s){throw new Error(" This browser does not support webGL. Try using the canvas renderer"+this)}i.initPrimitiveShader(),i.initDefaultShader(),i.initDefaultStripShader(),i.activateDefaultShader();var l=this.gl;i.WebGLRenderer.gl=l,this.batch=new i.WebGLBatch(l),l.disable(l.DEPTH_TEST),l.disable(l.CULL_FACE),l.enable(l.BLEND),l.colorMask(!0,!0,!0,this.transparent),i.projection=new i.Point(400,300),this.resize(this.width,this.height),this.contextLost=!1,this.stageRenderGroup=new i.WebGLRenderGroup(this.gl)},i.WebGLRenderer.prototype.constructor=i.WebGLRenderer,i.WebGLRenderer.getBatch=function(){return 0==i._batchs.length?new i.WebGLBatch(i.WebGLRenderer.gl):i._batchs.pop()},i.WebGLRenderer.returnBatch=function(e){e.clean(),i._batchs.push(e)},i.WebGLRenderer.prototype.render=function(e){if(!this.contextLost){this.__stage!==e&&(this.__stage=e,this.stageRenderGroup.setRenderable(e)),i.WebGLRenderer.updateTextures(),i.visibleCount++,e.updateTransform();var t=this.gl;if(t.colorMask(!0,!0,!0,this.transparent),t.viewport(0,0,this.width,this.height),t.bindFramebuffer(t.FRAMEBUFFER,null),this.transparent?t.clearColor(0,0,0,0):t.clearColor(e.backgroundColorSplit[0],e.backgroundColorSplit[1],e.backgroundColorSplit[2],1),t.clear(t.COLOR_BUFFER_BIT),this.stageRenderGroup.backgroundColor=e.backgroundColorSplit,this.stageRenderGroup.render(i.projection),e.interactive&&(e._interactiveEventsAdded||(e._interactiveEventsAdded=!0,e.interactionManager.setTarget(this))),i.Texture.frameUpdates.length>0){for(var n=0;n<i.Texture.frameUpdates.length;n++)i.Texture.frameUpdates[n].updateFrame=!1;i.Texture.frameUpdates=[]}}},i.WebGLRenderer.updateTextures=function(){for(var e=0;e<i.texturesToUpdate.length;e++)i.WebGLRenderer.updateTexture(i.texturesToUpdate[e]);for(var e=0;e<i.texturesToDestroy.length;e++)i.WebGLRenderer.destroyTexture(i.texturesToDestroy[e]);i.texturesToUpdate=[],i.texturesToDestroy=[]},i.WebGLRenderer.updateTexture=function(e){var t=i.gl;e._glTexture||(e._glTexture=t.createTexture()),e.hasLoaded&&(t.bindTexture(t.TEXTURE_2D,e._glTexture),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e.source),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),e._powerOf2?(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT)):(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)),t.bindTexture(t.TEXTURE_2D,null))},i.WebGLRenderer.destroyTexture=function(e){var t=i.gl;e._glTexture&&(e._glTexture=t.createTexture(),t.deleteTexture(t.TEXTURE_2D,e._glTexture))},i.WebGLRenderer.prototype.resize=function(e,t){this.width=e,this.height=t,this.view.width=e,this.view.height=t,this.gl.viewport(0,0,this.width,this.height),i.projection.x=this.width/2,i.projection.y=this.height/2},i.WebGLRenderer.prototype.handleContextLost=function(e){e.preventDefault(),this.contextLost=!0},i.WebGLRenderer.prototype.handleContextRestored=function(){this.gl=this.view.getContext("experimental-webgl",{alpha:!0}),this.initShaders();for(var e in i.TextureCache){var t=i.TextureCache[e].baseTexture;t._glTexture=null,i.WebGLRenderer.updateTexture(t)}for(var n=0;n<this.batchs.length;n++)this.batchs[n].restoreLostContext(this.gl),this.batchs[n].dirty=!0;i._restoreBatchs(this.gl),this.contextLost=!1},i._batchs=[],i._getBatch=function(e){return 0==i._batchs.length?new i.WebGLBatch(e):i._batchs.pop()},i._returnBatch=function(e){e.clean(),i._batchs.push(e)},i._restoreBatchs=function(e){for(var t=0;t<i._batchs.length;t++)i._batchs[t].restoreLostContext(e)},i.WebGLBatch=function(e){this.gl=e,this.size=0,this.vertexBuffer=e.createBuffer(),this.indexBuffer=e.createBuffer(),this.uvBuffer=e.createBuffer(),this.colorBuffer=e.createBuffer(),this.blendMode=i.blendModes.NORMAL,this.dynamicSize=1},i.WebGLBatch.prototype.constructor=i.WebGLBatch,i.WebGLBatch.prototype.clean=function(){this.verticies=[],this.uvs=[],this.indices=[],this.colors=[],this.dynamicSize=1,this.texture=null,this.last=null,this.size=0,this.head,this.tail},i.WebGLBatch.prototype.restoreLostContext=function(e){this.gl=e,this.vertexBuffer=e.createBuffer(),this.indexBuffer=e.createBuffer(),this.uvBuffer=e.createBuffer(),this.colorBuffer=e.createBuffer()},i.WebGLBatch.prototype.init=function(e){e.batch=this,this.dirty=!0,this.blendMode=e.blendMode,this.texture=e.texture.baseTexture,this.head=e,this.tail=e,this.size=1,this.growBatch()},i.WebGLBatch.prototype.insertBefore=function(e,t){this.size++,e.batch=this,this.dirty=!0;var n=t.__prev;t.__prev=e,e.__next=t,n?(e.__prev=n,n.__next=e):this.head=e},i.WebGLBatch.prototype.insertAfter=function(e,t){this.size++,e.batch=this,this.dirty=!0;var n=t.__next;t.__next=e,e.__prev=t,n?(e.__next=n,n.__prev=e):this.tail=e},i.WebGLBatch.prototype.remove=function(e){return this.size--,0==this.size?(e.batch=null,e.__prev=null,e.__next=null,void 0):(e.__prev?e.__prev.__next=e.__next:(this.head=e.__next,this.head.__prev=null),e.__next?e.__next.__prev=e.__prev:(this.tail=e.__prev,this.tail.__next=null),e.batch=null,e.__next=null,e.__prev=null,this.dirty=!0,void 0)},i.WebGLBatch.prototype.split=function(e){this.dirty=!0;var t=new i.WebGLBatch(this.gl);t.init(e),t.texture=this.texture,t.tail=this.tail,this.tail=e.__prev,this.tail.__next=null,e.__prev=null;for(var n=0;e;)n++,e.batch=t,e=e.__next;return t.size=n,this.size-=n,t},i.WebGLBatch.prototype.merge=function(e){this.dirty=!0,this.tail.__next=e.head,e.head.__prev=this.tail,this.size+=e.size,this.tail=e.tail;for(var t=e.head;t;)t.batch=this,t=t.__next},i.WebGLBatch.prototype.growBatch=function(){var e=this.gl;this.dynamicSize=1==this.size?1:1.5*this.size,this.verticies=new Float32Array(8*this.dynamicSize),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this.verticies,e.DYNAMIC_DRAW),this.uvs=new Float32Array(8*this.dynamicSize),e.bindBuffer(e.ARRAY_BUFFER,this.uvBuffer),e.bufferData(e.ARRAY_BUFFER,this.uvs,e.DYNAMIC_DRAW),this.dirtyUVS=!0,this.colors=new Float32Array(4*this.dynamicSize),e.bindBuffer(e.ARRAY_BUFFER,this.colorBuffer),e.bufferData(e.ARRAY_BUFFER,this.colors,e.DYNAMIC_DRAW),this.dirtyColors=!0,this.indices=new Uint16Array(6*this.dynamicSize);for(var t=this.indices.length/6,n=0;t>n;n++){var r=6*n,i=4*n;this.indices[r+0]=i+0,this.indices[r+1]=i+1,this.indices[r+2]=i+2,this.indices[r+3]=i+0,this.indices[r+4]=i+2,this.indices[r+5]=i+3}e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.indices,e.STATIC_DRAW)},i.WebGLBatch.prototype.refresh=function(){this.gl;this.dynamicSize<this.size&&this.growBatch();for(var e,t=0,n=this.head;n;){e=8*t;var r=n.texture,i=r.frame,o=r.baseTexture.width,a=r.baseTexture.height;this.uvs[e+0]=i.x/o,this.uvs[e+1]=i.y/a,this.uvs[e+2]=(i.x+i.width)/o,this.uvs[e+3]=i.y/a,this.uvs[e+4]=(i.x+i.width)/o,this.uvs[e+5]=(i.y+i.height)/a,this.uvs[e+6]=i.x/o,this.uvs[e+7]=(i.y+i.height)/a,n.updateFrame=!1,colorIndex=4*t,this.colors[colorIndex]=this.colors[colorIndex+1]=this.colors[colorIndex+2]=this.colors[colorIndex+3]=n.worldAlpha,n=n.__next,t++}this.dirtyUVS=!0,this.dirtyColors=!0},i.WebGLBatch.prototype.update=function(){for(var e,t,n,r,o,a,s,l,u,c,d,h,p,f,m,g,v=(this.gl,0),y=this.head;y;){if(y.vcount===i.visibleCount){if(t=y.texture.frame.width,n=y.texture.frame.height,r=y.anchor.x,o=y.anchor.y,a=t*(1-r),s=t*-r,l=n*(1-o),u=n*-o,c=8*v,e=y.worldTransform,d=e[0],h=e[3],p=e[1],f=e[4],m=e[2],g=e[5],this.verticies[c+0]=d*s+p*u+m,this.verticies[c+1]=f*u+h*s+g,this.verticies[c+2]=d*a+p*u+m,this.verticies[c+3]=f*u+h*a+g,this.verticies[c+4]=d*a+p*l+m,this.verticies[c+5]=f*l+h*a+g,this.verticies[c+6]=d*s+p*l+m,this.verticies[c+7]=f*l+h*s+g,y.updateFrame||y.texture.updateFrame){this.dirtyUVS=!0;var b=y.texture,x=b.frame,w=b.baseTexture.width,_=b.baseTexture.height;this.uvs[c+0]=x.x/w,this.uvs[c+1]=x.y/_,this.uvs[c+2]=(x.x+x.width)/w,this.uvs[c+3]=x.y/_,this.uvs[c+4]=(x.x+x.width)/w,this.uvs[c+5]=(x.y+x.height)/_,this.uvs[c+6]=x.x/w,this.uvs[c+7]=(x.y+x.height)/_,y.updateFrame=!1}if(y.cacheAlpha!=y.worldAlpha){y.cacheAlpha=y.worldAlpha;var T=4*v;this.colors[T]=this.colors[T+1]=this.colors[T+2]=this.colors[T+3]=y.worldAlpha,this.dirtyColors=!0}}else c=8*v,this.verticies[c+0]=0,this.verticies[c+1]=0,this.verticies[c+2]=0,this.verticies[c+3]=0,this.verticies[c+4]=0,this.verticies[c+5]=0,this.verticies[c+6]=0,this.verticies[c+7]=0;v++,y=y.__next}},i.WebGLBatch.prototype.render=function(e,t){if(e=e||0,void 0==t&&(t=this.size),this.dirty&&(this.refresh(),this.dirty=!1),0!=this.size){this.update();var n=this.gl,r=i.shaderProgram;n.useProgram(r),n.bindBuffer(n.ARRAY_BUFFER,this.vertexBuffer),n.bufferSubData(n.ARRAY_BUFFER,0,this.verticies),n.vertexAttribPointer(r.vertexPositionAttribute,2,n.FLOAT,!1,0,0),n.bindBuffer(n.ARRAY_BUFFER,this.uvBuffer),this.dirtyUVS&&(this.dirtyUVS=!1,n.bufferSubData(n.ARRAY_BUFFER,0,this.uvs)),n.vertexAttribPointer(r.textureCoordAttribute,2,n.FLOAT,!1,0,0),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,this.texture._glTexture),n.bindBuffer(n.ARRAY_BUFFER,this.colorBuffer),this.dirtyColors&&(this.dirtyColors=!1,n.bufferSubData(n.ARRAY_BUFFER,0,this.colors)),n.vertexAttribPointer(r.colorAttribute,1,n.FLOAT,!1,0,0),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var o=t-e;n.drawElements(n.TRIANGLES,6*o,n.UNSIGNED_SHORT,2*e*6)}},i.WebGLRenderGroup=function(e){this.gl=e,this.root,this.backgroundColor,this.batchs=[],this.toRemove=[]},i.WebGLRenderGroup.prototype.constructor=i.WebGLRenderGroup,i.WebGLRenderGroup.prototype.setRenderable=function(e){this.root&&this.removeDisplayObjectAndChildren(this.root),e.worldVisible=e.visible,this.root=e,this.addDisplayObjectAndChildren(e)},i.WebGLRenderGroup.prototype.render=function(e){i.WebGLRenderer.updateTextures();var t=this.gl;t.uniform2f(i.shaderProgram.projectionVector,e.x,e.y),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA);for(var n,r=0;r<this.batchs.length;r++)if(n=this.batchs[r],n instanceof i.WebGLBatch)this.batchs[r].render();else{var o=n.vcount===i.visibleCount;n instanceof i.TilingSprite?o&&this.renderTilingSprite(n,e):n instanceof i.Strip?o&&this.renderStrip(n,e):n instanceof i.Graphics?o&&n.renderable&&i.WebGLGraphics.renderGraphics(n,e):n instanceof i.FilterBlock&&(n.open?(t.enable(t.STENCIL_TEST),t.colorMask(!1,!1,!1,!1),t.stencilFunc(t.ALWAYS,1,255),t.stencilOp(t.KEEP,t.KEEP,t.REPLACE),i.WebGLGraphics.renderGraphics(n.mask,e),t.colorMask(!0,!0,!0,!1),t.stencilFunc(t.NOTEQUAL,0,255),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)):t.disable(t.STENCIL_TEST))}},i.WebGLRenderGroup.prototype.handleFilter=function(){},i.WebGLRenderGroup.prototype.renderSpecific=function(e,t){i.WebGLRenderer.updateTextures();var n=this.gl;n.uniform2f(i.shaderProgram.projectionVector,t.x,t.y);for(var r,o,a,s,l=e.first;l._iNext&&(l=l._iNext,!l.renderable||!l.__renderGroup););var u=l.batch;if(l instanceof i.Sprite){u=l.batch;var c=u.head;if(c==l)r=0;else for(r=1;c.__next!=l;)r++,c=c.__next}else u=l;for(var d,h=e,p=e;p.children.length>0;)p=p.children[p.children.length-1],p.renderable&&(h=p);if(h instanceof i.Sprite){d=h.batch;var c=d.head;if(c==h)a=0;else for(a=1;c.__next!=h;)a++,c=c.__next}else d=h;if(u==d)return u instanceof i.WebGLBatch?u.render(r,a+1):this.renderSpecial(u,t),void 0;o=this.batchs.indexOf(u),s=this.batchs.indexOf(d),u instanceof i.WebGLBatch?u.render(r):this.renderSpecial(u,t);for(var f=o+1;s>f;f++)renderable=this.batchs[f],renderable instanceof i.WebGLBatch?this.batchs[f].render():this.renderSpecial(renderable,t);d instanceof i.WebGLBatch?d.render(0,a+1):this.renderSpecial(d,t)},i.WebGLRenderGroup.prototype.renderSpecial=function(e,t){var n=e.vcount===i.visibleCount;if(e instanceof i.TilingSprite)n&&this.renderTilingSprite(e,t);else if(e instanceof i.Strip)n&&this.renderStrip(e,t);else if(e instanceof i.CustomRenderable)n&&e.renderWebGL(this,t);else if(e instanceof i.Graphics)n&&e.renderable&&i.WebGLGraphics.renderGraphics(e,t);else if(e instanceof i.FilterBlock){var r=i.gl;e.open?(r.enable(r.STENCIL_TEST),r.colorMask(!1,!1,!1,!1),r.stencilFunc(r.ALWAYS,1,255),r.stencilOp(r.KEEP,r.KEEP,r.REPLACE),i.WebGLGraphics.renderGraphics(e.mask,t),r.colorMask(!0,!0,!0,!0),r.stencilFunc(r.NOTEQUAL,0,255),r.stencilOp(r.KEEP,r.KEEP,r.KEEP)):r.disable(r.STENCIL_TEST)}},i.WebGLRenderGroup.prototype.updateTexture=function(e){this.removeObject(e);for(var t=e.first;t!=this.root&&(t=t._iPrev,!t.renderable||!t.__renderGroup););for(var n=e.last;n._iNext&&(n=n._iNext,!n.renderable||!n.__renderGroup););this.insertObject(e,t,n)},i.WebGLRenderGroup.prototype.addFilterBlocks=function(e,t){e.__renderGroup=this,t.__renderGroup=this;for(var n=e;n!=this.root&&(n=n._iPrev,!n.renderable||!n.__renderGroup););this.insertAfter(e,n);for(var r=t;r!=this.root&&(r=r._iPrev,!r.renderable||!r.__renderGroup););this.insertAfter(t,r)},i.WebGLRenderGroup.prototype.removeFilterBlocks=function(e,t){this.removeObject(e),this.removeObject(t)},i.WebGLRenderGroup.prototype.addDisplayObjectAndChildren=function(e){e.__renderGroup&&e.__renderGroup.removeDisplayObjectAndChildren(e);for(var t=e.first;t!=this.root.first&&(t=t._iPrev,!t.renderable||!t.__renderGroup););for(var n=e.last;n._iNext&&(n=n._iNext,!n.renderable||!n.__renderGroup););var r=e.first,i=e.last._iNext;do r.__renderGroup=this,r.renderable&&(this.insertObject(r,t,n),t=r),r=r._iNext;while(r!=i)},i.WebGLRenderGroup.prototype.removeDisplayObjectAndChildren=function(e){if(e.__renderGroup==this){{e.last}do e.__renderGroup=null,e.renderable&&this.removeObject(e),e=e._iNext;while(e)}},i.WebGLRenderGroup.prototype.insertObject=function(e,t,n){var r=t,o=n;if(e instanceof i.Sprite){var a,s;if(r instanceof i.Sprite){if(a=r.batch,a&&a.texture==e.texture.baseTexture&&a.blendMode==e.blendMode)return a.insertAfter(e,r),void 0}else a=r;if(o)if(o instanceof i.Sprite){if(s=o.batch){if(s.texture==e.texture.baseTexture&&s.blendMode==e.blendMode)return s.insertBefore(e,o),void 0;if(s==a){var l=a.split(o),u=i.WebGLRenderer.getBatch(),c=this.batchs.indexOf(a);return u.init(e),this.batchs.splice(c+1,0,u,l),void 0}}}else s=o;var u=i.WebGLRenderer.getBatch();if(u.init(e),a){var c=this.batchs.indexOf(a);this.batchs.splice(c+1,0,u)}else this.batchs.push(u)}else e instanceof i.TilingSprite?this.initTilingSprite(e):e instanceof i.Strip&&this.initStrip(e),this.insertAfter(e,r)},i.WebGLRenderGroup.prototype.insertAfter=function(e,t){if(t instanceof i.Sprite){var n=t.batch;if(n)if(n.tail==t){var r=this.batchs.indexOf(n);this.batchs.splice(r+1,0,e)}else{var o=n.split(t.__next),r=this.batchs.indexOf(n);this.batchs.splice(r+1,0,e,o)}else this.batchs.push(e)}else{var r=this.batchs.indexOf(t);this.batchs.splice(r+1,0,e)}},i.WebGLRenderGroup.prototype.removeObject=function(e){var t;if(e instanceof i.Sprite){var n=e.batch;if(!n)return;n.remove(e),0==n.size&&(t=n)}else t=e;if(t){var r=this.batchs.indexOf(t);if(-1==r)return;if(0==r||r==this.batchs.length-1)return this.batchs.splice(r,1),t instanceof i.WebGLBatch&&i.WebGLRenderer.returnBatch(t),void 0;if(this.batchs[r-1]instanceof i.WebGLBatch&&this.batchs[r+1]instanceof i.WebGLBatch&&this.batchs[r-1].texture==this.batchs[r+1].texture&&this.batchs[r-1].blendMode==this.batchs[r+1].blendMode)return this.batchs[r-1].merge(this.batchs[r+1]),t instanceof i.WebGLBatch&&i.WebGLRenderer.returnBatch(t),i.WebGLRenderer.returnBatch(this.batchs[r+1]),this.batchs.splice(r,2),void 0;this.batchs.splice(r,1),t instanceof i.WebGLBatch&&i.WebGLRenderer.returnBatch(t)}},i.WebGLRenderGroup.prototype.initTilingSprite=function(e){var t=this.gl;e.verticies=new Float32Array([0,0,e.width,0,e.width,e.height,0,e.height]),e.uvs=new Float32Array([0,0,1,0,1,1,0,1]),e.colors=new Float32Array([1,1,1,1]),e.indices=new Uint16Array([0,1,3,2]),e._vertexBuffer=t.createBuffer(),e._indexBuffer=t.createBuffer(),e._uvBuffer=t.createBuffer(),e._colorBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,e._vertexBuffer),t.bufferData(t.ARRAY_BUFFER,e.verticies,t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,e._uvBuffer),t.bufferData(t.ARRAY_BUFFER,e.uvs,t.DYNAMIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,e._colorBuffer),t.bufferData(t.ARRAY_BUFFER,e.colors,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e._indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,e.indices,t.STATIC_DRAW),e.texture.baseTexture._glTexture?(t.bindTexture(t.TEXTURE_2D,e.texture.baseTexture._glTexture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT),e.texture.baseTexture._powerOf2=!0):e.texture.baseTexture._powerOf2=!0
},i.WebGLRenderGroup.prototype.renderStrip=function(e,t){var n=this.gl,r=i.shaderProgram;n.useProgram(i.stripShaderProgram);var o=i.mat3.clone(e.worldTransform);i.mat3.transpose(o),n.uniformMatrix3fv(i.stripShaderProgram.translationMatrix,!1,o),n.uniform2f(i.stripShaderProgram.projectionVector,t.x,t.y),n.uniform1f(i.stripShaderProgram.alpha,e.worldAlpha),e.dirty?(e.dirty=!1,n.bindBuffer(n.ARRAY_BUFFER,e._vertexBuffer),n.bufferData(n.ARRAY_BUFFER,e.verticies,n.STATIC_DRAW),n.vertexAttribPointer(r.vertexPositionAttribute,2,n.FLOAT,!1,0,0),n.bindBuffer(n.ARRAY_BUFFER,e._uvBuffer),n.bufferData(n.ARRAY_BUFFER,e.uvs,n.STATIC_DRAW),n.vertexAttribPointer(r.textureCoordAttribute,2,n.FLOAT,!1,0,0),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,e.texture.baseTexture._glTexture),n.bindBuffer(n.ARRAY_BUFFER,e._colorBuffer),n.bufferData(n.ARRAY_BUFFER,e.colors,n.STATIC_DRAW),n.vertexAttribPointer(r.colorAttribute,1,n.FLOAT,!1,0,0),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e._indexBuffer),n.bufferData(n.ELEMENT_ARRAY_BUFFER,e.indices,n.STATIC_DRAW)):(n.bindBuffer(n.ARRAY_BUFFER,e._vertexBuffer),n.bufferSubData(n.ARRAY_BUFFER,0,e.verticies),n.vertexAttribPointer(r.vertexPositionAttribute,2,n.FLOAT,!1,0,0),n.bindBuffer(n.ARRAY_BUFFER,e._uvBuffer),n.vertexAttribPointer(r.textureCoordAttribute,2,n.FLOAT,!1,0,0),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,e.texture.baseTexture._glTexture),n.bindBuffer(n.ARRAY_BUFFER,e._colorBuffer),n.vertexAttribPointer(r.colorAttribute,1,n.FLOAT,!1,0,0),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e._indexBuffer)),n.drawElements(n.TRIANGLE_STRIP,e.indices.length,n.UNSIGNED_SHORT,0),n.useProgram(i.shaderProgram)},i.WebGLRenderGroup.prototype.renderTilingSprite=function(e,t){var n=this.gl,r=(i.shaderProgram,e.tilePosition),o=e.tileScale,a=r.x/e.texture.baseTexture.width,s=r.y/e.texture.baseTexture.height,l=e.width/e.texture.baseTexture.width/o.x,u=e.height/e.texture.baseTexture.height/o.y;e.uvs[0]=0-a,e.uvs[1]=0-s,e.uvs[2]=1*l-a,e.uvs[3]=0-s,e.uvs[4]=1*l-a,e.uvs[5]=1*u-s,e.uvs[6]=0-a,e.uvs[7]=1*u-s,n.bindBuffer(n.ARRAY_BUFFER,e._uvBuffer),n.bufferSubData(n.ARRAY_BUFFER,0,e.uvs),this.renderStrip(e,t)},i.WebGLRenderGroup.prototype.initStrip=function(e){{var t=this.gl;this.shaderProgram}e._vertexBuffer=t.createBuffer(),e._indexBuffer=t.createBuffer(),e._uvBuffer=t.createBuffer(),e._colorBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,e._vertexBuffer),t.bufferData(t.ARRAY_BUFFER,e.verticies,t.DYNAMIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,e._uvBuffer),t.bufferData(t.ARRAY_BUFFER,e.uvs,t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,e._colorBuffer),t.bufferData(t.ARRAY_BUFFER,e.colors,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e._indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,e.indices,t.STATIC_DRAW)},i.CanvasRenderer=function(e,t,n,r){this.transparent=r,this.width=e||800,this.height=t||600,this.view=n||document.createElement("canvas"),this.context=this.view.getContext("2d"),this.refresh=!0,this.view.width=this.width,this.view.height=this.height,this.count=0},i.CanvasRenderer.prototype.constructor=i.CanvasRenderer,i.CanvasRenderer.prototype.render=function(e){i.texturesToUpdate=[],i.texturesToDestroy=[],i.visibleCount++,e.updateTransform(),this.view.style.backgroundColor==e.backgroundColorString||this.transparent||(this.view.style.backgroundColor=e.backgroundColorString),this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.width,this.height),this.renderDisplayObject(e),e.interactive&&(e._interactiveEventsAdded||(e._interactiveEventsAdded=!0,e.interactionManager.setTarget(this))),i.Texture.frameUpdates.length>0&&(i.Texture.frameUpdates=[])},i.CanvasRenderer.prototype.resize=function(e,t){this.width=e,this.height=t,this.view.width=e,this.view.height=t},i.CanvasRenderer.prototype.renderDisplayObject=function(e){var t,n=this.context;n.globalCompositeOperation="source-over";var r=e.last._iNext;e=e.first;do if(t=e.worldTransform,e.visible)if(e.renderable){if(e instanceof i.Sprite){var o=e.texture.frame;o&&(n.globalAlpha=e.worldAlpha,n.setTransform(t[0],t[3],t[1],t[4],t[2],t[5]),n.drawImage(e.texture.baseTexture.source,o.x,o.y,o.width,o.height,e.anchor.x*-o.width,e.anchor.y*-o.height,o.width,o.height))}else if(e instanceof i.Strip)n.setTransform(t[0],t[3],t[1],t[4],t[2],t[5]),this.renderStrip(e);else if(e instanceof i.TilingSprite)n.setTransform(t[0],t[3],t[1],t[4],t[2],t[5]),this.renderTilingSprite(e);else if(e instanceof i.CustomRenderable)e.renderCanvas(this);else if(e instanceof i.Graphics)n.setTransform(t[0],t[3],t[1],t[4],t[2],t[5]),i.CanvasGraphics.renderGraphics(e,n);else if(e instanceof i.FilterBlock)if(e.open){n.save();var a=e.mask.alpha,s=e.mask.worldTransform;n.setTransform(s[0],s[3],s[1],s[4],s[2],s[5]),e.mask.worldAlpha=.5,n.worldAlpha=0,i.CanvasGraphics.renderGraphicsMask(e.mask,n),n.clip(),e.mask.worldAlpha=a}else n.restore();e=e._iNext}else e=e._iNext;else e=e.last._iNext;while(e!=r)},i.CanvasRenderer.prototype.renderStripFlat=function(e){var t=this.context,n=e.verticies,r=(e.uvs,n.length/2);this.count++,t.beginPath();for(var i=1;r-2>i;i++){var o=2*i,a=n[o],s=n[o+2],l=n[o+4],u=n[o+1],c=n[o+3],d=n[o+5];t.moveTo(a,u),t.lineTo(s,c),t.lineTo(l,d)}t.fillStyle="#FF0000",t.fill(),t.closePath()},i.CanvasRenderer.prototype.renderTilingSprite=function(e){var t=this.context;t.globalAlpha=e.worldAlpha,e.__tilePattern||(e.__tilePattern=t.createPattern(e.texture.baseTexture.source,"repeat")),t.beginPath();var n=e.tilePosition,r=e.tileScale;t.scale(r.x,r.y),t.translate(n.x,n.y),t.fillStyle=e.__tilePattern,t.fillRect(-n.x,-n.y,e.width/r.x,e.height/r.y),t.scale(1/r.x,1/r.y),t.translate(-n.x,-n.y),t.closePath()},i.CanvasRenderer.prototype.renderStrip=function(e){var t=this.context,n=e.verticies,r=e.uvs,i=n.length/2;this.count++;for(var o=1;i-2>o;o++){var a=2*o,s=n[a],l=n[a+2],u=n[a+4],c=n[a+1],d=n[a+3],h=n[a+5],p=r[a]*e.texture.width,f=r[a+2]*e.texture.width,m=r[a+4]*e.texture.width,g=r[a+1]*e.texture.height,v=r[a+3]*e.texture.height,y=r[a+5]*e.texture.height;t.save(),t.beginPath(),t.moveTo(s,c),t.lineTo(l,d),t.lineTo(u,h),t.closePath(),t.clip();var b=p*v+g*m+f*y-v*m-g*f-p*y,x=s*v+g*u+l*y-v*u-g*l-s*y,w=p*l+s*m+f*u-l*m-s*f-p*u,_=p*v*u+g*l*m+s*f*y-s*v*m-g*f*u-p*l*y,T=c*v+g*h+d*y-v*h-g*d-c*y,A=p*d+c*m+f*h-d*m-c*f-p*h,C=p*v*h+g*d*m+c*f*y-c*v*m-g*f*h-p*d*y;t.transform(x/b,T/b,w/b,A/b,_/b,C/b),t.drawImage(e.texture.baseTexture.source,0,0),t.restore()}},i.CanvasGraphics=function(){},i.CanvasGraphics.renderGraphics=function(e,t){for(var n=e.worldAlpha,r=0;r<e.graphicsData.length;r++){var o=e.graphicsData[r],a=o.points;if(t.strokeStyle=color="#"+("00000"+(0|o.lineColor).toString(16)).substr(-6),t.lineWidth=o.lineWidth,o.type==i.Graphics.POLY){t.beginPath(),t.moveTo(a[0],a[1]);for(var s=1;s<a.length/2;s++)t.lineTo(a[2*s],a[2*s+1]);a[0]==a[a.length-2]&&a[1]==a[a.length-1]&&t.closePath(),o.fill&&(t.globalAlpha=o.fillAlpha*n,t.fillStyle=color="#"+("00000"+(0|o.fillColor).toString(16)).substr(-6),t.fill()),o.lineWidth&&(t.globalAlpha=o.lineAlpha*n,t.stroke())}else if(o.type==i.Graphics.RECT)void 0!=o.fillColor&&(t.globalAlpha=o.fillAlpha*n,t.fillStyle=color="#"+("00000"+(0|o.fillColor).toString(16)).substr(-6),t.fillRect(a[0],a[1],a[2],a[3])),o.lineWidth&&(t.globalAlpha=o.lineAlpha*n,t.strokeRect(a[0],a[1],a[2],a[3]));else if(o.type==i.Graphics.CIRC)t.beginPath(),t.arc(a[0],a[1],a[2],0,2*Math.PI),t.closePath(),o.fill&&(t.globalAlpha=o.fillAlpha*n,t.fillStyle=color="#"+("00000"+(0|o.fillColor).toString(16)).substr(-6),t.fill()),o.lineWidth&&(t.globalAlpha=o.lineAlpha*n,t.stroke());else if(o.type==i.Graphics.ELIP){var l=o.points,u=2*l[2],c=2*l[3],d=l[0]-u/2,h=l[1]-c/2;t.beginPath();var p=.5522848,f=u/2*p,m=c/2*p,g=d+u,v=h+c,y=d+u/2,b=h+c/2;t.moveTo(d,b),t.bezierCurveTo(d,b-m,y-f,h,y,h),t.bezierCurveTo(y+f,h,g,b-m,g,b),t.bezierCurveTo(g,b+m,y+f,v,y,v),t.bezierCurveTo(y-f,v,d,b+m,d,b),t.closePath(),o.fill&&(t.globalAlpha=o.fillAlpha*n,t.fillStyle=color="#"+("00000"+(0|o.fillColor).toString(16)).substr(-6),t.fill()),o.lineWidth&&(t.globalAlpha=o.lineAlpha*n,t.stroke())}}},i.CanvasGraphics.renderGraphicsMask=function(e,t){var n=(e.worldAlpha,e.graphicsData.length);n>1&&(n=1,console.log("Pixi.js warning: masks in canvas can only mask using the first path in the graphics object"));for(var r=0;1>r;r++){var o=e.graphicsData[r],a=o.points;if(o.type==i.Graphics.POLY){t.beginPath(),t.moveTo(a[0],a[1]);for(var s=1;s<a.length/2;s++)t.lineTo(a[2*s],a[2*s+1]);a[0]==a[a.length-2]&&a[1]==a[a.length-1]&&t.closePath()}else if(o.type==i.Graphics.RECT)t.beginPath(),t.rect(a[0],a[1],a[2],a[3]),t.closePath();else if(o.type==i.Graphics.CIRC)t.beginPath(),t.arc(a[0],a[1],a[2],0,2*Math.PI),t.closePath();else if(o.type==i.Graphics.ELIP){var l=o.points,u=2*l[2],c=2*l[3],d=l[0]-u/2,h=l[1]-c/2;t.beginPath();var p=.5522848,f=u/2*p,m=c/2*p,g=d+u,v=h+c,y=d+u/2,b=h+c/2;t.moveTo(d,b),t.bezierCurveTo(d,b-m,y-f,h,y,h),t.bezierCurveTo(y+f,h,g,b-m,g,b),t.bezierCurveTo(g,b+m,y+f,v,y,v),t.bezierCurveTo(y-f,v,d,b+m,d,b),t.closePath()}}},i.Graphics=function(){i.DisplayObjectContainer.call(this),this.renderable=!0,this.fillAlpha=1,this.lineWidth=0,this.lineColor="black",this.graphicsData=[],this.currentPath={points:[]}},i.Graphics.prototype=Object.create(i.DisplayObjectContainer.prototype),i.Graphics.prototype.constructor=i.Graphics,i.Graphics.prototype.lineStyle=function(e,t,n){0==this.currentPath.points.length&&this.graphicsData.pop(),this.lineWidth=e||0,this.lineColor=t||0,this.lineAlpha=void 0==n?1:n,this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[],type:i.Graphics.POLY},this.graphicsData.push(this.currentPath)},i.Graphics.prototype.moveTo=function(e,t){0==this.currentPath.points.length&&this.graphicsData.pop(),this.currentPath=this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[],type:i.Graphics.POLY},this.currentPath.points.push(e,t),this.graphicsData.push(this.currentPath)},i.Graphics.prototype.lineTo=function(e,t){this.currentPath.points.push(e,t),this.dirty=!0},i.Graphics.prototype.beginFill=function(e,t){this.filling=!0,this.fillColor=e||0,this.fillAlpha=void 0==t?1:t},i.Graphics.prototype.endFill=function(){this.filling=!1,this.fillColor=null,this.fillAlpha=1},i.Graphics.prototype.drawRect=function(e,t,n,r){0==this.currentPath.points.length&&this.graphicsData.pop(),this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[e,t,n,r],type:i.Graphics.RECT},this.graphicsData.push(this.currentPath),this.dirty=!0},i.Graphics.prototype.drawCircle=function(e,t,n){0==this.currentPath.points.length&&this.graphicsData.pop(),this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[e,t,n,n],type:i.Graphics.CIRC},this.graphicsData.push(this.currentPath),this.dirty=!0},i.Graphics.prototype.drawElipse=function(e,t,n,r){0==this.currentPath.points.length&&this.graphicsData.pop(),this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[e,t,n,r],type:i.Graphics.ELIP},this.graphicsData.push(this.currentPath),this.dirty=!0},i.Graphics.prototype.clear=function(){this.lineWidth=0,this.filling=!1,this.dirty=!0,this.clearDirty=!0,this.graphicsData=[]},i.Graphics.POLY=0,i.Graphics.RECT=1,i.Graphics.CIRC=2,i.Graphics.ELIP=3,i.Strip=function(e,t,n){i.DisplayObjectContainer.call(this),this.texture=e,this.blendMode=i.blendModes.NORMAL;try{this.uvs=new Float32Array([0,1,1,1,1,0,0,1]),this.verticies=new Float32Array([0,0,0,0,0,0,0,0,0]),this.colors=new Float32Array([1,1,1,1]),this.indices=new Uint16Array([0,1,2,3])}catch(r){this.uvs=[0,1,1,1,1,0,0,1],this.verticies=[0,0,0,0,0,0,0,0,0],this.colors=[1,1,1,1],this.indices=[0,1,2,3]}this.width=t,this.height=n,e.baseTexture.hasLoaded?(this.width=this.texture.frame.width,this.height=this.texture.frame.height,this.updateFrame=!0):(this.onTextureUpdateBind=this.onTextureUpdate.bind(this),this.texture.addEventListener("update",this.onTextureUpdateBind)),this.renderable=!0},i.Strip.prototype=Object.create(i.DisplayObjectContainer.prototype),i.Strip.prototype.constructor=i.Strip,i.Strip.prototype.setTexture=function(e){this.texture=e,this.width=e.frame.width,this.height=e.frame.height,this.updateFrame=!0},i.Strip.prototype.onTextureUpdate=function(){this.updateFrame=!0},i.Rope=function(e,t){i.Strip.call(this,e),this.points=t;try{this.verticies=new Float32Array(4*t.length),this.uvs=new Float32Array(4*t.length),this.colors=new Float32Array(2*t.length),this.indices=new Uint16Array(2*t.length)}catch(n){this.verticies=verticies,this.uvs=uvs,this.colors=colors,this.indices=indices}this.refresh()},i.Rope.prototype=Object.create(i.Strip.prototype),i.Rope.prototype.constructor=i.Rope,i.Rope.prototype.refresh=function(){var e=this.points;if(!(e.length<1)){var t=this.uvs,n=this.indices,r=this.colors,i=e[0],o=e[0];this.count-=.2,t[0]=0,t[1]=1,t[2]=0,t[3]=1,r[0]=1,r[1]=1,n[0]=0,n[1]=1;for(var a=e.length,s=1;a>s;s++){var o=e[s],l=4*s,u=s/(a-1);s%2?(t[l]=u,t[l+1]=0,t[l+2]=u,t[l+3]=1):(t[l]=u,t[l+1]=0,t[l+2]=u,t[l+3]=1),l=2*s,r[l]=1,r[l+1]=1,l=2*s,n[l]=l,n[l+1]=l+1,i=o}}},i.Rope.prototype.updateTransform=function(){var e=this.points;if(!(e.length<1)){var t,n=this.verticies,r=e[0],o={x:0,y:0},a=e[0];this.count-=.2,n[0]=a.x+o.x,n[1]=a.y+o.y,n[2]=a.x-o.x,n[3]=a.y-o.y;for(var s=e.length,l=1;s>l;l++){var a=e[l],u=4*l;t=l<e.length-1?e[l+1]:a,o.y=-(t.x-r.x),o.x=t.y-r.y;var c=10*(1-l/(s-1));c>1&&(c=1);var d=Math.sqrt(o.x*o.x+o.y*o.y),h=this.texture.height/2;o.x/=d,o.y/=d,o.x*=h,o.y*=h,n[u]=a.x+o.x,n[u+1]=a.y+o.y,n[u+2]=a.x-o.x,n[u+3]=a.y-o.y,r=a}i.DisplayObjectContainer.prototype.updateTransform.call(this)}},i.Rope.prototype.setTexture=function(e){this.texture=e,this.updateFrame=!0},i.TilingSprite=function(e,t,n){i.DisplayObjectContainer.call(this),this.texture=e,this.width=t,this.height=n,this.tileScale=new i.Point(1,1),this.tilePosition=new i.Point(0,0),this.renderable=!0,this.blendMode=i.blendModes.NORMAL},i.TilingSprite.prototype=Object.create(i.DisplayObjectContainer.prototype),i.TilingSprite.prototype.constructor=i.TilingSprite,i.TilingSprite.prototype.setTexture=function(e){this.texture=e,this.updateFrame=!0},i.TilingSprite.prototype.onTextureUpdate=function(){this.updateFrame=!0},i.Spine=function(e){if(i.DisplayObjectContainer.call(this),this.spineData=i.AnimCache[e],!this.spineData)throw new Error("Spine data must be preloaded using PIXI.SpineLoader or PIXI.AssetLoader: "+e);this.skeleton=new c.Skeleton(this.spineData),this.skeleton.updateWorldTransform(),this.stateData=new c.AnimationStateData(this.spineData),this.state=new c.AnimationState(this.stateData),this.slotContainers=[];for(var t=0,n=this.skeleton.drawOrder.length;n>t;t++){var r=this.skeleton.drawOrder[t],o=r.attachment,a=new i.DisplayObjectContainer;if(this.slotContainers.push(a),this.addChild(a),o instanceof c.RegionAttachment){var s=o.rendererObject.name,l=this.createSprite(r,o.rendererObject);r.currentSprite=l,r.currentSpriteName=s,a.addChild(l)}}},i.Spine.prototype=Object.create(i.DisplayObjectContainer.prototype),i.Spine.prototype.constructor=i.Spine,i.Spine.prototype.updateTransform=function(){this.lastTime=this.lastTime||Date.now();var e=.001*(Date.now()-this.lastTime);this.lastTime=Date.now(),this.state.update(e),this.state.apply(this.skeleton),this.skeleton.updateWorldTransform();for(var t=this.skeleton.drawOrder,n=0,r=t.length;r>n;n++){var o=t[n],a=o.attachment,s=this.slotContainers[n];if(a instanceof c.RegionAttachment){if(a.rendererObject&&(!o.currentSpriteName||o.currentSpriteName!=a.name)){var l=a.rendererObject.name;if(void 0!==o.currentSprite&&(o.currentSprite.visible=!1),o.sprites=o.sprites||{},void 0!==o.sprites[l])o.sprites[l].visible=!0;else{var u=this.createSprite(o,a.rendererObject);s.addChild(u)}o.currentSprite=o.sprites[l],o.currentSpriteName=l}s.visible=!0;var d=o.bone;s.position.x=d.worldX+a.x*d.m00+a.y*d.m01,s.position.y=d.worldY+a.x*d.m10+a.y*d.m11,s.scale.x=d.worldScaleX,s.scale.y=d.worldScaleY,s.rotation=-(o.bone.worldRotation*Math.PI/180)}else s.visible=!1}i.DisplayObjectContainer.prototype.updateTransform.call(this)},i.Spine.prototype.createSprite=function(e,t){var n=i.TextureCache[t.name]?t.name:t.name+".png",r=new i.Sprite(i.Texture.fromFrame(n));return r.scale=t.scale,r.rotation=t.rotation,r.anchor.x=r.anchor.y=.5,e.sprites=e.sprites||{},e.sprites[t.name]=r,r};var c={};c.BoneData=function(e,t){this.name=e,this.parent=t},c.BoneData.prototype={length:0,x:0,y:0,rotation:0,scaleX:1,scaleY:1},c.SlotData=function(e,t){this.name=e,this.boneData=t},c.SlotData.prototype={r:1,g:1,b:1,a:1,attachmentName:null},c.Bone=function(e,t){this.data=e,this.parent=t,this.setToSetupPose()},c.Bone.yDown=!1,c.Bone.prototype={x:0,y:0,rotation:0,scaleX:1,scaleY:1,m00:0,m01:0,worldX:0,m10:0,m11:0,worldY:0,worldRotation:0,worldScaleX:1,worldScaleY:1,updateWorldTransform:function(e,t){var n=this.parent;null!=n?(this.worldX=this.x*n.m00+this.y*n.m01+n.worldX,this.worldY=this.x*n.m10+this.y*n.m11+n.worldY,this.worldScaleX=n.worldScaleX*this.scaleX,this.worldScaleY=n.worldScaleY*this.scaleY,this.worldRotation=n.worldRotation+this.rotation):(this.worldX=this.x,this.worldY=this.y,this.worldScaleX=this.scaleX,this.worldScaleY=this.scaleY,this.worldRotation=this.rotation);var r=this.worldRotation*Math.PI/180,i=Math.cos(r),o=Math.sin(r);this.m00=i*this.worldScaleX,this.m10=o*this.worldScaleX,this.m01=-o*this.worldScaleY,this.m11=i*this.worldScaleY,e&&(this.m00=-this.m00,this.m01=-this.m01),t&&(this.m10=-this.m10,this.m11=-this.m11),c.Bone.yDown&&(this.m10=-this.m10,this.m11=-this.m11)},setToSetupPose:function(){var e=this.data;this.x=e.x,this.y=e.y,this.rotation=e.rotation,this.scaleX=e.scaleX,this.scaleY=e.scaleY}},c.Slot=function(e,t,n){this.data=e,this.skeleton=t,this.bone=n,this.setToSetupPose()},c.Slot.prototype={r:1,g:1,b:1,a:1,_attachmentTime:0,attachment:null,setAttachment:function(e){this.attachment=e,this._attachmentTime=this.skeleton.time},setAttachmentTime:function(e){this._attachmentTime=this.skeleton.time-e},getAttachmentTime:function(){return this.skeleton.time-this._attachmentTime},setToSetupPose:function(){var e=this.data;this.r=e.r,this.g=e.g,this.b=e.b,this.a=e.a;for(var t=this.skeleton.data.slots,n=0,r=t.length;r>n;n++)if(t[n]==e){this.setAttachment(e.attachmentName?this.skeleton.getAttachmentBySlotIndex(n,e.attachmentName):null);break}}},c.Skin=function(e){this.name=e,this.attachments={}},c.Skin.prototype={addAttachment:function(e,t,n){this.attachments[e+":"+t]=n},getAttachment:function(e,t){return this.attachments[e+":"+t]},_attachAll:function(e,t){for(var n in t.attachments){var r=n.indexOf(":"),i=parseInt(n.substring(0,r)),o=n.substring(r+1),a=e.slots[i];if(a.attachment&&a.attachment.name==o){var s=this.getAttachment(i,o);s&&a.setAttachment(s)}}}},c.Animation=function(e,t,n){this.name=e,this.timelines=t,this.duration=n},c.Animation.prototype={apply:function(e,t,n){n&&0!=this.duration&&(t%=this.duration);for(var r=this.timelines,i=0,o=r.length;o>i;i++)r[i].apply(e,t,1)},mix:function(e,t,n,r){n&&0!=this.duration&&(t%=this.duration);for(var i=this.timelines,o=0,a=i.length;a>o;o++)i[o].apply(e,t,r)}},c.binarySearch=function(e,t,n){var r=0,i=Math.floor(e.length/n)-2;if(0==i)return n;for(var o=i>>>1;;){if(e[(o+1)*n]<=t?r=o+1:i=o,r==i)return(r+1)*n;o=r+i>>>1}},c.linearSearch=function(e,t,n){for(var r=0,i=e.length-n;i>=r;r+=n)if(e[r]>t)return r;return-1},c.Curves=function(e){this.curves=[],this.curves.length=6*(e-1)},c.Curves.prototype={setLinear:function(e){this.curves[6*e]=0},setStepped:function(e){this.curves[6*e]=-1},setCurve:function(e,t,n,r,i){var o=.1,a=o*o,s=a*o,l=3*o,u=3*a,c=6*a,d=6*s,h=2*-t+r,p=2*-n+i,f=3*(t-r)+1,m=3*(n-i)+1,g=6*e,v=this.curves;v[g]=t*l+h*u+f*s,v[g+1]=n*l+p*u+m*s,v[g+2]=h*c+f*d,v[g+3]=p*c+m*d,v[g+4]=f*d,v[g+5]=m*d},getCurvePercent:function(e,t){t=0>t?0:t>1?1:t;var n=6*e,r=this.curves,i=r[n];if(!i)return t;if(-1==i)return 0;for(var o=r[n+1],a=r[n+2],s=r[n+3],l=r[n+4],u=r[n+5],c=i,d=o,h=8;;){if(c>=t){var p=c-i,f=d-o;return f+(d-f)*(t-p)/(c-p)}if(0==h)break;h--,i+=a,o+=s,a+=l,s+=u,c+=i,d+=o}return d+(1-d)*(t-c)/(1-c)}},c.RotateTimeline=function(e){this.curves=new c.Curves(e),this.frames=[],this.frames.length=2*e},c.RotateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(e,t,n){e*=2,this.frames[e]=t,this.frames[e+1]=n},apply:function(e,t,n){var r=this.frames;if(!(t<r[0])){var i=e.bones[this.boneIndex];if(t>=r[r.length-2]){for(var o=i.data.rotation+r[r.length-1]-i.rotation;o>180;)o-=360;for(;-180>o;)o+=360;return i.rotation+=o*n,void 0}var a=c.binarySearch(r,t,2),s=r[a-1],l=r[a],u=1-(t-l)/(r[a-2]-l);u=this.curves.getCurvePercent(a/2-1,u);for(var o=r[a+1]-s;o>180;)o-=360;for(;-180>o;)o+=360;for(o=i.data.rotation+(s+o*u)-i.rotation;o>180;)o-=360;for(;-180>o;)o+=360;i.rotation+=o*n}}},c.TranslateTimeline=function(e){this.curves=new c.Curves(e),this.frames=[],this.frames.length=3*e},c.TranslateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(e,t,n,r){e*=3,this.frames[e]=t,this.frames[e+1]=n,this.frames[e+2]=r},apply:function(e,t,n){var r=this.frames;if(!(t<r[0])){var i=e.bones[this.boneIndex];if(t>=r[r.length-3])return i.x+=(i.data.x+r[r.length-2]-i.x)*n,i.y+=(i.data.y+r[r.length-1]-i.y)*n,void 0;var o=c.binarySearch(r,t,3),a=r[o-2],s=r[o-1],l=r[o],u=1-(t-l)/(r[o+-3]-l);u=this.curves.getCurvePercent(o/3-1,u),i.x+=(i.data.x+a+(r[o+1]-a)*u-i.x)*n,i.y+=(i.data.y+s+(r[o+2]-s)*u-i.y)*n}}},c.ScaleTimeline=function(e){this.curves=new c.Curves(e),this.frames=[],this.frames.length=3*e},c.ScaleTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(e,t,n,r){e*=3,this.frames[e]=t,this.frames[e+1]=n,this.frames[e+2]=r},apply:function(e,t,n){var r=this.frames;if(!(t<r[0])){var i=e.bones[this.boneIndex];if(t>=r[r.length-3])return i.scaleX+=(i.data.scaleX-1+r[r.length-2]-i.scaleX)*n,i.scaleY+=(i.data.scaleY-1+r[r.length-1]-i.scaleY)*n,void 0;var o=c.binarySearch(r,t,3),a=r[o-2],s=r[o-1],l=r[o],u=1-(t-l)/(r[o+-3]-l);u=this.curves.getCurvePercent(o/3-1,u),i.scaleX+=(i.data.scaleX-1+a+(r[o+1]-a)*u-i.scaleX)*n,i.scaleY+=(i.data.scaleY-1+s+(r[o+2]-s)*u-i.scaleY)*n}}},c.ColorTimeline=function(e){this.curves=new c.Curves(e),this.frames=[],this.frames.length=5*e},c.ColorTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(e,t){e*=5,this.frames[e]=t,this.frames[e+1]=r,this.frames[e+2]=g,this.frames[e+3]=b,this.frames[e+4]=a},apply:function(e,t,n){var r=this.frames;if(!(t<r[0])){var i=e.slots[this.slotIndex];if(t>=r[r.length-5]){var o=r.length-1;return i.r=r[o-3],i.g=r[o-2],i.b=r[o-1],i.a=r[o],void 0}var a=c.binarySearch(r,t,5),s=r[a-4],l=r[a-3],u=r[a-2],d=r[a-1],h=r[a],p=1-(t-h)/(r[a-5]-h);p=this.curves.getCurvePercent(a/5-1,p);var f=s+(r[a+1]-s)*p,m=l+(r[a+2]-l)*p,g=u+(r[a+3]-u)*p,v=d+(r[a+4]-d)*p;1>n?(i.r+=(f-i.r)*n,i.g+=(m-i.g)*n,i.b+=(g-i.b)*n,i.a+=(v-i.a)*n):(i.r=f,i.g=m,i.b=g,i.a=v)}}},c.AttachmentTimeline=function(e){this.curves=new c.Curves(e),this.frames=[],this.frames.length=e,this.attachmentNames=[],this.attachmentNames.length=e},c.AttachmentTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length},setFrame:function(e,t,n){this.frames[e]=t,this.attachmentNames[e]=n},apply:function(e,t){var n=this.frames;if(!(t<n[0])){var r;r=t>=n[n.length-1]?n.length-1:c.binarySearch(n,t,1)-1;var i=this.attachmentNames[r];e.slots[this.slotIndex].setAttachment(i?e.getAttachmentBySlotIndex(this.slotIndex,i):null)}}},c.SkeletonData=function(){this.bones=[],this.slots=[],this.skins=[],this.animations=[]},c.SkeletonData.prototype={defaultSkin:null,findBone:function(e){for(var t=this.bones,n=0,r=t.length;r>n;n++)if(t[n].name==e)return t[n];return null},findBoneIndex:function(e){for(var t=this.bones,n=0,r=t.length;r>n;n++)if(t[n].name==e)return n;return-1},findSlot:function(e){for(var t=this.slots,n=0,r=t.length;r>n;n++)if(t[n].name==e)return slot[n];return null},findSlotIndex:function(e){for(var t=this.slots,n=0,r=t.length;r>n;n++)if(t[n].name==e)return n;return-1},findSkin:function(e){for(var t=this.skins,n=0,r=t.length;r>n;n++)if(t[n].name==e)return t[n];return null},findAnimation:function(e){for(var t=this.animations,n=0,r=t.length;r>n;n++)if(t[n].name==e)return t[n];return null}},c.Skeleton=function(e){this.data=e,this.bones=[];for(var t=0,n=e.bones.length;n>t;t++){var r=e.bones[t],i=r.parent?this.bones[e.bones.indexOf(r.parent)]:null;this.bones.push(new c.Bone(r,i))}this.slots=[],this.drawOrder=[];for(var t=0,n=e.slots.length;n>t;t++){var o=e.slots[t],a=this.bones[e.bones.indexOf(o.boneData)],s=new c.Slot(o,this,a);this.slots.push(s),this.drawOrder.push(s)}},c.Skeleton.prototype={x:0,y:0,skin:null,r:1,g:1,b:1,a:1,time:0,flipX:!1,flipY:!1,updateWorldTransform:function(){for(var e=this.flipX,t=this.flipY,n=this.bones,r=0,i=n.length;i>r;r++)n[r].updateWorldTransform(e,t)},setToSetupPose:function(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()},setBonesToSetupPose:function(){for(var e=this.bones,t=0,n=e.length;n>t;t++)e[t].setToSetupPose()},setSlotsToSetupPose:function(){for(var e=this.slots,t=0,n=e.length;n>t;t++)e[t].setToSetupPose(t)},getRootBone:function(){return 0==this.bones.length?null:this.bones[0]},findBone:function(e){for(var t=this.bones,n=0,r=t.length;r>n;n++)if(t[n].data.name==e)return t[n];return null},findBoneIndex:function(e){for(var t=this.bones,n=0,r=t.length;r>n;n++)if(t[n].data.name==e)return n;return-1},findSlot:function(e){for(var t=this.slots,n=0,r=t.length;r>n;n++)if(t[n].data.name==e)return t[n];return null},findSlotIndex:function(e){for(var t=this.slots,n=0,r=t.length;r>n;n++)if(t[n].data.name==e)return n;return-1},setSkinByName:function(e){var t=this.data.findSkin(e);if(!t)throw"Skin not found: "+e;this.setSkin(t)},setSkin:function(e){this.skin&&e&&e._attachAll(this,this.skin),this.skin=e},getAttachmentBySlotName:function(e,t){return this.getAttachmentBySlotIndex(this.data.findSlotIndex(e),t)},getAttachmentBySlotIndex:function(e,t){if(this.skin){var n=this.skin.getAttachment(e,t);if(n)return n}return this.data.defaultSkin?this.data.defaultSkin.getAttachment(e,t):null},setAttachment:function(e,t){for(var n=this.slots,r=0,i=n.size;i>r;r++){var o=n[r];if(o.data.name==e){var a=null;if(t&&(a=this.getAttachment(r,t),null==a))throw"Attachment not found: "+t+", for slot: "+e;return o.setAttachment(a),void 0}}throw"Slot not found: "+e},update:function(e){time+=e}},c.AttachmentType={region:0},c.RegionAttachment=function(){this.offset=[],this.offset.length=8,this.uvs=[],this.uvs.length=8},c.RegionAttachment.prototype={x:0,y:0,rotation:0,scaleX:1,scaleY:1,width:0,height:0,rendererObject:null,regionOffsetX:0,regionOffsetY:0,regionWidth:0,regionHeight:0,regionOriginalWidth:0,regionOriginalHeight:0,setUVs:function(e,t,n,r,i){var o=this.uvs;i?(o[2]=e,o[3]=r,o[4]=e,o[5]=t,o[6]=n,o[7]=t,o[0]=n,o[1]=r):(o[0]=e,o[1]=r,o[2]=e,o[3]=t,o[4]=n,o[5]=t,o[6]=n,o[7]=r)},updateOffset:function(){var e=this.width/this.regionOriginalWidth*this.scaleX,t=this.height/this.regionOriginalHeight*this.scaleY,n=-this.width/2*this.scaleX+this.regionOffsetX*e,r=-this.height/2*this.scaleY+this.regionOffsetY*t,i=n+this.regionWidth*e,o=r+this.regionHeight*t,a=this.rotation*Math.PI/180,s=Math.cos(a),l=Math.sin(a),u=n*s+this.x,c=n*l,d=r*s+this.y,h=r*l,p=i*s+this.x,f=i*l,m=o*s+this.y,g=o*l,v=this.offset;v[0]=u-h,v[1]=d+c,v[2]=u-g,v[3]=m+c,v[4]=p-g,v[5]=m+f,v[6]=p-h,v[7]=d+f},computeVertices:function(e,t,n,r){e+=n.worldX,t+=n.worldY;var i=n.m00,o=n.m01,a=n.m10,s=n.m11,l=this.offset;r[0]=l[0]*i+l[1]*o+e,r[1]=l[0]*a+l[1]*s+t,r[2]=l[2]*i+l[3]*o+e,r[3]=l[2]*a+l[3]*s+t,r[4]=l[4]*i+l[5]*o+e,r[5]=l[4]*a+l[5]*s+t,r[6]=l[6]*i+l[7]*o+e,r[7]=l[6]*a+l[7]*s+t}},c.AnimationStateData=function(e){this.skeletonData=e,this.animationToMixTime={}},c.AnimationStateData.prototype={defaultMix:0,setMixByName:function(e,t,n){var r=this.skeletonData.findAnimation(e);if(!r)throw"Animation not found: "+e;var i=this.skeletonData.findAnimation(t);if(!i)throw"Animation not found: "+t;this.setMix(r,i,n)},setMix:function(e,t,n){this.animationToMixTime[e.name+":"+t.name]=n},getMix:function(e,t){var n=this.animationToMixTime[e.name+":"+t.name];return n?n:this.defaultMix}},c.AnimationState=function(e){this.data=e,this.queue=[]},c.AnimationState.prototype={current:null,previous:null,currentTime:0,previousTime:0,currentLoop:!1,previousLoop:!1,mixTime:0,mixDuration:0,update:function(e){if(this.currentTime+=e,this.previousTime+=e,this.mixTime+=e,this.queue.length>0){var t=this.queue[0];this.currentTime>=t.delay&&(this._setAnimation(t.animation,t.loop),this.queue.shift())}},apply:function(e){if(this.current)if(this.previous){this.previous.apply(e,this.previousTime,this.previousLoop);var t=this.mixTime/this.mixDuration;t>=1&&(t=1,this.previous=null),this.current.mix(e,this.currentTime,this.currentLoop,t)}else this.current.apply(e,this.currentTime,this.currentLoop)},clearAnimation:function(){this.previous=null,this.current=null,this.queue.length=0},_setAnimation:function(e,t){this.previous=null,e&&this.current&&(this.mixDuration=this.data.getMix(this.current,e),this.mixDuration>0&&(this.mixTime=0,this.previous=this.current,this.previousTime=this.currentTime,this.previousLoop=this.currentLoop)),this.current=e,this.currentLoop=t,this.currentTime=0},setAnimationByName:function(e,t){var n=this.data.skeletonData.findAnimation(e);if(!n)throw"Animation not found: "+e;this.setAnimation(n,t)},setAnimation:function(e,t){this.queue.length=0,this._setAnimation(e,t)},addAnimationByName:function(e,t,n){var r=this.data.skeletonData.findAnimation(e);if(!r)throw"Animation not found: "+e;this.addAnimation(r,t,n)},addAnimation:function(e,t,n){var r={};if(r.animation=e,r.loop=t,!n||0>=n){var i=0==this.queue.length?this.current:this.queue[this.queue.length-1].animation;n=null!=i?i.duration-this.data.getMix(i,e)+(n||0):0}r.delay=n,this.queue.push(r)},isComplete:function(){return!this.current||this.currentTime>=this.current.duration}},c.SkeletonJson=function(e){this.attachmentLoader=e},c.SkeletonJson.prototype={scale:1,readSkeletonData:function(e){for(var t=new c.SkeletonData,n=e.bones,r=0,i=n.length;i>r;r++){var o=n[r],a=null;if(o.parent&&(a=t.findBone(o.parent),!a))throw"Parent bone not found: "+o.parent;var s=new c.BoneData(o.name,a);s.length=(o.length||0)*this.scale,s.x=(o.x||0)*this.scale,s.y=(o.y||0)*this.scale,s.rotation=o.rotation||0,s.scaleX=o.scaleX||1,s.scaleY=o.scaleY||1,t.bones.push(s)}for(var l=e.slots,r=0,i=l.length;i>r;r++){var u=l[r],s=t.findBone(u.bone);if(!s)throw"Slot bone not found: "+u.bone;var d=new c.SlotData(u.name,s),h=u.color;h&&(d.r=c.SkeletonJson.toColor(h,0),d.g=c.SkeletonJson.toColor(h,1),d.b=c.SkeletonJson.toColor(h,2),d.a=c.SkeletonJson.toColor(h,3)),d.attachmentName=u.attachment,t.slots.push(d)}var p=e.skins;for(var f in p)if(p.hasOwnProperty(f)){var m=p[f],g=new c.Skin(f);for(var v in m)if(m.hasOwnProperty(v)){var y=t.findSlotIndex(v),b=m[v];for(var x in b)if(b.hasOwnProperty(x)){var w=this.readAttachment(g,x,b[x]);null!=w&&g.addAttachment(y,x,w)}}t.skins.push(g),"default"==g.name&&(t.defaultSkin=g)}var _=e.animations;for(var T in _)_.hasOwnProperty(T)&&this.readAnimation(T,_[T],t);return t},readAttachment:function(e,t,n){t=n.name||t;var r=c.AttachmentType[n.type||"region"];if(r==c.AttachmentType.region){var i=new c.RegionAttachment;return i.x=(n.x||0)*this.scale,i.y=(n.y||0)*this.scale,i.scaleX=n.scaleX||1,i.scaleY=n.scaleY||1,i.rotation=n.rotation||0,i.width=(n.width||32)*this.scale,i.height=(n.height||32)*this.scale,i.updateOffset(),i.rendererObject={},i.rendererObject.name=t,i.rendererObject.scale={},i.rendererObject.scale.x=i.scaleX,i.rendererObject.scale.y=i.scaleY,i.rendererObject.rotation=-i.rotation*Math.PI/180,i
}throw"Unknown attachment type: "+r},readAnimation:function(e,t,n){var r=[],i=0,o=t.bones;for(var a in o)if(o.hasOwnProperty(a)){var s=n.findBoneIndex(a);if(-1==s)throw"Bone not found: "+a;var l=o[a];for(var u in l)if(l.hasOwnProperty(u)){var d=l[u];if("rotate"==u){var h=new c.RotateTimeline(d.length);h.boneIndex=s;for(var p=0,f=0,m=d.length;m>f;f++){var g=d[f];h.setFrame(p,g.time,g.angle),c.SkeletonJson.readCurve(h,p,g),p++}r.push(h),i=Math.max(i,h.frames[2*h.getFrameCount()-2])}else{if("translate"!=u&&"scale"!=u)throw"Invalid timeline type for a bone: "+u+" ("+a+")";var h,v=1;"scale"==u?h=new c.ScaleTimeline(d.length):(h=new c.TranslateTimeline(d.length),v=this.scale),h.boneIndex=s;for(var p=0,f=0,m=d.length;m>f;f++){var g=d[f],y=(g.x||0)*v,b=(g.y||0)*v;h.setFrame(p,g.time,y,b),c.SkeletonJson.readCurve(h,p,g),p++}r.push(h),i=Math.max(i,h.frames[3*h.getFrameCount()-3])}}}var x=t.slots;for(var w in x)if(x.hasOwnProperty(w)){var _=x[w],T=n.findSlotIndex(w);for(var u in _)if(_.hasOwnProperty(u)){var d=_[u];if("color"==u){var h=new c.ColorTimeline(d.length);h.slotIndex=T;for(var p=0,f=0,m=d.length;m>f;f++){var g=d[f],A=g.color,C=c.SkeletonJson.toColor(A,0),E=c.SkeletonJson.toColor(A,1),S=c.SkeletonJson.toColor(A,2),k=c.SkeletonJson.toColor(A,3);h.setFrame(p,g.time,C,E,S,k),c.SkeletonJson.readCurve(h,p,g),p++}r.push(h),i=Math.max(i,h.frames[5*h.getFrameCount()-5])}else{if("attachment"!=u)throw"Invalid timeline type for a slot: "+u+" ("+w+")";var h=new c.AttachmentTimeline(d.length);h.slotIndex=T;for(var p=0,f=0,m=d.length;m>f;f++){var g=d[f];h.setFrame(p++,g.time,g.name)}r.push(h),i=Math.max(i,h.frames[h.getFrameCount()-1])}}}n.animations.push(new c.Animation(e,r,i))}},c.SkeletonJson.readCurve=function(e,t,n){var r=n.curve;r&&("stepped"==r?e.curves.setStepped(t):r instanceof Array&&e.curves.setCurve(t,r[0],r[1],r[2],r[3]))},c.SkeletonJson.toColor=function(e,t){if(8!=e.length)throw"Color hexidecimal length must be 8, recieved: "+e;return parseInt(e.substring(2*t,2),16)/255},c.Atlas=function(e,t){this.textureLoader=t,this.pages=[],this.regions=[];var n=new c.AtlasReader(e),r=[];r.length=4;for(var i=null;;){var o=n.readLine();if(null==o)break;if(o=n.trim(o),0==o.length)i=null;else if(i){var a=new c.AtlasRegion;a.name=o,a.page=i,a.rotate="true"==n.readValue(),n.readTuple(r);var s=parseInt(r[0]),l=parseInt(r[1]);n.readTuple(r);var u=parseInt(r[0]),d=parseInt(r[1]);a.u=s/i.width,a.v=l/i.height,a.rotate?(a.u2=(s+d)/i.width,a.v2=(l+u)/i.height):(a.u2=(s+u)/i.width,a.v2=(l+d)/i.height),a.x=s,a.y=l,a.width=Math.abs(u),a.height=Math.abs(d),4==n.readTuple(r)&&(a.splits=[parseInt(r[0]),parseInt(r[1]),parseInt(r[2]),parseInt(r[3])],4==n.readTuple(r)&&(a.pads=[parseInt(r[0]),parseInt(r[1]),parseInt(r[2]),parseInt(r[3])],n.readTuple(r))),a.originalWidth=parseInt(r[0]),a.originalHeight=parseInt(r[1]),n.readTuple(r),a.offsetX=parseInt(r[0]),a.offsetY=parseInt(r[1]),a.index=parseInt(n.readValue()),this.regions.push(a)}else{i=new c.AtlasPage,i.name=o,i.format=c.Atlas.Format[n.readValue()],n.readTuple(r),i.minFilter=c.Atlas.TextureFilter[r[0]],i.magFilter=c.Atlas.TextureFilter[r[1]];var h=n.readValue();i.uWrap=c.Atlas.TextureWrap.clampToEdge,i.vWrap=c.Atlas.TextureWrap.clampToEdge,"x"==h?i.uWrap=c.Atlas.TextureWrap.repeat:"y"==h?i.vWrap=c.Atlas.TextureWrap.repeat:"xy"==h&&(i.uWrap=i.vWrap=c.Atlas.TextureWrap.repeat),t.load(i,o),this.pages.push(i)}}},c.Atlas.prototype={findRegion:function(e){for(var t=this.regions,n=0,r=t.length;r>n;n++)if(t[n].name==e)return t[n];return null},dispose:function(){for(var e=this.pages,t=0,n=e.length;n>t;t++)this.textureLoader.unload(e[t].rendererObject)},updateUVs:function(e){for(var t=this.regions,n=0,r=t.length;r>n;n++){var i=t[n];i.page==e&&(i.u=i.x/e.width,i.v=i.y/e.height,i.rotate?(i.u2=(i.x+i.height)/e.width,i.v2=(i.y+i.width)/e.height):(i.u2=(i.x+i.width)/e.width,i.v2=(i.y+i.height)/e.height))}}},c.Atlas.Format={alpha:0,intensity:1,luminanceAlpha:2,rgb565:3,rgba4444:4,rgb888:5,rgba8888:6},c.Atlas.TextureFilter={nearest:0,linear:1,mipMap:2,mipMapNearestNearest:3,mipMapLinearNearest:4,mipMapNearestLinear:5,mipMapLinearLinear:6},c.Atlas.TextureWrap={mirroredRepeat:0,clampToEdge:1,repeat:2},c.AtlasPage=function(){},c.AtlasPage.prototype={name:null,format:null,minFilter:null,magFilter:null,uWrap:null,vWrap:null,rendererObject:null,width:0,height:0},c.AtlasRegion=function(){},c.AtlasRegion.prototype={page:null,name:null,x:0,y:0,width:0,height:0,u:0,v:0,u2:0,v2:0,offsetX:0,offsetY:0,originalWidth:0,originalHeight:0,index:0,rotate:!1,splits:null,pads:null},c.AtlasReader=function(e){this.lines=e.split(/\r\n|\r|\n/)},c.AtlasReader.prototype={index:0,trim:function(e){return e.replace(/^\s+|\s+$/g,"")},readLine:function(){return this.index>=this.lines.length?null:this.lines[this.index++]},readValue:function(){var e=this.readLine(),t=e.indexOf(":");if(-1==t)throw"Invalid line: "+e;return this.trim(e.substring(t+1))},readTuple:function(e){var t=this.readLine(),n=t.indexOf(":");if(-1==n)throw"Invalid line: "+t;for(var r=0,i=n+1;3>r;r++){var o=t.indexOf(",",i);if(-1==o){if(0==r)throw"Invalid line: "+t;break}e[r]=this.trim(t.substr(i,o-i)),i=o+1}return e[r]=this.trim(t.substring(i)),r+1}},c.AtlasAttachmentLoader=function(e){this.atlas=e},c.AtlasAttachmentLoader.prototype={newAttachment:function(e,t,n){switch(t){case c.AttachmentType.region:var r=this.atlas.findRegion(n);if(!r)throw"Region not found in atlas: "+n+" ("+t+")";var i=new c.RegionAttachment(n);return i.rendererObject=r,i.setUVs(r.u,r.v,r.u2,r.v2,r.rotate),i.regionOffsetX=r.offsetX,i.regionOffsetY=r.offsetY,i.regionWidth=r.width,i.regionHeight=r.height,i.regionOriginalWidth=r.originalWidth,i.regionOriginalHeight=r.originalHeight,i}throw"Unknown attachment type: "+t}},i.AnimCache={},c.Bone.yDown=!0,i.CustomRenderable=function(){i.DisplayObject.call(this)},i.CustomRenderable.prototype=Object.create(i.DisplayObject.prototype),i.CustomRenderable.prototype.constructor=i.CustomRenderable,i.CustomRenderable.prototype.renderCanvas=function(){},i.CustomRenderable.prototype.initWebGL=function(){},i.CustomRenderable.prototype.renderWebGL=function(){},i.BaseTextureCache={},i.texturesToUpdate=[],i.texturesToDestroy=[],i.BaseTexture=function(e){if(i.EventTarget.call(this),this.width=100,this.height=100,this.hasLoaded=!1,this.source=e,e){if(this.source instanceof Image||this.source instanceof HTMLImageElement)if(this.source.complete)this.hasLoaded=!0,this.width=this.source.width,this.height=this.source.height,i.texturesToUpdate.push(this);else{var t=this;this.source.onload=function(){t.hasLoaded=!0,t.width=t.source.width,t.height=t.source.height,i.texturesToUpdate.push(t),t.dispatchEvent({type:"loaded",content:t})}}else this.hasLoaded=!0,this.width=this.source.width,this.height=this.source.height,i.texturesToUpdate.push(this);this._powerOf2=!1}},i.BaseTexture.prototype.constructor=i.BaseTexture,i.BaseTexture.prototype.destroy=function(){this.source instanceof Image&&(this.source.src=null),this.source=null,i.texturesToDestroy.push(this)},i.BaseTexture.fromImage=function(e,t){var n=i.BaseTextureCache[e];if(!n){var r=new Image;t&&(r.crossOrigin=""),r.src=e,n=new i.BaseTexture(r),i.BaseTextureCache[e]=n}return n},i.TextureCache={},i.FrameCache={},i.Texture=function(e,t){if(i.EventTarget.call(this),t||(this.noFrame=!0,t=new i.Rectangle(0,0,1,1)),e instanceof i.Texture&&(e=e.baseTexture),this.baseTexture=e,this.frame=t,this.trim=new i.Point,this.scope=this,e.hasLoaded)this.noFrame&&(t=new i.Rectangle(0,0,e.width,e.height)),this.setFrame(t);else{var n=this;e.addEventListener("loaded",function(){n.onBaseTextureLoaded()})}},i.Texture.prototype.constructor=i.Texture,i.Texture.prototype.onBaseTextureLoaded=function(){var e=this.baseTexture;e.removeEventListener("loaded",this.onLoaded),this.noFrame&&(this.frame=new i.Rectangle(0,0,e.width,e.height)),this.noFrame=!1,this.width=this.frame.width,this.height=this.frame.height,this.scope.dispatchEvent({type:"update",content:this})},i.Texture.prototype.destroy=function(e){e&&this.baseTexture.destroy()},i.Texture.prototype.setFrame=function(e){if(this.frame=e,this.width=e.width,this.height=e.height,e.x+e.width>this.baseTexture.width||e.y+e.height>this.baseTexture.height)throw new Error("Texture Error: frame does not fit inside the base Texture dimensions "+this);this.updateFrame=!0,i.Texture.frameUpdates.push(this)},i.Texture.fromImage=function(e,t){var n=i.TextureCache[e];return n||(n=new i.Texture(i.BaseTexture.fromImage(e,t)),i.TextureCache[e]=n),n},i.Texture.fromFrame=function(e){var t=i.TextureCache[e];if(!t)throw new Error("The frameId '"+e+"' does not exist in the texture cache "+this);return t},i.Texture.fromCanvas=function(e){var t=new i.BaseTexture(e);return new i.Texture(t)},i.Texture.addTextureToCache=function(e,t){i.TextureCache[t]=e},i.Texture.removeTextureFromCache=function(e){var t=i.TextureCache[e];return i.TextureCache[e]=null,t},i.Texture.frameUpdates=[],i.RenderTexture=function(e,t){i.EventTarget.call(this),this.width=e||100,this.height=t||100,this.indetityMatrix=i.mat3.create(),this.frame=new i.Rectangle(0,0,this.width,this.height),i.gl?this.initWebGL():this.initCanvas()},i.RenderTexture.prototype=Object.create(i.Texture.prototype),i.RenderTexture.prototype.constructor=i.RenderTexture,i.RenderTexture.prototype.initWebGL=function(){var e=i.gl;this.glFramebuffer=e.createFramebuffer(),e.bindFramebuffer(e.FRAMEBUFFER,this.glFramebuffer),this.glFramebuffer.width=this.width,this.glFramebuffer.height=this.height,this.baseTexture=new i.BaseTexture,this.baseTexture.width=this.width,this.baseTexture.height=this.height,this.baseTexture._glTexture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.baseTexture._glTexture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.width,this.height,0,e.RGBA,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),this.baseTexture.isRender=!0,e.bindFramebuffer(e.FRAMEBUFFER,this.glFramebuffer),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.baseTexture._glTexture,0),this.projection=new i.Point(this.width/2,this.height/2),this.render=this.renderWebGL},i.RenderTexture.prototype.resize=function(e,t){if(this.width=e,this.height=t,i.gl){this.projection.x=this.width/2,this.projection.y=this.height/2;var n=i.gl;n.bindTexture(n.TEXTURE_2D,this.baseTexture._glTexture),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,this.width,this.height,0,n.RGBA,n.UNSIGNED_BYTE,null)}else this.frame.width=this.width,this.frame.height=this.height,this.renderer.resize(this.width,this.height)},i.RenderTexture.prototype.initCanvas=function(){this.renderer=new i.CanvasRenderer(this.width,this.height,null,0),this.baseTexture=new i.BaseTexture(this.renderer.view),this.frame=new i.Rectangle(0,0,this.width,this.height),this.render=this.renderCanvas},i.RenderTexture.prototype.renderWebGL=function(e,t,n){var r=i.gl;r.colorMask(!0,!0,!0,!0),r.viewport(0,0,this.width,this.height),r.bindFramebuffer(r.FRAMEBUFFER,this.glFramebuffer),n&&(r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT));var o=e.children,a=e.worldTransform;e.worldTransform=i.mat3.create(),e.worldTransform[4]=-1,e.worldTransform[5]=2*this.projection.y,t&&(e.worldTransform[2]=t.x,e.worldTransform[5]-=t.y),i.visibleCount++,e.vcount=i.visibleCount;for(var s=0,l=o.length;l>s;s++)o[s].updateTransform();var u=e.__renderGroup;u?e==u.root?u.render(this.projection):u.renderSpecific(e,this.projection):(this.renderGroup||(this.renderGroup=new i.WebGLRenderGroup(r)),this.renderGroup.setRenderable(e),this.renderGroup.render(this.projection)),e.worldTransform=a},i.RenderTexture.prototype.renderCanvas=function(e,t,n){var r=e.children;e.worldTransform=i.mat3.create(),t&&(e.worldTransform[2]=t.x,e.worldTransform[5]=t.y);for(var o=0,a=r.length;a>o;o++)r[o].updateTransform();n&&this.renderer.context.clearRect(0,0,this.width,this.height),this.renderer.renderDisplayObject(e),this.renderer.context.setTransform(1,0,0,1,0,0)},i.AssetLoader=function(e,t){i.EventTarget.call(this),this.assetURLs=e,this.crossorigin=t,this.loadersByType={jpg:i.ImageLoader,jpeg:i.ImageLoader,png:i.ImageLoader,gif:i.ImageLoader,json:i.JsonLoader,anim:i.SpineLoader,xml:i.BitmapFontLoader,fnt:i.BitmapFontLoader}},i.AssetLoader.prototype.constructor=i.AssetLoader,i.AssetLoader.prototype.load=function(){var e=this;this.loadCount=this.assetURLs.length;for(var t=0;t<this.assetURLs.length;t++){var n=this.assetURLs[t],r=n.split(".").pop().toLowerCase(),i=this.loadersByType[r];if(!i)throw new Error(r+" is an unsupported file type");var o=new i(n,this.crossorigin);o.addEventListener("loaded",function(){e.onAssetLoaded()}),o.load()}},i.AssetLoader.prototype.onAssetLoaded=function(){this.loadCount--,this.dispatchEvent({type:"onProgress",content:this}),this.onProgress&&this.onProgress(),0==this.loadCount&&(this.dispatchEvent({type:"onComplete",content:this}),this.onComplete&&this.onComplete())},i.JsonLoader=function(e,t){i.EventTarget.call(this),this.url=e,this.crossorigin=t,this.baseUrl=e.replace(/[^\/]*$/,""),this.loaded=!1},i.JsonLoader.prototype.constructor=i.JsonLoader,i.JsonLoader.prototype.load=function(){this.ajaxRequest=new u;var e=this;this.ajaxRequest.onreadystatechange=function(){e.onJSONLoaded()},this.ajaxRequest.open("GET",this.url,!0),this.ajaxRequest.overrideMimeType&&this.ajaxRequest.overrideMimeType("application/json"),this.ajaxRequest.send(null)},i.JsonLoader.prototype.onJSONLoaded=function(){if(4==this.ajaxRequest.readyState)if(200==this.ajaxRequest.status||-1==window.location.href.indexOf("http"))if(this.json=JSON.parse(this.ajaxRequest.responseText),this.json.frames){var e=this,t=this.baseUrl+this.json.meta.image,n=new i.ImageLoader(t,this.crossorigin),r=this.json.frames;this.texture=n.texture.baseTexture,n.addEventListener("loaded",function(){e.onLoaded()});for(var o in r){var a=r[o].frame;a&&(i.TextureCache[o]=new i.Texture(this.texture,{x:a.x,y:a.y,width:a.w,height:a.h}),r[o].trimmed&&(i.TextureCache[o].realSize=r[o].spriteSourceSize,i.TextureCache[o].trim.x=0))}n.load()}else if(this.json.bones){var s=new c.SkeletonJson,l=s.readSkeletonData(this.json);i.AnimCache[this.url]=l,this.onLoaded()}else this.onLoaded();else this.onError()},i.JsonLoader.prototype.onLoaded=function(){this.loaded=!0,this.dispatchEvent({type:"loaded",content:this})},i.JsonLoader.prototype.onError=function(){this.dispatchEvent({type:"error",content:this})},i.SpriteSheetLoader=function(e,t){i.EventTarget.call(this),this.url=e,this.crossorigin=t,this.baseUrl=e.replace(/[^\/]*$/,""),this.texture=null,this.frames={}},i.SpriteSheetLoader.prototype.constructor=i.SpriteSheetLoader,i.SpriteSheetLoader.prototype.load=function(){var e=this,t=new i.JsonLoader(this.url,this.crossorigin);t.addEventListener("loaded",function(t){e.json=t.content.json,e.onJSONLoaded()}),t.load()},i.SpriteSheetLoader.prototype.onJSONLoaded=function(){var e=this,t=this.baseUrl+this.json.meta.image,n=new i.ImageLoader(t,this.crossorigin),r=this.json.frames;this.texture=n.texture.baseTexture,n.addEventListener("loaded",function(){e.onLoaded()});for(var o in r){var a=r[o].frame;a&&(i.TextureCache[o]=new i.Texture(this.texture,{x:a.x,y:a.y,width:a.w,height:a.h}),r[o].trimmed&&(i.TextureCache[o].realSize=r[o].spriteSourceSize,i.TextureCache[o].trim.x=0))}n.load()},i.SpriteSheetLoader.prototype.onLoaded=function(){this.dispatchEvent({type:"loaded",content:this})},i.ImageLoader=function(e,t){i.EventTarget.call(this),this.texture=i.Texture.fromImage(e,t)},i.ImageLoader.prototype.constructor=i.ImageLoader,i.ImageLoader.prototype.load=function(){if(this.texture.baseTexture.hasLoaded)this.onLoaded();else{var e=this;this.texture.baseTexture.addEventListener("loaded",function(){e.onLoaded()})}},i.ImageLoader.prototype.onLoaded=function(){this.dispatchEvent({type:"loaded",content:this})},i.BitmapFontLoader=function(e,t){i.EventTarget.call(this),this.url=e,this.crossorigin=t,this.baseUrl=e.replace(/[^\/]*$/,""),this.texture=null},i.BitmapFontLoader.prototype.constructor=i.BitmapFontLoader,i.BitmapFontLoader.prototype.load=function(){this.ajaxRequest=new XMLHttpRequest;var e=this;this.ajaxRequest.onreadystatechange=function(){e.onXMLLoaded()},this.ajaxRequest.open("GET",this.url,!0),this.ajaxRequest.overrideMimeType&&this.ajaxRequest.overrideMimeType("application/xml"),this.ajaxRequest.send(null)},i.BitmapFontLoader.prototype.onXMLLoaded=function(){if(4==this.ajaxRequest.readyState&&(200==this.ajaxRequest.status||-1==window.location.href.indexOf("http"))){var e=this.baseUrl+this.ajaxRequest.responseXML.getElementsByTagName("page")[0].attributes.getNamedItem("file").nodeValue,t=new i.ImageLoader(e,this.crossorigin);this.texture=t.texture.baseTexture;var n={},r=this.ajaxRequest.responseXML.getElementsByTagName("info")[0],o=this.ajaxRequest.responseXML.getElementsByTagName("common")[0];n.font=r.attributes.getNamedItem("face").nodeValue,n.size=parseInt(r.attributes.getNamedItem("size").nodeValue,10),n.lineHeight=parseInt(o.attributes.getNamedItem("lineHeight").nodeValue,10),n.chars={};for(var a=this.ajaxRequest.responseXML.getElementsByTagName("char"),s=0;s<a.length;s++){var l=parseInt(a[s].attributes.getNamedItem("id").nodeValue,10),u={x:parseInt(a[s].attributes.getNamedItem("x").nodeValue,10),y:parseInt(a[s].attributes.getNamedItem("y").nodeValue,10),width:parseInt(a[s].attributes.getNamedItem("width").nodeValue,10),height:parseInt(a[s].attributes.getNamedItem("height").nodeValue,10)};i.TextureCache[l]=new i.Texture(this.texture,u),n.chars[l]={xOffset:parseInt(a[s].attributes.getNamedItem("xoffset").nodeValue,10),yOffset:parseInt(a[s].attributes.getNamedItem("yoffset").nodeValue,10),xAdvance:parseInt(a[s].attributes.getNamedItem("xadvance").nodeValue,10),kerning:{},texture:new i.Texture(this.texture,u)}}var c=this.ajaxRequest.responseXML.getElementsByTagName("kerning");for(s=0;s<c.length;s++){var d=parseInt(c[s].attributes.getNamedItem("first").nodeValue,10),h=parseInt(c[s].attributes.getNamedItem("second").nodeValue,10),p=parseInt(c[s].attributes.getNamedItem("amount").nodeValue,10);n.chars[h].kerning[d]=p}i.BitmapText.fonts[n.font]=n;var f=this;t.addEventListener("loaded",function(){f.onLoaded()}),t.load()}},i.BitmapFontLoader.prototype.onLoaded=function(){this.dispatchEvent({type:"loaded",content:this})},i.SpineLoader=function(e,t){i.EventTarget.call(this),this.url=e,this.crossorigin=t,this.loaded=!1},i.SpineLoader.prototype.constructor=i.SpineLoader,i.SpineLoader.prototype.load=function(){var e=this,t=new i.JsonLoader(this.url,this.crossorigin);t.addEventListener("loaded",function(t){e.json=t.content.json,e.onJSONLoaded()}),t.load()},i.SpineLoader.prototype.onJSONLoaded=function(){var e=new c.SkeletonJson,t=e.readSkeletonData(this.json);i.AnimCache[this.url]=t,this.onLoaded()},i.SpineLoader.prototype.onLoaded=function(){this.loaded=!0,this.dispatchEvent({type:"loaded",content:this})},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=i),exports.PIXI=i):n.PIXI=i}.call(this),define("pixi",function(e){return function(){var t;return t||e.PIXI}}(this)),define("common/views/svg-container",["require","common/performance","common/views/tab-index","common/views/hit-testing-helper","common/console","pixi"],function(e){var t=e("common/performance"),n=e("common/views/tab-index"),r=e("common/views/hit-testing-helper"),i=e("common/console"),o=e("pixi"),a=2,s=1e3;return function(e,l,u,c){function d(){return et++}function h(){return parseFloat(E.css("font-size"))||18}function p(){P=h(),k=P/18,q={top:0*k,right:0*k,bottom:0*k,left:0*k},(e.get("xunits")||e.get("yunits"))&&(q.bottom+=1.2*P,q.left+=1.3*P,q.top+=P/2,q.right+=P/2),(e.get("xlabel")||e.get("ylabel"))&&(q.bottom+=.8*P,q.left+=.8*P)}function f(){var t,n,r,i=e.get("viewPortWidth"),o=e.get("viewPortHeight"),s=e.get("viewPortX"),l=e.get("viewPortY");X=e.get("viewPortZoom")||1,H={minX:e.get("minX"),minY:e.get("minY"),maxX:e.get("maxX"),maxY:e.get("maxY")},z={width:null!=i?i:H.maxX-H.minX,height:null!=o?o:H.maxY-H.minY,x:null!=s?s:H.minX,y:null!=l?l:H.minY},z.scaledWidth=z.width/X,z.scaledHeight=z.height/X,"bottom-left"===Q&&(z.y+=z.scaledHeight),t=z.width/z.height,p(),U=E.width(),n=U-q.left-q.right,r=n/t,j=r+q.top+q.bottom,S.style.height=j+"px",W={width:U-q.left-q.right,height:j-q.top-q.bottom},W={width:n,height:r},rt.domain([0,z.width]).range([0,W.width]),tt.domain([0,z.scaledWidth]).range([0,W.width*a]),it.domain([z.height,0]).range("bottom-left"===Q?[0,W.height]:[W.height,0]),nt.domain([z.scaledHeight,0]).range("bottom-left"===Q?[0,W.height*a]:[W.height*a,0]),J&&J.x(rt).y(it)}function m(){var t,n,r=d3.scale.linear().domain([z.x,z.x+z.scaledWidth]).range([0,W.width]),i=d3.scale.linear().domain([z.y,z.y-z.scaledHeight]).range([0,W.height]),o=function(e){return"translate("+r(e)+",0)"},a=function(e){return"translate(0,"+i(e)+")"},s=function(e){return e?"#ccc":"#666"},l=r.tickFormat(5),u=i.tickFormat(5),c=e.getUnitDefinition?e.getUnitDefinition("length"):"";d3.event&&d3.event.transform&&d3.event.transform(r,i),R.selectAll("g.x, g.y").remove();var d=R.selectAll("g.x").data(r.ticks(5),String).attr("transform",o).classed("axes",!0);d.select("text").text(l);var h=d.enter().insert("g","a").attr("class","x").attr("transform",o);e.get("gridLines")?h.append("line").attr("stroke",s).attr("y1",0).attr("y2",W.height):h.selectAll("line").remove(),e.get("xunits")?h.append("text").attr("class","xunits").attr("y",W.height).attr("dy",.8*P+"px").attr("text-anchor","middle").text(l):h.select("text.xunits").remove(),d.exit().remove(),t=R.selectAll("text.xlabel").data(e.get("xlabel")?[c.pluralName]:[]),t.enter().append("text").attr("class","axis").attr("class","xlabel").attr("x",W.width/2).attr("y",W.height).attr("dy",1.6*P+"px").style("text-anchor","middle"),t.text(String),t.exit().remove();var p=R.selectAll("g.y").data(i.ticks(5),String).attr("transform",a).classed("axes",!0);p.select("text").text(u);var f=p.enter().insert("g","a").attr("class","y").attr("transform",a).attr("background-fill","#FFEEB6");e.get("gridLines")?f.append("line").attr("stroke",s).attr("x1",0).attr("x2",W.width):f.selectAll("line").remove(),e.get("yunits")?f.append("text").attr("class","yunits").attr("x","-0.3em").attr("dy",P/6+"px").attr("text-anchor","end").text(u):h.select("text.yunits").remove(),p.exit().remove(),n=R.selectAll("text.ylabel").data(e.get("ylabel")?[c.pluralName]:[]),n.enter().append("text").attr("class","axis").attr("class","ylabel").style("text-anchor","middle").attr("transform","translate("+1.6*-P+" "+W.height/2+") rotate(-90)"),n.text(String),n.exit().remove()}function g(){var t=e.get("backgroundColor")||"rgba(0, 0, 0, 0)";N.attr("fill",t),F.forEach(function(e){e.setBackgroundColor(parseInt(d3.rgb(t.replace("rgba","rgb")).toString().substr(1),16))})}function v(){y()}function y(){e.get("enableKeyboardHandlers")&&S.focus()}function b(){return this.attr({xmlns:"http://www.w3.org/2000/svg","xmlns:xmlns:xlink":"http://www.w3.org/1999/xlink",overflow:"hidden"})}function x(){return this.style({position:"absolute",top:0,left:0})}function w(){var t;f(),void 0===R&&(R=d3.select(S).append("svg").attr("class","root-layer container plot-container").style("z-index",d()).call(b),N=R.append("rect").attr("class","container-background background"),O=d3.select(S).append("svg").attr("class","root-layer container background-container svg-viewport").style("z-index",d()).call(b),I=O.append("g"),M=d3.select(S).append("svg").attr("class","root-layer container foreground-container svg-viewport").style("z-index",s).on("contextmenu",function(){d3.event.preventDefault()}).call(b),L=M.append("g"),B=M.append("g").attr("class","brush-container"),d3.select(S).selectAll(".root-layer").call(x),e.get("enableKeyboardHandlers")&&d3.select(S).attr("tabindex",0).on("mousedown",v),D=[],F=[],V=[],G=new r(M.node()),G.addLayer(R.node()),G.addLayer(O.node())),d3.select(S).selectAll(".root-layer").attr({width:U,height:j,left:q.left,top:q.top}).style({width:U+"px",height:j+"px"}),D.forEach(function(e){e.resize(U*a,j*a),$(e.view).css({width:U,height:j})}),t=rt(z.x)+" "+it(z.y)+" "+rt(z.scaledWidth)+" "+rt(z.scaledHeight),d3.select(S).selectAll(".svg-viewport").attr({viewBox:t,x:0,y:0,width:rt(z.width),height:rt(z.height)}),V.forEach(function(e){e.pivot.x=tt(z.x),e.pivot.y=nt(z.y)}),N.attr({width:rt(z.width),height:rt(z.height),x:0,y:0}),m(),C.renderCanvas()}function _(){function n(){l.push(e.properties.viewPortX),u.push(e.properties.viewPortY),c.push(t.now()),l.length>d&&(l.shift(),u.shift(),c.shift())}function r(){if(h)return!0;var n=t.now(),r=n-a,s=-.003*i,l=-.003*o;return e.properties.viewPortX+=i*r+.5*s*r*r,e.properties.viewPortY+=o*r+.5*l*r*r,ot.viewportDrag(),i+=s*r,o+=l*r,a=n,Math.abs(i)<1e-5&&Math.abs(o)<1e-5?!0:!1}var i,o,a,s,l=[],u=[],c=[],d=8,h=!1,p=e.properties.viewPortDrag||!1;return p===!1?(R.on("mousedown.drag",null).on("touchstart.drag",null).classed("draggable",!1),void 0):(s=d3.behavior.drag(),s.on("dragstart",function(){h=!0,l.length=0,u.length=0,c.length=0,n(),d3.select(window).on("mousemove.viewport-drag",function(){d3.event.preventDefault()})}).on("drag",function(){var t="y"===p?0:rt.invert(d3.event.dx),r="x"===p?0:rt.invert(d3.event.dy);e.properties.viewPortX-=t,e.properties.viewPortY+=r,ot.viewportDrag(),n()}).on("dragend",function(){d3.select(window).on("mousemove.viewport-drag",null),n();var e=l.length-1,t=c[e]-c[0];1e-5>t||c[e]-c[e-1]>100||(i=(l[e]-l[0])/t,o=(u[e]-u[0])/t,a=c[e],h=!1,d3.timer(r))}),R.call(s).classed("draggable",!0),void 0)}function T(){var e;for(e in Y)Y.hasOwnProperty(e)&&R.selectAll(e).on("click.custom",null)}function A(){w(),_(),Y={},K={},e.addPropertiesListener(["backgroundColor"],C.repaint),e.addPropertiesListener(["gridLines","xunits","yunits","xlabel","ylabel","viewPortX","viewPortY","viewPortZoom"],w),e.addPropertiesListener(["viewPortDrag"],_)}var C,E,S,k,P,R,O,M,N,I,L,B,D,F,V,G,U,j,q,W,H,z,X,Y,K,J,Z,Q=c&&c.origin||"bottom-left",et=0,tt=d3.scale.linear(),nt=d3.scale.linear(),rt=d3.scale.linear(),it=d3.scale.linear(),ot=d3.dispatch("viewportDrag");return C={get $el(){return E},get node(){return S},get foregroundContainer(){return M},get model2px(){return rt},get model2canvas(){return tt},get model2pxInv(){return it},get model2canvasInv(){return nt},get setFocus(){return y},get getFontSizeInPixels(){return h},get url(){return l},get clickHandler(){return Y},get dragHandler(){return K},get hitTestCallback(){return G.hitTestCallback},get mouseupCallback(){return G.mouseupCallback},repaint:function(){g(),Z.repaint&&Z.repaint(),C.updateClickHandlers(),C.renderCanvas()},appendViewport:function(){var e=D.length>0?L:I;return e.append("g")},appendPixiViewport:function(){if(0===D.length){var e=o.autoDetectRenderer(U*a,j*a,null,!0),t=new o.Stage(null);S.appendChild(e.view),d3.select(e.view).attr("class","pixi-viewport").style("z-index",d()).call(x),D.push(e),F.push(t),G.addLayer(e.view),G.passMouseMove(M.node(),D[0].view)}var n=new o.DisplayObjectContainer;return F[0].addChild(n),V.push(n),{pixiContainer:n,canvas:D[0].view}},resize:function(){w(),C.repaint(),J&&B.select("g.select-area").call(J),Z.resize&&Z.resize(),C.renderCanvas()},setup:function(){Z.setup&&Z.setup(e),C.renderCanvas()},update:function(){Z.update&&Z.update(),C.renderCanvas()},renderCanvas:function(){var e,t;for(e=0,t=D.length;t>e;e++)D[e].render(F[e])},getHeightForWidth:function(e){var t=z.width/z.height;return e=e-q.left-q.right,e/t+q.top+q.bottom},bindModel:function(t,n){l=n||l,e=t||e,T(),C.setSelectHandler(null),A(),Z.bindModel&&Z.bindModel(t,n)},pos:function(){var e={bottom:0,top:0,height:0,left:0,right:0,width:0};return E&&(e.top=E.position().top,e.left=E.position().left,e.width=E.width(),e.height=E.height(),e.bottom=e.top+e.height,e.right=e.left+e.width),e},on:function(e,t){ot.on(e,t)},setClickHandler:function(e,t){if("function"!=typeof t)throw new Error("Click handler should be a function.");Y[e]=t,C.updateClickHandlers()},updateClickHandlers:function(){function e(e){return function(t,n){if(!d3.event.defaultPrevented){var r=d3.mouse(N.node()),o=rt.invert(r[0]),a=it.invert(r[1]);i.log("[view] click at ("+o.toFixed(3)+", "+a.toFixed(3)+")"),e(o,a,t,n)}}}var t;for(t in Y)Y.hasOwnProperty(t)&&d3.selectAll(t).on("click.custom",e(Y[t]))},setSelectHandler:function(e){if("function"!=typeof e&&null!==e)throw new Error("Select handler should be a function or null.");return B.select("g.select-area").remove(),null===e?(J=null,void 0):(J=d3.svg.brush().x(rt).y(it).on("brushstart.select",function(){d3.select(window).on("mousemove.select",function(){d3.event.preventDefault()})}).on("brushend.select",function(){d3.select(window).on("mousemove.select",null);var t=J.extent(),n=t[0][0],r=t[0][1],o=t[1][0]-n,a=t[1][1]-r;i.log("[view] selection area ("+n.toFixed(3)+", "+r.toFixed(3)+"), width: "+o+", height: "+a),e(n,r,o,a),J.clear(),B.select("g.select-area").call(J)}),B.append("g").classed("select-area",!0).call(J),void 0)},setDragHandler:function(e,t){K[e]=t}},E=$("<div>").attr({id:"model-container","class":"container",tabindex:n}).css({width:"50px",height:"50px"}),S=E[0],A(),Z=new u(C,e),C}}),define("rgbcolor",function(e){return function(){var t;return t||e.rgbcolor}}(this)),function(){function e(){var e={};return e.FRAMERATE=30,e.MAX_VIRTUAL_PIXELS=3e4,e.init=function(t){var n=0;e.UniqueId=function(){return n++,"canvg"+n},e.Definitions={},e.Styles={},e.Animations=[],e.Images=[],e.ctx=t,e.ViewPort=new function(){this.viewPorts=[],this.Clear=function(){this.viewPorts=[]},this.SetCurrent=function(e,t){this.viewPorts.push({width:e,height:t})},this.RemoveCurrent=function(){this.viewPorts.pop()},this.Current=function(){return this.viewPorts[this.viewPorts.length-1]},this.width=function(){return this.Current().width},this.height=function(){return this.Current().height},this.ComputeSize=function(e){return null!=e&&"number"==typeof e?e:"x"==e?this.width():"y"==e?this.height():Math.sqrt(Math.pow(this.width(),2)+Math.pow(this.height(),2))/Math.sqrt(2)}}},e.init(),e.ImagesLoaded=function(){for(var t=0;t<e.Images.length;t++)if(!e.Images[t].loaded)return!1;return!0},e.trim=function(e){return e.replace(/^\s+|\s+$/g,"")},e.compressSpaces=function(e){return e.replace(/[\s\r\t\n]+/gm," ")},e.ajax=function(e){var t;return t=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),t?(t.open("GET",e,!1),t.send(null),t.responseText):null},e.parseXml=function(e){if(window.DOMParser){var t=new DOMParser;return t.parseFromString(e,"text/xml")}e=e.replace(/<!DOCTYPE svg[^>]*>/,"");var n=new ActiveXObject("Microsoft.XMLDOM");return n.async="false",n.loadXML(e),n},e.Property=function(e,t){this.name=e,this.value=t},e.Property.prototype.getValue=function(){return this.value},e.Property.prototype.hasValue=function(){return null!=this.value&&""!==this.value},e.Property.prototype.numValue=function(){if(!this.hasValue())return 0;var e=parseFloat(this.value);return(this.value+"").match(/%$/)&&(e/=100),e},e.Property.prototype.valueOrDefault=function(e){return this.hasValue()?this.value:e},e.Property.prototype.numValueOrDefault=function(e){return this.hasValue()?this.numValue():e},e.Property.prototype.addOpacity=function(t){var n=this.value;if(null!=t&&""!=t&&"string"==typeof this.value){var r=new RGBColor(this.value);r.ok&&(n="rgba("+r.r+", "+r.g+", "+r.b+", "+t+")")}return new e.Property(this.name,n)},e.Property.prototype.getDefinition=function(){var t=this.value.match(/#([^\)'"]+)/);return t&&(t=t[1]),t||(t=this.value),e.Definitions[t]},e.Property.prototype.isUrlDefinition=function(){return 0==this.value.indexOf("url(")},e.Property.prototype.getFillStyleDefinition=function(t,n){var r=this.getDefinition();if(null!=r&&r.createGradient)return r.createGradient(e.ctx,t,n);if(null!=r&&r.createPattern){if(r.getHrefAttribute().hasValue()){var i=r.attribute("patternTransform");r=r.getHrefAttribute().getDefinition(),i.hasValue()&&(r.attribute("patternTransform",!0).value=i.value)
}return r.createPattern(e.ctx,t)}return null},e.Property.prototype.getDPI=function(){return 96},e.Property.prototype.getEM=function(t){var n=12,r=new e.Property("fontSize",e.Font.Parse(e.ctx.font).fontSize);return r.hasValue()&&(n=r.toPixels(t)),n},e.Property.prototype.getUnits=function(){var e=this.value+"";return e.replace(/[0-9\.\-]/g,"")},e.Property.prototype.toPixels=function(t,n){if(!this.hasValue())return 0;var r=this.value+"";if(r.match(/em$/))return this.numValue()*this.getEM(t);if(r.match(/ex$/))return this.numValue()*this.getEM(t)/2;if(r.match(/px$/))return this.numValue();if(r.match(/pt$/))return this.numValue()*this.getDPI(t)*(1/72);if(r.match(/pc$/))return 15*this.numValue();if(r.match(/cm$/))return this.numValue()*this.getDPI(t)/2.54;if(r.match(/mm$/))return this.numValue()*this.getDPI(t)/25.4;if(r.match(/in$/))return this.numValue()*this.getDPI(t);if(r.match(/%$/))return this.numValue()*e.ViewPort.ComputeSize(t);var i=this.numValue();return n&&1>i?i*e.ViewPort.ComputeSize(t):i},e.Property.prototype.toMilliseconds=function(){if(!this.hasValue())return 0;var e=this.value+"";return e.match(/s$/)?1e3*this.numValue():e.match(/ms$/)?this.numValue():this.numValue()},e.Property.prototype.toRadians=function(){if(!this.hasValue())return 0;var e=this.value+"";return e.match(/deg$/)?this.numValue()*(Math.PI/180):e.match(/grad$/)?this.numValue()*(Math.PI/200):e.match(/rad$/)?this.numValue():this.numValue()*(Math.PI/180)},e.Font=new function(){this.Styles="normal|italic|oblique|inherit",this.Variants="normal|small-caps|inherit",this.Weights="normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit",this.CreateFont=function(t,n,r,i,o,a){var s=null!=a?this.Parse(a):this.CreateFont("","","","","",e.ctx.font);return{fontFamily:o||s.fontFamily,fontSize:i||s.fontSize,fontStyle:t||s.fontStyle,fontWeight:r||s.fontWeight,fontVariant:n||s.fontVariant,toString:function(){return[this.fontStyle,this.fontVariant,this.fontWeight,this.fontSize,this.fontFamily].join(" ")}}};var t=this;this.Parse=function(n){for(var r={},i=e.trim(e.compressSpaces(n||"")).split(" "),o={fontSize:!1,fontStyle:!1,fontWeight:!1,fontVariant:!1},a="",s=0;s<i.length;s++)o.fontStyle||-1==t.Styles.indexOf(i[s])?o.fontVariant||-1==t.Variants.indexOf(i[s])?o.fontWeight||-1==t.Weights.indexOf(i[s])?o.fontSize?"inherit"!=i[s]&&(a+=i[s]):("inherit"!=i[s]&&(r.fontSize=i[s].split("/")[0]),o.fontStyle=o.fontVariant=o.fontWeight=o.fontSize=!0):("inherit"!=i[s]&&(r.fontWeight=i[s]),o.fontStyle=o.fontVariant=o.fontWeight=!0):("inherit"!=i[s]&&(r.fontVariant=i[s]),o.fontStyle=o.fontVariant=!0):("inherit"!=i[s]&&(r.fontStyle=i[s]),o.fontStyle=!0);return""!=a&&(r.fontFamily=a),r}},e.ToNumberArray=function(t){for(var n=e.trim(e.compressSpaces((t||"").replace(/,/g," "))).split(" "),r=0;r<n.length;r++)n[r]=parseFloat(n[r]);return n},e.Point=function(e,t){this.x=e,this.y=t},e.Point.prototype.angleTo=function(e){return Math.atan2(e.y-this.y,e.x-this.x)},e.Point.prototype.applyTransform=function(e){var t=this.x*e[0]+this.y*e[2]+e[4],n=this.x*e[1]+this.y*e[3]+e[5];this.x=t,this.y=n},e.CreatePoint=function(t){var n=e.ToNumberArray(t);return new e.Point(n[0],n[1])},e.CreatePath=function(t){for(var n=e.ToNumberArray(t),r=[],i=0;i<n.length;i+=2)r.push(new e.Point(n[i],n[i+1]));return r},e.BoundingBox=function(e,t,n,r){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN,this.x=function(){return this.x1},this.y=function(){return this.y1},this.width=function(){return this.x2-this.x1},this.height=function(){return this.y2-this.y1},this.addPoint=function(e,t){null!=e&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=e,this.x2=e),e<this.x1&&(this.x1=e),e>this.x2&&(this.x2=e)),null!=t&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=t,this.y2=t),t<this.y1&&(this.y1=t),t>this.y2&&(this.y2=t))},this.addX=function(e){this.addPoint(e,null)},this.addY=function(e){this.addPoint(null,e)},this.addBoundingBox=function(e){this.addPoint(e.x1,e.y1),this.addPoint(e.x2,e.y2)},this.addQuadraticCurve=function(e,t,n,r,i,o){var a=e+2/3*(n-e),s=t+2/3*(r-t),l=a+1/3*(i-e),u=s+1/3*(o-t);this.addBezierCurve(e,t,a,l,s,u,i,o)},this.addBezierCurve=function(e,t,n,r,o,a,s,l){var u=[e,t],c=[n,r],d=[o,a],h=[s,l];for(this.addPoint(u[0],u[1]),this.addPoint(h[0],h[1]),i=0;1>=i;i++){var p=function(e){return Math.pow(1-e,3)*u[i]+3*Math.pow(1-e,2)*e*c[i]+3*(1-e)*Math.pow(e,2)*d[i]+Math.pow(e,3)*h[i]},f=6*u[i]-12*c[i]+6*d[i],m=-3*u[i]+9*c[i]-9*d[i]+3*h[i],g=3*c[i]-3*u[i];if(0!=m){var v=Math.pow(f,2)-4*g*m;if(!(0>v)){var y=(-f+Math.sqrt(v))/(2*m);y>0&&1>y&&(0==i&&this.addX(p(y)),1==i&&this.addY(p(y)));var b=(-f-Math.sqrt(v))/(2*m);b>0&&1>b&&(0==i&&this.addX(p(b)),1==i&&this.addY(p(b)))}}else{if(0==f)continue;var x=-g/f;x>0&&1>x&&(0==i&&this.addX(p(x)),1==i&&this.addY(p(x)))}}},this.isPointInBox=function(e,t){return this.x1<=e&&e<=this.x2&&this.y1<=t&&t<=this.y2},this.addPoint(e,t),this.addPoint(n,r)},e.Transform=function(t){var n=this;this.Type={},this.Type.translate=function(t){this.p=e.CreatePoint(t),this.apply=function(e){e.translate(this.p.x||0,this.p.y||0)},this.unapply=function(e){e.translate(-1*this.p.x||0,-1*this.p.y||0)},this.applyToPoint=function(e){e.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0])}},this.Type.rotate=function(t){var n=e.ToNumberArray(t);this.angle=new e.Property("angle",n[0]),this.cx=n[1]||0,this.cy=n[2]||0,this.apply=function(e){e.translate(this.cx,this.cy),e.rotate(this.angle.toRadians()),e.translate(-this.cx,-this.cy)},this.unapply=function(e){e.translate(this.cx,this.cy),e.rotate(-1*this.angle.toRadians()),e.translate(-this.cx,-this.cy)},this.applyToPoint=function(e){var t=this.angle.toRadians();e.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0]),e.applyTransform([Math.cos(t),Math.sin(t),-Math.sin(t),Math.cos(t),0,0]),e.applyTransform([1,0,0,1,-this.p.x||0,-this.p.y||0])}},this.Type.scale=function(t){this.p=e.CreatePoint(t),this.apply=function(e){e.scale(this.p.x||1,this.p.y||this.p.x||1)},this.unapply=function(e){e.scale(1/this.p.x||1,1/this.p.y||this.p.x||1)},this.applyToPoint=function(e){e.applyTransform([this.p.x||0,0,0,this.p.y||0,0,0])}},this.Type.matrix=function(t){this.m=e.ToNumberArray(t),this.apply=function(e){e.transform(this.m[0],this.m[1],this.m[2],this.m[3],this.m[4],this.m[5])},this.applyToPoint=function(e){e.applyTransform(this.m)}},this.Type.SkewBase=function(t){this.base=n.Type.matrix,this.base(t),this.angle=new e.Property("angle",t)},this.Type.SkewBase.prototype=new this.Type.matrix,this.Type.skewX=function(e){this.base=n.Type.SkewBase,this.base(e),this.m=[1,0,Math.tan(this.angle.toRadians()),1,0,0]},this.Type.skewX.prototype=new this.Type.SkewBase,this.Type.skewY=function(e){this.base=n.Type.SkewBase,this.base(e),this.m=[1,Math.tan(this.angle.toRadians()),0,1,0,0]},this.Type.skewY.prototype=new this.Type.SkewBase,this.transforms=[],this.apply=function(e){for(var t=0;t<this.transforms.length;t++)this.transforms[t].apply(e)},this.unapply=function(e){for(var t=this.transforms.length-1;t>=0;t--)this.transforms[t].unapply(e)},this.applyToPoint=function(e){for(var t=0;t<this.transforms.length;t++)this.transforms[t].applyToPoint(e)};for(var r=e.trim(e.compressSpaces(t)).replace(/\)(\s?,\s?)/g,") ").split(/\s(?=[a-z])/),i=0;i<r.length;i++){var o=e.trim(r[i].split("(")[0]),a=r[i].split("(")[1].replace(")",""),s=new this.Type[o](a);s.type=o,this.transforms.push(s)}},e.AspectRatio=function(t,n,r,i,o,a,s,l,u,c){n=e.compressSpaces(n),n=n.replace(/^defer\s/,"");var d=n.split(" ")[0]||"xMidYMid",h=n.split(" ")[1]||"meet",p=r/i,f=o/a,m=Math.min(p,f),g=Math.max(p,f);"meet"==h&&(i*=m,a*=m),"slice"==h&&(i*=g,a*=g),u=new e.Property("refX",u),c=new e.Property("refY",c),u.hasValue()&&c.hasValue()?t.translate(-m*u.toPixels("x"),-m*c.toPixels("y")):(d.match(/^xMid/)&&("meet"==h&&m==f||"slice"==h&&g==f)&&t.translate(r/2-i/2,0),d.match(/YMid$/)&&("meet"==h&&m==p||"slice"==h&&g==p)&&t.translate(0,o/2-a/2),d.match(/^xMax/)&&("meet"==h&&m==f||"slice"==h&&g==f)&&t.translate(r-i,0),d.match(/YMax$/)&&("meet"==h&&m==p||"slice"==h&&g==p)&&t.translate(0,o-a)),"none"==d?t.scale(p,f):"meet"==h?t.scale(m,m):"slice"==h&&t.scale(g,g),t.translate(null==s?0:-s,null==l?0:-l)},e.Element={},e.EmptyProperty=new e.Property("EMPTY",""),e.Element.ElementBase=function(t){if(this.attributes={},this.styles={},this.children=[],this.attribute=function(t,n){var r=this.attributes[t];return null!=r?r:(1==n&&(r=new e.Property(t,""),this.attributes[t]=r),r||e.EmptyProperty)},this.getHrefAttribute=function(){for(var t in this.attributes)if(t.match(/:href$/))return this.attributes[t];return e.EmptyProperty},this.style=function(t,n){var r=this.styles[t];if(null!=r)return r;var i=this.attribute(t);if(null!=i&&i.hasValue())return this.styles[t]=i,i;var o=this.parent;if(null!=o){var a=o.style(t);if(null!=a&&a.hasValue())return a}return 1==n&&(r=new e.Property(t,""),this.styles[t]=r),r||e.EmptyProperty},this.render=function(e){if("none"!=this.style("display").value&&"hidden"!=this.attribute("visibility").value){if(e.save(),this.attribute("mask").hasValue()){var t=this.attribute("mask").getDefinition();null!=t&&t.apply(e,this)}else if(this.style("filter").hasValue()){var n=this.style("filter").getDefinition();null!=n&&n.apply(e,this)}else this.setContext(e),this.renderChildren(e),this.clearContext(e);e.restore()}},this.setContext=function(){},this.clearContext=function(){},this.renderChildren=function(e){for(var t=0;t<this.children.length;t++)this.children[t].render(e)},this.addChild=function(t,n){var r=t;n&&(r=e.CreateElement(t)),r.parent=this,this.children.push(r)},null!=t&&1==t.nodeType){for(var n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];if(1==r.nodeType&&this.addChild(r,!0),this.captureTextNodes&&3==r.nodeType){var i=r.nodeValue||r.text||"";""!=e.trim(e.compressSpaces(i))&&this.addChild(new e.Element.tspan(r),!1)}}for(var n=0;n<t.attributes.length;n++){var o=t.attributes[n];this.attributes[o.nodeName]=new e.Property(o.nodeName,o.nodeValue)}var a=e.Styles[t.nodeName];if(null!=a)for(var s in a)this.styles[s]=a[s];if(this.attribute("class").hasValue())for(var l=e.compressSpaces(this.attribute("class").value).split(" "),u=0;u<l.length;u++){if(a=e.Styles["."+l[u]],null!=a)for(var s in a)this.styles[s]=a[s];if(a=e.Styles[t.nodeName+"."+l[u]],null!=a)for(var s in a)this.styles[s]=a[s]}if(this.attribute("id").hasValue()){var a=e.Styles["#"+this.attribute("id").value];if(null!=a)for(var s in a)this.styles[s]=a[s]}if(this.attribute("style").hasValue())for(var a=this.attribute("style").value.split(";"),n=0;n<a.length;n++)if(""!=e.trim(a[n])){var c=a[n].split(":"),s=e.trim(c[0]),d=e.trim(c[1]);this.styles[s]=new e.Property(s,d)}this.attribute("id").hasValue()&&null==e.Definitions[this.attribute("id").value]&&(e.Definitions[this.attribute("id").value]=this)}},e.Element.RenderedElementBase=function(t){this.base=e.Element.ElementBase,this.base(t),this.setContext=function(t){if(this.style("fill").isUrlDefinition()){var n=this.style("fill").getFillStyleDefinition(this,this.style("fill-opacity"));null!=n&&(t.fillStyle=n)}else if(this.style("fill").hasValue()){var r=this.style("fill");"currentColor"==r.value&&(r.value=this.style("color").value),t.fillStyle="none"==r.value?"rgba(0,0,0,0)":r.value}if(this.style("fill-opacity").hasValue()){var r=new e.Property("fill",t.fillStyle);r=r.addOpacity(this.style("fill-opacity").value),t.fillStyle=r.value}if(this.style("stroke").isUrlDefinition()){var n=this.style("stroke").getFillStyleDefinition(this,this.style("stroke-opacity"));null!=n&&(t.strokeStyle=n)}else if(this.style("stroke").hasValue()){var i=this.style("stroke");"currentColor"==i.value&&(i.value=this.style("color").value),t.strokeStyle="none"==i.value?"rgba(0,0,0,0)":i.value}if(this.style("stroke-opacity").hasValue()){var i=new e.Property("stroke",t.strokeStyle);i=i.addOpacity(this.style("stroke-opacity").value),t.strokeStyle=i.value}if(this.style("stroke-width").hasValue()){var o=this.style("stroke-width").toPixels();t.lineWidth=0==o?.001:o}if(this.style("stroke-linecap").hasValue()&&(t.lineCap=this.style("stroke-linecap").value),this.style("stroke-linejoin").hasValue()&&(t.lineJoin=this.style("stroke-linejoin").value),this.style("stroke-miterlimit").hasValue()&&(t.miterLimit=this.style("stroke-miterlimit").value),this.style("stroke-dasharray").hasValue()){var a=e.ToNumberArray(this.style("stroke-dasharray").value);"undefined"!=typeof t.setLineDash?t.setLineDash(a):"undefined"!=typeof t.webkitLineDash?t.webkitLineDash=a:"undefined"!=typeof t.mozDash&&(t.mozDash=a);var s=this.style("stroke-dashoffset").numValueOrDefault(1);"undefined"!=typeof t.lineDashOffset?t.lineDashOffset=s:"undefined"!=typeof t.webkitLineDashOffset?t.webkitLineDashOffset=s:"undefined"!=typeof t.mozDashOffset&&(t.mozDashOffset=s)}if("undefined"!=typeof t.font&&(t.font=e.Font.CreateFont(this.style("font-style").value,this.style("font-variant").value,this.style("font-weight").value,this.style("font-size").hasValue()?this.style("font-size").toPixels()+"px":"",this.style("font-family").value).toString()),this.attribute("transform").hasValue()){var l=new e.Transform(this.attribute("transform").value);l.apply(t)}if(this.style("clip-path").hasValue()){var u=this.style("clip-path").getDefinition();null!=u&&u.apply(t)}this.style("opacity").hasValue()&&(t.globalAlpha=this.style("opacity").numValue())}},e.Element.RenderedElementBase.prototype=new e.Element.ElementBase,e.Element.PathElementBase=function(t){this.base=e.Element.RenderedElementBase,this.base(t),this.path=function(t){return null!=t&&t.beginPath(),new e.BoundingBox},this.renderChildren=function(t){this.path(t),e.Mouse.checkPath(this,t),""!=t.fillStyle&&(this.attribute("fill-rule").hasValue()?t.fill(this.attribute("fill-rule").value):t.fill()),""!=t.strokeStyle&&t.stroke();var n=this.getMarkers();if(null!=n){if(this.style("marker-start").isUrlDefinition()){var r=this.style("marker-start").getDefinition();r.render(t,n[0][0],n[0][1])}if(this.style("marker-mid").isUrlDefinition())for(var r=this.style("marker-mid").getDefinition(),i=1;i<n.length-1;i++)r.render(t,n[i][0],n[i][1]);if(this.style("marker-end").isUrlDefinition()){var r=this.style("marker-end").getDefinition();r.render(t,n[n.length-1][0],n[n.length-1][1])}}},this.getBoundingBox=function(){return this.path()},this.getMarkers=function(){return null}},e.Element.PathElementBase.prototype=new e.Element.RenderedElementBase,e.Element.svg=function(t){this.base=e.Element.RenderedElementBase,this.base(t),this.baseClearContext=this.clearContext,this.clearContext=function(t){this.baseClearContext(t),e.ViewPort.RemoveCurrent()},this.baseSetContext=this.setContext,this.setContext=function(t){t.strokeStyle="rgba(0,0,0,0)",t.lineCap="butt",t.lineJoin="miter",t.miterLimit=4,this.baseSetContext(t),this.attribute("x").hasValue()||(this.attribute("x",!0).value=0),this.attribute("y").hasValue()||(this.attribute("y",!0).value=0),t.translate(this.attribute("x").toPixels("x"),this.attribute("y").toPixels("y"));var n=e.ViewPort.width(),r=e.ViewPort.height();if(this.attribute("width").hasValue()||(this.attribute("width",!0).value="100%"),this.attribute("height").hasValue()||(this.attribute("height",!0).value="100%"),"undefined"==typeof this.root){n=this.attribute("width").toPixels("x"),r=this.attribute("height").toPixels("y");var i=0,o=0;this.attribute("refX").hasValue()&&this.attribute("refY").hasValue()&&(i=-this.attribute("refX").toPixels("x"),o=-this.attribute("refY").toPixels("y")),t.beginPath(),t.moveTo(i,o),t.lineTo(n,o),t.lineTo(n,r),t.lineTo(i,r),t.closePath(),t.clip()}if(e.ViewPort.SetCurrent(n,r),this.attribute("viewBox").hasValue()){var a=e.ToNumberArray(this.attribute("viewBox").value),s=a[0],l=a[1];n=a[2],r=a[3],e.AspectRatio(t,this.attribute("preserveAspectRatio").value,e.ViewPort.width(),n,e.ViewPort.height(),r,s,l,this.attribute("refX").value,this.attribute("refY").value),e.ViewPort.RemoveCurrent(),e.ViewPort.SetCurrent(a[2],a[3])}}},e.Element.svg.prototype=new e.Element.RenderedElementBase,e.Element.rect=function(t){this.base=e.Element.PathElementBase,this.base(t),this.path=function(t){var n=this.attribute("x").toPixels("x"),r=this.attribute("y").toPixels("y"),i=this.attribute("width").toPixels("x"),o=this.attribute("height").toPixels("y"),a=this.attribute("rx").toPixels("x"),s=this.attribute("ry").toPixels("y");return this.attribute("rx").hasValue()&&!this.attribute("ry").hasValue()&&(s=a),this.attribute("ry").hasValue()&&!this.attribute("rx").hasValue()&&(a=s),a=Math.min(a,i/2),s=Math.min(s,o/2),null!=t&&(t.beginPath(),t.moveTo(n+a,r),t.lineTo(n+i-a,r),t.quadraticCurveTo(n+i,r,n+i,r+s),t.lineTo(n+i,r+o-s),t.quadraticCurveTo(n+i,r+o,n+i-a,r+o),t.lineTo(n+a,r+o),t.quadraticCurveTo(n,r+o,n,r+o-s),t.lineTo(n,r+s),t.quadraticCurveTo(n,r,n+a,r),t.closePath()),new e.BoundingBox(n,r,n+i,r+o)}},e.Element.rect.prototype=new e.Element.PathElementBase,e.Element.circle=function(t){this.base=e.Element.PathElementBase,this.base(t),this.path=function(t){var n=this.attribute("cx").toPixels("x"),r=this.attribute("cy").toPixels("y"),i=this.attribute("r").toPixels();return null!=t&&(t.beginPath(),t.arc(n,r,i,0,2*Math.PI,!0),t.closePath()),new e.BoundingBox(n-i,r-i,n+i,r+i)}},e.Element.circle.prototype=new e.Element.PathElementBase,e.Element.ellipse=function(t){this.base=e.Element.PathElementBase,this.base(t),this.path=function(t){var n=4*((Math.sqrt(2)-1)/3),r=this.attribute("rx").toPixels("x"),i=this.attribute("ry").toPixels("y"),o=this.attribute("cx").toPixels("x"),a=this.attribute("cy").toPixels("y");return null!=t&&(t.beginPath(),t.moveTo(o,a-i),t.bezierCurveTo(o+n*r,a-i,o+r,a-n*i,o+r,a),t.bezierCurveTo(o+r,a+n*i,o+n*r,a+i,o,a+i),t.bezierCurveTo(o-n*r,a+i,o-r,a+n*i,o-r,a),t.bezierCurveTo(o-r,a-n*i,o-n*r,a-i,o,a-i),t.closePath()),new e.BoundingBox(o-r,a-i,o+r,a+i)}},e.Element.ellipse.prototype=new e.Element.PathElementBase,e.Element.line=function(t){this.base=e.Element.PathElementBase,this.base(t),this.getPoints=function(){return[new e.Point(this.attribute("x1").toPixels("x"),this.attribute("y1").toPixels("y")),new e.Point(this.attribute("x2").toPixels("x"),this.attribute("y2").toPixels("y"))]},this.path=function(t){var n=this.getPoints();return null!=t&&(t.beginPath(),t.moveTo(n[0].x,n[0].y),t.lineTo(n[1].x,n[1].y)),new e.BoundingBox(n[0].x,n[0].y,n[1].x,n[1].y)},this.getMarkers=function(){var e=this.getPoints(),t=e[0].angleTo(e[1]);return[[e[0],t],[e[1],t]]}},e.Element.line.prototype=new e.Element.PathElementBase,e.Element.polyline=function(t){this.base=e.Element.PathElementBase,this.base(t),this.points=e.CreatePath(this.attribute("points").value),this.path=function(t){var n=new e.BoundingBox(this.points[0].x,this.points[0].y);null!=t&&(t.beginPath(),t.moveTo(this.points[0].x,this.points[0].y));for(var r=1;r<this.points.length;r++)n.addPoint(this.points[r].x,this.points[r].y),null!=t&&t.lineTo(this.points[r].x,this.points[r].y);return n},this.getMarkers=function(){for(var e=[],t=0;t<this.points.length-1;t++)e.push([this.points[t],this.points[t].angleTo(this.points[t+1])]);return e.push([this.points[this.points.length-1],e[e.length-1][1]]),e}},e.Element.polyline.prototype=new e.Element.PathElementBase,e.Element.polygon=function(t){this.base=e.Element.polyline,this.base(t),this.basePath=this.path,this.path=function(e){var t=this.basePath(e);return null!=e&&(e.lineTo(this.points[0].x,this.points[0].y),e.closePath()),t}},e.Element.polygon.prototype=new e.Element.polyline,e.Element.path=function(t){this.base=e.Element.PathElementBase,this.base(t);var n=this.attribute("d").value;n=n.replace(/,/gm," "),n=n.replace(/([MmZzLlHhVvCcSsQqTtAa])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2"),n=n.replace(/([MmZzLlHhVvCcSsQqTtAa])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2"),n=n.replace(/([MmZzLlHhVvCcSsQqTtAa])([^\s])/gm,"$1 $2"),n=n.replace(/([^\s])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2"),n=n.replace(/([0-9])([+\-])/gm,"$1 $2"),n=n.replace(/(\.[0-9]*)(\.)/gm,"$1 $2"),n=n.replace(/([Aa](\s+[0-9]+){3})\s+([01])\s*([01])/gm,"$1 $3 $4 "),n=e.compressSpaces(n),n=e.trim(n),this.PathParser=new function(t){this.tokens=t.split(" "),this.reset=function(){this.i=-1,this.command="",this.previousCommand="",this.start=new e.Point(0,0),this.control=new e.Point(0,0),this.current=new e.Point(0,0),this.points=[],this.angles=[]},this.isEnd=function(){return this.i>=this.tokens.length-1},this.isCommandOrEnd=function(){return this.isEnd()?!0:null!=this.tokens[this.i+1].match(/^[A-Za-z]$/)},this.isRelativeCommand=function(){switch(this.command){case"m":case"l":case"h":case"v":case"c":case"s":case"q":case"t":case"a":case"z":return!0}return!1},this.getToken=function(){return this.i++,this.tokens[this.i]},this.getScalar=function(){return parseFloat(this.getToken())},this.nextCommand=function(){this.previousCommand=this.command,this.command=this.getToken()},this.getPoint=function(){var t=new e.Point(this.getScalar(),this.getScalar());return this.makeAbsolute(t)},this.getAsControlPoint=function(){var e=this.getPoint();return this.control=e,e},this.getAsCurrentPoint=function(){var e=this.getPoint();return this.current=e,e},this.getReflectedControlPoint=function(){if("c"!=this.previousCommand.toLowerCase()&&"s"!=this.previousCommand.toLowerCase()&&"q"!=this.previousCommand.toLowerCase()&&"t"!=this.previousCommand.toLowerCase())return this.current;var t=new e.Point(2*this.current.x-this.control.x,2*this.current.y-this.control.y);return t},this.makeAbsolute=function(e){return this.isRelativeCommand()&&(e.x+=this.current.x,e.y+=this.current.y),e},this.addMarker=function(e,t,n){null!=n&&this.angles.length>0&&null==this.angles[this.angles.length-1]&&(this.angles[this.angles.length-1]=this.points[this.points.length-1].angleTo(n)),this.addMarkerAngle(e,null==t?null:t.angleTo(e))},this.addMarkerAngle=function(e,t){this.points.push(e),this.angles.push(t)},this.getMarkerPoints=function(){return this.points},this.getMarkerAngles=function(){for(var e=0;e<this.angles.length;e++)if(null==this.angles[e])for(var t=e+1;t<this.angles.length;t++)if(null!=this.angles[t]){this.angles[e]=this.angles[t];break}return this.angles}}(n),this.path=function(t){var n=this.PathParser;n.reset();var r=new e.BoundingBox;for(null!=t&&t.beginPath();!n.isEnd();)switch(n.nextCommand(),n.command){case"M":case"m":var i=n.getAsCurrentPoint();for(n.addMarker(i),r.addPoint(i.x,i.y),null!=t&&t.moveTo(i.x,i.y),n.start=n.current;!n.isCommandOrEnd();){var i=n.getAsCurrentPoint();n.addMarker(i,n.start),r.addPoint(i.x,i.y),null!=t&&t.lineTo(i.x,i.y)}break;case"L":case"l":for(;!n.isCommandOrEnd();){var o=n.current,i=n.getAsCurrentPoint();n.addMarker(i,o),r.addPoint(i.x,i.y),null!=t&&t.lineTo(i.x,i.y)}break;case"H":case"h":for(;!n.isCommandOrEnd();){var a=new e.Point((n.isRelativeCommand()?n.current.x:0)+n.getScalar(),n.current.y);n.addMarker(a,n.current),n.current=a,r.addPoint(n.current.x,n.current.y),null!=t&&t.lineTo(n.current.x,n.current.y)}break;case"V":case"v":for(;!n.isCommandOrEnd();){var a=new e.Point(n.current.x,(n.isRelativeCommand()?n.current.y:0)+n.getScalar());n.addMarker(a,n.current),n.current=a,r.addPoint(n.current.x,n.current.y),null!=t&&t.lineTo(n.current.x,n.current.y)}break;case"C":case"c":for(;!n.isCommandOrEnd();){var s=n.current,l=n.getPoint(),u=n.getAsControlPoint(),c=n.getAsCurrentPoint();n.addMarker(c,u,l),r.addBezierCurve(s.x,s.y,l.x,l.y,u.x,u.y,c.x,c.y),null!=t&&t.bezierCurveTo(l.x,l.y,u.x,u.y,c.x,c.y)}break;case"S":case"s":for(;!n.isCommandOrEnd();){var s=n.current,l=n.getReflectedControlPoint(),u=n.getAsControlPoint(),c=n.getAsCurrentPoint();n.addMarker(c,u,l),r.addBezierCurve(s.x,s.y,l.x,l.y,u.x,u.y,c.x,c.y),null!=t&&t.bezierCurveTo(l.x,l.y,u.x,u.y,c.x,c.y)}break;case"Q":case"q":for(;!n.isCommandOrEnd();){var s=n.current,u=n.getAsControlPoint(),c=n.getAsCurrentPoint();n.addMarker(c,u,u),r.addQuadraticCurve(s.x,s.y,u.x,u.y,c.x,c.y),null!=t&&t.quadraticCurveTo(u.x,u.y,c.x,c.y)}break;case"T":case"t":for(;!n.isCommandOrEnd();){var s=n.current,u=n.getReflectedControlPoint();n.control=u;var c=n.getAsCurrentPoint();n.addMarker(c,u,u),r.addQuadraticCurve(s.x,s.y,u.x,u.y,c.x,c.y),null!=t&&t.quadraticCurveTo(u.x,u.y,c.x,c.y)}break;case"A":case"a":for(;!n.isCommandOrEnd();){var s=n.current,d=n.getScalar(),h=n.getScalar(),p=n.getScalar()*(Math.PI/180),f=n.getScalar(),m=n.getScalar(),c=n.getAsCurrentPoint(),g=new e.Point(Math.cos(p)*(s.x-c.x)/2+Math.sin(p)*(s.y-c.y)/2,-Math.sin(p)*(s.x-c.x)/2+Math.cos(p)*(s.y-c.y)/2),v=Math.pow(g.x,2)/Math.pow(d,2)+Math.pow(g.y,2)/Math.pow(h,2);v>1&&(d*=Math.sqrt(v),h*=Math.sqrt(v));var y=(f==m?-1:1)*Math.sqrt((Math.pow(d,2)*Math.pow(h,2)-Math.pow(d,2)*Math.pow(g.y,2)-Math.pow(h,2)*Math.pow(g.x,2))/(Math.pow(d,2)*Math.pow(g.y,2)+Math.pow(h,2)*Math.pow(g.x,2)));isNaN(y)&&(y=0);var b=new e.Point(y*d*g.y/h,y*-h*g.x/d),x=new e.Point((s.x+c.x)/2+Math.cos(p)*b.x-Math.sin(p)*b.y,(s.y+c.y)/2+Math.sin(p)*b.x+Math.cos(p)*b.y),w=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2))},_=function(e,t){return(e[0]*t[0]+e[1]*t[1])/(w(e)*w(t))},T=function(e,t){return(e[0]*t[1]<e[1]*t[0]?-1:1)*Math.acos(_(e,t))},A=T([1,0],[(g.x-b.x)/d,(g.y-b.y)/h]),C=[(g.x-b.x)/d,(g.y-b.y)/h],E=[(-g.x-b.x)/d,(-g.y-b.y)/h],S=T(C,E);_(C,E)<=-1&&(S=Math.PI),_(C,E)>=1&&(S=0);var k=1-m?1:-1,P=A+k*(S/2),R=new e.Point(x.x+d*Math.cos(P),x.y+h*Math.sin(P));if(n.addMarkerAngle(R,P-k*Math.PI/2),n.addMarkerAngle(c,P-k*Math.PI),r.addPoint(c.x,c.y),null!=t){var _=d>h?d:h,O=d>h?1:d/h,M=d>h?h/d:1;t.translate(x.x,x.y),t.rotate(p),t.scale(O,M),t.arc(0,0,_,A,A+S,1-m),t.scale(1/O,1/M),t.rotate(-p),t.translate(-x.x,-x.y)}}break;case"Z":case"z":null!=t&&t.closePath(),n.current=n.start}return r},this.getMarkers=function(){for(var e=this.PathParser.getMarkerPoints(),t=this.PathParser.getMarkerAngles(),n=[],r=0;r<e.length;r++)n.push([e[r],t[r]]);return n}},e.Element.path.prototype=new e.Element.PathElementBase,e.Element.pattern=function(t){this.base=e.Element.ElementBase,this.base(t),this.createPattern=function(t){var n=this.attribute("width").toPixels("x",!0),r=this.attribute("height").toPixels("y",!0),i=new e.Element.svg;i.attributes.viewBox=new e.Property("viewBox",this.attribute("viewBox").value),i.attributes.width=new e.Property("width",n+"px"),i.attributes.height=new e.Property("height",r+"px"),i.attributes.transform=new e.Property("transform",this.attribute("patternTransform").value),i.children=this.children;var o=document.createElement("canvas");o.width=n,o.height=r;var a=o.getContext("2d");this.attribute("x").hasValue()&&this.attribute("y").hasValue()&&a.translate(this.attribute("x").toPixels("x",!0),this.attribute("y").toPixels("y",!0));for(var s=-1;1>=s;s++)for(var l=-1;1>=l;l++)a.save(),a.translate(s*o.width,l*o.height),i.render(a),a.restore();var u=t.createPattern(o,"repeat");return u}},e.Element.pattern.prototype=new e.Element.ElementBase,e.Element.marker=function(t){this.base=e.Element.ElementBase,this.base(t),this.baseRender=this.render,this.render=function(t,n,r){t.translate(n.x,n.y),"auto"==this.attribute("orient").valueOrDefault("auto")&&t.rotate(r),"strokeWidth"==this.attribute("markerUnits").valueOrDefault("strokeWidth")&&t.scale(t.lineWidth,t.lineWidth),t.save();var i=new e.Element.svg;i.attributes.viewBox=new e.Property("viewBox",this.attribute("viewBox").value),i.attributes.refX=new e.Property("refX",this.attribute("refX").value),i.attributes.refY=new e.Property("refY",this.attribute("refY").value),i.attributes.width=new e.Property("width",this.attribute("markerWidth").value),i.attributes.height=new e.Property("height",this.attribute("markerHeight").value),i.attributes.fill=new e.Property("fill",this.attribute("fill").valueOrDefault("black")),i.attributes.stroke=new e.Property("stroke",this.attribute("stroke").valueOrDefault("none")),i.children=this.children,i.render(t),t.restore(),"strokeWidth"==this.attribute("markerUnits").valueOrDefault("strokeWidth")&&t.scale(1/t.lineWidth,1/t.lineWidth),"auto"==this.attribute("orient").valueOrDefault("auto")&&t.rotate(-r),t.translate(-n.x,-n.y)}},e.Element.marker.prototype=new e.Element.ElementBase,e.Element.defs=function(t){this.base=e.Element.ElementBase,this.base(t),this.render=function(){}},e.Element.defs.prototype=new e.Element.ElementBase,e.Element.GradientBase=function(t){this.base=e.Element.ElementBase,this.base(t),this.gradientUnits=this.attribute("gradientUnits").valueOrDefault("objectBoundingBox"),this.stops=[];for(var n=0;n<this.children.length;n++){var r=this.children[n];"stop"==r.type&&this.stops.push(r)}this.getGradient=function(){},this.createGradient=function(t,n,r){var i=this;this.getHrefAttribute().hasValue()&&(i=this.getHrefAttribute().getDefinition());var o=function(t){if(r.hasValue()){var n=new e.Property("color",t);return n.addOpacity(r.value).value}return t},a=this.getGradient(t,n);if(null==a)return o(i.stops[i.stops.length-1].color);for(var s=0;s<i.stops.length;s++)a.addColorStop(i.stops[s].offset,o(i.stops[s].color));if(this.attribute("gradientTransform").hasValue()){var l=e.ViewPort.viewPorts[0],u=new e.Element.rect;u.attributes.x=new e.Property("x",-e.MAX_VIRTUAL_PIXELS/3),u.attributes.y=new e.Property("y",-e.MAX_VIRTUAL_PIXELS/3),u.attributes.width=new e.Property("width",e.MAX_VIRTUAL_PIXELS),u.attributes.height=new e.Property("height",e.MAX_VIRTUAL_PIXELS);var c=new e.Element.g;c.attributes.transform=new e.Property("transform",this.attribute("gradientTransform").value),c.children=[u];var d=new e.Element.svg;d.attributes.x=new e.Property("x",0),d.attributes.y=new e.Property("y",0),d.attributes.width=new e.Property("width",l.width),d.attributes.height=new e.Property("height",l.height),d.children=[c];var h=document.createElement("canvas");h.width=l.width,h.height=l.height;var p=h.getContext("2d");return p.fillStyle=a,d.render(p),p.createPattern(h,"no-repeat")}return a}},e.Element.GradientBase.prototype=new e.Element.ElementBase,e.Element.linearGradient=function(t){this.base=e.Element.GradientBase,this.base(t),this.getGradient=function(e,t){var n=t.getBoundingBox();this.attribute("x1").hasValue()||this.attribute("y1").hasValue()||this.attribute("x2").hasValue()||this.attribute("y2").hasValue()||(this.attribute("x1",!0).value=0,this.attribute("y1",!0).value=0,this.attribute("x2",!0).value=1,this.attribute("y2",!0).value=0);var r="objectBoundingBox"==this.gradientUnits?n.x()+n.width()*this.attribute("x1").numValue():this.attribute("x1").toPixels("x"),i="objectBoundingBox"==this.gradientUnits?n.y()+n.height()*this.attribute("y1").numValue():this.attribute("y1").toPixels("y"),o="objectBoundingBox"==this.gradientUnits?n.x()+n.width()*this.attribute("x2").numValue():this.attribute("x2").toPixels("x"),a="objectBoundingBox"==this.gradientUnits?n.y()+n.height()*this.attribute("y2").numValue():this.attribute("y2").toPixels("y");return r==o&&i==a?null:e.createLinearGradient(r,i,o,a)}},e.Element.linearGradient.prototype=new e.Element.GradientBase,e.Element.radialGradient=function(t){this.base=e.Element.GradientBase,this.base(t),this.getGradient=function(e,t){var n=t.getBoundingBox();this.attribute("cx").hasValue()||(this.attribute("cx",!0).value="50%"),this.attribute("cy").hasValue()||(this.attribute("cy",!0).value="50%"),this.attribute("r").hasValue()||(this.attribute("r",!0).value="50%");var r="objectBoundingBox"==this.gradientUnits?n.x()+n.width()*this.attribute("cx").numValue():this.attribute("cx").toPixels("x"),i="objectBoundingBox"==this.gradientUnits?n.y()+n.height()*this.attribute("cy").numValue():this.attribute("cy").toPixels("y"),o=r,a=i;this.attribute("fx").hasValue()&&(o="objectBoundingBox"==this.gradientUnits?n.x()+n.width()*this.attribute("fx").numValue():this.attribute("fx").toPixels("x")),this.attribute("fy").hasValue()&&(a="objectBoundingBox"==this.gradientUnits?n.y()+n.height()*this.attribute("fy").numValue():this.attribute("fy").toPixels("y"));var s="objectBoundingBox"==this.gradientUnits?(n.width()+n.height())/2*this.attribute("r").numValue():this.attribute("r").toPixels();return e.createRadialGradient(o,a,0,r,i,s)}},e.Element.radialGradient.prototype=new e.Element.GradientBase,e.Element.stop=function(t){this.base=e.Element.ElementBase,this.base(t),this.offset=this.attribute("offset").numValue(),this.offset<0&&(this.offset=0),this.offset>1&&(this.offset=1);
var n=this.style("stop-color");this.style("stop-opacity").hasValue()&&(n=n.addOpacity(this.style("stop-opacity").value)),this.color=n.value},e.Element.stop.prototype=new e.Element.ElementBase,e.Element.AnimateBase=function(t){this.base=e.Element.ElementBase,this.base(t),e.Animations.push(this),this.duration=0,this.begin=this.attribute("begin").toMilliseconds(),this.maxDuration=this.begin+this.attribute("dur").toMilliseconds(),this.getProperty=function(){var e=this.attribute("attributeType").value,t=this.attribute("attributeName").value;return"CSS"==e?this.parent.style(t,!0):this.parent.attribute(t,!0)},this.initialValue=null,this.initialUnits="",this.removed=!1,this.calcValue=function(){return""},this.update=function(e){if(null==this.initialValue&&(this.initialValue=this.getProperty().value,this.initialUnits=this.getProperty().getUnits()),this.duration>this.maxDuration){if("indefinite"!=this.attribute("repeatCount").value&&"indefinite"!=this.attribute("repeatDur").value)return"remove"!=this.attribute("fill").valueOrDefault("remove")||this.removed?!1:(this.removed=!0,this.getProperty().value=this.initialValue,!0);this.duration=0}this.duration=this.duration+e;var t=!1;if(this.begin<this.duration){var n=this.calcValue();if(this.attribute("type").hasValue()){var r=this.attribute("type").value;n=r+"("+n+")"}this.getProperty().value=n,t=!0}return t},this.from=this.attribute("from"),this.to=this.attribute("to"),this.values=this.attribute("values"),this.values.hasValue()&&(this.values.value=this.values.value.split(";")),this.progress=function(){var t={progress:(this.duration-this.begin)/(this.maxDuration-this.begin)};if(this.values.hasValue()){var n=t.progress*(this.values.value.length-1),r=Math.floor(n),i=Math.ceil(n);t.from=new e.Property("from",parseFloat(this.values.value[r])),t.to=new e.Property("to",parseFloat(this.values.value[i])),t.progress=(n-r)/(i-r)}else t.from=this.from,t.to=this.to;return t}},e.Element.AnimateBase.prototype=new e.Element.ElementBase,e.Element.animate=function(t){this.base=e.Element.AnimateBase,this.base(t),this.calcValue=function(){var e=this.progress(),t=e.from.numValue()+(e.to.numValue()-e.from.numValue())*e.progress;return t+this.initialUnits}},e.Element.animate.prototype=new e.Element.AnimateBase,e.Element.animateColor=function(t){this.base=e.Element.AnimateBase,this.base(t),this.calcValue=function(){var e=this.progress(),t=new RGBColor(e.from.value),n=new RGBColor(e.to.value);if(t.ok&&n.ok){var r=t.r+(n.r-t.r)*e.progress,i=t.g+(n.g-t.g)*e.progress,o=t.b+(n.b-t.b)*e.progress;return"rgb("+parseInt(r,10)+","+parseInt(i,10)+","+parseInt(o,10)+")"}return this.attribute("from").value}},e.Element.animateColor.prototype=new e.Element.AnimateBase,e.Element.animateTransform=function(t){this.base=e.Element.AnimateBase,this.base(t),this.calcValue=function(){for(var t=this.progress(),n=e.ToNumberArray(t.from.value),r=e.ToNumberArray(t.to.value),i="",o=0;o<n.length;o++)i+=n[o]+(r[o]-n[o])*t.progress+" ";return i}},e.Element.animateTransform.prototype=new e.Element.animate,e.Element.font=function(t){this.base=e.Element.ElementBase,this.base(t),this.horizAdvX=this.attribute("horiz-adv-x").numValue(),this.isRTL=!1,this.isArabic=!1,this.fontFace=null,this.missingGlyph=null,this.glyphs=[];for(var n=0;n<this.children.length;n++){var r=this.children[n];"font-face"==r.type?(this.fontFace=r,r.style("font-family").hasValue()&&(e.Definitions[r.style("font-family").value]=this)):"missing-glyph"==r.type?this.missingGlyph=r:"glyph"==r.type&&(""!=r.arabicForm?(this.isRTL=!0,this.isArabic=!0,"undefined"==typeof this.glyphs[r.unicode]&&(this.glyphs[r.unicode]=[]),this.glyphs[r.unicode][r.arabicForm]=r):this.glyphs[r.unicode]=r)}},e.Element.font.prototype=new e.Element.ElementBase,e.Element.fontface=function(t){this.base=e.Element.ElementBase,this.base(t),this.ascent=this.attribute("ascent").value,this.descent=this.attribute("descent").value,this.unitsPerEm=this.attribute("units-per-em").numValue()},e.Element.fontface.prototype=new e.Element.ElementBase,e.Element.missingglyph=function(t){this.base=e.Element.path,this.base(t),this.horizAdvX=0},e.Element.missingglyph.prototype=new e.Element.path,e.Element.glyph=function(t){this.base=e.Element.path,this.base(t),this.horizAdvX=this.attribute("horiz-adv-x").numValue(),this.unicode=this.attribute("unicode").value,this.arabicForm=this.attribute("arabic-form").value},e.Element.glyph.prototype=new e.Element.path,e.Element.text=function(t){this.captureTextNodes=!0,this.base=e.Element.RenderedElementBase,this.base(t),this.baseSetContext=this.setContext,this.setContext=function(e){this.baseSetContext(e),this.style("dominant-baseline").hasValue()&&(e.textBaseline=this.style("dominant-baseline").value),this.style("alignment-baseline").hasValue()&&(e.textBaseline=this.style("alignment-baseline").value)},this.getBoundingBox=function(){return new e.BoundingBox(this.attribute("x").toPixels("x"),this.attribute("y").toPixels("y"),0,0)},this.renderChildren=function(e){this.x=this.attribute("x").toPixels("x"),this.y=this.attribute("y").toPixels("y"),this.x+=this.getAnchorDelta(e,this,0);for(var t=0;t<this.children.length;t++)this.renderChild(e,this,t)},this.getAnchorDelta=function(e,t,n){var r=this.style("text-anchor").valueOrDefault("start");if("start"!=r){for(var i=0,o=n;o<t.children.length;o++){var a=t.children[o];if(o>n&&a.attribute("x").hasValue())break;i+=a.measureTextRecursive(e)}return-1*("end"==r?i:i/2)}return 0},this.renderChild=function(e,t,n){var r=t.children[n];r.attribute("x").hasValue()?r.x=r.attribute("x").toPixels("x")+this.getAnchorDelta(e,t,n):(this.attribute("dx").hasValue()&&(this.x+=this.attribute("dx").toPixels("x")),r.attribute("dx").hasValue()&&(this.x+=r.attribute("dx").toPixels("x")),r.x=this.x),this.x=r.x+r.measureText(e),r.attribute("y").hasValue()?r.y=r.attribute("y").toPixels("y"):(this.attribute("dy").hasValue()&&(this.y+=this.attribute("dy").toPixels("y")),r.attribute("dy").hasValue()&&(this.y+=r.attribute("dy").toPixels("y")),r.y=this.y),this.y=r.y,r.render(e);for(var n=0;n<r.children.length;n++)this.renderChild(e,r,n)}},e.Element.text.prototype=new e.Element.RenderedElementBase,e.Element.TextElementBase=function(t){this.base=e.Element.RenderedElementBase,this.base(t),this.getGlyph=function(e,t,n){var r=t[n],i=null;if(e.isArabic){var o="isolated";(0==n||" "==t[n-1])&&n<t.length-2&&" "!=t[n+1]&&(o="terminal"),n>0&&" "!=t[n-1]&&n<t.length-2&&" "!=t[n+1]&&(o="medial"),n>0&&" "!=t[n-1]&&(n==t.length-1||" "==t[n+1])&&(o="initial"),"undefined"!=typeof e.glyphs[r]&&(i=e.glyphs[r][o],null==i&&"glyph"==e.glyphs[r].type&&(i=e.glyphs[r]))}else i=e.glyphs[r];return null==i&&(i=e.missingGlyph),i},this.renderChildren=function(t){var n=this.parent.style("font-family").getDefinition();if(null==n)""!=t.fillStyle&&t.fillText(e.compressSpaces(this.getText()),this.x,this.y),""!=t.strokeStyle&&t.strokeText(e.compressSpaces(this.getText()),this.x,this.y);else{var r=this.parent.style("font-size").numValueOrDefault(e.Font.Parse(e.ctx.font).fontSize),i=this.parent.style("font-style").valueOrDefault(e.Font.Parse(e.ctx.font).fontStyle),o=this.getText();n.isRTL&&(o=o.split("").reverse().join(""));for(var a=e.ToNumberArray(this.parent.attribute("dx").value),s=0;s<o.length;s++){var l=this.getGlyph(n,o,s),u=r/n.fontFace.unitsPerEm;t.translate(this.x,this.y),t.scale(u,-u);var c=t.lineWidth;t.lineWidth=t.lineWidth*n.fontFace.unitsPerEm/r,"italic"==i&&t.transform(1,0,.4,1,0,0),l.render(t),"italic"==i&&t.transform(1,0,-.4,1,0,0),t.lineWidth=c,t.scale(1/u,-1/u),t.translate(-this.x,-this.y),this.x+=r*(l.horizAdvX||n.horizAdvX)/n.fontFace.unitsPerEm,"undefined"==typeof a[s]||isNaN(a[s])||(this.x+=a[s])}}},this.getText=function(){},this.measureTextRecursive=function(e){for(var t=this.measureText(e),n=0;n<this.children.length;n++)t+=this.children[n].measureTextRecursive(e);return t},this.measureText=function(t){var n=this.parent.style("font-family").getDefinition();if(null!=n){var r=this.parent.style("font-size").numValueOrDefault(e.Font.Parse(e.ctx.font).fontSize),i=0,o=this.getText();n.isRTL&&(o=o.split("").reverse().join(""));for(var a=e.ToNumberArray(this.parent.attribute("dx").value),s=0;s<o.length;s++){var l=this.getGlyph(n,o,s);i+=(l.horizAdvX||n.horizAdvX)*r/n.fontFace.unitsPerEm,"undefined"==typeof a[s]||isNaN(a[s])||(i+=a[s])}return i}var u=e.compressSpaces(this.getText());if(!t.measureText)return 10*u.length;t.save(),this.setContext(t);var c=t.measureText(u).width;return t.restore(),c}},e.Element.TextElementBase.prototype=new e.Element.RenderedElementBase,e.Element.tspan=function(t){this.captureTextNodes=!0,this.base=e.Element.TextElementBase,this.base(t),this.text=t.nodeValue||t.text||"",this.getText=function(){return this.text}},e.Element.tspan.prototype=new e.Element.TextElementBase,e.Element.tref=function(t){this.base=e.Element.TextElementBase,this.base(t),this.getText=function(){var e=this.getHrefAttribute().getDefinition();return null!=e?e.children[0].getText():void 0}},e.Element.tref.prototype=new e.Element.TextElementBase,e.Element.a=function(t){this.base=e.Element.TextElementBase,this.base(t),this.hasText=!0;for(var n=0;n<t.childNodes.length;n++)3!=t.childNodes[n].nodeType&&(this.hasText=!1);this.text=this.hasText?t.childNodes[0].nodeValue:"",this.getText=function(){return this.text},this.baseRenderChildren=this.renderChildren,this.renderChildren=function(t){if(this.hasText){this.baseRenderChildren(t);var n=new e.Property("fontSize",e.Font.Parse(e.ctx.font).fontSize);e.Mouse.checkBoundingBox(this,new e.BoundingBox(this.x,this.y-n.toPixels("y"),this.x+this.measureText(t),this.y))}else{var r=new e.Element.g;r.children=this.children,r.parent=this,r.render(t)}},this.onclick=function(){window.open(this.getHrefAttribute().value)},this.onmousemove=function(){e.ctx.canvas.style.cursor="pointer"}},e.Element.a.prototype=new e.Element.TextElementBase,e.Element.image=function(t){this.base=e.Element.RenderedElementBase,this.base(t);var n=this.getHrefAttribute().value,r=n.match(/\.svg$/);if(e.Images.push(this),this.loaded=!1,r)this.img=e.ajax(n),this.loaded=!0;else{this.img=document.createElement("img");var i=this;this.img.onload=function(){i.loaded=!0},this.img.onerror=function(){"undefined"!=typeof console&&(console.log('ERROR: image "'+n+'" not found'),i.loaded=!0)},this.img.src=n}this.renderChildren=function(t){var n=this.attribute("x").toPixels("x"),i=this.attribute("y").toPixels("y"),o=this.attribute("width").toPixels("x"),a=this.attribute("height").toPixels("y");0!=o&&0!=a&&(t.save(),r?t.drawSvg(this.img,n,i,o,a):(t.translate(n,i),e.AspectRatio(t,this.attribute("preserveAspectRatio").value,o,this.img.width,a,this.img.height,0,0),t.drawImage(this.img,0,0)),t.restore())},this.getBoundingBox=function(){var t=this.attribute("x").toPixels("x"),n=this.attribute("y").toPixels("y"),r=this.attribute("width").toPixels("x"),i=this.attribute("height").toPixels("y");return new e.BoundingBox(t,n,t+r,n+i)}},e.Element.image.prototype=new e.Element.RenderedElementBase,e.Element.g=function(t){this.base=e.Element.RenderedElementBase,this.base(t),this.getBoundingBox=function(){for(var t=new e.BoundingBox,n=0;n<this.children.length;n++)t.addBoundingBox(this.children[n].getBoundingBox());return t}},e.Element.g.prototype=new e.Element.RenderedElementBase,e.Element.symbol=function(t){this.base=e.Element.RenderedElementBase,this.base(t),this.baseSetContext=this.setContext,this.setContext=function(t){if(this.baseSetContext(t),this.attribute("viewBox").hasValue()){var n=e.ToNumberArray(this.attribute("viewBox").value),r=n[0],i=n[1];width=n[2],height=n[3],e.AspectRatio(t,this.attribute("preserveAspectRatio").value,this.attribute("width").toPixels("x"),width,this.attribute("height").toPixels("y"),height,r,i),e.ViewPort.SetCurrent(n[2],n[3])}}},e.Element.symbol.prototype=new e.Element.RenderedElementBase,e.Element.style=function(t){this.base=e.Element.ElementBase,this.base(t);for(var n="",r=0;r<t.childNodes.length;r++)n+=t.childNodes[r].nodeValue;n=n.replace(/(\/\*([^*]|[\r\n]|(\*+([^*\/]|[\r\n])))*\*+\/)|(^[\s]*\/\/.*)/gm,""),n=e.compressSpaces(n);for(var i=n.split("}"),r=0;r<i.length;r++)if(""!=e.trim(i[r]))for(var o=i[r].split("{"),a=o[0].split(","),s=o[1].split(";"),l=0;l<a.length;l++){var u=e.trim(a[l]);if(""!=u){for(var c={},d=0;d<s.length;d++){var h=s[d].indexOf(":"),p=s[d].substr(0,h),f=s[d].substr(h+1,s[d].length-h);null!=p&&null!=f&&(c[e.trim(p)]=new e.Property(e.trim(p),e.trim(f)))}if(e.Styles[u]=c,"@font-face"==u)for(var m=c["font-family"].value.replace(/"/g,""),g=c.src.value.split(","),v=0;v<g.length;v++)if(g[v].indexOf('format("svg")')>0)for(var y=g[v].indexOf("url"),b=g[v].indexOf(")",y),x=g[v].substr(y+5,b-y-6),w=e.parseXml(e.ajax(x)),_=w.getElementsByTagName("font"),T=0;T<_.length;T++){var A=e.CreateElement(_[T]);e.Definitions[m]=A}}}},e.Element.style.prototype=new e.Element.ElementBase,e.Element.use=function(t){this.base=e.Element.RenderedElementBase,this.base(t),this.baseSetContext=this.setContext,this.setContext=function(e){this.baseSetContext(e),this.attribute("x").hasValue()&&e.translate(this.attribute("x").toPixels("x"),0),this.attribute("y").hasValue()&&e.translate(0,this.attribute("y").toPixels("y"))},this.getDefinition=function(){var e=this.getHrefAttribute().getDefinition();return this.attribute("width").hasValue()&&(e.attribute("width",!0).value=this.attribute("width").value),this.attribute("height").hasValue()&&(e.attribute("height",!0).value=this.attribute("height").value),e},this.path=function(e){var t=this.getDefinition();null!=t&&t.path(e)},this.getBoundingBox=function(){var e=this.getDefinition();return null!=e?e.getBoundingBox():void 0},this.renderChildren=function(e){var t=this.getDefinition();if(null!=t){var n=t.parent;t.parent=null,t.render(e),t.parent=n}}},e.Element.use.prototype=new e.Element.RenderedElementBase,e.Element.mask=function(t){this.base=e.Element.ElementBase,this.base(t),this.apply=function(t,n){var r=this.attribute("x").toPixels("x"),i=this.attribute("y").toPixels("y"),o=this.attribute("width").toPixels("x"),a=this.attribute("height").toPixels("y");if(0==o&&0==a){for(var s=new e.BoundingBox,l=0;l<this.children.length;l++)s.addBoundingBox(this.children[l].getBoundingBox());var r=Math.floor(s.x1),i=Math.floor(s.y1),o=Math.floor(s.width()),a=Math.floor(s.height())}var u=n.attribute("mask").value;n.attribute("mask").value="";var c=document.createElement("canvas");c.width=r+o,c.height=i+a;var d=c.getContext("2d");this.renderChildren(d);var h=document.createElement("canvas");h.width=r+o,h.height=i+a;var p=h.getContext("2d");n.render(p),p.globalCompositeOperation="destination-in",p.fillStyle=d.createPattern(c,"no-repeat"),p.fillRect(0,0,r+o,i+a),t.fillStyle=p.createPattern(h,"no-repeat"),t.fillRect(0,0,r+o,i+a),n.attribute("mask").value=u},this.render=function(){}},e.Element.mask.prototype=new e.Element.ElementBase,e.Element.clipPath=function(t){this.base=e.Element.ElementBase,this.base(t),this.apply=function(t){for(var n=0;n<this.children.length;n++){var r=this.children[n];if("undefined"!=typeof r.path){var i=null;r.attribute("transform").hasValue()&&(i=new e.Transform(r.attribute("transform").value),i.apply(t)),r.path(t),t.clip(),i&&i.unapply(t)}}},this.render=function(){}},e.Element.clipPath.prototype=new e.Element.ElementBase,e.Element.filter=function(t){this.base=e.Element.ElementBase,this.base(t),this.apply=function(e,t){var n=t.getBoundingBox(),r=Math.floor(n.x1),i=Math.floor(n.y1),o=Math.floor(n.width()),a=Math.floor(n.height()),s=t.style("filter").value;t.style("filter").value="";for(var l=0,u=0,c=0;c<this.children.length;c++){var d=this.children[c].extraFilterDistance||0;l=Math.max(l,d),u=Math.max(u,d)}var h=document.createElement("canvas");h.width=o+2*l,h.height=a+2*u;var p=h.getContext("2d");p.translate(-r+l,-i+u),t.render(p);for(var c=0;c<this.children.length;c++)this.children[c].apply(p,0,0,o+2*l,a+2*u);e.drawImage(h,0,0,o+2*l,a+2*u,r-l,i-u,o+2*l,a+2*u),t.style("filter",!0).value=s},this.render=function(){}},e.Element.filter.prototype=new e.Element.ElementBase,e.Element.feMorphology=function(t){this.base=e.Element.ElementBase,this.base(t),this.apply=function(){}},e.Element.feMorphology.prototype=new e.Element.ElementBase,e.Element.feColorMatrix=function(t){function n(e,t,n,r,i,o){return e[n*r*4+4*t+o]}function r(e,t,n,r,i,o,a){e[n*r*4+4*t+o]=a}this.base=e.Element.ElementBase,this.base(t),this.apply=function(e,t,i,o,a){for(var s=e.getImageData(0,0,o,a),i=0;a>i;i++)for(var t=0;o>t;t++){var l=n(s.data,t,i,o,a,0),u=n(s.data,t,i,o,a,1),c=n(s.data,t,i,o,a,2),d=(l+u+c)/3;r(s.data,t,i,o,a,0,d),r(s.data,t,i,o,a,1,d),r(s.data,t,i,o,a,2,d)}e.clearRect(0,0,o,a),e.putImageData(s,0,0)}},e.Element.feColorMatrix.prototype=new e.Element.ElementBase,e.Element.feGaussianBlur=function(t){this.base=e.Element.ElementBase,this.base(t),this.blurRadius=Math.floor(this.attribute("stdDeviation").numValue()),this.extraFilterDistance=this.blurRadius,this.apply=function(t,n,r,i,o){return"undefined"==typeof stackBlurCanvasRGBA?("undefined"!=typeof console&&console.log("ERROR: StackBlur.js must be included for blur to work"),void 0):(t.canvas.id=e.UniqueId(),t.canvas.style.display="none",document.body.appendChild(t.canvas),stackBlurCanvasRGBA(t.canvas.id,n,r,i,o,this.blurRadius),document.body.removeChild(t.canvas),void 0)}},e.Element.feGaussianBlur.prototype=new e.Element.ElementBase,e.Element.title=function(){},e.Element.title.prototype=new e.Element.ElementBase,e.Element.desc=function(){},e.Element.desc.prototype=new e.Element.ElementBase,e.Element.MISSING=function(e){"undefined"!=typeof console&&console.log("ERROR: Element '"+e.nodeName+"' not yet implemented.")},e.Element.MISSING.prototype=new e.Element.ElementBase,e.CreateElement=function(t){var n=t.nodeName.replace(/^[^:]+:/,"");n=n.replace(/\-/g,"");var r=null;return r="undefined"!=typeof e.Element[n]?new e.Element[n](t):new e.Element.MISSING(t),r.type=t.nodeName,r},e.load=function(t,n){e.loadXml(t,e.ajax(n))},e.loadXml=function(t,n){e.loadXmlDoc(t,e.parseXml(n))},e.loadXmlDoc=function(t,n){e.init(t);var r=function(e){for(var n=t.canvas;n;)e.x-=n.offsetLeft,e.y-=n.offsetTop,n=n.offsetParent;return window.scrollX&&(e.x+=window.scrollX),window.scrollY&&(e.y+=window.scrollY),e};1!=e.opts.ignoreMouse&&(t.canvas.onclick=function(t){var n=r(new e.Point(null!=t?t.clientX:event.clientX,null!=t?t.clientY:event.clientY));e.Mouse.onclick(n.x,n.y)},t.canvas.onmousemove=function(t){var n=r(new e.Point(null!=t?t.clientX:event.clientX,null!=t?t.clientY:event.clientY));e.Mouse.onmousemove(n.x,n.y)});var i=e.CreateElement(n.documentElement);i.root=!0;var o=!0,a=function(){e.ViewPort.Clear(),t.canvas.parentNode&&e.ViewPort.SetCurrent(t.canvas.parentNode.clientWidth,t.canvas.parentNode.clientHeight),1!=e.opts.ignoreDimensions&&(i.style("width").hasValue()&&(t.canvas.width=i.style("width").toPixels("x"),t.canvas.style.width=t.canvas.width+"px"),i.style("height").hasValue()&&(t.canvas.height=i.style("height").toPixels("y"),t.canvas.style.height=t.canvas.height+"px"));var r=t.canvas.clientWidth||t.canvas.width,a=t.canvas.clientHeight||t.canvas.height;if(1==e.opts.ignoreDimensions&&i.style("width").hasValue()&&i.style("height").hasValue()&&(r=i.style("width").toPixels("x"),a=i.style("height").toPixels("y")),e.ViewPort.SetCurrent(r,a),null!=e.opts.offsetX&&(i.attribute("x",!0).value=e.opts.offsetX),null!=e.opts.offsetY&&(i.attribute("y",!0).value=e.opts.offsetY),null!=e.opts.scaleWidth&&null!=e.opts.scaleHeight){var s=1,l=1,u=e.ToNumberArray(i.attribute("viewBox").value);i.attribute("width").hasValue()?s=i.attribute("width").toPixels("x")/e.opts.scaleWidth:isNaN(u[2])||(s=u[2]/e.opts.scaleWidth),i.attribute("height").hasValue()?l=i.attribute("height").toPixels("y")/e.opts.scaleHeight:isNaN(u[3])||(l=u[3]/e.opts.scaleHeight),i.attribute("width",!0).value=e.opts.scaleWidth,i.attribute("height",!0).value=e.opts.scaleHeight,i.attribute("viewBox",!0).value="0 0 "+r*s+" "+a*l,i.attribute("preserveAspectRatio",!0).value="none"}1!=e.opts.ignoreClear&&t.clearRect(0,0,r,a),i.render(t),o&&(o=!1,"function"==typeof e.opts.renderCallback&&e.opts.renderCallback(n))},s=!0;e.ImagesLoaded()&&(s=!1,a()),e.intervalID=setInterval(function(){var t=!1;if(s&&e.ImagesLoaded()&&(s=!1,t=!0),1!=e.opts.ignoreMouse&&(t|=e.Mouse.hasEvents()),1!=e.opts.ignoreAnimation)for(var n=0;n<e.Animations.length;n++)t|=e.Animations[n].update(1e3/e.FRAMERATE);"function"==typeof e.opts.forceRedraw&&1==e.opts.forceRedraw()&&(t=!0),t&&(a(),e.Mouse.runEvents())},1e3/e.FRAMERATE)},e.stop=function(){e.intervalID&&clearInterval(e.intervalID)},e.Mouse=new function(){this.events=[],this.hasEvents=function(){return 0!=this.events.length},this.onclick=function(e,t){this.events.push({type:"onclick",x:e,y:t,run:function(e){e.onclick&&e.onclick()}})},this.onmousemove=function(e,t){this.events.push({type:"onmousemove",x:e,y:t,run:function(e){e.onmousemove&&e.onmousemove()}})},this.eventElements=[],this.checkPath=function(e,t){for(var n=0;n<this.events.length;n++){var r=this.events[n];t.isPointInPath&&t.isPointInPath(r.x,r.y)&&(this.eventElements[n]=e)}},this.checkBoundingBox=function(e,t){for(var n=0;n<this.events.length;n++){var r=this.events[n];t.isPointInBox(r.x,r.y)&&(this.eventElements[n]=e)}},this.runEvents=function(){e.ctx.canvas.style.cursor="";for(var t=0;t<this.events.length;t++)for(var n=this.events[t],r=this.eventElements[t];r;)n.run(r),r=r.parent;this.events=[],this.eventElements=[]}},e}this.canvg=function(t,n,r){if(null!=t||null!=n||null!=r){r=r||{},"string"==typeof t&&(t=document.getElementById(t)),null!=t.svg&&t.svg.stop();var i=e();(1!=t.childNodes.length||"OBJECT"!=t.childNodes[0].nodeName)&&(t.svg=i),i.opts=r;var o=t.getContext("2d");"undefined"!=typeof n.documentElement?i.loadXmlDoc(o,n):"<"==n.substr(0,1)?i.loadXml(o,n):i.load(o,n)}else for(var a=document.getElementsByTagName("svg"),s=0;s<a.length;s++){var l=a[s],u=document.createElement("canvas");u.width=l.clientWidth,u.height=l.clientHeight,l.parentNode.insertBefore(u,l),l.parentNode.removeChild(l);var c=document.createElement("div");c.appendChild(l),canvg(u,c.innerHTML)}}}(),"undefined"!=typeof CanvasRenderingContext2D&&(CanvasRenderingContext2D.prototype.drawSvg=function(e,t,n,r,i){canvg(this.canvas,e,{ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0,ignoreClear:!0,offsetX:t,offsetY:n,scaleWidth:r,scaleHeight:i})}),define("canvg",["rgbcolor"],function(e){return function(){var t;return t||e.canvg}}(this)),function(){define("cs!models/md2d/views/aminoacid-context-menu",["require","cs!models/md2d/models/aminoacids-helper"],function(e){var t,n,r,i,o,a,s,l,u,c;return u=e("cs!models/md2d/models/aminoacids-helper"),a="aminoacids-menu",i="hydrophobic",r="hydrophobic-category",n="hydrophilic",t="hydrophilic-category",l="pos-charge",s="neg-charge",o="marked",c=function(e,o){var a;return a={show:o?"slideDown":"show",hide:o?"slideUp":"hide"},"hydrophobic"===e?($("."+i)[a.show](),$("."+n)[a.hide](),$("."+r).addClass("expanded"),$("."+t).removeClass("expanded")):($("."+i)[a.hide](),$("."+n)[a.show](),$("."+r).removeClass("expanded"),$("."+t).addClass("expanded"))},{register:function(e,d,h,p){return $.contextMenu("destroy",h),$.contextMenu({selector:h,appendTo:"#responsive-content",className:a,animation:{show:"show",hide:"hide"},callback:function(t,n){var r,i,a;return a=p(),i=u.getAminoAcidByElement(a.element).abbreviation,n.items[i].$node.removeClass(o),r=u.abbrToElement(t),e.setAtomProperties(a.idx,{element:r}),d.repaint()},position:function(e,t,n){var r,i,o,a,s,l,u;return r=$(window),t||n?("maintain"===t&&"maintain"===n?a=e.$menu.position():(l=e.$trigger.parents().andSelf().filter(function(){return"fixed"===$(this).css("position")}).length,l&&(n-=r.scrollTop(),t-=r.scrollLeft()),a={top:n,left:t}),i=r.scrollTop()+r.height(),s=r.scrollLeft()+r.width(),o=e.$menu[0].scrollHeight,u=e.$menu[0].scrollWidth,a.top+o>i&&(a.top-=o),a.left+u>s&&(a.left-=u),a.left+=1,e.$menu.css(a)):(e.determinePosition.call(this,e.$menu),void 0)},events:{show:function(e){var t,n,r;return(r=p())?(n=u.getAminoAcidByElement(r.element).abbreviation,t=e.items[n].$node,t.addClass(o),t.hasClass(i)?c("hydrophobic"):c("hydrophilic"),!0):!1},hide:function(e){var t,n;return n=p(),t=u.getAminoAcidByElement(n.element).abbreviation,e.items[t].$node.removeClass(o),!0}},items:{Hydrophobic:{name:"Hydrophobic",className:""+r,callback:function(){return c("hydrophobic",!0),!1}},Gly:{name:"Glycine",className:""+i},Ala:{name:"Alanine",className:""+i},Val:{name:"Valine",className:""+i},Leu:{name:"Leucine",className:""+i},Ile:{name:"Isoleucine",className:""+i},Phe:{name:"Phenylalanine",className:""+i},Pro:{name:"Proline",className:""+i},Trp:{name:"Tryptophan",className:""+i},Met:{name:"Methionine",className:""+i},Cys:{name:"Cysteine",className:""+i},Tyr:{name:"Tyrosine",className:""+i},Hydrophilic:{name:"Hydrophilic",className:""+t,callback:function(){return c("hydrophilic",!0),!1}},Asn:{name:"Asparagine",className:""+n},Gln:{name:"Glutamine",className:""+n},Ser:{name:"Serine",className:""+n},Thr:{name:"Threonine",className:""+n},Asp:{name:"Asparticacid",className:""+n+" "+s},Glu:{name:"Glutamicacid",className:""+n+" "+s},Lys:{name:"Lysine",className:""+n+" "+l},Arg:{name:"Arginine",className:""+n+" "+l},His:{name:"Histidine",className:""+n+" "+l}}}),c("hydrophobic")}}})}.call(this),define("models/md2d/views/atoms-interactions",["require","common/alert","cs!models/md2d/views/aminoacid-context-menu"],function(e){var t=e("common/alert"),n=e("cs!models/md2d/views/aminoacid-context-menu"),r={};return function(e,i,o){function a(e,t,n,r){0===r.button&&A(D)}function s(){}function l(){}function u(){}function c(t,n,r){!V&&e.clickHandler[".atom"]&&e.clickHandler[".atom"](t,n,r,r.idx)}function d(){}function h(t){var n=T(t);D=_(n.x,n.y),F=null,V=!1,e.hitTestCallback(!!D),D&&a(n.x,n.y,D,t)}function p(t){var n=T(t),r=_(n.x,n.y);e.hitTestCallback(!!r),r?s(n.x,n.y,r,t):l(n.x,n.y,t),b(r)}function f(t){var n=T(t),r=_(n.x,n.y),i=!1;e.hitTestCallback(!!r),r&&(u(n.x,n.y,r,t),r===D&&(i=!0,c(n.x,n.y,D))),e.mouseupCallback(i),D=null}function m(){}function g(e){var t=T(e);l(t.x,t.y,e),x("auto")}function v(t){var n=T(t);F=_(n.x,n.y),e.hitTestCallback(!!F),F&&d(n.x,n.y,F)}function y(e){if(e.target!==o)return x("auto"),void 0;var t=T(e);b(_(t.x,t.y))}function b(e){e&&(i.isStopped()||e.draggable)?x("move"):x("auto")}function x(e){document.documentElement.style.cursor=e}function w(){S=e.model2canvas,k=e.model2canvasInv,M=$(o),M.addClass("atoms-interaction-layer"),o.addEventListener("mousedown",h),o.addEventListener("mouseup",f),o.addEventListener("mousemove",p),o.addEventListener("mouseover",m),o.addEventListener("mouseout",g),o.addEventListener("contextmenu",v),n.register(i,e,".atoms-interaction-layer",function(){return F}),E.bindModel(i)}function _(e,t){for(var n,r,i,o,a=0,s=P.length;s>a;a++)if(n=P[a],r=n.x,i=n.y,o=n.radius,e>r-o&&r+o>e&&t>i-o&&i+o>t)return n;return null}function T(e,t){t||(N=M.offset(),I=M.attr("width")/M.width(),L=i.get("viewPortX")||0,B=i.get("viewPortY")||0);var n=e.pageX,o=e.pageY;if(!n&&!o){var a=e.target.ownerDocument||document,s=a.documentElement,l=a.body;n=e.clientX+(s&&s.scrollLeft||l&&l.scrollLeft||0)-(s&&s.clientLeft||l&&l.clientLeft||0),o=e.clientY+(s&&s.scrollTop||l&&l.scrollTop||0)-(s&&s.clientTop||l&&l.clientTop||0)}return r.x=S.invert((n-N.left)*I)+L,r.y=k.invert((o-N.top)*I)+B,r}function A(n){if(i.isStopped()||n.draggable){var r,o,a,s,l,u=n.idx;$(window).on("mousemove.lab-drag",function(t){t.preventDefault(),V||(i.isStopped()?(s=n.x,l=n.y):n.draggable&&i.liveDragStart(u),V=!0),r=T(t,!0),o=r.x,a=r.y;var c=i.getMoleculeBoundingBox(u);c.left+o<0&&(o=0-c.left),c.right+o>R&&(o=R-c.right),c.bottom+a<0&&(a=0-c.bottom),c.top+a>O&&(a=O-c.top),i.isStopped()?(C(u,o,a,!1,!0),e.update()):i.liveDrag(o,a),x("move"),e.dragHandler.atom&&e.dragHandler.atom(o,a,n,u)}).on("selectstart.lab-drag",function(e){e.preventDefault()}).one("mouseup.lab-drag",function(r){$(window).off(".lab-drag"),V&&(r.preventDefault(),y(r),i.isStopped()?C(u,n.x,n.y,!0,!0)||(t("You can't drop the atom there"),C(u,s,l,!1,!0),e.update()):i.liveDragEnd())})}}function C(e,t,n,r,o){return i.setAtomProperties(e,{x:t,y:n},r,o)}var E,S,k,P,R,O,M,N,I,L,B,D,F,V;return E={bindModel:function(e){i=e,P=i.getAtoms(),R=i.get("width"),O=i.get("height")}},w(),E}}),define("models/md2d/views/atoms-renderer",["require","pixi","canvg","mustache","models/md2d/views/atoms-interactions","common/layout/detect-font-change"],function(e){var t=e("pixi"),n=e("canvg"),r=e("mustache"),i=e("models/md2d/views/atoms-interactions"),o=e("common/layout/detect-font-change"),a='<svg x="0px" y="0px" width="{{ width }}px" height="{{ height }}px"        viewBox="0 0 32 32" xml:space="preserve">         <style type="text/css">         <![CDATA[           text {             font-family: Lato, "Open Sans", helvetica, sans-serif;             font-size: {{ fontSize }}px;             font-weight: bold;             fill: #222;           }           .shadow {             stroke: rgba(255, 255, 255, 0.7);             stroke-width: 3px;           }         ]]>         </style>          <defs>             <radialGradient id="grad" cx="50%" cy="47%" r="53%" fx="35%" fy="30%">               <stop stop-color="{{ lightCol }}" offset="0%"></stop>               <stop stop-color="{{ medCol }}" offset="40%"></stop>               <stop stop-color="{{ darkCol }}" offset="80%"></stop>               <stop stop-color="{{ medCol }}" offset="100%"></stop>             </radialGradient>          </defs>          {{#excited}}           <circle fill="#ffe600" cx="16" cy="16" r="12" fill-opacity="{{ opacity }}"/>           <circle fill="url(#grad)" cx="16" cy="16" r="8" fill-opacity="{{ opacity }}"/>          {{/excited}}          {{^excited}}           <circle fill="url(#grad)" cx="16" cy="16" r="16" fill-opacity="{{ opacity }}"/>          {{/excited}}          <text class="shadow" text-anchor="middle" x="16" y="16" dy="0.31em">{{ label }}</text>          <text text-anchor="middle" x="16" y="16" dy="0.31em">{{ label }}</text>        </svg>',s=["#FFFFFF","#F2F2F2","#A4A4A4"],l=["#FFFFFF","#FF8080","#FF2020"],u=25,c=["#FFFFFF","#f2f2f2","#A4A4A4"],d=d3.scale.linear().interpolate(d3.interpolateRgb).range(["#FFFFFF","#ffefff"]),h=d3.scale.linear().interpolate(d3.interpolateRgb).range(["#f2f2f2","#9090FF"]),p=d3.scale.linear().interpolate(d3.interpolateRgb).range(["#A4A4A4","#3030FF"]),f=d3.scale.linear().interpolate(d3.interpolateRgb).range(["#FFFFFF","#dfffff"]),m=d3.scale.linear().interpolate(d3.interpolateRgb).range(["#f2f2f2","#FF8080"]),g=d3.scale.linear().interpolate(d3.interpolateRgb).range(["#A4A4A4","#FF2020"]),v=function(e){var t=Math.round(Math.min(Math.abs(e)/3,1)*u);return t/=u,e>0?[d(t),h(t),p(t)]:0>e?[f(t),m(t),g(t)]:c},y=function(e){return e>0?["#F0E6D1","#E0A21B","#AD7F1C"]:["#dfffef","#75a643","#2a7216"]},b=["keShading","chargeShading","atomNumbers","showChargeSymbols","aminoAcidColorScheme","useThreeLetterCode","viewPortZoom"];return function(e,u,c,d){function h(){k=u.get("width"),P=u.get("height"),p(),u.addPropertiesListener(b,function(){p(),_.setup(),e.renderCanvas()})}function p(){b.forEach(function(e){O[e]=u.get(e)})}function f(e){var t,n,r=E[e],i=r.element,o=u.getElementProperties(i);if(r.marked)return t=u.get("markColor"),n=d3.rgb(t),[n.brighter(1).toString(),n.toString(),n.darker(1).toString()];if(r.aminoAcid)switch(O.aminoAcidColorScheme){case"charge":return v(r.charge);case"hydrophobicity":return y(r.hydrophobicity);case"chargeAndHydro":return 0!==r.charge?v(r.charge):y(r.hydrophobicity)}return O.keShading?s:O.chargeShading?v(r.charge):(t=(o.color+Math.pow(2,24)).toString(16),t="000000".substr(0,6-t.length)+t,n=d3.rgb("#"+t),[n.brighter(1).toString(),n.toString(),n.darker(1).toString()])}function m(e,i){var o,s=E[e].element,l=A(u.getElementProperties(s).radius),c=E[e].visible,d=E[e].excitation,h=w(e);if(i=i||f(e),o=c?s+"-"+l+"-"+i.join("")+"-"+h.text+"-"+d+"-"+h.fontSize:l+"-invisible",void 0===R[o]){var p,m=document.createElement("canvas");x("bold "+h.fontSize+"px Lato"),x("bold "+h.fontSize+'px "Open Sans"'),p={width:d?4*l:2*l,height:d?4*l:2*l,lightCol:i[0],medCol:i[1],darkCol:i[2],opacity:Number(c),label:h.text,fontSize:h.fontSize,excited:d},n(m,r.render(a,p)),R[o]=new t.Texture.fromCanvas(m)
}return R[o]}function g(){R={},S.forEach(function(e,t){e.setTexture(m(t))}),e.renderCanvas()}function x(e){o({font:e,onchange:g})}function w(e){var t="",n=0;return O.atomNumbers?(t=e,n=1.2):O.useThreeLetterCode&&E[e].label?(t=E[e].label,n=1):!O.useThreeLetterCode&&E[e].symbol?(t=E[e].symbol,n=1.4):O.showChargeSymbols&&(E[e].charge>0?t="+":E[e].charge<0&&(t="-"),n=1.6),{text:t,fontSize:16*n}}var _,T,A,C,E,S,k,P,R={},O={},M=new i(e,u,d);return _={setup:function(){var n,r,i,o;for(T&&c.removeChild(T),T=new t.DisplayObjectContainer,c.addChild(T),A=e.model2canvas,C=e.model2canvasInv,S=[],E=u.getAtoms(),n=0,r=E.length;r>n;++n)i=new t.Sprite(m(n)),i.anchor.x=.5,i.anchor.y=.5,i.i=n,S.push(i),T.addChild(i);if(O.keShading)for(n=0,r=E.length;r>n;++n)o=new t.Sprite(m(n,l)),o.anchor.x=.5,o.anchor.y=.5,S[n].keSprite=o,T.addChild(o);_.update()},bindModel:function(e){u=e,h(),M.bindModel(e)},update:function(){var e,t,n,r,i;for(e=0,t=S.length;t>e;++e)n=S[e],r=A(E[e].x),i=C(E[e].y),n.position.x=r,n.position.y=i,O.keShading&&(n.keSprite.alpha=Math.min(5*u.getAtomKineticEnergy(e),1),n.keSprite.position.x=r,n.keSprite.position.y=i),u.properties.useQuantumDynamics&&S[e].setTexture(m(e))},getAtomColors:f},h(),_}}),define("models/md2d/views/bonds-renderer",["require","pixi"],function(e){var t=e("pixi"),n={STANDARD_STICK:101,LONG_SPRING:102,BOND_SOLID_LINE:103,GHOST:104,UNICOLOR_STICK:105,SHORT_SPRING:106,DOUBLE_BOND:107,TRIPLE_BOND:108,DISULPHIDE_BOND:109},r=["keShading","chargeShading","aminoAcidColorScheme"];return function(e,i,o,a){function s(){i.addPropertiesListener(r,function(){h.setup(),e.renderCanvas()})}function l(e){var t,n,r,i=p(e.x1),o=f(e.y1),a=p(e.x2),s=f(e.y2),l=a-i,u=s-o,h=Math.sqrt(l*l+u*u)/p(.01),m=Math.floor(24*e.length),g=h/m,y=l/h,b=u/h,x=y*g,w=b*g,_=y*m,T=b*m;for(v.lineStyle(d(e),c(e,1)),v.moveTo(i,o),r=0;m>r;r++)r%2===0?(t=i+(r+.5)*x-.5*T,n=o+(r+.5)*w+.5*_):(t=i+(r+.5)*x+.5*T,n=o+(r+.5)*w-.5*_),v.lineTo(t,n);v.lineTo(a,s)}function u(e){var t=p(e.x1),r=f(e.y1),i=p(e.x2),o=f(e.y2),a=p(g[e.atom1].radius),s=p(g[e.atom2].radius),l=i-t,u=o-r,h=Math.sqrt(l*l+u*u);if(!(0>=h-a-s)){var m,y,b,x,w=.5*(h+a-s)/h,_=t+w*l,T=r+w*u,A=d(e);e.type===n.DOUBLE_BOND?(m=.4*p(Math.min(g[e.atom1].radius,g[e.atom2].radius)),y=Math.atan2(u,l),b=Math.sin(y)*m,x=-Math.cos(y)*m,v.lineStyle(A,c(e,1)),v.moveTo(t+b,r+x),v.lineTo(_+b,T+x),v.moveTo(t-b,r-x),v.lineTo(_-b,T-x),v.lineStyle(A,c(e,2)),v.moveTo(_+b,T+x),v.lineTo(i+b,o+x),v.moveTo(_-b,T-x),v.lineTo(i-b,o-x)):e.type===n.TRIPLE_BOND?(m=.52*p(Math.min(g[e.atom1].radius,g[e.atom2].radius)),y=Math.atan2(u,l),b=Math.sin(y)*m,x=-Math.cos(y)*m,v.lineStyle(A,c(e,1)),v.moveTo(t,r),v.lineTo(_,T),v.moveTo(t+b,r+x),v.lineTo(_+b,T+x),v.moveTo(t-b,r-x),v.lineTo(_-b,T-x),v.lineStyle(A,c(e,2)),v.moveTo(_,T),v.lineTo(i,o),v.moveTo(_+b,T+x),v.lineTo(i+b,o+x),v.moveTo(_-b,T-x),v.lineTo(i-b,o-x)):(v.lineStyle(A,c(e,1)),v.moveTo(t,r),v.lineTo(_,T),v.lineStyle(A,c(e,2)),v.moveTo(_,T),v.lineTo(i,o))}}function c(e,t){return e.type===n.SHORT_SPRING?8947848:e.type===n.DISULPHIDE_BOND?16771418:1===t?parseInt(a.getAtomColors(e.atom1)[2].substr(1),16):2===t?parseInt(a.getAtomColors(e.atom2)[2].substr(1),16):void 0}function d(e){if(e.type===n.SHORT_SPRING)return p(.012);var t=p(Math.min(g[e.atom1].radius,g[e.atom2].radius));return e.type===n.DOUBLE_BOND?.5*t:e.type===n.TRIPLE_BOND?.35*t:.75*t}var h,p,f,m,g,v=new t.Graphics;return h={setup:function(){m=i.getRadialBonds(),g=i.getAtoms(),p=e.model2canvas,f=e.model2canvasInv,h.update()},bindModel:function(e){i=e,s()},update:function(){var e,t,r;for(v.clear(),e=0,t=m.length;t>e;++e)r=m[e],r.type===n.SHORT_SPRING?l(r):u(r)}},s(),o.addChild(v),h}}),define("models/md2d/views/genetic-elements-renderer",["require","models/md2d/views/nucleotides"],function(e){function t(e){var t=e.select("defs");return t.empty()&&(t=e.append("defs")),t}function n(e){var n,r=t(e);r.select("#transcription-bg").empty()&&(n=r.append("linearGradient").attr("id","transcription-bg").attr("x1","0%").attr("y1","0%").attr("x2","0%").attr("y2","100%"),n.append("stop").attr("stop-color","#C8DD69").attr("offset","0%"),n.append("stop").attr("stop-color","#778B3D").attr("offset","100%"))}function r(e,t,r,o){function l(e){return"scale("+e.scale+")"}function u(e){return e.opacity}function c(e){var n=e.translateX||0,i=e.translateY||0;return"translate("+t(n)+" "+r(i)+")"}function d(e){return c(e)+" "+l(e)}function h(e){var t=e?o.geneticEngine().PRECODING_LEN:0,n=Math.floor(o.properties.viewPortX/i.WIDTH)-2,r=Math.ceil((o.properties.viewPortX+o.properties.viewPortWidth)/i.WIDTH)+4;return[Math.max(0,n+t),r+t]}return{cells:function(e,n){var r=e.select(".background-layer").selectAll(".cells").data(n.cells);r.enter().append("image").attr({"class":"cells",x:t(a.CELLS*-.567),y:t(s.CELLS*-.445),width:t(a.CELLS),height:t(s.CELLS),preserveAspectRatio:"none","xlink:href":"resources/dna/Cells.svg",transform:d}).style("opacity",u),d3.transition(r).attr("transform",d).style("opacity",u),d3.transition(r.exit()).remove()},dna1:function(e,n){var r=e.select(".dna-layer").selectAll(".dna1").data(n.dna1);r.enter().append("image").attr({"class":"dna1",x:t(a.DNA1*-.5),y:t(s.DNA1*-.5),width:t(a.DNA1),height:t(s.DNA1),preserveAspectRatio:"none","xlink:href":"resources/dna/DNA_InsideNucleus_1.svg",transform:d}).style("opacity",u),d3.transition(r).attr("transform",d).style("opacity",u),d3.transition(r.exit()).remove()},dna2:function(e,n){var r=e.select(".dna-layer").selectAll(".dna2").data(n.dna2);r.enter().append("image").attr({"class":"dna2",x:t(a.DNA2*-.5),y:t(s.DNA2*-.404),width:t(a.DNA2),height:t(s.DNA2),preserveAspectRatio:"none","xlink:href":"resources/dna/DNA_InsideNucleus_2.svg",transform:d}).style("opacity",u),d3.transition(r).attr("transform",d).style("opacity",u),d3.transition(r.exit()).remove()},dna3:function(e,n){var r,i,o=14;r=e.select(".dna-layer").selectAll(".dna3").data(n.dna3),i=r.enter().append("g").attr({"class":"dna3 main-dna",transform:d}).style("opacity",u),i.selectAll("dna3-unit").data(new Array(o)).enter().append("image").attr({"class":"dna3-unit",x:function(e,n){return(n-.5*o)*t(a.DNA3)*.98},y:t(s.DNA3*-.5),width:t(a.DNA3),height:t(s.DNA3),preserveAspectRatio:"none","xlink:href":"resources/dna/DoubleHelix_Unit.svg"}),d3.transition(r).attr("transform",d).style("opacity",u),d3.transition(r.exit()).remove()},dna:function(e,n,r){var a=o.geneticEngine().viewModel,s=h(!0),l=n.dna[0]?n.dna[0].bonds:0,u=i(),d=e.select(".dna-layer").selectAll(".dna");return u.model2px(t).sequence(a.DNA.slice(s[0],s[1])).glow(o.get("DNAMutations")).bonds(l),r?(d.call(u.enterExitOnly(!0)),void 0):(d=d.data(n.dna),d.enter().append("g").attr({"class":"dna",transform:c}),d.call(u),d3.transition(d).attr("transform",c),d3.transition(d.exit()).remove(),void 0)},dnaComp:function(e,n,r){var a=o.geneticEngine().viewModel,s=h(!0),l=n.dnaComp[0]?n.dnaComp[0].bonds:0,u=i(),d=e.select(".dna-layer").selectAll(".dna-comp");return u.model2px(t).sequence(a.DNAComp.slice(s[0],s[1])).direction(2).glow(o.get("DNAMutations")).bonds(l),r?(d.call(u.enterExitOnly(!0)),void 0):(d=d.data(n.dnaComp),d.enter().append("g").attr({"class":"dna-comp",transform:c}),d.call(u),d3.transition(d).attr("transform",c),d3.transition(d.exit()).remove(),void 0)},mrna:function(e,n,r){var a=o.geneticEngine(),s=a.viewModel.mRNA,l=h(),u=a.stopCodonsHash(),d=n.mrna[0]?n.mrna[0].bonds:0,p=n.mrna[0]?n.mrna[0].direction:1,f=i(),m=e.select(".dna-layer").selectAll(".mrna");return f.model2px(t).sequence(s.slice(l[0],l[1])).backbone("RNA").direction(p).bonds(d).stopCodonsHash(u),r?(m.call(f.enterExitOnly(!0)),void 0):(m=m.data(n.mrna),m.enter().append("g").attr({"class":"mrna",transform:c}),m.call(f),d3.transition(m).attr("transform",c),d3.transition(m.exit()).remove(),void 0)},polymeraseUnder:function(e,n){var r=e.select(".under-dna-layer").selectAll(".polymerase-under").data(n.polymeraseUnder);r.enter().append("image").attr({"class":"polymerase-under",x:t(a.POLY_UNDER*-.5),y:t(s.POLY_UNDER*-.5),width:t(a.POLY_UNDER),height:t(s.POLY_UNDER),preserveAspectRatio:"none","xlink:href":"resources/dna/Polymerase_Under.svg",transform:d}).style("opacity",u),d3.transition(r).attr("transform",d).style("opacity",u),d3.transition(r.exit()).remove()},polymeraseOver:function(e,n){var r=e.select(".over-dna-layer").selectAll(".polymerase-over").data(n.polymeraseOver);r.enter().append("image").attr({"class":"polymerase-over",x:t(a.POLY_OVER*-.5),y:t(s.POLY_OVER*-.5),width:t(a.POLY_OVER),height:t(s.POLY_OVER),preserveAspectRatio:"none","xlink:href":"resources/dna/Polymerase_Over.svg",transform:d}).style("opacity",u),d3.transition(r).attr("transform",d).style("opacity",u),d3.transition(r.exit()).remove()},nucleus:function(e,n){var r=e.select(".background-layer").selectAll(".nucleus").data(n.nucleus);r.enter().append("image").attr({"class":"nucleus",x:t(a.NUCLEUS*-.5),y:t(s.NUCLEUS*-.5),width:t(a.NUCLEUS),height:t(s.NUCLEUS),preserveAspectRatio:"none","xlink:href":"resources/dna/BG_Nucleus.svg",transform:c}).style("opacity",u),d3.transition(r).attr("transform",c).style("opacity",u),d3.transition(r.exit()).remove()},ribosomeBottom:function(e,n){var r=e.select(".over-dna-layer").selectAll(".ribosome-bottom").data(n.ribosomeBottom);r.enter().append("image").attr({"class":"ribosome-bottom",x:t(a.RIBO_BOTTOM*-.5),y:t(s.RIBO_BOTTOM*-.5),width:t(a.RIBO_BOTTOM),height:t(s.RIBO_BOTTOM),preserveAspectRatio:"none","xlink:href":"resources/dna/Ribosome_bottom1.svg",transform:c}).style("opacity",0),d3.transition(r).attr("transform",c).style("opacity",u),d3.transition(r.exit()).style("opacity",0).remove()},ribosomeTop:function(e,n){var r=e.select(".over-dna-layer").selectAll(".ribosome-top").data(n.ribosomeTop);r.enter().append("image").attr({"class":"ribosome-top",x:t(a.RIBO_TOP*-.5),y:t(s.RIBO_TOP*-.5),width:t(a.RIBO_TOP),height:t(s.RIBO_TOP),preserveAspectRatio:"none","xlink:href":"resources/dna/Ribosome_top1.svg",transform:c}).style("opacity",0),d3.transition(r).attr("transform",c).style("opacity",u),d3.transition(r.exit()).style("opacity",0).remove()},ribosomeUnder:function(e,n){var r=e.select(".under-dna-layer").selectAll(".ribosome-under").data(n.ribosomeUnder);r.enter().append("image").attr({"class":"ribosome-under",x:t(a.RIBO_UNDER*-.5),y:t(s.RIBO_UNDER*-.5),width:t(a.RIBO_UNDER),height:t(s.RIBO_UNDER),preserveAspectRatio:"none","xlink:href":"resources/dna/Ribosome_under.png",transform:c}).style({opacity:u}),d3.transition(r).attr("transform",c).style("opacity",u),d3.transition(r.exit()).remove()},ribosomeOver:function(e,n){var r=e.select(".over-dna-layer").selectAll(".ribosome-over").data(n.ribosomeOver);r.enter().append("image").attr({"class":"ribosome-over",x:t(a.RIBO_OVER*-.5),y:t(s.RIBO_OVER*-.5),width:t(a.RIBO_OVER),height:t(s.RIBO_OVER),preserveAspectRatio:"none","xlink:href":"resources/dna/Ribosome_over.png",transform:c}).style("opacity",u),d3.transition(r).attr("transform",c).style("opacity",u),d3.transition(r.exit()).remove()},trna:function(e,n){var r,l,d,h,p=o.geneticEngine(),f=3*i.WIDTH,m=.55*(f-a.TRNA);r=e.select(".top-layer").selectAll(".trna").data(n.trna,function(e){return e.index}),l=r.enter().append("g").attr({"class":"trna",display:function(e){return e.index<0?"none":"inline"},transform:function(e,n){return"translate("+t(2*i.HEIGHT)+", "+t(-2.78)+") "+c(e,n)+" rotate(30)"}}).style("opacity",u),l.append("g").attr("transform","translate(0, "+t(-s.A)+")").call(i().model2px(t).sequence(function(e){return p.codonComplement(e.index)}).backbone(!1).randomEnter(!1)),l.append("image").attr({"class":"trna-neck",x:t(.52*(f-a.TRNA_NECK)),y:t(-s.TRNA_NECK-.95*s.TRNA-.92*s.A),width:t(a.TRNA_NECK),height:t(s.TRNA_NECK),preserveAspectRatio:"none","xlink:href":"resources/dna/tRNA_neck.png"}),l.append("image").attr({"class":"trna-base",x:t(m),y:t(-s.TRNA-.92*s.A),width:t(a.TRNA),height:t(s.TRNA),preserveAspectRatio:"none","xlink:href":"resources/dna/tRNA_base.png"}),d=d3.transition(r).attr("transform",c).style("opacity",u),d.select(".trna-neck").style("opacity",function(e){return e.neck}),h=d3.transition(r.exit()).attr("transform",function(e,n){return"translate("+t(-5*i.HEIGHT)+", "+t(-4*i.HEIGHT)+") "+c(e,n)+" rotate(-30)"}).style("opacity",0),h.selectAll(".bonds").style("opacity",0),h.remove()},viewPort:function(t,n){var r=n.viewPort[0].position,a=n.viewPort[0].ease,s=n.viewPort[0].drag,l=d3.transition(d3.select(e));o.set("viewPortDrag",s?"x":!1),l.duration?(l.ease(a),l.tween("model-update",function(){var e=d3.interpolate(Number(o.properties.viewPortX),r*i.WIDTH);return function(t){var n=e(t);Math.abs(o.properties.viewPortX-n)>.001&&(o.properties.viewPortX=n)}})):o.set("viewPortX",r*i.WIDTH)},background:function(t,r){n(t),d3.transition(d3.select(e).select(".container-background")).attr("fill",r.background[0].color)}}}var i=e("models/md2d/views/nucleotides"),o=.007,a={CELLS:720,DNA1:661,DNA2:720,DNA3:337.4,POLY_UNDER:426.15,POLY_OVER:402.525,NUCLEUS:729.45,RIBO_TOP:550.7,RIBO_BOTTOM:509.031,RIBO_UNDER:550.55,RIBO_OVER:550.7,TRNA:117.325,TRNA_NECK:15.925},s={CELLS:500,DNA1:550,DNA2:414.263,DNA3:89.824,POLY_UNDER:368.6,POLY_OVER:368.6,NUCLEUS:543.199,RIBO_TOP:250,RIBO_BOTTOM:147.15,RIBO_UNDER:311.6,RIBO_OVER:311.6,TRNA:67.9,TRNA_NECK:21.14,A:31.15},l=["background","cells","dna1","dna2","dna3","polymeraseUnder","polymeraseOver","polymeraseUnder","polymeraseOver","dna","dnaComp","mrna","nucleus","ribosomeBottom","ribosomeTop","ribosomeUnder","ribosomeOver","trna","viewPort"];return function(){var e;for(e in a)a.hasOwnProperty(e)&&(a[e]*=o);for(e in s)s.hasOwnProperty(e)&&(s[e]*=o)}(),r.W=a,r.H=s,r.OBJECT_NAMES=l,r}),define("common/views/state-manager",[],function(){return function(e){var t,n=[],r={};return t={newState:function(t,i){var o=$.extend(!0,{},i);e.forEach(function(e){"undefined"==typeof o[e]&&(o[e]=[])}),n.push(o),r[t]=o},extendLastState:function(t,i){var o=n[n.length-1],a={};e.forEach(function(e){a[e]=[],"undefined"!=typeof i[e]&&i[e].forEach(function(t,n){a[e].push($.extend(!0,{},o[e][n],t))})}),n.push(a),r[t]=a},getState:function(e){var t,n=r[e],i=$.extend(!0,{},n);for(t in i)i.hasOwnProperty(t)&&i[t].forEach(function(e,r){var i;for(i in e)"function"==typeof e[i]&&(e[i]=n[t][r][i]())});return i}}}}),define("models/md2d/views/genetic-anim-states",["require","models/md2d/views/nucleotides","models/md2d/views/genetic-elements-renderer","common/views/state-manager"],function(e){var t=e("models/md2d/views/nucleotides"),n=e("models/md2d/views/genetic-elements-renderer"),r=e("common/views/state-manager"),i=n.H,o=n.OBJECT_NAMES;return function(e){function n(){var t=c.state();return"translation-end"===t.name?e.geneticEngine().lastTranslationStep():l=isNaN(t.step)?l:t.step}function a(){return(1.65+3*Math.max(0,n()-2))*t.WIDTH}function s(){return 3*this.index()*t.WIDTH}var l,u=new r(o),c=e.geneticEngine(),d=e.get("viewPortWidth"),h=e.get("viewPortHeight"),p=.5*d,f=.5*h;return u.newState("intro-cells",{cells:[{translateX:p+.33,translateY:f,scale:1}],dna1:[{translateX:p+.33,translateY:f,scale:.13,opacity:0}],viewPort:[{position:0,ease:"cubic-in-out",drag:!1}],background:[{color:"#8492ef"}]}),u.extendLastState("intro-zoom1",{cells:[{translateX:p,scale:6}],dna1:[{translateX:p,scale:.78,opacity:5}],dna2:[{translateX:p,translateY:f,scale:.5,opacity:0}],viewPort:[{}],background:[{}]}),u.extendLastState("intro-zoom2",{cells:[{scale:24}],dna1:[{scale:3.12,opacity:0}],dna2:[{scale:2,opacity:1}],dna3:[{translateX:p,translateY:f,scale:.2,opacity:0}],viewPort:[{}],background:[{}]}),u.extendLastState("intro-zoom3-s0",{cells:[{}],dna2:[{scale:3.8,opacity:0}],dna3:[{scale:.4,opacity:1}],viewPort:[{}],background:[{}]}),u.extendLastState("intro-zoom3",{cells:[{}],dna3:[{scale:.6}],polymeraseUnder:[{scale:.2,translateX:-2,translateY:4,opacity:1}],viewPort:[{}],background:[{}]}),u.extendLastState("intro-polymerase-s0",{cells:[{}],dna3:[{}],polymeraseUnder:[{scale:.8,translateX:p,translateY:f,opacity:1}],polymeraseOver:[{translateX:p,translateY:f,scale:.8,opacity:0}],viewPort:[{}],background:[{}]}),u.extendLastState("intro-polymerase",{cells:[{}],dna3:[{}],polymeraseUnder:[{scale:1}],polymeraseOver:[{scale:1,opacity:1}],viewPort:[{}],background:[{}]}),u.extendLastState("dna-s0",{cells:[{opacity:0}],dna3:[{scale:1.5}],polymeraseUnder:[{scale:2.5}],polymeraseOver:[{scale:2.5}],viewPort:[{}],background:[{}]}),u.extendLastState("dna",{polymeraseUnder:[{opacity:0}],polymeraseOver:[{opacity:0}],dna3:[{opacity:0}],dna:[{translateX:-e.geneticEngine().PRECODING_LEN*t.WIDTH,translateY:h/2+t.HEIGHT,bonds:1}],dnaComp:[{translateX:-e.geneticEngine().PRECODING_LEN*t.WIDTH,translateY:h/2-t.HEIGHT,bonds:1}],viewPort:[{position:-2,drag:!0}],background:[{color:"url(#transcription-bg)"}]}),u.extendLastState("transcription",{dna:[{translateY:h/2+2.5*t.HEIGHT,bonds:0}],dnaComp:[{translateY:h/2-2.5*t.HEIGHT,bonds:function(){var t=n()+e.geneticEngine().PRECODING_LEN;return function(e){return"c"===e.region&&e.idx<t?1:0}}}],mrna:[{translateY:h/2-.5*t.HEIGHT,bonds:1,direction:1}],viewPort:[{position:function(){return Math.max(0,Math.min(e.get("DNA").length-10,n()-6))-2},ease:"linear"}],background:[{}]}),u.extendLastState("transcription-end",{dna:[{}],dnaComp:[{bonds:function(){return function(e){return"c"===e.region?1:0}}}],mrna:[{}],polymeraseUnder:[{translateX:function(){return e.get("DNA").length*t.WIDTH},translateY:.5*h,scale:3.5,opacity:0}],polymeraseOver:[{translateX:function(){return e.get("DNA").length*t.WIDTH},translateY:.5*h,scale:3.5,opacity:0}],viewPort:[{position:function(){return Math.max(0,e.get("DNA").length-10)-2}}],background:[{}]}),u.extendLastState("after-transcription",{dna:[{}],dnaComp:[{}],mrna:[{}],polymeraseUnder:[{opacity:1}],polymeraseOver:[{opacity:1}],viewPort:[{}],background:[{}]}),u.extendLastState("before-translation-s0",{dna:[{}],dnaComp:[{}],mrna:[{}],polymeraseUnder:[{scale:1.4}],polymeraseOver:[{scale:1.4,opacity:0}],viewPort:[{}],background:[{color:"#8492ef"}]}),u.extendLastState("before-translation-s1",{dna:[{}],dnaComp:[{}],mrna:[{}],polymeraseUnder:[{translateX:function(){return e.get("viewPortX")+.5*d+5},translateY:.5*h-2,scale:.7}],viewPort:[{}],background:[{}]}),u.extendLastState("before-translation-s2",{dna:[{}],dnaComp:[{}],mrna:[{}],nucleus:[{translateX:.5*d-2*t.WIDTH,translateY:.5*h}],viewPort:[{position:-2,ease:"cubic-in-out"}],background:[{}]}),u.extendLastState("before-translation-s3",{dna:[{translateY:4*t.HEIGHT}],dnaComp:[{translateY:2*t.HEIGHT,bonds:0}],mrna:[{bonds:0}],nucleus:[{translateY:0}],viewPort:[{}],background:[{color:function(){return e.get("backgroundColor")}}]}),u.extendLastState("before-translation-s4",{dna:[{translateY:-1*t.HEIGHT}],dnaComp:[{translateY:-3*t.HEIGHT}],mrna:[{translateY:2.5*t.HEIGHT}],nucleus:[{translateY:i.NUCLEUS*-.5}],viewPort:[{}],background:[{}]}),u.extendLastState("before-translation",{mrna:[{translateY:1.5*t.HEIGHT,direction:2,bonds:0}],ribosomeBottom:[{translateX:-3,translateY:f,opacity:0}],viewPort:[{}],background:[{}]}),u.extendLastState("translation-s0",{mrna:[{}],ribosomeBottom:[{translateX:a,translateY:1.75*t.HEIGHT,opacity:1}],ribosomeTop:[{translateX:-3,translateY:6,opacity:0}],viewPort:[{}],background:[{}]}),u.extendLastState("translation-s1",{mrna:[{}],ribosomeBottom:[{}],ribosomeTop:[{translateX:a,translateY:4.52*t.HEIGHT,opacity:1}],ribosomeUnder:[{translateX:a,translateY:3.7*t.HEIGHT,opacity:0}],ribosomeOver:[{translateX:a,translateY:3.7*t.HEIGHT,opacity:0}],viewPort:[{}],background:[{}]}),u.extendLastState("translation",{mrna:[{bonds:function(){var e=n();return function(t){return t.idx<3*(e-2)||t.idx>=3*e?0:1}}}],ribosomeUnder:[{opacity:1}],ribosomeOver:[{opacity:1}],trna:[{index:function(){return n()-2},translateX:s,translateY:2.5*t.HEIGHT,neck:0},{index:function(){return n()-1},translateX:s,translateY:2.5*t.HEIGHT,neck:1}],viewPort:[{position:function(){return Math.max(0,3*(n()-3))-2},ease:"linear"}],background:[{}]}),u.extendLastState("translation-step0",{mrna:[{bonds:function(){var e=n();return function(t){return t.idx<3*(e-3)||t.idx>=3*e?0:1}}}],ribosomeUnder:[{}],ribosomeOver:[{}],trna:[{index:function(){return n()-3}},{index:function(){return n()-2}},{index:function(){return n()-1},translateX:s,translateY:2.5*t.HEIGHT,neck:1}],viewPort:[{}],background:[{}]}),u.extendLastState("translation-step1",{mrna:[{}],ribosomeUnder:[{}],ribosomeOver:[{}],trna:[{},{neck:0},{}],viewPort:[{}],background:[{}]}),u.extendLastState("translation-end-s0",{mrna:[{}],ribosomeUnder:[{}],ribosomeOver:[{}],trna:[{index:function(){return n()-2}},{index:function(){return n()-1},neck:0}],viewPort:[{}],background:[{}]}),u.extendLastState("translation-end-s1",{mrna:[{bonds:function(){var e=n();return function(t){return t.idx<3*(e-1)||t.idx>=3*e?0:1}}}],ribosomeUnder:[{}],ribosomeOver:[{}],trna:[{index:function(){return n()-1}}],viewPort:[{}],background:[{}]}),u.extendLastState("translation-end-s2",{mrna:[{bonds:0}],ribosomeUnder:[{}],ribosomeOver:[{}],viewPort:[{}],background:[{}]}),u.extendLastState("translation-end-s3",{mrna:[{}],ribosomeBottom:[{translateX:a,translateY:1.75*t.HEIGHT,opacity:1}],ribosomeTop:[{translateX:a,translateY:4.52*t.HEIGHT,opacity:1}],viewPort:[{}],background:[{}]}),u.extendLastState("translation-end-s4",{mrna:[{}],ribosomeBottom:[{translateY:1.75*t.HEIGHT-.3}],ribosomeTop:[{translateY:4.52*t.HEIGHT+.5}],viewPort:[{}],background:[{}]}),u.extendLastState("translation-end-s5",{mrna:[{}],ribosomeBottom:[{translateX:function(){return a()+8},translateY:1.75*t.HEIGHT-.5}],ribosomeTop:[{translateX:function(){return a()+8},translateY:4.52*t.HEIGHT+5}],viewPort:[{}],background:[{}]}),u.extendLastState("translation-end",{mrna:[{}],viewPort:[{}],background:[{}]}),u}}),function(){var e={}.hasOwnProperty;define("cs!models/md2d/views/mutations-context-menu",["require"],function(){return{register:function(t,n,r){var i,o,a;i=null,a=function(t){var n,r,o;i=d3.select(t.$trigger[0]).datum().type,o=t.items.Substitution.items;for(r in o)e.call(o,r)&&(n=o[r],r=r.split(":")[1],n.$node.addClass(""+i+"-to-"+r));return d3.select(t.$trigger[0]).classed("glowing",!0),!0},o=function(t){var n,r,o;o=t.items.Substitution.items;for(r in o)e.call(o,r)&&(n=o[r],r=r.split(":")[1],n.$node.removeClass(""+i+"-to-"+r));return d3.select(t.$trigger[0]).classed("glowing",!1),!0},$.contextMenu("destroy",t),$.contextMenu({selector:t,appendTo:"#responsive-content",className:"mutations-menu",trigger:"left",events:{show:a,hide:o},callback:function(e,t){var i;switch(e=e.split(":"),i=d3.select(t.$trigger[0]).datum(),e[0]){case"substitute":return n.geneticEngine().mutate(i.idx,e[1],r);case"insert":return n.geneticEngine().insert(i.idx,e[1],r);case"delete":return n.geneticEngine()["delete"](i.idx)}},items:{Substitution:{name:"Substitution mutation",className:"substitution-submenu",items:{"substitute:A":{name:""},"substitute:T":{name:""},"substitute:G":{name:""},"substitute:C":{name:""}}},Insertion:{name:"Insertion mutation",className:"insertion-submenu",items:{"insert:A":{name:"Insert",className:"A"},"insert:T":{name:"Insert",className:"T"},"insert:G":{name:"Insert",className:"G"},"insert:C":{name:"Insert",className:"C"}}},"delete":{name:"Deletion mutation"}}})}}})}.call(this),define("models/md2d/views/genetic-renderer",["require","models/md2d/views/nucleotides","models/md2d/views/genetic-elements-renderer","models/md2d/views/genetic-anim-states","cs!models/md2d/views/mutations-context-menu"],function(e){function t(e,t){function s(){t.geneticEngine().on("change",u),t.geneticEngine().on("transition",p),t.addPropertiesListener(["DNAMutations"],l),t.addPropertiesListener(["viewPortX"],function(){if(x&&t.get("DNA")&&("transcription"!==_.name||!E)){var e=k.getState(S||_.name);P.mrna(x,e,!0),P.dna(x,e,!0),P.dnaComp(x,e,!0),!E&&"translation-end"===_.name&&t.getNumberOfAtoms()>0&&t.geneticEngine().centerProtein()}}),o.register('[class~="dna"] [class~="clickable-nucleo"]',t,!1),o.register('[class~="dna-comp"] [class~="clickable-nucleo"]',t,!0)}function l(){_=t.geneticEngine().state(),h(),b.selectAll("g.genetics").remove(),x=null,t.get("DNA")&&(x=b.insert("g",".image-container-below").attr("class","genetics"),x.append("g").attr("class","background-layer"),x.append("g").attr("class","under-dna-layer"),x.append("g").attr("class","dna-layer"),x.append("g").attr("class","over-dna-layer"),x.append("g").attr("class","top-layer"),u())}function u(e){C=e,_=t.geneticEngine().state(),h(),c(x,_.name,null,E),E=!1}function c(e,t,n,r){function i(e){var t=!!s[e].length,n=!(!l||!l[e].length);return C&&"viewPort"===e?!1:r||t||n?!0:!1}function o(){e.each(function(){var e=d3.select(this);a.forEach(function(t){i(t)&&P[t](e,s)})}),n&&n(e)}var s=k.getState(t),l=T?k.getState(T):null;e.duration?(e.each("start.transition-name",function(){S=t,o()}),e.each("end.transition-name",function(){S=null})):o(),T=t,A=_.step||0}function d(e){var t;return t=!e&&w&&w.node().__transition__?w.transition():x.transition(),w=t,t}function h(){var e=d3.select(g),t=e.select("g.genetics");!t.empty()&&t.node().__transition__&&(e.selectAll("g.genetics, g.genetics *").interrupt(),e.select(".container-background").interrupt(),w=null,S=null)}function p(e,n){E=!0,C=n,_=t.geneticEngine().state(),Number(e.split(":")[1])>0&&(e=e.split(":")[0]),m[e](),w.each("end.trans-end",function(){E=!1,t.geneticEngine().transitionEnded()})}var f,m,g=e.node,v=e.model2px,y=e.model2pxInv,b=d3.select(g).select(".below-atoms"),x=null,w=null,_=null,T=null,A=null,C=!1,E=!1,S=null,k=new i(t),P=new r(g,v,y,t);return m={"dna-updated":function(){var e=d(!0).ease("cubic-in-out").duration(800);c(e,_.name,null,!0)},"intro-zoom1":function(){var e=d(!0).ease("cubic").duration(3e3);c(e,"intro-zoom1")},"intro-zoom2":function(){var e=d(!0).ease("linear").duration(3e3);c(e,"intro-zoom2")},"intro-zoom3":function(){var e=d(!0).ease("linear").duration(2e3);c(e,"intro-zoom3-s0"),e=d().ease("quad-out").duration(3300),c(e,"intro-zoom3")},"intro-polymerase":function(){var e=d(!0).ease("quad-out").duration(3e3);c(e,"intro-polymerase-s0"),e=d().ease("cubic-in-out").duration(1e3),c(e,"intro-polymerase")},dna:function(){var e=d(!0).duration(2e3);c(e,"dna-s0"),e=d().duration(1e3),c(e,"dna",function(e){e.selectAll(".nucleotide").duration(5),e.selectAll(".container-background").duration(5)})},"transcription:0":function(){var e=d(!0).duration(1500);c(e,"transcription",function(e){e.selectAll(".bonds").duration(250)})},transcription:function(){var e=d(!0).duration(500);c(e,"transcription",function(e){e.selectAll(".bonds").ease("cubic")})},"transcription-end":function(){var e=d(!0).duration(500);c(e,"transcription-end",function(e){e.selectAll(".bonds").ease("cubic")})},"after-transcription":function(){var e=d(!0).ease("cubic-in-out").duration(700);c(e,"after-transcription")},"before-translation":function(){var e=d(!0).ease("cubic-in-out").duration(1e3);c(e,"before-translation-s0",function(e){e.selectAll(".container-background").duration(1)}),e=d().ease("cubic-in-out").duration(1500),c(e,"before-translation-s1"),e=d().ease("cubic-in-out").duration(1500),c(e,"before-translation-s2"),e=d().ease("cubic").duration(1e3),c(e,"before-translation-s3",function(e){e.selectAll(".bonds").duration(250),e.selectAll(".container-background").duration(1)}),e=d().ease("cubic-out").duration(1e3),c(e,"before-translation-s4"),e=d().ease("cubic-out").duration(500),c(e,"before-translation")},"translation:0":function(){var e=d(!0).ease("cubic-in-out").duration(1e3);c(e,"translation-s0"),e=d().ease("cubic-in-out").duration(1e3),c(e,"translation-s1"),e=d().ease("cubic-in-out").duration(500),c(e,"translation")},translation:function(){var e,r=t.geneticEngine(),i=_.step-1,o=1e3,a=500;e=d(!0).duration(o),c(e,"translation-step0",function(e){e.selectAll(".bonds").ease("cubic"),r.translationStepStarted(i,1.45+3*i*n.WIDTH,3.95,.53+3*i*n.WIDTH,1.57,o)}),e=d().duration(a),c(e,"translation-step1",function(e){e.selectAll(".trna-neck").duration(150),r.shiftAminoAcids(i,2*n.WIDTH,a)}),i>0&&(e=d().duration(900),c(e,"translation",function(e){r.connectAminoAcid(i),e.selectAll(".bonds").duration(150)}))},"translation-end":function(){var e,n=t.geneticEngine(),r=t.getNumberOfAtoms();r>=1?(e=d(!0).duration(150),c(e,"translation-end-s0"),e=d().duration(800),c(e,"translation-end-s1",function(e){n.translationCompleted(),e.selectAll(".bonds").duration(150)}),e=d().duration(800),c(e,"translation-end-s2",function(e){e.selectAll(".bonds").duration(150)}),e=d().duration(500),c(e,"translation-end-s3")):(e=d(!0).duration(500),c(e,"translation-end-s3")),e=d().duration(300),c(e,"translation-end-s4"),e=d().duration(1e3),c(e,"translation-end-s5"),e=d().duration(700),c(e,"translation-end",function(){n.centerProtein(700)})}},f={setup:l,render:u},s(),f}var n=e("models/md2d/views/nucleotides"),r=e("models/md2d/views/genetic-elements-renderer"),i=e("models/md2d/views/genetic-anim-states"),o=e("cs!models/md2d/views/mutations-context-menu"),a=r.OBJECT_NAMES;return d3.selection.prototype.interrupt=function(){return this.each(function(){var e=this.__transition__;if(e){var t=-1;for(var n in e)(n=+n)>t&&(t=n);e.active=t+1}})},t}),function(){define("cs!common/layout/wrap-svg-text",["require"],function(){var e,t;return e="http://www.w3.org/2000/svg",t=window.wrapSVGText=function(t,n,r,i,o){var a,s,l,u,c,d,h,p,f,m,g,v,y,b,x,w,_,T,A;for(u=/-/gi,t.search("\n")>0?(_=t.split("\n"),p=!0,l=[]):(_=t.split(/[\s-]/),p=!1,l=function(){var e;for(e=[];m=u.exec(t);)e.push(m.index);return e}()),s=0,a=0,f=1,b=0,c=T=0,A=_.length;A>T;c=++T)w=_[c],s+=w.length+1,0===c||p||r>0&&a>r?(c>0&&(p?(b=Math.max(y.getComputedTextLength(),b),f++):(g=y.firstChild.nodeValue,g.length>_[c-1].length+1?(d=g.slice(g.length-_[c-1].length-1),y.firstChild.nodeValue=g.slice(0,g.length-_[c-1].length-1)):g.length===_[c-1].length+1&&(y.firstChild.nodeValue=g.slice(0,g.length-1)),b=Math.max(y.getComputedTextLength(),b),f++)),y=document.createElementNS(e,"tspan"),y.setAttributeNS(null,"x",i),y.setAttributeNS(null,"dy",0===c?0:o),v=document.createTextNode(h),y.appendChild(v),n.appendChild(y),h=~l.indexOf(s-1)?w+"-":w+" ",c&&d&&(h=d+h)):h+=~l.indexOf(s-1)?w+"-":w+" ",y.firstChild.nodeValue=h,a=y.getComputedTextLength(),p&&(b=Math.max(y.getComputedTextLength(),b)),p||c&&c===_.length-1&&r>0&&a>r&&(g=y.firstChild.nodeValue,y.firstChild.nodeValue=g.slice(0,g.length-_[c].length-1),y=document.createElementNS(e,"tspan"),y.setAttributeNS(null,"x",i),y.setAttributeNS(null,"dy",o),v=document.createTextNode(_[c]),y.appendChild(v),n.appendChild(y),f++);return 0===b&&(b=n.childNodes[0].getComputedTextLength()),x=r>b?r:b,{lines:f,width:x,textWidth:b}}})}.call(this),define("common/views/gradients",[],function(){return{createRadialGradient:function(e,t,n,r,i){var o,a,s;return a=i.select("defs"),a.empty()&&(a=i.append("defs")),s=a.select("#"+e),s.empty()?s=a.append("radialGradient").attr("id",e).attr("cx","50%").attr("cy","47%").attr("r","53%").attr("fx","35%").attr("fy","30%"):s.selectAll("stop").remove(),s.append("stop").attr("stop-color",t).attr("offset","0%"),s.append("stop").attr("stop-color",n).attr("offset","40%"),s.append("stop").attr("stop-color",r).attr("offset","80%"),s.append("stop").attr("stop-color",n).attr("offset","100%"),o="url(#"+e+")",this.mainColorOfGradient[o]=r,o},mainColorOfGradient:{},settleParens:function(e,t){var n,r,i;for(r=!1,e=e.split(""),n=0;n<e.length;n++)r?")"==e[n]?r=!1:"("==e[n]&&(e[i]=" ",i=n):"("==e[n]?t?(e[n]=" ",t=!1):(r=!0,i=n):")"==e[n]&&(e[n]=" ");return e.join("").replace(/\s+/," ").trim()},smartSplit:function(e,t){var n,r,i,o,a;for(e=this.settleParens(e,t),o=!1,i=[],r=1;r<e.length;r++)o?")"==e[r]&&(o=!1):","==e[r]||" "==e[r]?(a=e.slice(n,r).trim(),a.length>0&&i.push(this.parseWord(a)),n=r+1):"("==e[r]&&(o=!0);return r==e.length&&i.push(this.parseWord(e.slice(n,r).trim())),i},parseWord:function(e){var t,n;return t=new String(e),-1!=e.search(/(^|[^a-zA-Z])li?n?e?a?r?($|[^a-zA-Z])/)&&(t.linear=!0),-1!=e.search(/(^|[^a-zA-Z])ra?d?i?a?l?($|[^a-zA-Z])/)&&(t.radial=!0),-1!=e.search(/(^|[^a-zA-Z])gr?a?d?i?e?n?t?($|[^a-zA-Z])/)&&(t.gradient=!0),-1!=e.search(/(\(|\))/)?(t.parens=!0,t):(n=parseFloat(e),isNaN(n)||(t.number=n),-1!=e.search(/(^|[^a-zA-Z])de?g?r?e?e?s?($|[^a-zA-Z])/)&&(t.degrees=!0),-1!=e.search(/(^|[^a-zA-Z])ri?g?h?t?($|[^a-zA-Z])/)&&(t.right=!0),-1!=e.search(/(^|[^a-zA-Z])le?f?t?($|[^a-zA-Z])/)&&(t.left=!0),-1!=e.search(/(^|[^a-zA-Z])(t|u)o?p?($|[^a-zA-Z])/)&&(t.top=!0),-1!=e.search(/(^|[^a-zA-Z])bo?t?t?o?m?($|[^a-zA-Z])/)&&(t.bottom=!0),-1!=e.search(/(^|[^a-zA-Z])re?pe?a?t?($|[^a-zA-Z])/)&&(t.repeat=!0),-1!=e.search(/(^|[^a-zA-Z])re?fl?e?c?t?($|[^a-zA-Z])/)&&(t.reflect=!0),t)
},interpolateStops:function(e){var t,n,r,i,o,a;if(0==e.length)return e;if("offset"in e[0]||(e[0].offset=0),1==e.length)return e;"offset"in e[e.length-1]||(e[e.length-1].offset=100);for(t=2;t<e.length;t++)if("offset"in e[t]&&!("offset"in e[t-1])){for(i=0,o=e[t].offset,n=t-2;n>=0;n--)if("offset"in e[n]){i=e[n].offset;break}a=(o-i)/(t-n);for(var r=n+1;t>r;r++)e[r].offset=i+a*(r-n)}return e},fullParse:function(e){if(e=e.trim().toLowerCase(),-1==e.search(/[^#0-9a-zA-Z-]/))return{color:e};var t,n,r,i,o,a,s,l,u,c,d;for(e=e.replace(/[\n\r:;]/g," ").replace(/\/\*.*\*\/$/,"").replace(/\{\[/,"(").replace(/\}\]/,")").replace(/[^a-zA-Z0-9%#\-\(\)\., ]*/g,"").replace(/\s*-\s+/g,"-").replace(/\s*\(/g,"(").replace(/\s+/g," "),n=this.smartSplit(e,!1),s={},a=0;a<n.length;a++)"parens"in n[a]&&("gradient"in n[a]||"linear"in n[a]||"radial"in n[a])&&n.splice.apply(n,[a,1].concat(this.smartSplit(n[a],!0)));for(r=!1,o=!1,i=!1,d=!1,u=0,c=0,a=0;a<n.length;a++)l=!1,"left"in n[a]?(u-=1,l=!0):"right"in n[a]&&(u+=1,l=!0),"top"in n[a]?(c+=1,l=!0):"bottom"in n[a]&&(c-=1,l=!0),"radial"in n[a]&&!("right"in n[a])&&(o=!0,l=!0),"linear"in n[a]&&!("left"in n[a])&&(i=!0,l=!0),"number"in n[a]&&("degrees"in n[a]||a+1<n.length&&"degrees"in n[a+1])&&(r===!1&&(r=n[a].number),l=!0),"repeat"in n[a]?(d="repeat",l=!0):"reflect"in n[a]&&(d="reflect",l=!0),(l||"degrees"in n[a]||"gradient"in n[a])&&(n.splice(a,1),a--);for(r!==!1||0==u&&0==c||(r=180*Math.atan2(c,u)/Math.PI%360),t=[],a=0;a<n.length;a++)"number"in n[a]||(a+1<n.length&&"number"in n[a+1]?(t.push({color:n[a],offset:n[a+1].number}),n.splice(a,2)):(t.push({color:n[a]}),n.splice(a,1)),a--);if(1==t.length)return{color:t[0].color};if(0==t.length)return{color:"none"};for(this.interpolateStops(t),a=0;a<n.length;a++)"number"in n[a]&&r===!1&&(r=n[a].number);return o&&!i?(r=!1,s.gradient="radial"):(r===!1&&(r=0),r%=360,0>r&&(r+=360),s.gradient="linear",s.direction=r),d!==!1&&(s.repeat=d),s.stops=t,s.standard=this.toStandardForm(s),s},parse:function(e){if(e=e.trim().toLowerCase().replace(/\s+/g," "),-1==e.search(/ /))return{color:e,standard:e};var t,n,r,i,o,a,s;if(t=e.split(" "),r={},i=t.shift(),"linear"!=i&&"radial"!=i)return this.fullParse(e);if(r.gradient=i,"linear"==i){if(n=parseFloat(t.shift()),isNaN(n))return this.fullParse(e);n%=360,0>n&&(n+=360),r.direction=n,s=!0}if(r.stops=[],t.length%2!=0)return this.fullParse(e);for(o=0;o<t.length;o+=2){if(a=parseFloat(t[o+1]),isNaN(a))return this.fullParse(e);r.stops.push({color:t[o],offset:a})}return r.standard=s?this.toStandardForm(r):e,r},toCSS:function(e,t){var n,r;if("color"in e)t.style.backgroundColor=e.color.length?e.color:"inherit",t.style.backgroundImage="none";else{for(n="radial"==e.gradient?"-webkit-radial-gradient(ellipse,":"-webkit-linear-gradient("+e.direction+"deg, ",r=0;r<e.stops.length;r++)n+=e.stops[r].color+" "+e.stops[r].offset+"%",r<e.stops.length-1&&(n+=",");n+=")",t.style.backgroundColor="none",t.style.backgroundImage=n}},toStandardForm:function(e){var t,n;if("color"in e)return e.standard=e.color,e.color;for(t=e.gradient+" "+("linear"==e.gradient?e.direction+"deg ":""),n=0;n<e.stops.length;n++)t+=e.stops[n].color+" "+e.stops[n].offset+"%",n<e.stops.length-1&&(t+=" ");return e.standard=t,t},toSVG:function(e,t){if(e.color)return e.color;var n,r,i,o,a,s,l,u,c,d;if(n=t.select("defs"),n.empty()&&(n=t.append("defs")),i=e.standard.replace(/[^a-z0-9]/g,""),r=n.select("#"+i),!r.empty())return"url(#"+i+")";for("linear"==e.gradient?(l=-Math.cos(Math.PI*e.direction/180),u=-Math.sin(Math.PI*e.direction/180),Math.abs(u)>Math.abs(l)?(a=l*Math.abs(50/u),s=50*(0>u?-1:1)):(a=50*(0>l?-1:1),s=u*Math.abs(50/l)),r=n.append("linearGradient").attr("id",i).attr("x1",50+a+"%").attr("y1",50+s+"%").attr("x2",50-a+"%").attr("y2",50-s+"%")):r=n.append("radialGradient").attr("id",i).attr("cx","50%").attr("cy","50%").attr("r","50%").attr("fx","50%").attr("fy","50%"),o=0;o<e.stops.length;o++)d=r.append("stop").attr("stop-color",e.stops[o].color).attr("offset",e.stops[o].offset+"%"),c=e.stops[o].color.split(","),4!=c.length||isNaN(c=parseFloat(c[3]))||d.attr("stop-opacity",c);return"url(#"+i+")"}}}),define("common/views/color",[],function(){function e(e){var t=e.match(/rgba\(([0-9]+),([0-9]+),([0-9]+),([0-9]+)\)/i);return null!==t?d3.rgb(t[1],t[2],t[3]):d3.rgb(e)}return{contrastingColor:function(t){return t=e(t),(299*t.r+587*t.g+114*t.b)/1e3>=128?"#000":"#fff"}}}),define("models/md2d/views/images-renderer",["require","lab.config"],function(e){var t=e("lab.config");return function(e,n,r){function i(r){var i,o=n.properties.imageMapping;return n.properties.imagePath?i=t.actualRoot+n.properties.imagePath:e.url&&(i=t.actualRoot+e.url.slice(0,e.url.lastIndexOf("/")+1)),i+(o[r.imageUri]||r.imageUri)}function o(t){var r,i,o,a,s=n.properties.images,l=n.getAtoms(),c=n.get_obstacles(),d=e.model2px,h=e.model2pxInv,p=s[t];return p.imageHostType?("Atom"===p.imageHostType?(r=l[p.imageHostIndex].x,i=l[p.imageHostIndex].y):"RectangularObstacle"===p.imageHostType&&(r=c.x[p.imageHostIndex]+c.width[p.imageHostIndex]/2,i=c.y[p.imageHostIndex]+c.height[p.imageHostIndex]/2),o=u[t][0],a=u[t][1],r-=o/2,i+=a/2):(r=p.imageX,i=p.imageY),[d(r),h(i)]}function a(){var t,a,s,l,c=n.properties.images,d=e.model2px,h=[],p=[],f=[];if(r.above.selectAll("image").remove(),r.below.selectAll("image").remove(),c)for(s=0;s<c.length;s++)h[s]=new Image,h[s].src=i(c[s]),h[s].onload=function(e){return function(){t=c[e].imageLayer,l=1===t?p:f,l.push({i:e,zOrder:c[e].imageLayerPosition?c[e].imageLayerPosition:0}),l.sort(function(e,t){return d3.ascending(e.zOrder,t.zOrder)}),u[e]=[.01*h[e].width,.01*h[e].height],a=1===t?r.above:r.below,a.selectAll("image").remove(),a.selectAll("image").data(l,function(e){return e.i}).enter().append("image").attr("x",function(e){return o(e.i)[0]}).attr("y",function(e){return o(e.i)[1]}).attr("class",function(e){return"image_attach"+e.i}).attr("xlink:href",function(e){return h[e.i].src}).attr("width",function(e){return d(u[e.i][0])}).attr("height",function(e){return d(u[e.i][1])}).attr("pointer-events",function(e){return c[e.i].imageHostType?"none":"auto"})}}(s)}function s(){var e,t,i,a,s,l=n.properties.images;for(e=l.length,s=0;e>s;s++)u&&u[s]&&(a=o(s),t=l[s].imageLayer,i=1===t?r.above:r.below,i.selectAll("image.image_attach"+s).attr("x",a[0]).attr("y",a[1]))}function l(e){n=e}var u=[];return{setup:a,update:s,bindModel:l}}}),define("models/md2d/views/renderer",["require","lab.config","common/console","common/benchmark/benchmark","models/md2d/views/atoms-renderer","models/md2d/views/bonds-renderer","models/md2d/views/genetic-renderer","cs!common/layout/wrap-svg-text","common/views/gradients","common/views/color","./images-renderer"],function(e){var t=e("lab.config"),n=e("common/console"),r=e("common/benchmark/benchmark"),i=e("models/md2d/views/atoms-renderer"),o=e("models/md2d/views/bonds-renderer"),a=e("models/md2d/views/genetic-renderer"),s=e("cs!common/layout/wrap-svg-text"),l=e("common/views/gradients"),u=e("common/views/color"),c=e("./images-renderer");return function(e,d){function h(e,t,n){var r,i,o,a,s,u=(t+Math.pow(2,24)).toString(16);for(s=u.length;6>s;s++)u=String(0)+u;return r=d3.rgb("#"+u),i=r.toString(),o=r.brighter(1).toString(),a=r.darker(1).toString(),l.createRadialGradient(e,o,i,a,n)}function p(){var e,t,n,r,i;for(e=0;4>e;e++)h("elem"+e+"-grad",ot.color[e],Zt);r=d.get("markColor"),t=d3.rgb(r),n=t.brighter(1).toString(),i=t.darker(1).toString(),l.createRadialGradient("mark-grad",n,r,i,Zt)}function f(){var e,t,n,r,i=d3.scale.linear().interpolate(d3.interpolateRgb).range(["#F2F2F2","#FF8080"]),o=d3.scale.linear().interpolate(d3.interpolateRgb).range(["#A4A4A4","#FF2020"]);for(r=0;hn>r;r++)e="ke-shading-"+r,n=r/hn,t=l.createRadialGradient(e,"#FFFFFF",i(n),o(n),Zt),dn[r]=t;l.createRadialGradient("neutral-grad","#FFFFFF","#f2f2f2","#A4A4A4",Zt);var a,s=d3.scale.linear().interpolate(d3.interpolateRgb).range(["#FFFFFF","#ffefff"]),u=d3.scale.linear().interpolate(d3.interpolateRgb).range(["#f2f2f2","#9090FF"]),c=d3.scale.linear().interpolate(d3.interpolateRgb).range(["#A4A4A4","#3030FF"]),d=d3.scale.linear().interpolate(d3.interpolateRgb).range(["#FFFFFF","#dfffff"]),h=d3.scale.linear().interpolate(d3.interpolateRgb).range(["#f2f2f2","#FF8080"]),p=d3.scale.linear().interpolate(d3.interpolateRgb).range(["#A4A4A4","#FF2020"]);for(r=1;mn>r;r++)e="pos-charge-shading-"+r,a=r/mn,t=l.createRadialGradient(e,s(a),u(a),c(a),Zt),pn[r]=t,e="neg-charge-shading-"+r,a=r/mn,t=l.createRadialGradient(e,d(a),h(a),p(a),Zt),fn[r]=t;l.createRadialGradient("green-grad","#dfffef","#75a643","#2a7216",Zt),l.createRadialGradient("orange-grad","#F0E6D1","#E0A21B","#AD7F1C",Zt)}function m(e,t,n){if(!t||"none"===t)return"none";var r,i,o="Arrowhead-path"+e+"-"+t.toLowerCase().replace(/[^a-z0-9]/g,"")+(n?"-start":"");return r=Zt.select("defs"),r.empty()&&(r=Zt.append("defs")),i=r.select("#"+o),i.remove(),i=r.append("marker").attr("id",o).attr("viewBox","0 0 10 10").attr("refX","5").attr("refY","5").attr("markerUnits","strokeWidth").attr("markerWidth","4").attr("markerHeight","4").attr("orient","auto"),i.append("path").attr("d",t).attr("fill",yt.visible[e]?yt.lineColor[e]:"transparent").attr("transform",n?"translate(10, 10) rotate(180)":""),"url(#"+o+")"}function g(e,t){var n,r,i="Triangle-"+t;n=Zt.select("defs"),n.empty()&&(n=Zt.append("defs")),r=n.select("#"+i).remove(),r=n.append("marker").attr("id","Triangle-"+t).attr("viewBox","0 0 10 10").attr("refX","0").attr("refY","5").attr("markerUnits","strokeWidth").attr("markerWidth","4").attr("markerHeight","3").attr("orient","auto").attr("stroke",e).attr("fill",e),r.append("path").attr("d","M 0 0 L 10 5 L 0 10 z")}function v(){var e,t;e=Zt.select("defs"),e.empty()&&(e=Zt.append("defs")),t=e.select("#glow"),t.empty()&&(t=e.append("filter").attr("id","glow").attr("x","-2").attr("y","-2").attr("width","800%").attr("height","800%"),t.append("feMorphology").attr("result","bigger").attr("in","SourceGraphic").attr("operator","dilate").attr("radius","6"),t.append("feGaussianBlur").attr("result","blurOut").attr("in","bigger").attr("stdDeviation","10"),t.append("feBlend").attr("in","SourceGraphic").attr("in2","blurOut").attr("mode","normal"))}function y(){var e="1%",t=Math.max(ht,12);sn.select("#heat-bath").empty()&&sn.append("image").attr({id:"heat-bath",x:e,width:2*t,height:2*t,preserveAspectRatio:"xMinYMin","xlink:href":"resources/upstatement/heatbath.svg","class":"opaque-on-hover"}).append("title").text("Heatbath active"),sn.select("#ke-gradient").empty()&&sn.append("image").attr({id:"ke-gradient",x:"0",width:2.2*t,height:6*t,preserveAspectRatio:"xMinYMin","xlink:href":"resources/upstatement/ke-gradient.svg","class":"opaque-on-hover"}).append("title").text("Kinetic energy gradient")}function b(){var e,t,n=d.get("temperatureControl"),r=0,i=1,o=Math.max(ht,12);n?(r+=i,e=sn.select("#heat-bath").attr({y:r,width:2*o,height:2*o}).style("display",""),t=parseInt(e.attr("height"),10),r+=t):sn.select("#heat-bath").style("display","none"),wt?(r+=i,sn.select("#ke-gradient").attr({y:r,width:2.2*o,height:6*o}).style("display","")):sn.select("#ke-gradient").style("display","none")}function x(e,t,n,r,i){e.enter().append("path").attr({"class":"vector-"+i,"marker-end":Cn?"":"url(#Triangle-"+i+")",d:t,"stroke-width":n,stroke:r,fill:"none"})}function w(){$t.enter().append("path").attr({"class":"atomTrace",d:H,"stroke-width":ut(.01),stroke:Gt,fill:"none","stroke-dasharray":"6, 6"})}function _(){var e=pt.enter().append("g");e.attr("class","obstacle").attr("transform",function(e,t){return"translate("+ut(ft.x[t])+" "+ct(ft.y[t]+ft.height[t])+")"}),e.append("rect").attr({"class":"obstacle-shape",x:0,y:0,width:function(e,t){return ut(ft.width[t])},height:function(e,t){return ut(ft.height[t])},fill:function(e,t){return ft.visible[t]?l.toSVG(l.parse(ft.color[t]),Zt):"transparent"},"stroke-width":function(e,t){return ft.visible[t]?.2:0},stroke:function(e,t){return ft.visible[t]?l.toSVG(l.parse(ft.color[t]),Zt):"transparent"}}),e.each(function(e,t){if(ft.externalAx[t]||ft.externalAy[t]){var n,r,i=d3.select(this),o=ft.height[t],a=ft.width[t],s=ft.externalAx[t],l=ft.externalAy[t],u=.06,c=.06;s&&(n=(o-2*c)/Math.round((o-2*c)/.2),r=d3.range(c,o,n),i.selectAll("path.obstacle-force-hor").data(r).enter().append("path").attr({"class":"obstacle-force-hor",d:function(e){return 0>s?"M "+ut(a+u+c)+","+ut(e)+" L "+ut(a+c)+","+ut(e):"M "+ut(-u-c)+","+ut(e)+" L "+ut(-c)+","+ut(e)}})),l&&(n=(a-2*c)/Math.round((a-2*c)/.2),r=d3.range(c,a,n),i.selectAll("path.obstacle-force-vert").data(r).enter().append("path").attr({"class":"obstacle-force-vert",d:function(e){return 0>l?"M "+ut(e)+","+ut(-u-c)+" L "+ut(e)+","+ut(-c):"M "+ut(e)+","+ut(o+u+c)+" L "+ut(e)+","+ut(o+c)}})),i.selectAll("path.obstacle-force-hor, path.obstacle-force-vert").attr({"marker-end":Cn?"":"url(#Triangle-"+_n+")","stroke-width":ut(Ot),stroke:Rt,fill:"none"})}})}function T(){var e,t=[gt,vt];for(e=0;e<t.length;e++){var n=t[e].enter().append("g");n.attr("class","shape").attr("transform",function(e){return"translate("+ut(mt.x[e.index])+" "+ct(mt.y[e.index]+mt.height[e.index])+")"}),n.append("rect").attr({"class":"shape-rectangle",x:0,y:0,width:function(e){return ut(mt.width[e.index])},height:function(e){return ut(mt.height[e.index])},fill:function(e){return mt.visible[e.index]&&"rectangle"===mt.type[e.index]?l.toSVG(l.parse(mt.color[e.index]),Zt):"transparent"},"stroke-width":function(e){return mt.lineWeight[e.index]},"stroke-dasharray":function(e){return mt.lineDashes[e.index]},stroke:function(e){return mt.visible[e.index]&&"rectangle"===mt.type[e.index]?mt.lineColor[e.index]:"transparent"}}),n.append("ellipse").attr({"class":"shape-ellipse",cx:function(e){return ut(mt.width[e.index])/2},cy:function(e){return ut(mt.height[e.index])/2},rx:function(e){return ut(mt.width[e.index])/2},ry:function(e){return ut(mt.height[e.index])/2},fill:function(e){return mt.visible[e.index]&&"ellipse"===mt.type[e.index]?l.toSVG(l.parse(mt.color[e.index]),Zt):"transparent"},"stroke-width":function(e){return mt.lineWeight[e.index]},"stroke-dasharray":function(e){return mt.lineDashes[e.index]},stroke:function(e){return mt.visible[e.index]&&"ellipse"===mt.type[e.index]?mt.lineColor[e.index]:"transparent"}})}}function A(){bt.enter().append("line").attr({"class":"line",x1:function(e,t){return ut(yt.x1[t])},y1:function(e,t){return ct(yt.y1[t])},x2:function(e,t){return ut(yt.x2[t])},y2:function(e,t){return ct(yt.y2[t])},"stroke-width":function(e,t){return yt.lineWeight[t]},"stroke-dasharray":function(e,t){return yt.lineDashes[t]},stroke:function(e,t){return yt.visible[t]?yt.lineColor[t]:"transparent"},"marker-start":function(e,t){return m(t,yt.beginStyle[t],!0)},"marker-end":function(e,t){return m(t,yt.endStyle[t])}})}function C(){var e=ut(.02),t=ut(.03)+" "+ut(.02);xt.attr({x1:function(e){return ut(it[e[0]].x)},y1:function(e){return ct(it[e[0]].y)},x2:function(e){return ut(it[e[1]].x)},y2:function(e){return ct(it[e[1]].y)}}),xt.enter().append("line").attr({"class":"attractionforce",x1:function(e){return ut(it[e[0]].x)},y1:function(e){return ct(it[e[0]].y)},x2:function(e){return ut(it[e[1]].x)},y2:function(e){return ct(it[e[1]].y)}}).style({"stroke-width":e,"stroke-dasharray":t}),xt.exit().remove()}function E(e){var t,n,r,i,o,a,s,l,u,c,d=ut(e.fontSize);return t=e.x,n=e.y,e.hostType&&("Atom"===e.hostType?(r=it[e.hostIndex].x,i=it[e.hostIndex].y):(r=ft.x[e.hostIndex]+ft.width[e.hostIndex]/2,i=ft.y[e.hostIndex]+ft.height[e.hostIndex]/2)),e.hostType&&!e.calloutPoint&&(t=r,n=i),e.calloutPoint&&(e.hostType?(u=r,c=i):(u=e.calloutPoint[0],c=e.calloutPoint[1])),s=ut(t),l=ct(n),o=s+.75*d,a=l+1.2*d,u=ut(u),c=ct(c),[o,a,s,l,u,c]}function S(e,t,n,r,i){var o=[parseFloat(e[0]),parseFloat(e[1])],a=[parseFloat(t.getAttribute("x"))+n/2,parseFloat(t.getAttribute("y"))+r/2],s=An-Math.atan((o[0]-a[0])/(o[1]-a[1])),l=Math.min(i,r/2),u=Math.sin(s)*l,c=Math.cos(s)*l;return a[0]+u+", "+(a[1]-c)+" "+(a[0]-u)+", "+(a[1]+c)+" "+o}function k(){var e,t=[an,Yt];e=function(e){var n=t[e-1],r=Dt.filter(function(t){return t.layer===e});n.selectAll("g.textBoxWrapper rect").data(r.filter(function(e){return e.frame})).attr({x:function(e){return E(e)[2]},y:function(e){return E(e)[3]},transform:function(e){var t=e.rotate,n=E(e);return"rotate("+t+" "+n[0]+" "+n[1]+")"}}),n.selectAll("g.textBoxWrapper text").data(r).attr({y:function(e){return $(this).find("tspan").attr("x",E(e)[0]),E(e)[1]}}),n.selectAll("g.textBoxWrapper polygon").data(r.filter(function(e){return e.calloutPoint})).attr({"callout-location-data":function(e){var t=E(e);return t[4]+", "+t[5]}})},e(1),e(2),$(".textBox").each(function(){var e,t,n,r,i=$(this.parentNode),o=i.find("polygon"),a=i.find("rect")[0];a&&0!==o.length&&(e=parseFloat(this.getAttributeNS(null,"font-size")),t=a.getAttribute("width"),n=a.getAttribute("height"),r=o.attr("callout-location-data").split(", "),o.attr("points",S(r,a,t,n,e)))})}function P(){var e,r,i,o="Chrome"===Tn.browser&&Tn.oscpu.indexOf("OS X")>0;Dt=d.get("textBoxes"),e=[d.get("width"),d.get("height")],r=[an,Yt],i=function(i){var a,s,l,u=r[i-1];u.selectAll("g.textBoxWrapper").remove(),s=Dt.filter(function(e){return e.layer===i}),l=u.selectAll("g.textBoxWrapper").data(s),a=l.enter().append("svg:g").attr("class","textBoxWrapper"),a.filter(function(e){return e.calloutPoint}).append("polygon").attr({points:"0,0 0,0 0,0",style:function(e){var t=e.backgroundColor,n=e.strokeWidthEms*ht,r=e.strokeOpacity;return"fill:"+t+";opacity:1.0;fill-opacity:1;stroke:#000000;stroke-width:"+2*n+";stroke-opacity:"+r},"callout-location-data":function(e){var t=E(e);return t[4]+", "+t[5]}}),a.filter(function(e){return e.frame}).append("rect").attr({"class":function(e,t){return"textBoxFrame text-"+t},id:function(e,t){return"text-"+t},transform:function(e){var t=e.rotate,n=E(e);return"rotate("+t+" "+n[0]+" "+n[1]+")"},style:function(e){var t=e.backgroundColor,n=e.strokeWidthEms*ht,r=e.strokeOpacity;return o&&1>n&&(r*=n,n=1),"fill:"+t+";opacity:1.0;fill-opacity:1;stroke:#000000;stroke-width:"+n+";stroke-opacity:"+r},width:0,height:0,rx:function(e){return"rounded rectangle"===e.frame?ut(e.fontSize)/2.5:0},ry:function(e){return"rounded rectangle"===e.frame?ut(e.fontSize)/2:0},x:function(e){return E(e)[2]},y:function(e){return E(e)[3]}}),a.filter(function(e){return e.calloutPoint}).append("polygon").attr({points:"0,0 0,0 0,0",style:function(e){var t=e.backgroundColor;return"fill:"+t+";opacity:1.0;fill-opacity:1;stroke:#000000;stroke-width:0;"}}),a.append("text").attr({"class":function(){return"textBox"+(AUTHORING?" draggable":"")},transform:function(e){var t=e.rotate,n=E(e);return"rotate("+t+" "+n[0]+" "+n[1]+")"},"x-data":function(e){return E(e)[0]},y:function(e){return E(e)[1]},"width-data":function(e){return e.width},"height-data":function(e){return e.height},width:ut(e[0]),height:ut(e[1]),"xml:space":"preserve","font-family":"'"+t.fontface+"', sans-serif","font-size":function(e){return ut(e.fontSize)+"px"},fill:function(e){return e.color||"black"},"text-data":function(e){return e.text},"text-anchor":function(e){var t=e.textAlign||"left";return"center"===t&&(t="middle"),t},"has-host":function(e){return!!e.hostType}}).call(d3.behavior.drag().on("drag",X).on("dragend",function(e){n.log('"x": '+e.x+","),n.log('"y": '+e.y+",")})),l.exit().remove()},i(1),i(2),$(".textBox").each(function(){var e,t,n,r,i,o,a,l,u,c,d,h=this.getAttributeNS(null,"text-data"),p=this.getAttributeNS(null,"x-data"),f=this.getAttributeNS(null,"width-data"),m=this.getAttributeNS(null,"height-data"),g=parseFloat(this.getAttributeNS(null,"font-size")),v=this.getAttributeNS(null,"transform"),y=this.getAttributeNS(null,"has-host"),b=this.getAttributeNS(null,"text-anchor"),x=$(this.parentNode);for(a=1.2*g,e=1.5*+g,t=g/1.8,f=""===f?-1:ut(f),m=""===m?-1:ut(m);this.firstChild;)this.removeChild(this.firstChild);n=s(h,this,f,p,a),x.find("rect").length>0&&(o=x.find("rect")[0],r=n.width+e,o.setAttributeNS(null,"width",r),i=m>0?m:n.lines*a+t,o.setAttributeNS(null,"height",i)),c=x.find("polygon"),o&&c.length>0&&(d=c.attr("callout-location-data").split(", "),c.attr("points",S(d,o,r,i,g))),"middle"===b&&(l=n.width/2,u=m>0?m/2-1.5*t-(n.lines-1)*a/2:0,v=v+" translate("+l+","+u+")",$(this).attr("transform",v)),"true"===y&&0===c.length&&(l=n.width/-2-e/2,u=n.lines*a/-2-t/2,x.attr("transform","translate("+l+","+u+")"))})}function R(){ft=d.get_obstacles(),Zt.selectAll("g.obstacle").remove(),ft&&(gn.length=ft.x.length,pt=Zt.selectAll("g.obstacle").data(gn),_())}function O(){if(mt=d.get_shapes(),nn.selectAll(".shape").remove(),zt.selectAll(".shape").remove(),mt){vn=[],yn=[];for(var e=0;e<mt.x.length;e++)1===mt.layer[e]?vn.push({index:e,layerPosition:mt.layerPosition[e]}):yn.push({index:e,layerPosition:mt.layerPosition[e]});vn.sort(function(e,t){return e.layerPosition-t.layerPosition}),yn.sort(function(e,t){return e.layerPosition-t.layerPosition}),gt=nn.selectAll(".shape").data(vn),vt=zt.selectAll(".shape").data(yn),T()}}function M(){yt=d.get_lines(),rn.selectAll(".line").remove(),yt&&(bn.length=yt.x1.length,bt=rn.selectAll(".line").data(bn),A())}function N(){Kt.selectAll("line.attractionforce").remove(),I(),Tt=d.get("showVDWLines"),Tt&&(xt=Kt.selectAll("line.attractionforce").data(xn),C())}function I(){for(var e=d.get_vdw_pairs(),t=0;t<e.count;t++)xn[t]=[e.atom1[t],e.atom2[t]];xn.splice(e.count)}function L(){Zt.selectAll("path.vector-"+wn).remove(),Zt.selectAll("path.vector-"+_n).remove(),At=d.get("showVelocityVectors"),Pt=d.get("showForceVectors"),At&&(It=Zt.selectAll("path.vector-"+wn).data(it),x(It,G,j,Et,wn)),Pt&&(Lt=Zt.selectAll("path.vector-"+_n).data(it),x(Lt,U,q,Rt,_n))}function B(){var e,t,n=d.get("electricFieldDensity"),r=d.get("showElectricField");Ct=r&&n>0,Bt=Ht.selectAll(".vector-electric-field").data(r?d.getElectricField():[]),Bt.exit().remove(),Ct&&(Bt.enter().append("g").attr("class","vector-electric-field").append("g").attr("class","rot-g").append("svg").attr("viewBox","-5 -12 10 12").append("path").attr("d","M0,0 L0,-8 L1,-8 L0,-10 L-1,-8, L0,-8"),e=d.get("electricFieldColor"),"auto"===e&&(e=u.contrastingColor(d.get("backgroundColor"))),Bt.attr("transform",function(e){return"translate("+ut(e.x)+", "+ct(e.y)+")"}).style("fill",e).style("stroke",e),t=Math.sqrt(30/n),Bt.select("svg").attr("x",-.5*t+"em").attr("y",-t+"em").attr("width",t+"em").attr("height",t+"em"),Bt=Bt.select(".rot-g"),D())}function D(){var e=180/Math.PI;Bt.attr("transform",function(t){return"rotate("+Math.atan2(t.fx,t.fy)*e+")"}).style("opacity",function(e){return Math.min(1,.3*Math.pow(e.fx*e.fx+e.fy*e.fy,.2))})}function F(){Zt.selectAll("path.atomTrace").remove(),Ut="",Ft=d.get("showAtomTrace"),Vt=d.get("atomTraceId"),Ft&&($t=Zt.selectAll("path.atomTrace").data([it[Vt]]),w())}function V(){I(),xt=Kt.selectAll("line.attractionforce").data(xn),C()}function G(e){var t=ut(e.x),n=ct(e.y),r="M "+t+","+n,i=100*kt;return r+" L "+(t+ut(e.vx*i))+","+(n-ut(e.vy*i))}function U(e){var t=ut(e.x),n=ct(e.y),r=e.mass,i=100*Mt*r;return Nt&&(r*=r,i/=1e3*Math.sqrt(e.ax*e.ax*r+e.ay*e.ay*r)||1),"M"+t+","+n+"L"+(t+ut(e.ax*i))+","+(n-ut(e.ay*i))}function j(e){return Math.abs(e.vx)+Math.abs(e.vy)>1e-6?ut(St):0}function q(e){return Math.abs(e.ax)+Math.abs(e.ay)>1e-8?ut(Ot):0}function W(e,t,n){e.attr({d:t,"stroke-width":n})}function H(e){var t,n,r=Math.floor(100*ut(e.x))/100,i=Math.floor(100*ct(e.y))/100;return Ut?(Ut+=r+","+i+" ",Ut.length>4e3&&(t=Ut.indexOf("L"),n=Ut.indexOf(" "),Ut="M"+Ut.slice(t+1,n)+"L"+Ut.slice(n+1)),Ut):(Ut="M"+r+","+i+"L","M "+r+","+i)}function z(){$t.attr({d:H})}function X(e){var t=ut.invert(d3.event.dx),n=ut.invert(d3.event.dy);AUTHORING&&d.isStopped()&&(e.x=e.x+t,e.y=e.y-n,k())}function Y(){var t,n,i,o,a=r.what_browser();"Firefox"===a.browser&&a.version>="18"&&a.version<"23"&&(t=$("#firefox-warning-pane"),n=e.pos(),i=n.bottom-t.height(),o=n.right-t.width(),t.css({display:"inline",top:i-5,left:o-15,"z-index":100}))}function K(){Et=d.get("velocityVectors").color,St=d.get("velocityVectors").width,kt=d.get("velocityVectors").length,Rt=d.get("forceVectors").color,Ot=d.get("forceVectors").width,Mt=d.get("forceVectors").length,Nt=d.get("forceVectorsDirectionOnly"),g(Et,wn),g(Rt,_n),Gt=d.get("atomTraceColor")}function J(){_t=d.properties.useQuantumDynamics,_t&&v(),y(),f(),dt=new a(e,d)}function Z(e){var t,n=[],r=40,i=d3.svg.line().x(function(e){return ut(.5/r*e.x)}).y(function(e){return ut(.1*e.y)}),o=2*e.angularFrequency*Math.PI/r;for(t=0;r>t;t++)n.push({x:t-r/2,y:Math.sin(t*o)/(1+.01*(t-.5*r)*(t-.5*r))});return i(n)}function Q(){var e=Zt.selectAll(".photon").data(d.getPhotons(),function(e){return e.id});e.enter().append("path").attr({"class":"photon",d:Z,"stroke-width":.5,stroke:"rgba(0,0,0,0.8)","fill-opacity":0}),e.exit().remove(),e.attr("transform",function(e){return"translate("+ut(e.x)+", "+ct(e.y)+") rotate("+e.angle+")"})}function et(){function t(t){return function(){t(),e.updateClickHandlers()}}ut=e.model2px,ct=e.model2pxInv,ht=e.getFontSizeInPixels(),it=d.getAtoms(),ot=d.get_elements(),at=d.get("width"),st=d.get("height"),lt=at/st,J(),d.addPropertiesListener(["temperatureControl"],b),d.addPropertiesListener(["chargeShading","showChargeSymbols","useThreeLetterCode","showVDWLines","VDWLinesCutoff","showVelocityVectors","showForceVectors","showAtomTrace","atomTraceId","aminoAcidColorScheme","backgroundColor","markColor","forceVectorsDirectionOnly"],t(nt)),d.addPropertiesListener(["electricFieldDensity","showElectricField","electricFieldColor"],B),d.on("addAtom",t(function(){ln.setup(),e.renderCanvas()})),d.on("removeAtom",t(function(){ln.setup(),e.renderCanvas()})),d.on("addRadialBond",t(function(){un.setup(),e.renderCanvas()})),d.on("removeRadialBond",t(function(){un.setup(),e.renderCanvas()})),d.on("textBoxesChanged",t(P)),d.on("imagesChanged",t(cn.setup)),d.on("addElectricField",B),d.on("removeElectricField",B),d.on("changeElectricField",B),Y(),qt=!0}function tt(e){d=e,ln.bindModel(e),un.bindModel(e),cn.bindModel(e),et()}function nt(t,n){arguments.length&&(ut=t,ct=n),ht=e.getFontSizeInPixels(),K(),p(),R(),N(),ln.setup(),un.setup(),O(),M(),dt.setup(),L(),B(),F(),cn.setup(),P(),b(),Y(),_t&&Q()}function rt(){n.time("view update"),ft&&pt.attr("transform",function(e,t){return"translate("+ut(ft.x[t])+" "+ct(ft.y[t]+ft.height[t])+")"}),mt&&(gt.attr("transform",function(e){return"translate("+ut(mt.x[e.index])+" "+ct(mt.y[e.index]+mt.height[e.index])+")"}),vt.attr("transform",function(e){return"translate("+ut(mt.x[e.index])+" "+ct(mt.y[e.index]+mt.height[e.index])+")"})),Tt&&V(),ln.update(),un.update(),At&&W(It,G,j),Pt&&W(Lt,U,q),Ct&&D(),Ft&&z(),d.properties.images&&0!==d.properties.images.length&&cn.update(),Dt&&Dt.length>0&&k(),_t&&Q(),n.timeEnd("view update")}var it,ot,at,st,lt,ut,ct,dt,ht,pt,ft,mt,gt,vt,yt,bt,xt,wt,_t,Tt,At,Ct,Et,St,kt,Pt,Rt,Ot,Mt,Nt,It,Lt,Bt,Dt,Ft,Vt,Gt,$t,Ut,jt={},qt=!1,Wt=e.appendViewport().classed("below-atoms",!0),Ht=Wt.append("g").attr("class","field-visualization"),zt=Wt.append("g").attr("class","shape-container-below"),Xt=Wt.append("g").attr("class","image-container-below"),Yt=Wt.append("g").attr("class","text-container-below"),Kt=Wt.append("g").attr("class","vdw-lines-container"),Jt=e.appendViewport().classed("atoms",!0),Zt=Jt.append("g").attr("class","atoms-container"),Qt=e.appendPixiViewport(),en=e.appendPixiViewport(!0),tn=e.appendViewport().classed("above-atoms",!0),nn=tn.append("g").attr("class","shape-container-top"),rn=tn.append("g").attr("class","line-container-top"),on=tn.append("g").attr("class","image-container-top"),an=tn.append("g").attr("class","text-container-top"),sn=e.foregroundContainer.append("g").attr("class","icon-container"),ln=new i(e,d,en.pixiContainer,en.canvas),un=new o(e,d,Qt.pixiContainer,ln),cn=new c(e,d,{below:Xt,above:on}),dn=[],hn=25,pn=[],fn=[],mn=25,gn=[],vn=[],yn=[],bn=[],xn=[],wn="velocity",_n="force",Tn=r.what_browser(),An=Math.PI/2,Cn="MSIE"===Tn.browser&&Number(Tn.version)>=10;return jt={setup:function(){qt||et()},update:function(){qt&&rt()},repaint:function(){qt&&nt()},bindModel:tt}}}),define("models/md2d/views/view",["require","common/views/svg-container","models/md2d/views/renderer"],function(e){var t=e("common/views/svg-container"),n=e("models/md2d/views/renderer");return function(e,r){return new t(e,r,n)}}),define("models/md2d/views/dna-edit-dialog",[],function(){return function(e){var t,n,r,i,o,a=function(){n=$("<div></div>"),r=$('<input type="text" id="dna-sequence-input" size="55"></input>'),r.appendTo(n),i=$('<p class="error"></p>'),i.appendTo(n),n.dialog({dialogClass:"dna-edit-dialog",appendTo:"#responsive-content",title:"DNA Code on Sense Strand",autoOpen:!1,width:"35em",buttons:{Apply:function(){e.set({DNA:r.val()}),$(this).dialog("close")}}}),o=$(".dna-edit-dialog button:contains('Apply')"),r.on("input",function(){try{e.getPropertyValidateFunc("DNA")(r.val()),o.button("enable"),i.text("")}catch(t){o.button("disable"),i.text(t.message)}})};return t={open:function(){i.text(""),o.removeAttr("disabled"),r.val(e.get("DNA")),n.dialog("open")}},a(),t}}),define("models/md2d/controllers/scripting-api",["require","models/md2d/views/dna-edit-dialog"],function(e){var t=e("models/md2d/views/dna-edit-dialog");return function(e,n){var r=new t(n),i=0,o=function(){var t,n=arguments[0],r=arguments[1];Array.isArray(r)?(t=Array.prototype.slice.call(arguments,2,arguments.length),e.batch(function(){for(var e=0,i=r[0];e<r.length;i=r[++e])n.apply(null,Array.prototype.concat(i,t))})):(t=Array.prototype.slice.call(arguments,1,arguments.length),n.apply(null,t)),e.repaintIfReady()};return{getCurrentComputerTime:function(){return Date.now()},getNumberOfAtoms:function(e){return n.getNumberOfAtoms(e)},getNumberOfObstacles:function(){return n.getNumberOfObstacles()},getNumberOfElements:function(){return n.getNumberOfElements()},getNumberOfRadialBonds:function(){return n.getNumberOfRadialBonds()},getNumberOfAngularBonds:function(){return n.getNumberOfAngularBonds()},addAtom:function(e){return n.addAtom(e)},removeAtom:function(e,t){try{n.removeAtom(e,t)}catch(r){if(!t||!t.silent)throw r}},removeRadialBond:function(t,r){try{n.removeRadialBond(t)}catch(i){if(!r||!r.silent)throw i}e.repaintIfReady()},removeAngularBond:function(t,r){try{n.removeAngularBond(t)}catch(i){if(!r||!r.silent)throw i}e.repaintIfReady()},addRandomAtom:function(){return n.addRandomAtom.apply(n,arguments)},adjustTemperature:function(e){n.set({targetTemperature:e*n.get("targetTemperature")})},setTemperatureOfAtoms:function(e,t){n.setTemperatureOfAtoms(e,t)},getTemperatureOfAtoms:function(e){return n.getTemperatureOfAtoms(e)},limitHighTemperature:function(e){n.get("targetTemperature")>e&&n.set({targetTemperature:e})},randomAtoms:function(t){var r=n.getNumberOfAtoms();if(null===t&&(t=1+e.randomInteger(r-1)),!e.isInteger(t))throw new Error("randomAtoms: number of atoms requested, "+t+", is not an integer.");if(0>t)throw new Error("randomAtoms: number of atoms requested, "+t+", was less be greater than zero.");return t>r&&(t=r),e.choose(t,r)},turnOnLightSource:function(){n.turnOnLightSource()},turnOffLightSource:function(){n.turnOffLightSource()},setLightSourceAngle:function(e){n.setLightSourceAngle(e)},setLightSourceFrequency:function(e){n.setLightSourceFrequency(e)},setLightSourcePeriod:function(e){n.setLightSourcePeriod(e)},setLightSourceNumber:function(e){n.setLightSourceNumber(e)},atomsWithinCircle:function(e,t,r,i){var o,a,s,l,u=[];for(s=0,l=n.getNumberOfAtoms();l>s;s++)o=n.getAtomProperties(s),("undefined"==typeof i||o.element===i)&&(a=Math.sqrt(Math.pow(e-o.x,2)+Math.pow(t-o.y,2)),r>=a&&u.push(s));return u},atomsWithinRect:function(e,t,r,i,o){var a,s,l,u,c,d,h=[];for(c=0,d=n.getNumberOfAtoms();d>c;c++)a=n.getAtomProperties(c),("undefined"==typeof o||a.element===o)&&("undefined"==typeof i?(s=Math.sqrt(Math.pow(e-a.x,2)+Math.pow(t-a.y,2)),r>=s&&h.push(c)):(l=a.x>=e&&a.x<=e+r,u=a.y>=t&&a.y<=t+i,l&&u&&h.push(c)));return h},atomsWithinTriangle:function(e,t,r,i,o,a,s){function l(n,s){var l=[o-e,a-t],u=[r-e,i-t],c=[n-e,s-t],d=l[0]*l[0]+l[1]*l[1],h=l[0]*u[0]+l[1]*u[1],p=l[0]*c[0]+l[1]*c[1],f=u[0]*u[0]+u[1]*u[1],m=u[0]*c[0]+u[1]*c[1],g=1/(d*f-h*h),v=(f*p-h*m)*g,y=(d*m-h*p)*g;
return v>=0&&y>=0&&1>v+y}var u,c,d,h=[];for(c=0,d=n.getNumberOfAtoms();d>c;c++)u=n.getAtomProperties(c),("undefined"==typeof s||u.element===s)&&l(u.x,u.y)&&h.push(c);return h},markAtoms:function(t){var r,i;if(0!==arguments.length){for(e.isArray(arguments[0])||(t=arguments),e.unmarkAllAtoms(),r=0,i=t.length;i>r;r++)n.setAtomProperties(t[r],{marked:1});e.repaintIfReady()}},unmarkAllAtoms:function(){for(var t=0,r=n.getNumberOfAtoms();r>t;t++)n.setAtomProperties(t,{marked:0});e.repaintIfReady()},traceAtom:function(e){null!==e&&(n.set({atomTraceId:e}),n.set({showAtomTrace:!0}))},untraceAtom:function(){n.set({showAtomTrace:!1})},setAtomProperties:function(e,t,r,i){o(n.setAtomProperties,e,t,r,i)},atomTransition:function(){return n.atomTransition()},getAtomProperties:function(e){return n.getAtomProperties(e)},getRadialBondsForAtom:function(e){return n.getRadialBondsForAtom(e)},getAngularBondsForAtom:function(e){return n.getAngularBondsForAtom(e)},getMoleculeAtoms:function(e){return n.getMoleculeAtoms(e)},setElementProperties:function(e,t){o(n.setElementProperties,e,t)},setPairwiseLJProperties:function(e,t,r){n.getPairwiseLJProperties().set(e,t,r)},getElementProperties:function(e){return n.getElementProperties(e)},addObstacle:function(t,r){try{n.addObstacle(t)}catch(i){if(!r||!r.silent)throw i}e.repaintIfReady()},setObstacleProperties:function(e,t){o(n.setObstacleProperties,e,t)},getObstacleProperties:function(e){return n.getObstacleProperties(e)},removeObstacle:function(t,r){try{n.removeObstacle(t)}catch(i){if(!r||!r.silent)throw i}e.repaintIfReady()},setShapeProperties:function(e,t){o(n.setShapeProperties,e,t)},getShapeProperties:function(e){return n.getShapeProperties(e)},setLineProperties:function(e,t){o(n.setLineProperties,e,t)},getLineProperties:function(e){return n.getLineProperties(e)},addElectricField:function(e,t){try{n.addElectricField(e)}catch(r){if(!t||!t.silent)throw r}},removeElectricField:function(e,t){try{n.removeElectricField(e)}catch(r){if(!t||!t.silent)throw r}},setElectricFieldProperties:function(e,t){n.setElectricFieldProperties(e,t)},getElectricFieldProperties:function(e){return n.getElectricFieldProperties(e)},getAtomsWithinShape:function(e){var t=n.getShapeProperties(e);return this.atomsWithinRect(t.x,t.y,t.width,t.height)},removeShape:function(t,r){try{n.removeShape(t)}catch(i){if(!r||!r.silent)throw i}e.repaintIfReady()},removeLine:function(t,r){try{n.removeLine(t)}catch(i){if(!r||!r.silent)throw i}e.repaintIfReady()},setRadialBondProperties:function(t,r){n.setRadialBondProperties(t,r),e.repaintIfReady()},getRadialBondProperties:function(e){return n.getRadialBondProperties(e)},setAngularBondProperties:function(t,r){n.setAngularBondProperties(t,r),e.repaintIfReady()},getAngularBondProperties:function(e){return n.getAngularBondProperties(e)},openDNADialog:function(){r.open()},jumpToNextDNAState:function(){n.geneticEngine().jumpToNextState()},jumpToPrevDNAState:function(){n.geneticEngine().jumpToPrevState()},DNAStateBefore:function(e){return n.geneticEngine().stateBefore(e)},DNAStateAfter:function(e){return n.geneticEngine().stateAfter(e)},animateToNextDNAState:function(){n.geneticEngine().transitionToNextState()},animateToDNAState:function(e){n.geneticEngine().transitionTo(e)},stopDNAAnimation:function(){n.geneticEngine().stopTransition()},transcribeDNAStep:function(e){var t=n.geneticEngine();t.stateBefore("dna")||t.stateAfter("transcription-end")?(n.set("DNAState","dna"),t.transitionTo("transcription:0"),t.transcribeStep(e)):"transcription-end"!==n.get("DNAState")&&t.transcribeStep(e)},translateDNAStep:function(){var e=n.geneticEngine();e.stateBefore("translation:0")||e.stateAfter("translation-end")?(n.set("DNAState","translation:0"),e.transitionTo("translation:1")):"translation-end"!==n.get("DNAState")&&e.transitionToNextState()},generateRandomProtein:function(e){var t=n.geneticEngine().generateProtein(void 0,e);if(t!==e)throw new Error("Generated protein was truncated due to limited area of the model. Only"+t+" amino acids were generated.")},setSolvent:function(e){n.setSolvent(e)},pe:function(){return n.get("potentialEnergy")},ke:function(){return n.get("kineticEnergy")},atomsKe:function(e){var t,r=0;for(t=0;t<e.length;t++)r+=n.getAtomKineticEnergy(e[t]);return r},minimizeEnergy:function(){n.minimizeEnergy(),e.repaintIfReady()},addTextBox:function(e){n.addTextBox(e)},removeTextBox:function(e){n.removeTextBox(e)},setTextBoxProperties:function(e,t){o(n.setTextBoxProperties,e,t)},getTextBoxProperties:function(e){return n.getTextBoxProperties(e)},getNumberOfTextBoxes:function(){return n.getNumberOfTextBoxes()},getNumberOfLines:function(){return n.getNumberOfLines()},getImageProperties:function(e){return n.getImageProperties(e)},setImageProperties:function(e,t){o(n.setImageProperties,e,t)},repaintIfReady:function(){0===i&&e.repaint()},batch:function(t){++i,n.startBatch(),t(),n.endBatch(),--i,e.repaintIfReady()}}}}),define("models/md2d/benchmarks/benchmarks",["require","common/performance"],function(e){var t=e("common/performance"),n=5e3,r=1e3;return function(e){var i,o=e.model;return[{name:"atoms",numeric:!0,run:function(e){e(o.getNumberOfAtoms())}},{name:"temperature",numeric:!0,formatter:d3.format("5.1f"),run:function(e){e(o.get("temperature"))}},{name:"engine (ms)",numeric:!0,formatter:d3.format("5.1f"),run:function(e){o.start(),setTimeout(function(){o.stop(),t.collectData(!0),i=o.stepCounter(),setTimeout(function(){o.start(),setTimeout(function(){o.stop(),t.collectData(!1),e(t.getAvgTime("engine"))},n)},100)},r)}},{name:"JS rendering (ms)",numeric:!0,formatter:d3.format("5.1f"),run:function(e){e(t.getAvgTime("js-rendering"))}},{name:"tick (ms)",numeric:!0,formatter:d3.format("5.1f"),run:function(e){e(t.getAvgTime("tick"))}},{name:"gap b/w frames (ms)",numeric:!0,formatter:d3.format("5.1f"),run:function(e){e(t.getAvgTime("gap"))}},{name:"fps",numeric:!0,formatter:d3.format("5.1f"),run:function(e){e(1e3*(o.stepCounter()-i)/n)}},{name:"interactive",numeric:!1,run:function(e){e(window.location.pathname+window.location.hash)}}]}}),define("models/md2d/controllers/controller",["require","common/controllers/model-controller","models/md2d/models/modeler","models/md2d/views/view","models/md2d/controllers/scripting-api","models/md2d/benchmarks/benchmarks"],function(e){var t=e("common/controllers/model-controller"),n=e("models/md2d/models/modeler"),r=e("models/md2d/views/view"),i=e("models/md2d/controllers/scripting-api"),o=e("models/md2d/benchmarks/benchmarks");return function(e,a,s){return new t(e,a,s,n,r,i,o)}}),define("models/solar-system/models/engine/constants/units",["require","exports","module"],function(e,t){var n,r,i,o=86400,a=149597870700,s=5.97219e24,l=332946,u={TIME:"time",LENGTH:"length",MASS:"mass",ENERGY:"energy",POWER:"power",FORCE:"force",VELOCITY:"velocity",ACCELERATION:"acceleration",GRAVITATIONAL_CONSTANT:"Gravitational Constant",AREA:"area",VOLUME:"volume",PRESSURE:"pressure"};t.unit=n={DAY:{name:"Day",value:1,type:u.TIME},SECOND:{name:"second",value:o,type:u.TIME},AU:{name:"au",value:1,type:u.LENGTH},METER:{name:"meter",value:a,type:u.LENGTH},EARTH_MASS:{name:"Earth Mass",value:1,type:u.MASS},KILOGRAM:{name:"kilogram",value:s,type:u.MASS},SOLAR_MASS:{name:"Solar Mass",value:l,type:u.MASS},JOULE:{name:"Joule",value:1/s*(1/a)*(1/a)/(1/o*(1/o)),type:u.ENERGY},WATT:{name:"Watt",value:1/s*(1/a)*(1/a)/(1/o*(1/o)*(1/o)),type:u.POWER},NEWTON:{name:"Newton",value:1,type:u.FORCE},METERS_PER_SECOND:{name:"meters per second",value:1/a*o,type:u.VELOCITY},METERS_PER_SECOND_PER_SECOND:{name:"meters per second per second",value:1/a*o*o,type:u.ACCELERATION},METERS_CUBED_PER_KILOGRAMS_TIMES_TIME_SQUARED:{name:"meters cubed per kilograms times second squared",value:1/a*(1/a)*(1/a)/(1/s*o*o),type:u.ACCELERATION},ASTRONOMICAL_FORCE:{name:" in Astronomical units (Earth Mass, AU, Day)",value:1*s,type:u.GRAVITATIONAL_CONSTANT},SI_GC:{name:"gravitational constant of proprtionality in SI units (kg, m, s)",value:1,type:u.GRAVITATIONAL_CONSTANT},ASTRONOMICAL_GC:{name:"gravitational constant of proprtionality in Astronomical units (Earth Mass, AU, Day)",value:1*s*o*o/(a*a*a),type:u.GRAVITATIONAL_CONSTANT}},t.ratio=r=function(e,t){var n=function(e,t){if(e.type!==t.type)throw new Error("Attempt to convert incompatible type '"+e.name+"'' to '"+t.name+"'")};if(t.per)return n(e,t.per),e.value/t.per.value;if(t.as)return n(e,t.as),t.as.value/e.value;throw new Error("units.ratio() received arguments it couldn't understand.")},t.convert=i=function(e,t){var n=t&&t.from,i=t&&t.to;if(!n)throw new Error('units.convert() did not receive a "from" argument');if(!i)throw new Error('units.convert() did not receive a "to" argument');return e*r(i,{per:n})}}),define("models/solar-system/models/engine/constants/index",["require","exports","module","./units"],function(e,t){var n,r,i=e("./units"),o=i.unit,a=i.ratio,s=i.convert,l={SOLAR_LUMINOSITY:{value:3.839e26,unit:o.WATT},ASTRONOMICAL_UNIT_DISTANCE:{value:149597870691,unit:o.METER},GRAVITATIONAL_CONSTANT:{value:6.67384e-11,unit:o.SI_GC}};t.unit=o,t.ratio=a,t.convert=s;for(n in l)l.hasOwnProperty(n)&&(r=l[n],t[n]=function(e){return{as:function(t){return i.convert(e.value,{from:e.unit,to:t})}}}(r))}),define("models/solar-system/models/engine/solar-system",["require","exports","module","arrays","common/array-types","./constants/index","common/console","common/models/engines/clone-restore-wrapper"],function(e,t){var n=e("arrays"),r=e("common/array-types"),i=e("./constants/index"),o=(i.unit,e("common/console"),e("common/models/engines/clone-restore-wrapper")),a=i.GRAVITATIONAL_CONSTANT.as(i.unit.ASTRONOMICAL_GC);t.createEngine=function(){var e,t,i,s,u,c,d,h,p,f,m,g,v,y,b,x,w,_=a,T=!1,A=[50,50],C=-25,E=-25,S=25,k=25,P=0,R=0,O=function(){I(0)},M=function(e,t){var r,i;if(Array.isArray(e))for(r=0,i=e.length;i>r;r++)n.isArray(e[r])&&(e[r]=n.extend(e[r],t));else for(r in e)e.hasOwnProperty(r)&&n.isArray(e[r])&&(e[r]=n.extend(e[r],t))},N={bodies:function(){s=b.radius,u=b.x,c=b.y,d=b.vx,h=b.vy,p=b.px,f=b.py,m=b.ax,g=b.ay,v=b.mass,y=b.speed,pinned=b.pinned}},I=function(t){b=e.bodies={},b.radius=n.create(t,0,r.float),b.x=n.create(t,0,r.float),b.y=n.create(t,0,r.float),b.vx=n.create(t,0,r.float),b.vy=n.create(t,0,r.float),b.px=n.create(t,0,r.float),b.py=n.create(t,0,r.float),b.ax=n.create(t,0,r.float),b.ay=n.create(t,0,r.float),b.mass=n.create(t,0,r.floatType),b.speed=n.create(t,0,r.float),b.pinned=n.create(t,0,r.uint8),b.marked=n.create(t,0,r.uint8),b.visible=n.create(t,0,r.uint8),N.bodies()},L=function(e){var t=s[e],n=C+t,r=E+t,i=S-t,o=k-t,a=A[0],l=A[1];if(x)u[e]+s[e]<n?u[e]+=a:u[e]-s[e]>i&&(u[e]-=a);else if(u[e]<n){for(;u[e]<n-a;)u[e]+=a;u[e]=n+(n-u[e]),d[e]*=-1,p[e]*=-1}else if(u[e]>i){for(;u[e]>i+a;)u[e]-=a;u[e]=i-(u[e]-i),d[e]*=-1,p[e]*=-1}if(w)c[e]+s[e]<r?c[e]+=l:c[e]-s[e]>o&&(c[e]-=l);else if(c[e]<r){for(;c[e]<r-l;)c[e]+=l;c[e]=r+(r-c[e]),h[e]*=-1,f[e]*=-1}else if(c[e]>o){for(;c[e]>o+l;)c[e]-=l;c[e]=o-(c[e]-o),h[e]*=-1,f[e]*=-1}},B=function(){var e;if(0!==R){for(e=0;R>e;e++)m[e]=g[e]=0;D()}},D=function(){var e,t,n,r,i,o,a,s;for(e=-1;++e<R;)for(m1=v[e],t=e;++t<R;)n=u[t]-u[e],r=c[t]-c[e],i=n*n+r*r,l=Math.sqrt(i),m2=v[t],o=_*m1*m2/i,a=n/l*o,s=r/l*o,m[e]+=a/m1,g[e]+=s/m1,m[t]-=a/m2,g[t]-=s/m2},F=function(){var e,n;for(e=0;R>e;e++)n=v[e],d[e]+=.5*m[e]*t,p[e]=n*d[e],h[e]+=.5*g[e]*t,f[e]=n*h[e]},V=function(){{var e,n,r;100*A[0],100*A[1]}for(r=0;R>r;r++)e=u[r],n=c[r],u[r]+=d[r]*t,c[r]+=h[r]*t,L(r)},G=function(){var e;for(e=0;R>e;e++)pinned[e]&&(d[e]=h[e]=m[e]=g[e]=0)},$=function(){var e;for(e=0;R>e;e++)y[e]=Math.sqrt(d[e]*d[e]+h[e]*h[e])};return e={setTime:function(e){P=e},setDimensions:function(e){if(T)throw new Error("The SolarSystem model's size has already been set, and cannot be reset.");C=e[0],E=e[1],S=e[2],k=e[3],A=[S-C,k-E],T=!0},getDimensions:function(){return[C,S,E,k]},setHorizontalWrapping:function(e){x=!!e},setVerticalWrapping:function(e){w=!!e},setGravitationalConstant:function(e){_="number"==typeof e&&0!==e?e:a},setBodyProperties:function(e,t){var n;for(n in t)t.hasOwnProperty(n)&&(b[n][e]=t[n]);y[e]=Math.sqrt(d[e]*d[e]+h[e]*h[e])},addBody:function(t){R+1>b.x.length&&(M(b,R+10),N.bodies()),t.ax=t.ay=0,R++,e.setBodyProperties(R-1,t)},removeBody:function(e){var t,n;if(e>=R)throw new Error("Body "+e+" doesn't exist, so it can't be removed.");for(t=e;R>t;t++)for(n in b)b.hasOwnProperty(n)&&(b[n][t]=t===R-1?0:b[n][t+1]);R--,updateParticlesAccelerations()},setupBodiesRandomly:function(){var t,n,r,i,o,a,s,l,u=Math.floor(Math.sqrt(R)),c=Math.ceil(R/u);for(o=A[0]/(1+c),i=A[1]/(1+u),t=-1,n=1;u>=n;n++)for(r=1;c>=r&&(t++,t!==R);r++)a=math.normal(1,.25),s=2*Math.random()*Math.PI,l={x:r*o,y:n*i,mass:5*Math.random(),vx:a*Math.cos(s),vy:a*Math.sin(s)},l.radius=radiusFromMass(l.mass),e.setBodyProperties(t,l)},radiusFromMass:function(e){var t,n=1e3,r=e/n;return t=Math.pow(r/(4/3*Math.PI),1/3)},integrate:function(e,n){var r,o,a=P;for(void 0===e&&(e=100),void 0===n&&(n=.1),t=n,i=t*t,0===P&&B(),r=Math.floor(e/t),o=1;r>=o;o++)P=a+o*t,F(),G(),V(),B(),F(),$()},getNumberOfBodies:function(){return R},computeOutputState:function(e){e.time=P},getState:function(){return[new o(b),{clone:function(){return P},restore:function(t){e.setTime(t)}}]}},O(),e}}),define("models/solar-system/models/metadata",[],function(){return{mainProperties:{type:{defaultValue:"solar-system",immutable:!0},imagePath:{defaultValue:"",immutable:!0},minX:{defaultValue:-25,immutable:!0},maxX:{defaultValue:25,immutable:!0},minY:{defaultValue:-25,immutable:!0},maxY:{defaultValue:25,immutable:!0},width:{defaultValue:50},height:{defaultValue:50},unitsScheme:{defaultValue:"solar-system"},modelSampleRate:{defaultValue:"default"},timeStep:{defaultValue:.1,storeInTickHistory:!0},timeStepsPerTick:{defaultValue:50,storeInTickHistory:!0},horizontalWrapping:{defaultValue:!1},verticalWrapping:{defaultValue:!1}},viewOptions:{viewPortWidth:{unitType:"length",immutable:!0},viewPortHeight:{unitType:"length",immutable:!0},viewPortZoom:{defaultValue:1},viewPortX:{unitType:"length"},viewPortY:{unitType:"length"},viewPortDrag:{defaultValue:!1},showClock:{defaultValue:!0,storeInTickHistory:!0},showBodyTrace:{defaultValue:!1,storeInTickHistory:!0},bodyTraceId:{defaultValue:0,storeInTickHistory:!0},backgroundColor:{defaultValue:"#eeeeee"},bodyTraceColor:{defaultValue:"#ee8833"},markColor:{defaultValue:"#f8b500"},images:{defaultValue:[]},imageMapping:{defaultValue:{}},textBoxes:{defaultValue:[]},fitToParent:{defaultValue:!1},xlabel:{defaultValue:!1},ylabel:{defaultValue:!1},xunits:{defaultValue:!1},yunits:{defaultValue:!1},controlButtons:{defaultValue:"play"},gridLines:{defaultValue:!1},planetNumbers:{defaultValue:!1},enableBodyTooltips:{defaultValue:!1},enableKeyboardHandlers:{defaultValue:!0},planetTraceColor:{defaultValue:"#6913c5"}},body:{x:{required:!0},y:{required:!0},vx:{defaultValue:0},vy:{defaultValue:0},ax:{defaultValue:0,serialize:!1},ay:{defaultValue:0,serialize:!1},mass:{defaultValue:1},radius:{},pinned:{defaultValue:!1},visible:{defaultValue:1},marked:{defaultValue:0},px:{readOnly:!0,serialize:!1},py:{readOnly:!0,serialize:!1},speed:{readOnly:!0,serialize:!1}},textBox:{text:{defaultValue:""},x:{defaultValue:0,unitType:"length"},y:{defaultValue:0,unitType:"length"},anchor:{defaultValue:"lower-left"},layer:{defaultValue:1},width:{},height:{},frame:{},color:{},backgroundColor:{defaultValue:"white"},strokeWidthEms:{defaultValue:.03},strokeOpacity:{defaultValue:1},rotate:{defaultValue:0},fontScale:{defaultValue:1},hostType:{},hostIndex:{},textAlign:{}}}}),define("models/solar-system/models/unit-definitions/solar-system",[],function(){return{name:"solar-system",translated:!1,units:{length:{name:"Astronomical Unit",pluralName:"Astronomical Units",symbol:"AU"},mass:{name:"Earth Mass",pluralName:"Earth Masses",symbol:"M"},time:{name:"day",pluralName:"days",symbol:"D",displayValue:{unitsPerBaseUnit:1,name:"day",pluralName:"days",symbol:"D"}},velocity:{name:"Astronomical Unit per day",pluralName:"Astronomical Units per day",symbol:"AU/D"},acceleration:{name:"Astronomical Unit per day squared",pluralName:"Astronomical Units per day squared",symbol:"AU/D"},momentum:{name:"Earth Mass Astronomical Unit per day",pluralName:"Earth Mass Astronomical Units per day",symbol:"MAU/D"},force:{name:"Earth Mass Astronomical Unit per day squared",pluralName:"Earth Mass Astronomical Units per day squared",symbol:"MAU/D"},energy:{name:"joules",pluralName:"joules",symbol:"J"},temperature:{name:"Kelvin",pluralName:"Kelvin",symbol:"K"},angle:{name:"radian",pluralName:"radians",symbol:"rad"}}}}),define("models/solar-system/models/unit-definitions/index",["require","models/solar-system/models/unit-definitions/solar-system","underscore"],function(e){var t={solarSystem:e("models/solar-system/models/unit-definitions/solar-system")},n=e("underscore");return{get:function(e){var r;return"solar-system"===e?t.solarSystem:(r=n.extend({},t[e]),r.units=n.extend({},t.solarSystem.units,t[e].units),r)}}}),define("models/solar-system/models/modeler",["require","arrays","common/console","common/serialize","common/validator","common/property-support","common/property-description","common/models/tick-history","models/solar-system/models/engine/solar-system","models/solar-system/models/metadata","models/solar-system/models/engine/constants/units","models/solar-system/models/unit-definitions/index","underscore"],function(e){var t=(e("arrays"),e("common/console")),n=e("common/serialize"),r=e("common/validator"),i=e("common/property-support"),o=e("common/property-description"),a=e("common/models/tick-history"),s=e("models/solar-system/models/engine/solar-system"),l=e("models/solar-system/models/metadata"),u=(e("models/solar-system/models/engine/constants/units"),e("models/solar-system/models/unit-definitions/index")),c=e("underscore");return function(e,d){function h(e,t,n){var i,o;if("mainProperty"===e)i=l.mainProperties;else{if("viewOption"!==e)throw new Error(e+" is not a supported built-in property type");i=l.viewOptions}o={type:e,writable:r.propertyIsWritable(i[t]),set:n,includeInHistoryState:!!i[t].storeInTickHistory,validate:function(e){return r.validateSingleProperty(i[t],t,e,!1)}},R.defineProperty(t,o)}function p(e,n){var r=k.get("timeStep");return t.time("integration"),w.integrate(k.get("timeStepsPerTick")*r,r),t.timeEnd("integration"),t.time("reading model state"),f(),t.timeEnd("reading model state"),t.time("tick history push"),x.push(),t.timeEnd("tick history push"),I=!0,n||P.tick(),M}function f(){v(),R.deleteComputedPropertyCachedValues(),D.forEach(function(e){F[e].addSample()}),R.notifyAllComputedProperties()}function m(){L||(B++,0===B&&(R.storeComputedProperties(),R.deleteComputedPropertyCachedValues(),R.enableCaching=!1),B++)}function g(){L||(B--,0===B&&(R.enableCaching=!0),w&&v(),D.forEach(function(e){F[e].addSample()}),0===B&&(R.enableCaching=!0,R.notifyChangedComputedProperties(),x&&x.invalidateFollowingState(),P.invalidation()))}function v(){var e,t,n;for(w.computeOutputState(b),y(),e=0,n=k.get_num_bodies();n>e;e++)for(t in _)_.hasOwnProperty(t)&&(T[e][t]=_[t][e])}function y(){var e,t;for(T||(T=[]),e=T.length,t=k.get_num_bodies();t>e;e++)T[e]||(T[e]={idx:e});T.length=t}this.constructor.type="solar-system";var b,x,w,_,T,A,C,E,S,k={},P=d3.dispatch("tick","play","stop","reset","stepForward","stepBack","seek","addBody","removeBody","invalidation","textBoxesChanged","ready"),R=new i({types:["output","parameter","mainProperty","viewOption"]}),O=1e3,M=!0,N=!1,I=!1,L=!1,B=0,D=[],F={},V=!1,G=function(){var e=[{getNum:"getNumberOfBodies",addEvent:"addBody",removeEvent:"removeBody"}];return function(t){var n,r,i;for(n=0;n<e.length;n++)r=e[n],r.num=w[r.getNum]();for(t(),n=0;n<e.length;n++)r=e[n],i=w[r.getNum](),i>r.num?P[r.addEvent]():i<r.num&&P[r.removeEvent]()}}();return R.mixInto(k),C=k.set,k.set=function(e,t){w&&m(),C(e,t),w&&g()},k.addPropertiesListener=function(e,t){"string"==typeof e?k.addObserver(e,t):e.forEach(function(e){k.addObserver(e,t)})},k.defineOutput=function(e,t,n){R.defineProperty(e,{type:"output",writable:!1,get:n,includeInHistoryState:!1,description:new o(A,t)})},k.defineFilteredOutput=function(e,t,n,r,i){var o,a;if("RunningAverage"!==r)throw new Error("FilteredOutput: unknown filter type "+r+".");if(o=new RunningAverageFilter(i),a=k.get(n),void 0===a||isNaN(Number(a)))throw new Error("FilteredOutput: property is not a valid numeric value or it is undefined.");o.addSample(k.get("time"),a),D.push(e),F[e]={addSample:function(){o.addSample(k.get("time"),k.get(n))}},x.registerExternalObject({push:function(){},extract:function(e){o.setCurrentStep(e)},invalidate:function(e){o.invalidate(e)},setHistoryLength:function(e){o.setMaxBufferLength(e)}}),t.property=n,t.type=r,t.period=i,k.defineOutput(e,t,function(){return o.calculate()})},k.defineParameter=function(e,t,n){var r={type:"parameter",includeInHistoryState:!0,invokeSetterAfterBulkRestore:!1,description:new o(A,t)};n&&(r.set=function(e){n.call(k,e)}),R.defineProperty(e,r)},k.stepCounter=function(){return x.get("counter")},k.stepStartCounter=function(){return x.get("startCounter")},k.steps=function(){return x.get("length")},k.isNewStep=function(){return I},k.seek=function(e){return arguments.length||(e=0),k.isStopped()||k.stop(),I=!1,G(function(){x.seekExtract(e),f(),P.seek()}),x.get("counter")},k.stepBack=function(e){return arguments.length||(e=1),k.isStopped()||k.stop(),I=!1,G(function(){var t,n;for(t=-1;++t<e;)n=x.get("index"),n>0&&(x.decrementExtract(),f(),P.stepBack())}),x.get("counter")},k.stepForward=function(e){return arguments.length||(e=1),k.isStopped()||k.stop(),G(function(){var t,n,r;for(t=-1;++t<e;)n=x.get("index"),r=x.get("length"),r-1>n?(x.incrementExtract(),f(),P.stepForward()):p()}),x.get("counter")},k.initializeDimensions=function(){k.set({width:k.get("maxX")-k.get("minX")}),k.set({height:k.get("maxY")-k.get("minY")})},k.initializeEngine=function(){w=s.createEngine(),w.setDimensions([k.get("minX"),k.get("minY"),k.get("maxX"),k.get("maxY")]),w.setHorizontalWrapping(k.get("horizontalWrapping")),w.setVerticalWrapping(k.get("verticalWrapping")),window.state=b={},_=w.bodies},k.createBodies=function(e){var t,n,r,i,o={supressCheck:!0,deserialization:!0};if(m(),"number"==typeof e?n=e:void 0!==e.num?n=e.num:e.x&&(n=e.x.length),e.x&&e.y)for(t=0;n>t;t++){i={};for(r in e)e.hasOwnProperty(r)&&(i[r]=e[r][t]);i.radius||(i.radius=w.radiusFromMass(e.mass[t])),k.addBody(i,o)}else{for(t=0;n>t;t++)i={x:0,y:0},k.addBody(i,o);w.setupBodiesRandomly()}return g(),P.reset(),k},k.ready=function(){if(V)throw new Error("ready() called on an already-ready model.");x.saveInitialState(),x.push(),R.invalidatingChangePreHook(),V=!0,R.invalidatingChangePostHook(),P.ready()},k.reset=function(){w.setTime(0),x.restoreInitialState(),P.reset()},k.addRandomBody=function(){var e,t,n=k.get("width"),r=k.get("height"),i=k.get("minX"),o=k.get("minY"),a={};return t=10*Math.random(),e=w.radiusFromMass(t),a={x:i+Math.random()*n-2*e,y:o+Math.random()*r-2*e,vx:(Math.random()-.5)/100,vy:(Math.random()-.5)/100,mass:t,radius:e},k.addBody(a),!1},k.addBody=function(e,t){k.get("minX"),k.get("minY"),k.get("maxX"),k.get("maxY");return t=t||{},e=r.validateCompleteness(l.body,e),t.deserialization||m(),w.addBody(e),t.deserialization||g(),t.supressEvent||P.addBody(),!0},k.removeBody=function(e,t){t=t||{},m(),w.removeBody(e),T.length=0,g(),t.supressEvent||P.removeplanet()},k.setBodyProperties=function(e,t,n){if(t=r.validate(l.body,t),n){var i="number"==typeof t.x?t.x:_.x[e],o="number"==typeof t.y?t.y:_.y[e];if(!w.canPlaceplanet(el,i,o,e))return!1}return m(),w.setBodyProperties(e,t),g(),!0},k.getBodyProperties=function(e){var t,n=l.body,r={};for(t in n)n.hasOwnProperty(t)&&(r[t]=_[t][e]);return r},k.addTextBox=function(e){e=r.validateCompleteness(l.textBox,e),k.get("textBoxes").push(e),P.textBoxesChanged()},k.removeTextBox=function(e){var t=k.get("textBoxes");if(!(e>=0&&e<t.length))throw new Error('Text box "'+e+'" does not exist, so it cannot be removed.');k.set("textBoxes",t.slice(0,e).concat(t.slice(e+1))),P.textBoxesChanged()},k.setTextBoxProperties=function(e,t){var n,i=k.get("textBoxes")[e];if(!i)throw new Error('Text box "'+e+'" does not exist, so it cannot have properties set.');t=r.validate(l.textBox,t);for(n in t)t.hasOwnProperty(n)&&(i[n]=t[n]);P.textBoxesChanged()},k.isStopped=function(){return M},k.get_bodies=function(){return _},k.get_results=function(){return T},k.get_num_bodies=function(){return w.getNumberOfBodies()},k.on=function(e,t){return P.on(e,t),k},k.tickInPlace=function(){return P.tick(),k},k.tick=function(e,t){arguments.length||(e=1);for(var n=t&&t.dontDispatchTickEvent||!1,r=-1;++r<e;)p(null,n);return k},k.start=function(){return k.resume()},k.restart=function(){N=!0},k.resume=function(){return t.time("gap between frames"),k.timer(function(e){return t.timeEnd("gap between frames"),M?!0:N?(setTimeout(k.resume,0),!0):(p(e,!1),t.time("gap between frames"),!1)}),N=!1,M&&(M=!1,P.play()),k},k.timer=function(e){var t,n=k.get("modelSampleRate");"default"===n?d3.timer(e):t=window.setInterval(function(){e()&&window.clearInterval(t)},1e3/n)},k.stop=function(){return M=!0,P.stop(),k},k.getUnitDefinition=function(e){return A.units[e]},k.serialize=function(){var e={},t=function(t,n){e.bodies[t].every(function(e){return e===n})&&delete e.bodies[t]};return e=n(l.mainProperties,properties),e.viewOptions=n(l.viewOptions,properties),e.bodies=n(l.body,_,w.getNumberOfBodies()),e.viewOptions.showBodyTrace===!1&&delete e.viewOptions.bodyTraceId,t("marked",l.body.marked.defaultValue),t("visible",l.body.visible.defaultValue),e},function(){if(e.viewOptions&&e.viewOptions.textBoxes){var t,n,i=e.viewOptions.textBoxes;for(t=0,n=i.length;n>t;t++)i[t]=r.validateCompleteness(l.textBox,i[t])}}(),S=r.validateCompleteness(l.viewOptions,e.viewOptions||{}),E=r.validateCompleteness(l.mainProperties,e),A=u.get(E.unitsScheme),function(){var e={modelSampleRate:function(){M||k.restart()}};Object.keys(l.mainProperties).forEach(function(t){h("mainProperty",t,e[t])}),R.setRawValues(E)}(),Object.keys(l.viewOptions).forEach(function(e){h("viewOption",e)}),R.setRawValues(S),k.initializeDimensions(),k.initializeEngine(),e.bodies&&k.createBodies(e.bodies),x=new a({getProperties:function(){return R.historyStateRawValues},restoreProperties:R.setRawValues,state:w.getState()},k,O),I=!0,mainPropertyUnitTypes={},c.each(l.mainProperties,function(e,t){e.unitType&&(mainPropertyUnitTypes[t]={unitType:e.unitType})}),k.defineOutput("time",{label:"Time",unitType:"time",format:"f"},function(){return b.time}),k.defineOutput("timePerTick",{label:"Model time per tick",unitType:"time",format:"f"},function(){return k.get("timeStep")*k.get("timeStepsPerTick")}),function(){var e;A.units.time.displayValue?e=A.units.time.displayValue:(e=c.extend({},A.units.time),e.unitsPerBaseUnit=1),k.defineOutput("displayTime",{label:"Time",unitName:e.name,unitPluralName:e.pluralName,unitAbbreviation:e.symbol,format:".1f"},function(){return k.get("time")*e.unitsPerBaseUnit}),k.defineOutput("displayTimePerTick",{label:"Model time per tick",unitName:e.name,unitPluralName:e.pluralName,unitAbbreviation:e.symbol,format:".3f"},function(){return k.get("timePerTick")*e.unitsPerBaseUnit})}(),k.defineOutput("tickCounter",{label:"Tick Counter",unitType:"",format:"4g"},function(){return x.get("counter")}),k.defineOutput("newStep",{label:"New Step",unitType:"",format:""},function(){return I}),k.defineOutput("isPlayable",{label:"Playable"},function(){return V}),f(),d.waitForSetup||k.ready(),k}}),define("models/solar-system/views/renderer",["require","lab.config","common/console","cs!common/layout/wrap-svg-text","common/views/gradients"],function(e){var t=e("lab.config"),n=e("common/console"),r=(e("cs!common/layout/wrap-svg-text"),e("common/views/gradients"));return function(e,i){function o(){var e,t,n,o;n=i.get("markColor"),e=d3.rgb(n),t=e.brighter(1).toString(),o=e.darker(1).toString(),r.createRadialGradient("mark-grad",t,n,o,J),r.createRadialGradient("neutral-grad","#FFFFFF","#f2f2f2","#A4A4A4",J)}function a(e){return e.marked?"url(#mark-grad)":"url(#neutral-grad)"}function s(){var e,t;for(Z.length=R.length,e=0,t=R.length;t>e;e++)Z[e]=a(R[e])}function l(){J.selectAll("circle").remove(),J.selectAll("g.label").remove(),M=J.selectAll("circle").data(R),c(),N=J.selectAll("g.label").data(R),I=N.enter().append("g").attr("class","label").attr("transform",function(e){return"translate("+k(e.x)+","+P(e.y)+")"}),I.each(function(e){var t,n=d3.select(this);i.get("astromonicalBodyNumbers")&&n.append("text").text(e.idx).style("font-size",k(1.4*e.radius)+"px"),t=n.selectAll("text"),t.node()&&(t.attr("pointer-events","none").style({"font-weight":"bold",opacity:.7}),t.attr({x:-t.node().getComputedTextLength()/2,y:"0.31em"})),n.select("text.shadow").style({stroke:"#fff","stroke-width":.15*k(e.radius),"stroke-opacity":.7})})}function u(){J.selectAll("path.bodyTrace").remove(),z="",j=i.get("showBodyTrace"),q=i.get("bodyTraceId"),j&&(H=J.selectAll("path.bodyTrace").data([R[q]]),m())}function c(){M.enter().append("circle").attr({r:function(e){return k(e.radius)},cx:function(e){return k(e.x)},cy:function(e){return P(e.y)},"fill-opacity":function(e){return e.visible},fill:function(e,t){return Z[t]}}).on("mousedown",p).on("mouseover",h).on("mouseout",y)}function d(){M.attr({r:function(e){return k(e.radius)},cx:function(e){return k(e.x)},cy:function(e){return P(e.y)}}),(0===O||O>0)&&v(O)}function h(e,t){i.get("enableBodyTooltips")&&v(t)}function p(t,n){e.node.focus(),i.get("enableBodyTooltips")&&(O!==!1?(L.style("opacity",1e-6),L.style("display","none"),O=!1):(O=d3.event.shiftKey?n:!1,v(n)))}function f(){H.attr({d:g})}function m(){H.enter().append("path").attr({"class":"bodyTrace",d:g,"stroke-width":X,stroke:W,fill:"none"})}function g(e){var t,n,r=Math.floor(100*k(e.x))/100,i=Math.floor(100*P(e.y))/100;return z?(z+=r+","+i+" ",z.length>Q&&(t=z.indexOf("L"),n=z.indexOf(" "),z="M"+z.slice(t+1,n)+"L"+z.slice(n+1)),z):(z="M"+r+","+i+"L","M "+r+","+i)}function v(e){L.style("opacity",1).style("display","inline").style("background","rgba(100%, 100%, 100%, 0.7)").style("left",k(R[e].x)+60+"px").style("top",P(R[e].y)+30+"px").style("zIndex",100).transition().duration(250),B.text("astromonicalBody: "+e+"\ntime: "+modelTimeLabel()+"\nspeed: "+d3.format("+6.3e")(R[e].speed)+"\nvx:    "+d3.format("+6.3e")(R[e].vx)+"\nvy:    "+d3.format("+6.3e")(R[e].vy)+"\nax:    "+d3.format("+6.3e")(R[e].ax)+"\nay:    "+d3.format("+6.3e")(R[e].ay)+"\n")}function y(){O||0===O||L.style("opacity",1e-6).style(0/0)}function b(){void 0===L&&(L=d3.select("body").append("div").attr("class","tooltip").style("opacity",1e-6),B=L.append("pre"))}function x(){V=i.get("images"),G=i.get("imageMapping"),$=i.get("imagePath"),$?U=t.actualRoot+$:e.url&&(U=t.actualRoot+e.url.slice(0,e.url.lastIndexOf("/")+1)),W=i.get("bodyTraceColor")}function w(){function t(t){return function(){t(),e.updateClickHandlers()}}k=e.model2px,P=e.model2pxInv,D=e.getFontSizeInPixels(),F=.9*D,X=D/12,R=i.get_results(),C=i.get("width"),E=i.get("height"),S=C/E,x(),modelMinX=i.get("minX"),modelMinY=i.get("minY"),modelMaxX=i.get("maxX"),modelMaxY=i.get("maxY"),b(),i.addPropertiesListener(["showBodyTrace","bodyTraceId","backgroundColor","markColor"],t(T)),i.on("addBody",t(T)),i.on("removeBody",t(T))}function _(e){i=e,w()}function T(t,n){arguments.length&&(k=t,P=n),D=e.getFontSizeInPixels(),F=.9*D,o(),u(),s(),l()}function A(){n.time("view update"),d(),j&&f(),n.timeEnd("view update")}var C,E,S,k,P,R,O,M,N,I,L,B,D,F,V,G,$,U,j,q,W,H,z,X,Y={},K=e.appendViewport(),J=(K.append("g").attr("class","image-container-below"),K.append("g").attr("class","text-container-below"),K.append("g").attr("class","main-container")),Z=(K.append("g").attr("class","image-container-top"),K.append("g").attr("class","text-container-top"),[]),Q=35500;return Y={update:A,repaint:T,bindModel:_,model2px:e.model2px,model2pxInv:e.model2pxInv}}}),define("models/solar-system/views/view",["require","common/views/svg-container","models/solar-system/views/renderer"],function(e){var t=e("common/views/svg-container"),n=e("models/solar-system/views/renderer");
return function(e,r){return new t(e,r,n)}}),define("models/solar-system/controllers/scripting-api",["require"],function(){return function(e){return{getNumberOfBodies:function(){return model.get_num_bodies()},addBody:function(e,t){return t&&t.supressRepaint&&(t.supressEvent=!0),model.addBody(e,t)},removeBody:function(e,t){t&&t.supressRepaint&&(t.supressEvent=!0,delete t.supressRepaint);try{model.removeBody(e,t)}catch(n){if(!t||!t.silent)throw n}},addRandomBody:function(){return model.addRandomBody.apply(model,arguments)},randomBodies:function(t){var n=model.get_num_bodies();if(null===t&&(t=1+e.randomInteger(n-1)),!e.isInteger(t))throw new Error("randomBodies: number of bodies requested, "+t+", is not an integer.");if(0>t)throw new Error("randomBodies: number of bodies requested, "+t+", was less be greater than zero.");return t>n&&(t=n),e.choose(t,n)},markBodies:function t(){var n,r;if(0!==arguments.length){if(e.isArray(arguments[0]))return t.apply(null,arguments[0]);for(e.unmarkAllBodies(),n=0,r=arguments.length;r>n;n++)model.setBodyProperties(arguments[n],{marked:1});e.repaint()}},unmarkAllBodies:function(){for(var t=0,n=model.get_num_bodies();n>t;t++)model.setBodyProperties(t,{marked:0});e.repaint()},traceBody:function(e){null!==e&&(model.set({bodyTraceId:e}),model.set({showBodyTrace:!0}))},untraceBody:function(){model.set({showBodyTrace:!1})},setBodyProperties:function(t,n,r,i,o){model.setBodyProperties(t,n,r,i),o&&o.supressRepaint||e.repaint()},getBodyProperties:function(e){return model.getBodyProperties(e)},addTextBox:function(e){model.addTextBox(e)},removeTextBox:function(e){model.removeTextBox(e)},setTextBoxProperties:function(e,t){model.setTextBoxProperties(e,t)}}}}),define("models/solar-system/benchmarks/benchmarks",["require","common/performance"],function(e){var t=e("common/performance");return function(e){var n=0,r=0,i=null,o=[{name:"bodies",numeric:!0,run:function(e){e(model.get_num_bodies())}},{name:"just graphics (steps/s)",numeric:!0,formatter:d3.format("5.1f"),run:function(n){var r,i,o;for(model.stop(),i=+t.now(),o=-1;o++<100;)e.modelContainer.update();r=t.now()-i,n(100/r*1e3)}},{name:"model (steps/s)",numeric:!0,formatter:d3.format("5.1f"),run:function(e){var n,r,i;for(model.stop(),r=+t.now(),i=-1;i++<100;)model.tick(1,{dontDispatchTickEvent:!0});n=t.now()-r,e(100/n*1e3)}},{name:"model+graphics (steps/s)",numeric:!0,formatter:d3.format("5.1f"),run:function(e){var n,r,i;for(model.stop(),n=+t.now(),i=-1;i++<100;)model.tick();r=t.now()-n,e(100/r*1e3)}},{name:"fps",numeric:!0,formatter:d3.format("5.1f"),run:function(e){n=0,r=0,i=null,model.on("tickEnd",function(){i=t.now()}),model.on("tickStart",function(){i&&(n+=t.now()-i,r+=1)}),model.start(),setTimeout(function(){model.stop();var t=model.get("time");setTimeout(function(){model.start(),setTimeout(function(){model.stop();var n=model.get("time")-t;e(n/(model.get("timeStepsPerTick")*model.get("timeStep"))/2)},2e3)},100)},1e3)}},{name:"gap b/w frames (ms)",numeric:!0,formatter:d3.format("5.1f"),run:function(e){e(n/r)}},{name:"interactive",numeric:!1,run:function(e){e(window.location.pathname+window.location.hash)}}];return o}}),define("models/solar-system/controllers/controller",["require","common/controllers/model-controller","models/solar-system/models/modeler","models/solar-system/views/view","models/solar-system/controllers/scripting-api","models/solar-system/benchmarks/benchmarks"],function(e){var t=e("common/controllers/model-controller"),n=e("models/solar-system/models/modeler"),r=e("models/solar-system/views/view"),i=e("models/solar-system/controllers/scripting-api"),o=e("models/solar-system/benchmarks/benchmarks");return function(e,a,s){return new t(e,a,s,n,r,i,o)}}),define("models/signal-generator/metadata",[],function(){return{mainProperties:{type:{defaultValue:"signal-generator",immutable:!0},frequency:{defaultValue:1,unitType:"frequency",propertyChangeInvalidates:!0},modelSampleRate:{defaultValue:60,propertyChangeInvalidates:!0},timeScale:{defaultValue:1,unitType:"time",propertyChangeInvalidates:!0}},viewOptions:{showClock:{defaultValue:!0,propertyChangeInvalidates:!1},controlButtons:{defaultValue:"play_reset",propertyChangeInvalidates:!1}}}}),define("models/signal-generator/modeler",["require","common/lab-modeler-mixin","common/validator","models/signal-generator/metadata"],function(e){var t=e("common/lab-modeler-mixin"),n=(e("common/validator"),e("models/signal-generator/metadata")),r={units:{time:{name:"second",pluralName:"seconds",symbol:"s"},frequency:{name:"Hertz",pluralName:"Hertz",symbol:"Hz"},angle:{name:"radian",pluralName:"radians",symbol:"rad"}}};return function(e){function i(e){return e-2*Math.PI*Math.floor(e/(2*Math.PI))}var o,a,s={frequency:function(e){void 0!==o&&(c=i(c+2*Math.PI*(o-e)*a.properties.time)),o=e}},l=new t({metadata:n,setters:s,unitsDefinition:r,initialProperties:e}),u=l.dispatchSupport,c=0,d=0,h=0;return a={tick:function(){var e=1e3/a.properties.modelSampleRate;h++,d+=.001*e*a.properties.timeScale,a.updateAllOutputProperties(),u.tick()},stepCounter:function(){return h},reset:function(){u.reset()}},l.mixInto(a),u.addEventTypes("tick"),u.addEventTypes("reset"),a.defineOutput("time",{label:"Time",unitType:"time",format:".2f"},function(){return d}),a.defineOutput("displayTime",{label:"Time",unitType:"time",format:".2f"},function(){return d}),a.defineOutput("signalValue",{label:"Signal Value",format:".2f"},function(){return Math.cos(a.properties.angle)}),a.defineOutput("angle",{label:"Angle",unitType:"angle",format:".2f"},function(){var e=c+2*Math.PI*a.properties.frequency*a.properties.time;return i(e)}),a}}),define("common/views/null-model-view",[],function(){return function(){return{$el:$("<div id='model-container' class='container'/>"),getHeightForWidth:function(){return 0},resize:function(){},repaint:function(){},bindModel:function(){},setup:function(){},update:function(){}}}}),define("models/signal-generator/controller",["require","common/controllers/model-controller","models/signal-generator/modeler","common/views/null-model-view"],function(e){var t=e("common/controllers/model-controller"),n=e("models/signal-generator/modeler"),r=e("common/views/null-model-view"),i=function(){},o=function(){};return function(e,a,s){return new t(e,a,s,n,r,i,o)}}),define("models/sensor/metadata",[],function(){return{mainProperties:{type:{defaultValue:"sensor",immutable:!0},sensorType:{defaultValue:null},samplesPerSecond:{readOnly:!0},collectionTime:{defaultValue:null},tareValue:{defaultValue:0}},viewOptions:{showClock:{defaultValue:!0,propertyChangeInvalidates:!1},controlButtons:{defaultValue:"play_reset",propertyChangeInvalidates:!1},controlButtonStyle:{defaultValue:"video",propertyChangeInvalidates:!1,serialize:!1}}}}),define("sensor-applet/units-definition",[],function(){return{units:{time:{name:"second",pluralName:"seconds",symbol:"s"},distance:{name:"meter",pluralName:"meters",symbol:"m"},temperature:{name:"degree Celsius",pluaralName:"degrees Celsius",symbol:"C"},light:{name:"lux",pluralName:"lux",symbol:"lux"},force:{name:"Newton",pluralName:"Newtons",symbol:"N"},ph:{name:"pH Unit",pluralName:"pH Units",symbol:"pH"},co2:{name:"part per million",pluralName:"parts per million",symbol:"ppm"},o2:{name:"part per million",pluralName:"parts per million",symbol:"ppm"}}}}),define("common/mini-class",[],function(){function e(e,t){var n,r={}.hasOwnProperty;for(n in t)r.call(t,n)&&(e[n]=t[n])}function t(t,n){function r(){this.constructor=t}e(t,n),r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype}function n(t){function n(t){e(this,t)}return e(n.prototype,t),n}function r(n,r){function i(t){e(this,t)}return t(i,n),e(i.prototype,r),i}return{defineClass:n,extendClass:r,mixin:e}}),define("sensor-applet/mini-event-emitter",[],function(){return{on:function(e,t){this._ee_listeners||(this._ee_listeners={}),this._ee_listeners[e]||(this._ee_listeners[e]=[]),this._ee_listeners[e].push(t)},emit:function(e){var t=arguments.length>1?[].splice.call(arguments,1):[];if(this._ee_listeners&&this._ee_listeners[e])for(var n=0,r=this._ee_listeners[e].length;r>n;n++)this._ee_listeners[e][n].apply(null,t)},removeListener:function(e,t){if(this._ee_listeners&&this._ee_listeners[e])for(var n=0,r=this._ee_listeners[e].length;r>n;n++)this._ee_listeners[e][n]===t&&this._ee_listeners[e].splice(n,1)},removeListeners:function(e){e?this._ee_listeners&&(this._ee_listeners[e]=[]):this._ee_listeners={}}}}),define("sensor-applet/errors",["require","common/inherit"],function(e){function t(e){Error.call(this),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),this.name=this.constructor.name,this.message=e}function n(){t.apply(this,Array.prototype.slice.apply(arguments))}function r(){t.apply(this,Array.prototype.slice.apply(arguments))}function i(){t.apply(this,Array.prototype.slice.apply(arguments))}function o(){t.apply(this,Array.prototype.slice.apply(arguments))}var a=e("common/inherit");return a(n,Error),a(r,Error),a(i,Error),a(o,Error),{JavaLoadError:n,AppletInitializationError:r,AlreadyReadingError:o,SensorConnectionError:i}}),define("sensor-applet/sensor-applet",["require","common/mini-class","./mini-event-emitter","./errors","common/console"],function(e){function t(){var e=null,t=null;this.handleCallback=function(){a.log("handling callback from applet"),setTimeout(function(){return null===e?(a.log("applet called callback after timer expired"),void 0):(window.clearInterval(e),e=null,t.success(),void 0)},5)},this.wait=function(n){var r=0,i=n.times;t=n,e=window.setInterval(function(){r++,r>i&&(window.clearInterval(e),e=null,n.fail())},n.interval)}}var n,r=e("common/mini-class"),i=e("./mini-event-emitter"),o=e("./errors"),a=e("common/console");return n=r.defineClass({listenerPath:"",sensorDefinitions:null,codebase:"",deviceType:"",appletId:"sensor-applet",classNames:"applet sensor-applet",jarUrls:["com/sun/jna/jna.jar","org/concord/sensor/sensor.jar","org/concord/sensor/sensor-applets/sensor-applets.jar"],deviceSpecificJarUrls:[],code:"org.concord.sensor.applet.SensorApplet",testAppletReadyInterval:100,getHTML:function(){var e=this.jarUrls.concat(this.deviceSpecificJarUrls);return["<applet ",'id="',this.appletId,'" ','class="',this.classNames,'" ','archive="',e.join(", "),'" ','code="',this.code,'" ','codebase="',this.codebase,'" ','width="1px" ','height="1px" ','MAYSCRIPT="true" ',">",'<param name="MAYSCRIPT" value="true" />','<param name="evalOnInit" value="'+this.listenerPath+'.appletIsReadyCallback()" />',"</applet>"].join("")},getTestAppletHTML:function(){return["<applet ",'id="',this.appletId,'-test-applet" ','class="applet test-sensor-applet" ','code="org.concord.sensor.applet.DetectionApplet" ','archive="org/concord/sensor/sensor-applets/sensor-applets.jar"','codebase="',this.codebase,'" ','width="150px" ','height="150px" ','style="position: absolute; ',"left: "+($("body").width()/2-75)+"px; ","top: "+($("body").height()/2-75)+'px;" ','MAYSCRIPT="true" ',">",'<param name="MAYSCRIPT" value="true" />','<param name="evalOnInit" value="'+this.listenerPath+'.testAppletIsReadyCallback()" />',"</applet>"].join("")},isSensorConnected:function(e){var t,n,r=this;setTimeout(function(){t=function(i){i?(t=function(){var t=r.appletInstance.getCachedAttachedSensors();if(t)if(1===r.sensorDefinitions.length){for(var n=0;n<t.length;n++)if(r.appletInstance.getTypeConstantName(t[n].getType())===r.sensorDefinitions[0].typeConstantName)return e.call(r,!0),void 0;e.call(r,!1)}else e.call(r,!0);else e.call(r,!1)},n=r.registerCallback(t),r.appletInstance.getAttachedSensors(r.deviceType,""+n)):e.call(r,!1)},n=r.registerCallback(t),r.appletInstance.isInterfaceConnected(r.deviceType,""+n)})},_state:"not appended",getState:function(){return this._state},append:function(e,t){if("not appended"!==this.getState())throw new Error("Can't call append() when sensor applet has left 'not appended' state");a.log("appending test applet"),this.$testAppletContainer=this._appendHTML(this.appletId+"-test-applet-container",this.getTestAppletHTML(),e),this._state="test applet appended",this._waitForTestApplet(),this._appendCallback=t},_appendHTML:function(e,t,n){var r=$("#"+e);return r.length||(r=$("<div id='"+e+"'/>").appendTo(n)),r.html(t),r},_testAppletWaiter:new t,testAppletIsReadyCallback:function(){this._testAppletWaiter.handleCallback()},_waitForTestApplet:function(){var e=this;this._testAppletWaiter.wait({times:30,interval:1e3,success:function(){e.$appletContainer=e._appendHTML(e.appletId+"-container",e.getHTML(),$("body")),e._state="appended",e._waitForApplet()},fail:function(){e._appendCallback(new o.JavaLoadError("Timed out waiting for test applet to initialize."))}})},_appletWaiter:new t,appletIsReadyCallback:function(){this._appletWaiter.handleCallback()},_waitForApplet:function(){var e=this;this._appletWaiter.wait({times:30,interval:1e3,success:function(){var t=[];e.$testAppletContainer.html(""),"appended"===e.getState()&&(e._state="applet ready"),e.appletInstance=$("#"+e.appletId)[0];for(var n=0;n<e.sensorDefinitions.length;n++)t[n]=e.appletInstance.getSensorRequest(e.sensorDefinitions[n].measurementType);e.appletInstance.initSensorInterface(e.listenerPath,e.deviceType,t)},fail:function(){e._appendCallback(new o.AppletInitializationError("Timed out waiting for sensor applet to initialize."))}})},readSensor:function(e){var t=this;return"reading sensor"===this.getState()?(a.log("Already reading sensor in another thread..."),e.call(this,new o.AlreadyReadingError("Already reading sensor in another thread"),null),void 0):"stopped"!==this.getState()?(e.call(this,new Error("Tried to read the sensor value from non-stopped state '"+this.getState()+'"'),null),void 0):(this._state="reading sensor",this.isSensorConnected(function(n){if(n){var r=function(n){t._state="stopped",n&&0!==n.length?e.call(t,null,n):e.call(t,new Error("readSensor: no sensor values to report"),null)},i=t.registerCallback(r);t.appletInstance.getConfiguredSensorsValues(t.deviceType,""+i)}else t._state="stopped",e.call(t,new o.SensorConnectionError("readSensor: sensor is not connected"),null)}),void 0)},start:function(e){var t=this;return"reading sensor"===this.getState()?(a.log("start called while waiting for a sensor reading"),setTimeout(function(){t.start(e)},100),void 0):"stopped"!==this.getState()?(e&&setTimeout(function(){e.call(this,new Error("Tried to start the applet from non-stopped state '"+this.getState()+'"'),!1)},5),void 0):(this._state="starting",this.isSensorConnected(function(n){n?(t.appletInstance.startCollecting(),t._state="started",e&&e.call(t,null,!0)):(t._state="stopped",e&&e.call(t,new o.SensorConnectionError("Device reported the requested sensor type was not attached."),null))}),void 0)},stop:function(){"started"===this.getState()&&(this._state="stopped",this.appletInstance.stopCollecting())},remove:function(){"not appended"!==this.getState()&&(this.$appletContainer&&this.$appletContainer.html(""),this.$testAppletContainer&&this.$testAppletContainer.html(""),this._state="not appended")},initSensorInterfaceComplete:function(e){var t=this;setTimeout(function(){e?(t._state="stopped",t._appendCallback(null),t._appendCallback=null):t._appendCallback(new o.SensorConnectionError("Device reported the requested sensor type was not attached."))},5)},dataReceived:function(e,t,n){var r=this,i=[],o=this.sensorDefinitions.length;setTimeout(function(){n=n||[];for(var e=0;t>e;e++)for(var a=0;o>a;a++)i[a]=n[e*o+a],r.emit("data",i)},5)},deviceUnplugged:function(){var e=this;window.setTimeout(function(){e.emit("deviceUnplugged")},5)},sensorUnplugged:function(){a.log("received sensorUnplugged message; deviceType = "+this.deviceType)},callbackTable:[],registerCallback:function(e){return this.callbackTable.push(e),this.callbackTable.length-1},handleCallback:function(e,t){var n,r=this;"string"==typeof e&&this[e]?n=this[e]:this.callbackTable[e]&&(n=this.callbackTable[e],this.callbackTable[e]=null),n&&setTimeout(function(){n.apply(r,t)},5)}}),r.mixin(n.prototype,i),n}),define("sensor-applet/applet-classes",["require","common/mini-class","./sensor-applet"],function(e){var t=e("common/mini-class"),n=e("./sensor-applet");return{goio:t.extendClass(n,{deviceType:"golink",deviceSpecificJarUrls:["org/concord/sensor/sensor-vernier/sensor-vernier.jar","org/concord/sensor/goio-jna/goio-jna.jar"]}),labquest:t.extendClass(n,{deviceType:"labquest",deviceSpecificJarUrls:["org/concord/sensor/sensor-vernier/sensor-vernier.jar","org/concord/sensor/labquest-jna/labquest-jna.jar"]})}}),define("sensor-applet/sensor-definitions",[],function(){return{goMotion:{appletClass:"goio",measurementName:"Distance",measurementType:"distance",typeConstantName:"distance",sensorName:"GoMotion",deviceName:"GoMotion",samplesPerSecond:20,tareable:!0,minReading:0,maxReading:4,precision:2,maxSeconds:20},goLinkTemperature:{appletClass:"goio",measurementName:"Temperature",measurementType:"temperature",typeConstantName:"temperature",sensorName:"GoIO Temperature Sensor",deviceName:"GoIO",samplesPerSecond:10,tareable:!1,minReading:0,maxReading:40,maxSeconds:20},goLinkLight:{appletClass:"goio",measurementName:"Light Intensity",measurementType:"light",typeConstantName:"light",sensorName:"GoIO Light Sensor",deviceName:"GoIO",samplesPerSecond:10,tareable:!1,minReading:0,maxReading:2e3,maxSeconds:20},goLinkForce:{appletClass:"goio",measurementName:"Force",measurementType:"force",typeConstantName:"force",sensorName:"GoIO Force Sensor",deviceName:"GoIO",samplesPerSecond:20,tareable:!0,minReading:-50,maxReading:50,precision:2,maxSeconds:10},goLinkPH:{appletClass:"goio",measurementName:"Acidity",measurementType:"ph",typeConstantName:"ph",sensorName:"GoIO pH Sensor",deviceName:"GoIO",samplesPerSecond:10,tareable:!1,minReading:0,maxReading:14,maxSeconds:60},goLinkCO2:{appletClass:"goio",measurementName:"CO Concentration",measurementType:"co2",typeConstantName:"co2_gas",sensorName:"GoIO CO sensor",deviceName:"GoIO",samplesPerSecond:1,tareable:!1,minReading:0,maxReading:5e3,maxSeconds:60},goLinkO2:{appletClass:"goio",measurementName:"O Concentration",measurementType:"o2",typeConstantName:"oxygen_gas",sensorName:"GoIO O sensor",deviceName:"GoIO",samplesPerSecond:1,tareable:!1,minReading:0,maxReading:100,maxSeconds:60},labQuestMotion:{appletClass:"labquest",measurementName:"Distance",measurementType:"distance",typeConstantName:"distance",sensorName:"LabQuest Motion Sensor",deviceName:"LabQuest",samplesPerSecond:20,tareable:!0,minReading:0,maxReading:4,precision:2,maxSeconds:20},labQuestTemperature:{appletClass:"labquest",measurementName:"Temperature",measurementType:"temperature",typeConstantName:"temperature",sensorName:"LabQuest Temperature Sensor",deviceName:"LabQuest",samplesPerSecond:10,tareable:!1,minReading:0,maxReading:40,maxSeconds:20},labQuestLight:{appletClass:"labquest",measurementName:"Light Intensity",measurementType:"light",typeConstantName:"light",sensorName:"LabQuest Light Sensor",deviceName:"LabQuest",samplesPerSecond:10,tareable:!1,minReading:0,maxReading:2e3,maxSeconds:20},labQuestForce:{appletClass:"labquest",measurementName:"Force",measurementType:"force",typeConstantName:"force",sensorName:"LabQuest Force Sensor",deviceName:"LabQuest",samplesPerSecond:20,tareable:!0,minReading:-50,maxReading:50,precision:2,maxSeconds:10},labQuestPH:{appletClass:"labquest",measurementName:"Acidity",measurementType:"ph",typeConstantName:"ph",sensorName:"LabQuest pH Sensor",deviceName:"LabQuest",samplesPerSecond:10,tareable:!1,minReading:0,maxReading:14,maxSeconds:60},labQuestCO2:{appletClass:"labquest",measurementName:"CO Concentration",measurementType:"co2",typeConstantName:"co2_gas",sensorName:"LabQuest CO sensor",deviceName:"LabQuest",samplesPerSecond:1,tareable:!1,minReading:0,maxReading:5e3,maxSeconds:60},labQuestO2:{appletClass:"labquest",measurementName:"O Concentration",measurementType:"o2",typeConstantName:"oxygen_gas",sensorName:"LabQuest O sensor",deviceName:"LabQuest",samplesPerSecond:1,tareable:!1,minReading:0,maxReading:100,maxSeconds:60}}}),define("models/sensor/modeler",["require","common/property-support","common/property-description","cs!common/filters/running-average-filter","common/validator","./metadata","sensor-applet/units-definition","sensor-applet/applet-classes","sensor-applet/errors","sensor-applet/sensor-definitions","lab.config","common/controllers/basic-dialog","common/controllers/export-controller"],function(e){function t(e,t){var n=new h({width:"60%",buttons:t});n.setContent(e),n.open()}var n=e("common/property-support"),r=e("common/property-description"),i=e("cs!common/filters/running-average-filter"),o=e("common/validator"),a=e("./metadata"),s=e("sensor-applet/units-definition"),l=e("sensor-applet/applet-classes"),u=e("sensor-applet/errors"),c=e("sensor-applet/sensor-definitions"),d=e("lab.config"),h=e("common/controllers/basic-dialog"),p=e("common/controllers/export-controller"),f={label:"Sensor Reading",unitAbbreviation:"-",format:".2f",min:0,max:1};return function(e){function h(e,t,n){var i,l,u,c;if("mainProperty"===t)i=a.mainProperties;else{if("viewOption"!==t)throw new Error(t+" is not a supported built-in property type");i=a.viewOptions}u=o.propertyChangeInvalidates(i[e]),l={type:t,writable:o.propertyIsWritable(i[e]),set:n,includeInHistoryState:!!i[e].storeInTickHistory,validate:function(t){return o.validateSingleProperty(i[e],e,t,!1)},beforeSetCallback:u?m:void 0,afterSetCallback:u?g:void 0},c=i[e].unitType,l.description=c?new r(s,{unitType:c}):new r(null,{label:i.label||e}),X.defineProperty(e,l)}function m(){0===tt&&(X.storeComputedProperties(),X.deleteComputedPropertyCachedValues(),X.enableCaching=!1),tt++}function g(){tt--,y(),0===tt&&(X.enableCaching=!0,X.notifyChangedComputedProperties())}function v(e){m(),e(),g()}function y(){nt.forEach(function(e){e.addSample()})}function b(e,t,n){var i,o;i=z.getPropertyDescription(e).getHash(),i.min=t,i.max=n,o=new r(s,i),X.setPropertyDescription(e,o)}function x(){null!=z.properties.collectionTime&&b("displayTime",0,z.properties.collectionTime)}function w(){L&&(L.removeListeners("data"),L.removeListeners("deviceUnplugged"),L.removeListeners("sensorUnplugged"),L.remove()),v(function(){Z=!1,Q=!1})}function _(){v(function(){Q=!0}),setTimeout(function(){L.on("data",R),L.on("deviceUnplugged",function(){C("device")}),L.on("sensorUnplugged",function(){C("sensor")}),L.append($("body"),function(e){return e?(e instanceof u.JavaLoadError?A("It appears that Java applets cannot run in your browser. If you are able to fix this, reload the page to use the sensor"):e instanceof u.AppletInitializationError?A("The sensor applet appears not to be loading. If you are able to fix this, reload the page to use the sensor"):e instanceof u.SensorConnectionError?T():A("There was an unexpected error when connecting to the sensor."),v(function(){Q=!1}),void 0):(v(function(){Z=!0,Q=!1}),void 0)})},10)}function T(){w(),t("The "+z.properties.sensorName+' does not appear to be attached. Try re-attaching it, and then click "Try Again".',{"Try Again":function(){$(this).dialog("close"),_()},Cancel:function(){$(this).remove(),z.reload()}})}function A(e){w(),t(e,{OK:function(){$(this).remove(),z.reload()}})}function C(e){w(),z.stop(),p.logAction("User unplugged the "+e+" ("+z.properties[e+"Name"]+")."),t("The "+z.properties[e+"Name"]+' was unplugged. Try plugging it back in, and then click "Try Again".',{"Try Again":function(){$(this).dialog("close"),_()},Cancel:function(){$(this).dialog("close")}})}function E(){B&&clearInterval(B);var e=function(e,t){if(e)if(e instanceof u.AlreadyReadingError);else{if(!(e instanceof u.SensorConnectionError))throw clearInterval(B),e;clearInterval(B),T()}else v(function(){V=t[0],j&&(z.properties.tareValue=V,j=!1)})};B=setInterval(function(){L.readSensor(e)},1e3/et)}function S(){B&&(clearInterval(B),B=null)}function k(){G=0,F=0,V=void 0,U=!1,q=!1,j=!1}function P(e){var t,n,i,o;I!==e&&(I&&(z.properties.tareValue=0),I=e,V=void 0,L&&w(),I?(n=c[I],D=n.samplesPerSecond,o=n.measurementType,t=l[n.appletClass],q=n.tareable,L=window.Lab.sensor[I]=new t({listenerPath:"Lab.sensor."+I,sensorDefinitions:[n],appletId:I+"-sensor",codebase:d.actualRoot+"jnlp"}),_(),i=new r(s,{label:n.measurementName,unitType:o,min:n.minReading,max:n.maxReading}),X.setPropertyDescription("sensorReading",i),null==z.properties.collectionTime&&(z.properties.collectionTime=n.maxSeconds)):z.properties.hasOwnProperty("sensorReading")&&(i=new r(s,f),X.setPropertyDescription("sensorReading",i)))}function R(e){G++,F+=1/D,window.__bizarreSafariFix=1,V=e[0],U||z.freeze("sensorType"),U=!0,X.deleteComputedPropertyCachedValues(),X.notifyAllComputedProperties(),y(),J.tick()}var O,M,N,I,L,B,D,F,V,G,U,j,q,W,H,z,X=new n({types:["mainProperty","viewOption","parameter","output"]}),Y=!0,K=!1,J=d3.dispatch("play","stop","tick","willReset","reset","stepForward","stepBack","seek","invalidation"),Z=!1,Q=!1,et=1,tt=0,nt=[];return z={on:function(e,t){J.on(e,t)},start:function(){z.properties.isPlayable&&L.start(function(e,t){e?e instanceof u.SensorConnectionError&&T():t&&(v(function(){Y=!1}),J.play())})},stop:function(){L&&L.stop(),v(function(){Y=!0}),J.stop()},tare:function(){if(!Y)throw new Error("Sensor model: tare() called on a non-stopped model.");null!=B&&null!=V?z.properties.tareValue=V:v(function(){j=!0})},willReset:function(){J.willReset()},reset:function(){z.stop(),w(),k(),z.properties.tareValue=W,z.unfreeze("sensorType"),z.properties.sensorType=N,J.reset()},reload:function(){z.stop(),v(function(){K=!0})},isStopped:function(){return Y},stepCounter:function(){return G},addPropertiesListener:function(e,t){"string"==typeof e?z.addObserver(e,t):e.forEach(function(e){z.addObserver(e,t)})},defineParameter:function(e,t,n){var i={type:"parameter",includeInHistoryState:!0,invokeSetterAfterBulkRestore:!1,description:new r(s,t),beforeSetCallback:m,afterSetCallback:g};n&&(i.set=function(e){n.call(z,e)}),X.defineProperty(e,i)},defineOutput:function(e,t,n){X.defineProperty(e,{type:"output",writable:!1,get:n,includeInHistoryState:!1,description:new r(s,t)})},defineFilteredOutput:function(e,t,n,r,o){var a,s;if("RunningAverage"!==r)throw new Error("FilteredOutput: unknown filter type "+r+".");if(a=new i(o),s=z.properties[e],void 0===s||isNaN(Number(s)))throw new Error("FilteredOutput: property is not a valid numeric value or it is undefined.");a.addSample(z.properties.time,s),nt.push({addSample:function(){a.addSample(z.properties.time,z.properties[n])}}),t.property=n,t.type=r,t.period=o,z.defineOutput(e,t,function(){return a.calculate()})}},k(),void 0===window.Lab&&(window.Lab={}),window.Lab.sensor={},X.mixInto(z),H={sensorType:P},M=o.validateCompleteness(a.mainProperties,e),Object.keys(M).forEach(function(e){h(e,"mainProperty",H[e])}),X.setRawValues(M),N=z.properties.sensorType,W=z.properties.tareValue,O=o.validateCompleteness(a.viewOptions,e.viewOptions||{}),Object.keys(O).forEach(function(e){h(e,"viewOption")}),X.setRawValues(O),z.defineOutput("time",{label:"Time",unitType:"time",format:".2f"},function(){return F}),z.defineOutput("displayTime",{label:"Time",unitType:"time",format:".2f"},function(){return F}),z.defineOutput("sensorReading",f,function(){return null==V?V:V-z.properties.tareValue}),z.defineOutput("sensorName",{label:"Sensor Name"},function(){return c[I].sensorName}),z.defineOutput("deviceName",{label:"Sensor Interface Device Name"},function(){return c[I].deviceName}),z.defineOutput("isStopped",{label:"Stopped?"},function(){return Y}),z.defineOutput("isPlayable",{label:"Startable?"},function(){return Z&&!U}),z.defineOutput("hasPlayed",{label:"Has successfully collected data?"},function(){return U}),z.defineOutput("shouldPollSensor",{label:"Polling Sensor?"},function(){return z.properties.isPlayable&&Y}),z.defineOutput("isSensorInitializing",{label:"Loading Sensor?"},function(){return Q}),z.defineOutput("isTaring",{label:"Waiting for a tare value?"},function(){return j}),z.defineOutput("canTare",{label:"Can set a tare value?"},function(){return Y&&!U&&q&&!j}),z.defineOutput("needsReload",{label:"Needs Reload?"},function(){return K}),z.on("willReset.model",w),z.addObserver("shouldPollSensor",function(){z.properties.shouldPollSensor?E():S()}),z.addObserver("collectionTime",x),x(),P(z.properties.sensorType),z}}),define("models/sensor/view",["common/views/select-box-view","common/views/numeric-output-view","sensor-applet/sensor-definitions","common/views/view-state"],function(){var e=require("common/views/select-box-view"),t=require("common/views/numeric-output-view"),n=require("sensor-applet/sensor-definitions"),r=require("common/views/view-state");return function(i,o){function a(){i.properties.isTaring?d.$zeroButton.find("button").html("Zeroing..."):d.$zeroButton.find("button").html("Zero")}function s(){i.properties.canTare?r.enableView(d.$zeroButton):r.disableView(d.$zeroButton)}function l(){var e=i.getPropertyDescription("sensorType");e.getFrozen()?r.disableView(d.$selectBox):r.enableView(d.$selectBox)}function u(){i.addObserver("isTaring",a),a(),i.addObserver("canTare",s),s(),i.addPropertyDescriptionObserver("sensorType",l),l()}var c,d,h=new e({id:"sensor-type-view",options:[{value:null,text:"Select type of sensor...",selected:null==i.properties.sensorType,disabled:!0}].concat(Object.keys(n).map(function(e){return{value:e,text:n[e].sensorName,selected:e===i.properties.sensorType,disabled:!1}})),onChange:function(e){i.properties.sensorType=e.value}}),p=d3.format(".2f");return d={$el:$("<div id='model-container' class='container sensor-model-container' />"),bindModel:function(e,t){o=t||o,i=e||i,u()},getHeightForWidth:function(){return"2.6em"},setup:function(){this.$el.empty(),c=new t({id:"sensor-value-view",label:"Reading: ",units:i.getPropertyDescription("sensorReading").getUnitAbbreviation()});var e=h.render(this.$el),n=$("<div><button>Zero</button></div>"),r=c.render();e.addClass("interactive-pulldown component component-spacing"),n.addClass("interactive-button component component-spacing"),r.addClass("numeric-output component horizontal component-spacing"),this.$el.css("zIndex",4),this.$el.append(e),this.$el.append(r),this.$el.append(n),this.$zeroButton=n,this.$selectBox=e,u(),n.on("click","button",function(){i.tare()})},showInitializationProgress:function(){var e;this.$progressbarContainer||(e=$("<div/>").attr("id","sensor-progressbar"),this.$progressbarContainer=$("<div/>").attr("id","sensor-progressbar-container").css("bottom",$("body").height()/2+75+$("#responsive-content").offset().top).append('<div class="label">Loading sensor...</div>').append(e).appendTo("#responsive-content"),e.progressbar({value:!1})),this.$progressbarContainer.show()},hideInitializationProgress:function(){this.$progressbarContainer.hide()},resize:function(){},repaint:function(){},updateUnits:function(e){c.updateUnits(e),null==i.properties.sensorReading&&c.hideUnits()},update:function(){null==i.properties.sensorReading?(c.update(""),c.hideUnits()):(c.update(p(i.properties.sensorReading)),c.showUnits())}}}}),define("models/sensor/controller",["require","common/controllers/model-controller","models/sensor/modeler","models/sensor/view"],function(e){var t=e("common/controllers/model-controller"),n=e("models/sensor/modeler"),r=e("models/sensor/view"),i=function(){},o=function(){};return function(e,a,s){function l(){var e=u.model;e.addObserver("isSensorInitializing",function(){var t=u.modelContainer;e.properties.isSensorInitializing?t.showInitializationProgress():t.hideInitializationProgress()}),e.addObserver("sensorReading",function(){e.isStopped()&&u.updateView()}),e.addObserver("needsReload",function(){e.properties.needsReload&&u.reload()}),e.addPropertyDescriptionObserver("sensorReading",function(){var t=e.getPropertyDescription("sensorReading"),n=u.modelContainer;n.updateUnits(t.getUnitAbbreviation())})}var u=new t(e,a,s,n,r,i,o);return l(),u.on("modelLoaded.sensor-model-controller",l),u}}),define("models/energy2d/models/constants",["require","exports","module"],function(e,t){"use strict";t.AIR_THERMAL_CONDUCTIVITY=.025,t.AIR_SPECIFIC_HEAT=1012,t.AIR_DENSITY=1.204,t.AIR_VISCOSITY=1568e-8,t.STEFAN_CONSTANT=5.67e-8
}),define("models/energy2d/metadata",["require","models/energy2d/models/constants"],function(e){var t=e("models/energy2d/models/constants");return{mainProperties:{type:{defaultValue:"energy2d",immutable:!0},use_WebGL:{defaultValue:!1},grid_width:{defaultValue:100,immutable:!0},grid_height:{defaultValue:100,immutable:!0},model_width:{defaultValue:10,immutable:!0},model_height:{defaultValue:10,immutable:!0},timeStep:{defaultValue:1},timeStepsPerTick:{defaultValue:4},ticksPerGPUSync:{defaultValue:30},convective:{defaultValue:!0},background_temperature:{defaultValue:0},background_conductivity:{defaultValue:t.AIR_THERMAL_CONDUCTIVITY},background_specific_heat:{defaultValue:t.AIR_SPECIFIC_HEAT},background_density:{defaultValue:t.AIR_DENSITY},background_viscosity:{defaultValue:t.AIR_VISCOSITY},thermal_buoyancy:{defaultValue:25e-5},buoyancy_approximation:{defaultValue:1},boundary:{defaultValue:{type:"temperature",upper:0,lower:0,left:0,right:0}},sunny:{defaultValue:!1},sun_angle:{defaultValue:1.5707964},solar_power_density:{defaultValue:2e3},solar_ray_count:{defaultValue:24},solar_ray_speed:{defaultValue:.1},photon_emission_interval:{defaultValue:20}},viewOptions:{showClock:{defaultValue:!0,propertyChangeInvalidates:!1},controlButtons:{defaultValue:"play_reset",propertyChangeInvalidates:!1},color_palette_type:{defaultValue:0},velocity:{defaultValue:!1},minimum_temperature:{defaultValue:0},maximum_temperature:{defaultValue:40},enableKeyboardHandlers:{defaultValue:!0}},part:{shapeType:{required:!0,immutable:!0},x:{defaultValue:0},y:{defaultValue:0},width:{},height:{},a:{},b:{},inner:{},outer:{},vertices:{},raw_x_coords:{serialize:!1},raw_y_coords:{serialize:!1},thermal_conductivity:{defaultValue:1},specific_heat:{defaultValue:1300},density:{defaultValue:25},transmission:{defaultValue:0},reflection:{defaultValue:0},absorption:{defaultValue:1},emissivity:{defaultValue:0},temperature:{defaultValue:0},constant_temperature:{defaultValue:!1},power:{defaultValue:0},wind_speed:{defaultValue:0},wind_angle:{defaultValue:0},visible:{defaultValue:!0},filled:{defaultValue:!0},color:{defaultValue:"auto"},label:{defaultValue:""},texture:{defaultValue:!1},draggable:{defaultValue:!0}},sensor:{type:{required:!0,immutable:!0},x:{required:!0,unitType:"length"},y:{required:!0,unitType:"length"},angle:{immutable:!0},label:{defaultValue:""},value:{readOnly:!0,serialize:!1}}}}),define("models/energy2d/models/physics-solvers/heat-solver",["require","exports","module","arrays"],function(e,t){"use strict";var n=e("arrays"),r=5;t.makeHeatSolver=function(e){var t=e.getModelOptions(),i=t.grid_width,o=t.grid_height,a=r,s=e.getConductivityArray(),l=e.getCapacityArray(),u=e.getDensityArray(),c=e.getUVelocityArray(),d=e.getVVelocityArray(),h=e.getBoundaryTemperatureArray(),p=e.getFluidityArray(),f=n.create(i*o,0,e.getArrayType()),m=i-1,g=o-1,v=i-2,y=o-2,b=t.model_width/t.grid_width,x=t.model_height/t.grid_height,w=function(e){var n,r,a,l,u=t.boundary,c=u.upper,d=u.lower,h=u.left,p=u.right;if("temperature"===u.type){for(n=0;i>n;n+=1)a=n*i,e[a]=c,e[a+g]=d;for(r=0;o>r;r+=1)e[r]=h,e[m*i+r]=p}else if("flux"===u.type){for(n=0;i>n;n+=1)a=n*i,l=a+g,e[a]=e[a+1]+c*x/s[a],e[l]=e[a+y]-d*x/s[l];for(r=0;o>r;r+=1)e[r]=e[i+r]-h*b/s[r],e[m*i+r]=e[v*i+r]+p*b/s[m*i+r]}},_=function(e){var n,r,o,a,s,l,u,h,v=t.timeStep,y=.5*v/b,_=.5*v/x;for(n=1;m>n;n+=1)for(o=n*i,r=1;g>r;r+=1)a=o+r,l=a-i,s=a+i,h=a-1,u=a+1,p[a]&&(f[a]=e[a]-y*(c[s]*e[s]-c[l]*e[l])-_*(d[u]*e[u]-d[h]*e[h]));for(w(f),n=1;m>n;n+=1)for(o=n*i,r=1;g>r;r+=1)a=o+r,p[a]&&(l=a-i,s=a+i,h=a-1,u=a+1,e[a]=.5*(e[a]+f[a])-.5*y*c[a]*(f[s]-f[l])-.5*_*d[a]*(f[u]-f[h]));w(e)};return{solve:function(e,r,o){var c,d,p,v,y,T,A,C,E,S,k,P,R,O,M,N=t.timeStep,I=.5/(b*b),L=.5/(x*x),B=1/N;for(n.copy(r,f),A=0;a>A;A+=1){for(C=1;m>C;C+=1)for(S=C*i,E=1;g>E;E+=1)k=S+E,isNaN(h[k])?(R=k-i,P=k+i,M=k-1,O=k+1,d=l[k]*u[k]*B,c=s[k],p=I*(c+s[R]),v=I*(c+s[P]),y=L*(c+s[M]),T=L*(c+s[O]),r[k]=(f[k]*d+o[k]+p*r[R]+v*r[P]+y*r[M]+T*r[O])/(d+p+v+y+T)):r[k]=h[k];w(r)}e&&_(r)}}}}),define("models/energy2d/gpu/context",[],function(){"use strict";var e;return{getWebGLContext:function(){if(!e){var t=document.createElement("canvas");try{e=t.getContext("webgl")||t.getContext("experimental-webgl")}catch(n){}if(!e)throw new Error("GL: WebGL not supported.")}return e},get error(){if(!e)return"WebGL unavailable";var t=e.getError();return t===e.NO_ERROR?void 0:t}}}),define("models/energy2d/gpu/shader",["require","common/console","models/energy2d/gpu/context"],function(e){"use strict";var t,n,r=e("common/console"),i=e("models/energy2d/gpu/context"),o=function(e,t,n){for(var r;null!==(r=e.exec(t));)n(r)},a=function(e){var t=Object.prototype.toString.call(e);return"[object Array]"===t||"[object Float32Array]"===t},s=function(e){var t=Object.prototype.toString.call(e);return"[object Number]"===t||"[object Boolean]"===t};return n=function(e,n){function r(e,n){var r=t.createShader(e);if(t.shaderSource(r,n),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS))throw new Error("Shader: compile error.\n"+t.getShaderInfoLog(r)+"\nSource:\n"+n);return r}var a="      attribute vec4 gl_Vertex;      attribute vec4 gl_TexCoord;      attribute vec3 gl_Normal;      attribute vec4 gl_Color;      ",s="      precision highp float;      ",l=function(e,t){var n,r={};return n=/^((\s*\/\/.*\n|\s*#extension.*\n)+)[^]*$/.exec(t),t=n?n[1]+e+t.substr(n[1].length):e+t,o(/\bgl_\w+\b/g,e,function(e){void 0===r[e]&&(t=t.replace(new RegExp("\\b"+e+"\\b","g"),"_"+e),r[e]=!0)}),t},u={};if(t=i.getWebGLContext(),e=l(a,e),n=l(s,n),this.program=t.createProgram(),t.attachShader(this.program,r(t.VERTEX_SHADER,e)),t.attachShader(this.program,r(t.FRAGMENT_SHADER,n)),t.linkProgram(this.program),!t.getProgramParameter(this.program,t.LINK_STATUS))throw new Error("Shader: link error.\n"+t.getProgramInfoLog(this.program)+"\nSource:\n"+e+"\n\n"+n);this.attributes={},this.uniformLocations={},o(/uniform\s+sampler(1D|2D|3D|Cube)\s+(\w+)\s*;/g,e+n,function(e){u[e[2]]=1}),this.isSampler=u},n.prototype.uniforms=function(e){var n,i,o;t.useProgram(this.program);for(n in e)if(e.hasOwnProperty(n)){if(void 0===this.uniformLocations[n]&&(this.uniformLocations[n]=t.getUniformLocation(this.program,n)),i=this.uniformLocations[n],null===i){r.warn("Shader: name "+n+" does not correspond to an active uniform variable.");continue}if(o=e[n],a(o))switch(o.length){case 1:t.uniform1fv(i,new Float32Array(o));break;case 2:t.uniform2fv(i,new Float32Array(o));break;case 3:t.uniform3fv(i,new Float32Array(o));break;case 4:t.uniform4fv(i,new Float32Array(o));break;case 9:t.uniformMatrix3fv(i,!1,new Float32Array([o[0],o[3],o[6],o[1],o[4],o[7],o[2],o[5],o[8]]));break;case 16:t.uniformMatrix4fv(i,!1,new Float32Array([o[0],o[4],o[8],o[12],o[1],o[5],o[9],o[13],o[2],o[6],o[10],o[14],o[3],o[7],o[11],o[15]]));break;default:throw new Error("Shader: don't know how to load uniform \""+n+'" of length '+o.length)}else{if(!s(o))throw new Error('Shader: attempted to set uniform "'+n+'" to invalid value '+o);(this.isSampler[n]?t.uniform1i:t.uniform1f).call(t,i,o)}}return this},n.prototype.draw=function(e,n){t.useProgram(this.program),this.drawBuffers(e.vertexBuffers,e.indexBuffers[n===t.LINES?"lines":"triangles"],arguments.length<2?t.TRIANGLES:n)},n.prototype.drawBuffers=function(e,n,r){var i,o,a,s=0;for(i in e)if(e.hasOwnProperty(i)){if(o=e[i],void 0===this.attributes[i]&&(this.attributes[i]=t.getAttribLocation(this.program,i.replace(/^gl_/,"_gl_"))),a=this.attributes[i],-1===a||!o.buffer)continue;t.bindBuffer(t.ARRAY_BUFFER,o.buffer),t.enableVertexAttribArray(a),t.vertexAttribPointer(a,o.buffer.spacing,t.FLOAT,!1,0,0),s=o.buffer.length/o.buffer.spacing}for(i in this.attributes)this.attributes.hasOwnProperty(i)&&void 0===e[i]&&t.disableVertexAttribArray(this.attributes[i]);!s||n&&!n.buffer||(n?(t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n.buffer),t.drawElements(r,n.buffer.length,t.UNSIGNED_SHORT,0)):t.drawArrays(r,0,s))},n}),define("models/energy2d/gpu/texture",["require","models/energy2d/gpu/context"],function(e){"use strict";var t,n,r=e("models/energy2d/gpu/context");return n=function(e,n,i){t=r.getWebGLContext(),i=i||{},this.id=t.createTexture(),this.width=e,this.height=n,this.format=i.format||t.RGBA,this.type=i.type||t.UNSIGNED_BYTE,this.tex_unit=null,this.fbo=null,t.bindTexture(t.TEXTURE_2D,this.id),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,i.mag_filter||i.filter||t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,i.min_filter||i.filter||t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,i.wrap||i.wrap_s||t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,i.wrap||i.wrap_t||t.CLAMP_TO_EDGE),t.texImage2D(t.TEXTURE_2D,0,this.format,e,n,0,this.format,this.type,null)},n.prototype.setAsRenderTarget=function(){null===this.fbo?(this.fbo=t.createFramebuffer(),t.bindFramebuffer(t.FRAMEBUFFER,this.fbo),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.id,0),t.viewport(0,0,this.width,this.height)):(t.bindFramebuffer(t.FRAMEBUFFER,this.fbo),t.viewport(0,0,this.width,this.height))},n.prototype.bind=function(e){this.tex_unit=e||0,t.activeTexture(t.TEXTURE0+this.tex_unit),t.bindTexture(t.TEXTURE_2D,this.id)},n.prototype.unbind=function(){null!==this.tex_unit&&(t.activeTexture(t.TEXTURE0+this.tex_unit),t.bindTexture(t.TEXTURE_2D,null),this.tex_unit=null)},n.prototype.drawTo=function(e){if(null===this.fbo)throw new Error("Texture: call setupAsRenderTarget() method first.");t.bindFramebuffer(t.FRAMEBUFFER,this.fbo),t.viewport(0,0,this.width,this.height),e(),t.bindFramebuffer(t.FRAMEBUFFER,null)},n.prototype.swapWith=function(e){var t;t=e.id,e.id=this.id,this.id=t,t=e.tex_unit,e.tex_unit=this.tex_unit,this.tex_unit=t,t=e.fbo,e.fbo=this.fbo,this.fbo=t},n}),define("models/energy2d/gpu/mesh",["require","models/energy2d/gpu/context"],function(e){"use strict";var t,n,r,i=e("models/energy2d/gpu/context");return n=function(e,n){t=i.getWebGLContext(),this.buffer=null,this.target=e,this.type=n,this.data=[]},n.prototype.compile=function(e){var n,r,i,o=[];for(n=0,r=1e4;n<this.data.length;n+=r)o=Array.prototype.concat.apply(o,this.data.slice(n,n+r));if(i=this.data.length?o.length/this.data.length:0,i!==Math.round(i))throw new Error("Mesh: buffer elements not of consistent size, average size is "+i);this.buffer=this.buffer||t.createBuffer(),this.buffer.length=o.length,this.buffer.spacing=i,t.bindBuffer(this.target,this.buffer),t.bufferData(this.target,new this.type(o),e||t.STATIC_DRAW)},r=function(e){t=i.getWebGLContext(),e=e||{},this.vertexBuffers={},this.indexBuffers={},this.addVertexBuffer("vertices","gl_Vertex"),e.coords&&this.addVertexBuffer("coords","gl_TexCoord"),e.normals&&this.addVertexBuffer("normals","gl_Normal"),e.colors&&this.addVertexBuffer("colors","gl_Color"),(void 0===e.lines||e.triangles)&&this.addIndexBuffer("triangles"),e.lines&&this.addIndexBuffer("lines")},r.prototype.addVertexBuffer=function(e,r){var i=this.vertexBuffers[r]=new n(t.ARRAY_BUFFER,Float32Array);i.name=e,this[e]=[]},r.prototype.addIndexBuffer=function(e){this.indexBuffers[e]=new n(t.ELEMENT_ARRAY_BUFFER,Uint16Array);this[e]=[]},r.prototype.compile=function(){var e,t,n;for(e in this.vertexBuffers)this.vertexBuffers.hasOwnProperty(e)&&(n=this.vertexBuffers[e],n.data=this[n.name],n.compile());for(t in this.indexBuffers)this.indexBuffers.hasOwnProperty(t)&&(n=this.indexBuffers[t],n.data=this[t],n.compile())},r.plane=function(e){var t,n,i,o,a,s,l,u;for(e=e||{},t=new r(e),n=e.detailX||e.detail||1,i=e.detailY||e.detail||1,a=0;i>=a;a+=1)for(s=a/i,o=0;n>=o;o+=1)l=o/n,t.vertices.push([2*l-1,2*s-1,0]),t.coords&&t.coords.push([l,s]),t.normals&&t.normals.push([0,0,1]),n>o&&i>a&&(u=o+a*(n+1),t.triangles.push([u,u+1,u+n+1]),t.triangles.push([u+n+1,u+1,u+n+2]));return t.compile(),t},r}),define("models/energy2d/gpu/gpgpu",["require","models/energy2d/gpu/context","models/energy2d/gpu/texture","models/energy2d/gpu/shader","models/energy2d/gpu/mesh"],function(e){"use strict";var t,n,r,i,o,a,s,l,u,c=e("models/energy2d/gpu/context"),d=e("models/energy2d/gpu/texture"),h=e("models/energy2d/gpu/shader"),p=e("models/energy2d/gpu/mesh"),f=!1,m=!1,g="    varying vec2 coord;    void main() {      coord = gl_Vertex.xy * 0.5 + 0.5;      gl_Position = vec4(gl_Vertex.xyz, 1.0);    }",v="    uniform sampler2D texture;    uniform float channel;    varying vec2 coord;    float shift_right(float v, float amt) {      v = floor(v) + 0.5;      return floor(v / exp2(amt));    }    float shift_left(float v, float amt) {      return floor(v * exp2(amt) + 0.5);    }        float mask_last(float v, float bits) {      return mod(v, shift_left(1.0, bits));    }    float extract_bits(float num, float from, float to) {      from = floor(from + 0.5);      to = floor(to + 0.5);      return mask_last(shift_right(num, from), to - from);    }    vec4 encode_float(float val) {      if (val == 0.0)        return vec4(0, 0, 0, 0);      float sign = val > 0.0 ? 0.0 : 1.0;      val = abs(val);      float exponent = floor(log2(val));      float biased_exponent = exponent + 127.0;      float fraction = ((val / exp2(exponent)) - 1.0) * 8388608.0;            float t = biased_exponent / 2.0;      float last_bit_of_biased_exponent = fract(t) * 2.0;      float remaining_bits_of_biased_exponent = floor(t);            float byte4 = extract_bits(fraction, 0.0, 8.0) / 255.0;      float byte3 = extract_bits(fraction, 8.0, 16.0) / 255.0;      float byte2 = (last_bit_of_biased_exponent * 128.0 + extract_bits(fraction, 16.0, 23.0)) / 255.0;      float byte1 = (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;      return vec4(byte4, byte3, byte2, byte1);    }    void main() {      vec4 data = texture2D(texture, coord);      if (channel == 0.0)        gl_FragColor = encode_float(data.r);      else if (channel == 1.0)        gl_FragColor = encode_float(data.g);      else if (channel == 2.0)        gl_FragColor = encode_float(data.b);      else        gl_FragColor = encode_float(data.a);    }",y="    uniform sampler2D texture;    varying vec2 coord;    void main() {      gl_FragColor = texture2D(texture, coord);    }",b="GPGPU: call init(grid_width, grid_height) with proper dimensions first!",x={WebGLContext:{required:!0,available:!1},OES_texture_float:{required:!0,available:!1},"FLOAT texture as render target":{required:!0,available:!1},OES_texture_float_linear:{required:!1,available:!1}},w=function(){if(t=c.getWebGLContext(),!t)throw x.WebGLContext.available=!1,new Error("GPGPU: WebGL is not supported!");if(x.WebGLContext.available=!0,!t.getExtension("OES_texture_float"))throw x.OES_texture_float.available=!1,new Error("GPGPU: OES_texture_float is not supported!");if(x.OES_texture_float.available=!0,t.getExtension("OES_texture_float_linear")?x.OES_texture_float_linear.available=!0:(x.OES_texture_float_linear.available=!1,console.warn("GPGPU: OES_texture_float_linear is not supported. Renering quality will be affected.")),i=new d(1,1,{type:t.FLOAT,format:t.RGBA,filter:x.OES_texture_float_linear.available?t.LINEAR:t.NEAREST}),i.setAsRenderTarget(),t.checkFramebufferStatus(t.FRAMEBUFFER)!==t.FRAMEBUFFER_COMPLETE)throw t.bindFramebuffer(t.FRAMEBUFFER,null),x["FLOAT texture as render target"].available=!1,new Error("GPGPU: FLOAT texture as render target is not supported!");x["FLOAT texture as render target"].available=!0,t.bindFramebuffer(t.FRAMEBUFFER,null),t.disable(t.DEPTH_TEST),s=p.plane(),l=new h(g,v),u=new h(g,y),m=!0},_=function(e,t,n,r,i){var o,a,s;if(e.length!==t.length||e.length!==n.length||e.length!==r.length||i.length!==4*e.length)throw new Error("GPGPU: Invalid input data length.");for(o=0,s=e.length;s>o;o+=1)a=4*o,i[a]=e[o],i[a+1]=t[o],i[a+2]=n[o],i[a+3]=r[o]};return{init:function(e,s){var l;m||w(),n=e,r=s,l=x.OES_texture_float_linear.available?t.LINEAR:t.NEAREST,i=new d(n,r,{type:t.FLOAT,format:t.RGBA,filter:l}),o=new d(n,r,{type:t.UNSIGNED_BYTE,format:t.RGBA,filter:l}),a=new Float32Array(n*r*4)},get featuresInfo(){if(!m)try{w()}catch(e){}return x},getWebGLContext:function(){return void 0===t&&w(),t},createTexture:function(){return n&&r?new d(n,r,{type:t.FLOAT,format:t.RGBA,filter:x.OES_texture_float_linear.available?t.LINEAR:t.NEAREST}):new Error(b)},convertToRGBA:function(e,t,i){var o,a,s,l;if(e.length!==n*r)throw new Error("GPGPU: Invalid input data length.");for(o=void 0===i?new Float32Array(4*e.length):i,void 0===t&&(t=0),a=0,s=e.length;s>a;a+=1)l=4*a,o[l]=o[l+1]=o[l+2]=o[l+3]=0,o[l+t]=e[a];return o},writeTexture:function(e,n){var r=this.convertToRGBA(n,0,a);t.bindTexture(t.TEXTURE_2D,e.id),t.texImage2D(t.TEXTURE_2D,0,e.format,e.width,e.height,0,e.format,e.type,r)},writeRGBATexture:function(e,n,r,i,o){_(n,r,i,o,a),t.bindTexture(t.TEXTURE_2D,e.id),t.texImage2D(t.TEXTURE_2D,0,e.format,e.width,e.height,0,e.format,e.type,a)},readTexture:function(e,i,a){var u;return t&&e.width===n&&e.height===r?(void 0===a&&(a=0),u=new Uint8Array(i.buffer),e.bind(),o.setAsRenderTarget(),l.uniforms({channel:a}),l.draw(s),t.readPixels(0,0,o.width,o.height,o.format,o.type,u),void 0):new Error(b)},copyTexture:function(e,t){e.bind(),t.setAsRenderTarget(),u.draw(s)},executeProgram:function(e,t,n){var r,o;for(r=0,o=t.length;o>r;r+=1)t[r].bind(r);for(i.setAsRenderTarget(),e.draw(s),r=0,o=t.length;o>r;r+=1)t[r].unbind(r);n.swapWith(i)},setSynchronizationAllowed:function(e){f=e},tryFinish:function(){f&&t.finish()}}}),define("text!models/energy2d/models/physics-solvers-gpu/heat-solver-glsl/basic.vs.glsl",[],function(){return"varying vec2 coord;\n\nvoid main() {\n  coord = gl_Vertex.xy * 0.5 + 0.5;\n  gl_Position = vec4(gl_Vertex.xy, 0.0, 1.0);\n}\n"}),define("text!models/energy2d/models/physics-solvers-gpu/heat-solver-glsl/solver.fs.glsl",[],function(){return'// texture 0:\n// - R: t\n// - G: t0\n// - B: tb\n// - A: conductivity\nuniform sampler2D data0_tex;\n// texture 1:\n// - R: q\n// - G: capacity\n// - B: density\n// - A: fluidity\nuniform sampler2D data1_tex;\n\nuniform vec2 grid;\nuniform float hx;\nuniform float hy;\nuniform float inv_timeStep;\n\n// Boundary conditions uniforms\nuniform float enforce_temp;\nuniform float vN;\nuniform float vS;\nuniform float vW;\nuniform float vE;\n\nvarying vec2 coord;\n\nvoid main() {\n  vec4 data0 = texture2D(data0_tex, coord);\n  if (coord.x > grid.x && coord.x < 1.0 - grid.x &&\n      coord.y > grid.y && coord.y < 1.0 - grid.y) {\n    vec2 dx = vec2(grid.x, 0.0);\n    vec2 dy = vec2(0.0, grid.y);\n    float tb = data0.b;\n    // Check if tb is NaN. isnan() function is not available\n    // in OpenGL ES GLSL, so use some tricks. IEEE 754 spec defines\n    // that NaN != NaN, however this seems to not work on Windows.\n    // So, also check if the value is outside [-3.4e38, 3.4e38] (3.4e38\n    // is close to 32Float max value), as such values are not expected.\n    if (tb != tb || tb < -3.4e38 || tb > 3.4e38) {\n      vec4 data1 = texture2D(data1_tex, coord);\n      vec4 data0_m_dy = texture2D(data0_tex, coord - dy);\n      vec4 data0_p_dy = texture2D(data0_tex, coord + dy);\n      vec4 data0_m_dx = texture2D(data0_tex, coord - dx);\n      vec4 data0_p_dx = texture2D(data0_tex, coord + dx);\n      float sij = data1.g * data1.b * inv_timeStep;\n      float rij = data0.a;\n      float axij = hx * (rij + data0_m_dy.a);\n      float bxij = hx * (rij + data0_p_dy.a);\n      float ayij = hy * (rij + data0_m_dx.a);\n      float byij = hy * (rij + data0_p_dx.a);\n      data0.r = (data0.g * sij + data1.r\n                 + axij * data0_m_dy.r\n                 + bxij * data0_p_dy.r\n                 + ayij * data0_m_dx.r\n                 + byij * data0_p_dx.r)\n                 / (sij + axij + bxij + ayij + byij);\n    } else {\n      data0.r = tb;\n    }\n  } else if (enforce_temp == 1.0) {\n    // "temperature at border" boundary conditions are\n    // integrated into this shader.\n    if (coord.x < grid.x) {\n      data0.r = vN;\n    } else if (coord.x > 1.0 - grid.x) {\n      data0.r = vS;\n    } else if (coord.y < grid.y) {\n      data0.r = vW;\n    } else if (coord.y > 1.0 - grid.y) {\n      data0.r = vE;\n    }\n  }\n  gl_FragColor = data0;\n}\n'}),define("text!models/energy2d/models/physics-solvers-gpu/heat-solver-glsl/force-flux-t.fs.glsl",[],function(){return"// texture 0: \n// - R: t\n// - G: t0\n// - B: tb\n// - A: conductivity\nuniform sampler2D data0_tex;\n\nuniform vec2 grid;\nuniform float vN;\nuniform float vS;\nuniform float vW;\nuniform float vE;\nuniform float delta_x;\nuniform float delta_y;\n\nvarying vec2 coord;\n\nvoid main() {\n  vec4 data0 = texture2D(data0_tex, coord);\n  vec2 dx = vec2(grid.x, 0.0);\n  vec2 dy = vec2(0.0, grid.y);\n  if (coord.x < grid.x) {\n    data0.r = texture2D(data0_tex, coord + dx).r\n            + vN * delta_y / data0.a;\n  } else if (coord.x > 1.0 - grid.x) {\n    data0.r = texture2D(data0_tex, coord - dx).r\n            - vS * delta_y / data0.a;\n  } else if (coord.y < grid.y) {\n    data0.r = texture2D(data0_tex, coord + dy).r\n            - vW * delta_x / data0.a;\n  } else if (coord.y > 1.0 - grid.y) {\n    data0.r = texture2D(data0_tex, coord - dy).r\n            + vE * delta_x / data0.a;\n  }\n  gl_FragColor = data0;\n}\n"}),define("text!models/energy2d/models/physics-solvers-gpu/heat-solver-glsl/t-to-t0.fs.glsl",[],function(){return"// texture 0: \n// - R: t\n// - G: t0\n// - B: tb\n// - A: conductivity\nuniform sampler2D data0_tex;\n\nvarying vec2 coord;\n\nvoid main() {\n	vec4 data0 = texture2D(data0_tex, coord);\n	data0.g = data0.r;\n	gl_FragColor = data0;\n}\n"}),define("text!models/energy2d/models/physics-solvers-gpu/heat-solver-glsl/maccormack-step1.fs.glsl",[],function(){return'// texture 0: \n// - R: t\n// - G: t0\n// - B: tb\n// - A: conductivity\nuniform sampler2D data0_tex;\n// texture 1: \n// - R: q\n// - G: capacity\n// - B: density\n// - A: fluidity\nuniform sampler2D data1_tex;\n// texture 2: \n// - R: u\n// - G: v\n// - B: u0\n// - A: v0\nuniform sampler2D data2_tex;\n\nuniform vec2 grid;\nuniform float tx;\nuniform float ty;\n\n// Boundary conditions uniforms.\nuniform float enforce_temp;\nuniform float vN;\nuniform float vS;\nuniform float vW;\nuniform float vE;\n\nvarying vec2 coord;\n\nvoid main() {\n  vec4 data0 = texture2D(data0_tex, coord);\n  \n  if (coord.x > grid.x && coord.x < 1.0 - grid.x &&\n      coord.y > grid.y && coord.y < 1.0 - grid.y) {\n    \n    float fluidity = texture2D(data1_tex, coord).a;\n    if (fluidity == 1.0) {\n      vec2 dx = vec2(grid.x, 0.0);\n      vec2 dy = vec2(0.0, grid.y);\n\n      // Temperature.\n      float t_m_dy = texture2D(data0_tex, coord - dy).r;\n      float t_p_dy = texture2D(data0_tex, coord + dy).r;\n      float t_m_dx = texture2D(data0_tex, coord - dx).r;\n      float t_p_dx = texture2D(data0_tex, coord + dx).r;\n      // Velocity.\n      float u_m_dy = texture2D(data2_tex, coord - dy).r;\n      float u_p_dy = texture2D(data2_tex, coord + dy).r;\n      float v_m_dx = texture2D(data2_tex, coord - dx).g;\n      float v_p_dx = texture2D(data2_tex, coord + dx).g;\n      // Update T0.\n      data0.g = data0.r - tx * (u_p_dy * t_p_dy - u_m_dy * t_m_dy)\n                        - ty * (v_p_dx * t_p_dx - v_m_dx * t_m_dx);\n    }\n  } else if (enforce_temp == 1.0) {\n    // "temperature at border" boundary conditions are\n    // integrated into this shader.\n    if (coord.x < grid.x) {\n      data0.g = vN;\n    } else if (coord.x > 1.0 - grid.x) {\n      data0.g = vS;\n    } else if (coord.y < grid.y) {\n      data0.g = vW;\n    } else if (coord.y > 1.0 - grid.y) {\n      data0.g = vE;\n    }\n  }\n  gl_FragColor = data0;\n}\n'}),define("text!models/energy2d/models/physics-solvers-gpu/heat-solver-glsl/maccormack-step2.fs.glsl",[],function(){return'// texture 0: \n// - R: t\n// - G: t0\n// - B: tb\n// - A: conductivity\nuniform sampler2D data0_tex;\n// texture 1: \n// - R: q\n// - G: capacity\n// - B: density\n// - A: fluidity\nuniform sampler2D data1_tex;\n// texture 2: \n// - R: u\n// - G: v\n// - B: u0\n// - A: v0\nuniform sampler2D data2_tex;\n\nuniform vec2 grid;\nuniform float tx;\nuniform float ty;\n\n// Boundary conditions uniforms.\nuniform float enforce_temp;\nuniform float vN;\nuniform float vS;\nuniform float vW;\nuniform float vE;\n\nvarying vec2 coord;\n\nvoid main() {\n  vec4 data0 = texture2D(data0_tex, coord);\n  \n  if (coord.x > grid.x && coord.x < 1.0 - grid.x &&\n      coord.y > grid.y && coord.y < 1.0 - grid.y) {\n    \n    float fluidity = texture2D(data1_tex, coord).a;\n    if (fluidity == 1.0) {\n      vec2 dx = vec2(grid.x, 0.0);\n      vec2 dy = vec2(0.0, grid.y);\n\n      // Temperature t0.\n      float t0_m_dy = texture2D(data0_tex, coord - dy).g;\n      float t0_p_dy = texture2D(data0_tex, coord + dy).g;\n      float t0_m_dx = texture2D(data0_tex, coord - dx).g;\n      float t0_p_dx = texture2D(data0_tex, coord + dx).g;\n      // Velocity.\n      float u = texture2D(data2_tex, coord).r;\n      float v = texture2D(data2_tex, coord).g;\n      // Update T.\n      data0.r = 0.5 * (data0.r + data0.g)\n              - 0.5 * tx * u * (t0_p_dy - t0_m_dy)\n              - 0.5 * ty * v * (t0_p_dx - t0_m_dx);\n    }\n  } else if (enforce_temp == 1.0) {\n    // "temperature at border" boundary conditions are\n    // integrated into this shader.\n    if (coord.x < grid.x) {\n      data0.r = vN;\n    } else if (coord.x > 1.0 - grid.x) {\n      data0.r = vS;\n    } else if (coord.y < grid.y) {\n      data0.r = vW;\n    } else if (coord.y > 1.0 - grid.y) {\n      data0.r = vE;\n    }\n  }\n  gl_FragColor = data0;\n}\n'}),define("models/energy2d/models/physics-solvers-gpu/heat-solver-gpu",["require","exports","module","models/energy2d/gpu/shader","models/energy2d/gpu/gpgpu","text!models/energy2d/models/physics-solvers-gpu/heat-solver-glsl/basic.vs.glsl","text!models/energy2d/models/physics-solvers-gpu/heat-solver-glsl/solver.fs.glsl","text!models/energy2d/models/physics-solvers-gpu/heat-solver-glsl/force-flux-t.fs.glsl","text!models/energy2d/models/physics-solvers-gpu/heat-solver-glsl/force-flux-t.fs.glsl","text!models/energy2d/models/physics-solvers-gpu/heat-solver-glsl/t-to-t0.fs.glsl","text!models/energy2d/models/physics-solvers-gpu/heat-solver-glsl/maccormack-step1.fs.glsl","text!models/energy2d/models/physics-solvers-gpu/heat-solver-glsl/maccormack-step2.fs.glsl"],function(e,t){"use strict";var n=e("models/energy2d/gpu/shader"),r=e("models/energy2d/gpu/gpgpu"),i=e("text!models/energy2d/models/physics-solvers-gpu/heat-solver-glsl/basic.vs.glsl"),o=e("text!models/energy2d/models/physics-solvers-gpu/heat-solver-glsl/solver.fs.glsl"),a=e("text!models/energy2d/models/physics-solvers-gpu/heat-solver-glsl/force-flux-t.fs.glsl"),s=e("text!models/energy2d/models/physics-solvers-gpu/heat-solver-glsl/force-flux-t.fs.glsl"),l=e("text!models/energy2d/models/physics-solvers-gpu/heat-solver-glsl/t-to-t0.fs.glsl"),u=e("text!models/energy2d/models/physics-solvers-gpu/heat-solver-glsl/maccormack-step1.fs.glsl"),c=e("text!models/energy2d/models/physics-solvers-gpu/heat-solver-glsl/maccormack-step2.fs.glsl"),d=10;t.makeHeatSolverGPU=function(e){var t=new n(i,o),h=new n(i,a),p=new n(i,s),f=new n(i,l),m=new n(i,u),g=new n(i,c),v=e.getModelOptions(),y=v.grid_width,b=v.grid_height,x=v.timeStep,w=v.boundary,_=v.model_width/v.grid_width,T=v.model_height/v.grid_height,A=d,C=e.getSimulationTexture(0),E=e.getSimulationTexture(1),S=e.getSimulationTexture(2),k=[C,E,S],P=[C,E],R=[C],O=[1/b,1/y],M=function(){var e;e={data0_tex:0,data1_tex:1,grid:O,enforce_temp:0,hx:.5/(_*_),hy:.5/(T*T),inv_timeStep:1/x},t.uniforms(e),e={data0_tex:0,data1_tex:1,data2_tex:2,grid:O,enforce_temp:0,tx:.5*x/_,ty:.5*x/T},m.uniforms(e),g.uniforms(e),"temperature"===w.type?(e={enforce_temp:1,vN:w.upper,vS:w.lower,vW:w.left,vE:w.right},t.uniforms(e),m.uniforms(e),g.uniforms(e)):"flux"===w.type&&(e={data0_tex:0,grid:O,vN:w.upper,vS:w.lower,vW:w.left,vE:w.right,delta_x:_,delta_y:T},h.uniforms(e),p.uniforms(e))},N=function(){r.executeProgram(m,k,C),"flux"===w.type&&r.executeProgram(p,R,C),r.executeProgram(g,k,C),"flux"===w.type&&r.executeProgram(h,R,C)},I={solve:function(e){var n;for(r.executeProgram(f,R,C),n=0;A>n;n+=1)r.executeProgram(t,P,C),"flux"===w.type&&r.executeProgram(h,R,C);e&&N()}};return M(),I}}),define("models/energy2d/models/physics-solvers/fluid-solver",["require","exports","module","arrays"],function(e,t){"use strict";var n=e("arrays"),r=5,i=0,o=0,a=1;t.makeFluidSolver=function(e){var t=e.getModelOptions(),s=t.grid_width,l=t.grid_height,u=r,c=i,d=e.getTemperatureArray(),h=e.getFluidityArray(),p=e.getUWindArray(),f=e.getVWindArray(),m=e.getArrayType(),g=n.create(s*l,0,m),v=n.create(s*l,0,m),y=s-1,b=l-1,x=s-2,w=l-2,_=t.model_width/t.grid_width,T=t.model_height/t.grid_height,A=.5/_,C=.5/T,E=1/(_*_),S=1/(T*T),k=function(e,t){var n,r,i,o,a,l,u,c=1===e,d=2===e,h=y*s,p=x*s;for(n=1;y>n;n+=1)i=n*s,o=i+1,a=i+b,l=i+w,t[i]=d?-t[o]:t[o],t[a]=d?-t[l]:t[l];for(r=1;b>r;r+=1)u=s+r,t[r]=c?-t[u]:t[u],t[h+r]=c?-t[p+r]:t[p+r];t[0]=.5*(t[s]+t[1]),t[h]=.5*(t[p]+t[h+1]),t[b]=.5*(t[s+b]+t[w]),t[h+b]=.5*(t[p+b]+t[h+w])},P=function(e,t){var n,r,i,o,a,l,u,c,d,m,g=0;for(i=1;y>i;i+=1)for(a=i*s,o=1;b>o;o+=1)l=a+o,c=l-s,u=l+s,m=l-1,d=l+1,h[l]||(n=p[l],r=f[l],g=0,h[c]?(g+=1,e[l]=n-e[c],t[l]=r+t[c]):h[u]&&(g+=1,e[l]=n-e[u],t[l]=r+t[u]),h[m]?(g+=1,e[l]=n+e[m],t[l]=r-t[m]):h[d]&&(g+=1,e[l]=n+e[d],t[l]=r-t[d]),0===g&&(e[l]=n,t[l]=r))},R=function(e){var t,n,r,i,o,a,l,u;for(t=1;y>t;t+=1)for(r=t*s,n=1;b>n;n+=1)i=r+n,h[i]||(a=i-s,o=i+s,u=i-1,l=i+1,h[a]?e[i]=e[a]:h[o]&&(e[i]=e[o]),h[u]?e[i]=e[u]:h[l]&&(e[i]=e[l]))},O=function(e,t){var n,r,i=0,o=l,a=0;for(n=t-1;n>0;n-=1)if(r=e*s+n,!h[r]){i=n;break}for(n=t+1;l>n;n+=1)if(r=e*s+n,!h[r]){o=n;break}for(n=i;o>n;n+=1)r=e*s+n,a+=d[r];return a/(o-i)},M=function(e){var n,r,i,l,u,p=c*t.timeStep,f=t.thermal_buoyancy*t.timeStep;switch(t.buoyancy_approximation){case o:for(n=function(e){var t,n=0,r=e.length;for(t=0;r>t;t+=1)n+=e[t];return n/r}(d),r=1;y>r;r+=1)for(l=r*s,i=1;b>i;i+=1)u=l+i,h[u]&&(e[u]+=(p-f)*d[u]+f*n);break;case a:for(r=1;y>r;r+=1)for(l=r*s,i=1;b>i;i+=1)u=l+i,h[u]&&(n=O(r,i),e[u]+=(p-f)*d[u]+f*n)}},N=function(e,t,n,r){var i,o,a,l,c,d,p,f,m,g=.5/(E+S);for(o=1;y>o;o+=1)for(l=o*s,a=1;b>a;a+=1)c=l+a,h[c]&&(p=c-s,d=c+s,m=c-1,f=c+1,r[c]=(e[d]-e[p])*A+(t[f]-t[m])*C,n[c]=0);for(k(0,r),k(0,n),R(r),R(n),i=0;u>i;i+=1)for(o=1;y>o;o+=1)for(l=o*s,a=1;b>a;a+=1)c=l+a,h[c]&&(p=c-s,d=c+s,m=c-1,f=c+1,n[c]=g*((n[p]+n[d])*E+(n[m]+n[f])*S-r[c]));for(o=1;y>o;o+=1)for(l=o*s,a=1;b>a;a+=1)c=l+a,h[c]&&(p=c-s,d=c+s,m=c-1,f=c+1,e[c]-=(n[d]-n[p])*A,t[c]-=(n[f]-n[m])*C);k(1,e),k(2,t)},I=function(e,r,i){var o,a,l,c,d,p,f,m,g,v=t.timeStep,x=t.background_viscosity,w=v*x*E,_=v*x*S,T=1/(1+2*(w+_));for(n.copy(i,r),o=0;u>o;o+=1){for(a=1;y>a;a+=1)for(c=a*s,l=1;b>l;l+=1)d=c+l,h[d]&&(f=d-s,p=d+s,g=d-1,m=d+1,i[d]=(r[d]+w*(i[f]+i[p])+_*(i[g]+i[m]))*T);k(e,i)}},L=function(e,r,i){var o,a,l,u,c,d,p,f,m=t.timeStep,x=.5*m/_,w=.5*m/T;for(o=1;y>o;o+=1)for(l=o*s,a=1;b>a;a+=1)u=l+a,h[u]&&(d=u-s,c=u+s,f=u-1,p=u+1,i[u]=r[u]-x*(g[c]*r[c]-g[d]*r[d])-w*(v[p]*r[p]-v[f]*r[f]));for(k(e,i),o=1;y>o;o+=1)for(l=o*s,a=1;b>a;a+=1)u=l+a,h[u]&&(d=u-s,c=u+s,f=u-1,p=u+1,r[u]=.5*(r[u]+i[u])-.5*x*g[u]*(i[c]-i[d])-.5*w*v[u]*(i[p]-i[f]));n.copy(r,i),k(e,i)},B=function(e,t,n){L(e,t,n)};return{solve:function(e,r){0!==t.thermal_buoyancy&&M(r),P(e,r),t.background_viscosity>0&&(I(1,g,e),I(2,v,r),N(e,r,g,v),P(e,r)),n.copy(e,g),n.copy(r,v),B(1,g,e),B(2,v,r),N(e,r,g,v),P(e,r)}}}}),define("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/basic.vs.glsl",[],function(){return"varying vec2 coord;\n\nvoid main() {\n  coord = gl_Vertex.xy * 0.5 + 0.5;\n  gl_Position = vec4(gl_Vertex.xy, 0.0, 1.0);\n}\n"}),define("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/maccormack-step1.fs.glsl",[],function(){return"// texture 1: \n// - R: q\n// - G: capacity\n// - B: density\n// - A: fluidity\nuniform sampler2D data1_tex;\n// texture 2: \n// - R: u\n// - G: v\n// - B: u0\n// - A: v0\nuniform sampler2D data2_tex;\n\nuniform vec2 grid;\nuniform float tx;\nuniform float ty;\n\nvarying vec2 coord;\n\nvoid main() {\n  vec4 data2 = texture2D(data2_tex, coord);\n  float fluidity = texture2D(data1_tex, coord).a;\n  \n  if (coord.x > grid.x && coord.x < 1.0 - grid.x &&\n      coord.y > grid.y && coord.y < 1.0 - grid.y &&\n      fluidity == 1.0) {\n    \n    vec2 dx = vec2(grid.x, 0.0);\n    vec2 dy = vec2(0.0, grid.y);\n    \n    vec4 data2_m_dy = texture2D(data2_tex, coord - dy);\n    vec4 data2_p_dy = texture2D(data2_tex, coord + dy);\n    vec4 data2_m_dx = texture2D(data2_tex, coord - dx);\n    vec4 data2_p_dx = texture2D(data2_tex, coord + dx);\n    // Update velocity UV components.\n    data2.rg = data2.ba - tx * (data2_p_dy.bb * data2_p_dy.ba - data2_m_dy.bb * data2_m_dy.ba)\n              - ty * (data2_p_dx.aa * data2_p_dx.ba - data2_m_dx.aa * data2_m_dx.ba);\n  }\n\n  gl_FragColor = data2;\n}\n"
}),define("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/maccormack-step2.fs.glsl",[],function(){return"// texture 1: \n// - R: q\n// - G: capacity\n// - B: density\n// - A: fluidity\nuniform sampler2D data1_tex;\n// texture 2: \n// - R: u\n// - G: v\n// - B: u0\n// - A: v0\nuniform sampler2D data2_tex;\n\nuniform vec2 grid;\nuniform float tx;\nuniform float ty;\n\nvarying vec2 coord;\n\nvoid main() {\n  vec4 data2 = texture2D(data2_tex, coord);\n  float fluidity = texture2D(data1_tex, coord).a;\n  \n  if (coord.x > grid.x && coord.x < 1.0 - grid.x &&\n      coord.y > grid.y && coord.y < 1.0 - grid.y &&\n      fluidity == 1.0) {\n    \n    vec2 dx = vec2(grid.x, 0.0);\n    vec2 dy = vec2(0.0, grid.y);\n    \n    vec4 data2_m_dy = texture2D(data2_tex, coord - dy);\n    vec4 data2_p_dy = texture2D(data2_tex, coord + dy);\n    vec4 data2_m_dx = texture2D(data2_tex, coord - dx);\n    vec4 data2_p_dx = texture2D(data2_tex, coord + dx);\n    // Update velocity UV components.\n    data2.rg = 0.5 * (data2.ba + data2.rg) \n            - 0.5 * tx * data2.bb * (data2_p_dy.rg - data2_m_dy.rg)\n            - 0.5 * ty * data2.aa * (data2_p_dx.rg - data2_m_dx.rg);\n  }\n\n  gl_FragColor = data2;\n}\n"}),define("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/apply-uv-boundary.fs.glsl",[],function(){return"// texture 2: \n// - R: u\n// - G: v\n// - B: u0\n// - A: v0\nuniform sampler2D data2_tex;\n\nuniform vec2 grid;\n\nvarying vec2 coord;\n\nvoid main() {\n  vec4 data2 = texture2D(data2_tex, coord);\n  vec2 dx = vec2(grid.x, 0.0);\n  vec2 dy = vec2(0.0, grid.y);\n  // Process corners.\n  // TODO: values from previous step are used for corners.\n  if (coord.x < grid.x && coord.y < grid.y) {  \n    vec4 data2_p_dy = texture2D(data2_tex, coord + dy);\n    vec4 data2_p_dx = texture2D(data2_tex, coord + dx);\n    data2.rg = 0.5 * (data2_p_dy.rg + data2_p_dx.rg);\n  }\n  else if (coord.x > 1.0 - grid.x && coord.y < grid.y) {  \n    vec4 data2_p_dy = texture2D(data2_tex, coord + dy);\n    vec4 data2_m_dx = texture2D(data2_tex, coord - dx);\n    data2.rg = 0.5 * (data2_p_dy.rg + data2_m_dx.rg);\n  }\n  else if (coord.x > 1.0 - grid.x && coord.y > 1.0 - grid.y) {  \n    vec4 data2_m_dy = texture2D(data2_tex, coord - dy);\n    vec4 data2_m_dx = texture2D(data2_tex, coord - dx);\n    data2.rg = 0.5 * (data2_m_dy.rg + data2_m_dx.rg);\n  }\n  else if (coord.x < grid.x && coord.y > 1.0 - grid.y) {  \n    vec4 data2_m_dy = texture2D(data2_tex, coord - dy);\n    vec4 data2_p_dx = texture2D(data2_tex, coord + dx);\n    data2.rg = 0.5 * (data2_m_dy.rg + data2_p_dx.rg);\n  }\n  // Process boundaries.\n  // Left.\n  else if (coord.x < grid.x) {\n    vec4 data2_p_dx = texture2D(data2_tex, coord + dx);\n    data2.rg = vec2(data2_p_dx.r, -data2_p_dx.g);\n  }\n  // Right.\n  else if (coord.x > 1.0 - grid.x) {\n    vec4 data2_m_dx = texture2D(data2_tex, coord - dx);\n    data2.rg = vec2(data2_m_dx.r, -data2_m_dx.g);\n  }\n  // Down.\n  else if (coord.y < grid.y) {\n    vec4 data2_p_dy = texture2D(data2_tex, coord + dy);\n    data2.rg = vec2(-data2_p_dy.r, data2_p_dy.g);\n  }\n  // Up.\n  else if (coord.y > 1.0 - grid.y) {\n    vec4 data2_m_dy = texture2D(data2_tex, coord - dy);\n    data2.rg = vec2(-data2_m_dy.r, data2_m_dy.g);\n  }\n  \n  gl_FragColor = data2;\n}\n"}),define("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/apply-u0v0-boundary.fs.glsl",[],function(){return"// texture 2: \n// - R: u\n// - G: v\n// - B: u0\n// - A: v0\nuniform sampler2D data2_tex;\n\nuniform vec2 grid;\n\nvarying vec2 coord;\n\nvoid main() {\n  vec4 data2 = texture2D(data2_tex, coord);\n  vec2 dx = vec2(grid.x, 0.0);\n  vec2 dy = vec2(0.0, grid.y);\n  // Process corners.\n  // TODO: values from previous step are used for corners.\n  if (coord.x < grid.x && coord.y < grid.y) {  \n    vec4 data2_p_dy = texture2D(data2_tex, coord + dy);\n    vec4 data2_p_dx = texture2D(data2_tex, coord + dx);\n    data2.ba = 0.5 * (data2_p_dy.ba + data2_p_dx.ba);\n  }\n  else if (coord.x > 1.0 - grid.x && coord.y < grid.y) {  \n    vec4 data2_p_dy = texture2D(data2_tex, coord + dy);\n    vec4 data2_m_dx = texture2D(data2_tex, coord - dx);\n    data2.ba = 0.5 * (data2_p_dy.ba + data2_m_dx.ba);\n  }\n  else if (coord.x > 1.0 - grid.x && coord.y > 1.0 - grid.y) {  \n    vec4 data2_m_dy = texture2D(data2_tex, coord - dy);\n    vec4 data2_m_dx = texture2D(data2_tex, coord - dx);\n    data2.ba = 0.5 * (data2_m_dy.ba + data2_m_dx.ba);\n  }\n  else if (coord.x < grid.x && coord.y > 1.0 - grid.y) {  \n    vec4 data2_m_dy = texture2D(data2_tex, coord - dy);\n    vec4 data2_p_dx = texture2D(data2_tex, coord + dx);\n    data2.ba = 0.5 * (data2_m_dy.ba + data2_p_dx.ba);\n  }\n  // Process boundaries.\n  // Left.\n  else if (coord.x < grid.x) {\n    data2.ba = texture2D(data2_tex, coord + dx).ba;\n  }\n  // Right.\n  else if (coord.x > 1.0 - grid.x) {\n    data2.ba = texture2D(data2_tex, coord - dx).ba;\n  }\n  // Down.\n  else if (coord.y < grid.y) {\n    data2.ba = texture2D(data2_tex, coord + dy).ba;\n  }\n  // Up.\n  else if (coord.y > 1.0 - grid.y) {\n    data2.ba = texture2D(data2_tex, coord - dy).ba;\n  }\n  \n  gl_FragColor = data2;\n}\n"}),define("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/set-obstacle-boundary.fs.glsl",[],function(){return"// texture 1: \n// - R: q\n// - G: capacity\n// - B: density\n// - A: fluidity\nuniform sampler2D data1_tex;\n// texture 2: \n// - R: u\n// - G: v\n// - B: u0\n// - A: v0\nuniform sampler2D data2_tex;\n\nuniform vec2 grid;\n\nvarying vec2 coord;\n\nvoid main() {\n  vec4 data2 = texture2D(data2_tex, coord);\n  float fluidity = texture2D(data1_tex, coord).a;\n  \n  if (coord.x > grid.x && coord.x < 1.0 - grid.x &&\n      coord.y > grid.y && coord.y < 1.0 - grid.y &&\n      fluidity == 0.0) {\n    \n    vec2 dx = vec2(grid.x, 0.0);\n    vec2 dy = vec2(0.0, grid.y);\n\n    if (texture2D(data1_tex, coord - dy).a == 1.0) {\n      data2.ba = texture2D(data2_tex, coord - dy).ba;\n    } \n    else if (texture2D(data1_tex, coord + dy).a == 1.0) {\n      data2.ba = texture2D(data2_tex, coord + dy).ba;\n    } \n\n    if (texture2D(data1_tex, coord - dx).a == 1.0) {\n      data2.ba = texture2D(data2_tex, coord - dx).ba;\n    } \n    else if (texture2D(data1_tex, coord + dx).a == 1.0) {\n      data2.ba = texture2D(data2_tex, coord + dx).ba;\n    } \n  }\n\n  gl_FragColor = data2;\n}\n"}),define("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/set-obstacle-velocity.fs.glsl",[],function(){return"// texture 1: \n// - R: q\n// - G: capacity\n// - B: density\n// - A: fluidity\nuniform sampler2D data1_tex;\n// texture 2: \n// - R: u\n// - G: v\n// - B: u0\n// - A: v0\nuniform sampler2D data2_tex;\n// texture 3: \n// - R: uWind\n// - G: vWind\n// - B: undefined\n// - A: undefined\nuniform sampler2D data3_tex;\n\nuniform vec2 grid;\n\nvarying vec2 coord;\n\nvoid main() {\n  vec4 data2 = texture2D(data2_tex, coord);\n  float fluidity = texture2D(data1_tex, coord).a;\n\n  if (coord.x > grid.x && coord.x < 1.0 - grid.x &&\n      coord.y > grid.y && coord.y < 1.0 - grid.y &&\n      fluidity == 0.0) {\n    \n    vec2 dx = vec2(grid.x, 0.0);\n    vec2 dy = vec2(0.0, grid.y);\n\n    int count = 0;\n\n    if (texture2D(data1_tex, coord - dy).a == 1.0) {\n      count += 1;\n      vec2 data2_m_dy = texture2D(data2_tex, coord - dy).rg;\n      data2.rg = texture2D(data3_tex, coord).rg + vec2(-data2_m_dy.r, data2_m_dy.g);\n    } \n    else if (texture2D(data1_tex, coord + dy).a == 1.0) {\n      count += 1;\n      vec2 data2_p_dy = texture2D(data2_tex, coord + dy).rg;\n      data2.rg = texture2D(data3_tex, coord).rg + vec2(-data2_p_dy.r, data2_p_dy.g);\n    } \n\n    if (texture2D(data1_tex, coord - dx).a == 1.0) {\n      count += 1;\n      vec2 data2_m_dx = texture2D(data2_tex, coord - dx).rg;\n      data2.rg = texture2D(data3_tex, coord).rg + vec2(data2_m_dx.r, -data2_m_dx.g);\n    } \n    else if (texture2D(data1_tex, coord + dx).a == 1.0) {\n      count += 1;\n      vec2 data2_p_dx = texture2D(data2_tex, coord + dx).rg;\n      data2.rg = texture2D(data3_tex, coord).rg + vec2(data2_p_dx.r, -data2_p_dx.g);\n    } \n\n    if (count == 0) {\n      data2.rg = texture2D(data3_tex, coord).rg;\n    }\n  }\n  \n  gl_FragColor = data2;\n}\n"}),define("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/uv-to-u0v0.fs.glsl",[],function(){return"// texture 2: \n// - R: u\n// - G: v\n// - B: u0\n// - A: v0\nuniform sampler2D data2_tex;\n\nvarying vec2 coord;\n\nvoid main() {\n	vec4 data2 = texture2D(data2_tex, coord);\n	data2.ba = data2.rg;\n	gl_FragColor = data2;\n}\n"}),define("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/conserve-step1.fs.glsl",[],function(){return"// texture 1: \n// - R: q\n// - G: capacity\n// - B: density\n// - A: fluidity\nuniform sampler2D data1_tex;\n// texture 2: \n// - R: u\n// - G: v\n// - B: u0\n// - A: v0\nuniform sampler2D data2_tex;\n\nuniform vec2 grid;\nuniform float i2dx;\nuniform float i2dy;\n\nvarying vec2 coord;\n\nvoid main() {\n  vec4 data2 = texture2D(data2_tex, coord);\n  float fluidity = texture2D(data1_tex, coord).a;\n  \n  if (coord.x > grid.x && coord.x < 1.0 - grid.x &&\n      coord.y > grid.y && coord.y < 1.0 - grid.y &&\n      fluidity == 1.0) {\n    \n    vec2 dx = vec2(grid.x, 0.0);\n    vec2 dy = vec2(0.0, grid.y);\n    \n    vec4 data2_m_dy = texture2D(data2_tex, coord - dy);\n    vec4 data2_p_dy = texture2D(data2_tex, coord + dy);\n    vec4 data2_m_dx = texture2D(data2_tex, coord - dx);\n    vec4 data2_p_dx = texture2D(data2_tex, coord + dx);\n    \n    // Phi.\n    data2.b = 0.0;\n    // Div.\n    data2.a = (data2_p_dy.r - data2_m_dy.r) * i2dx + (data2_p_dx.g - data2_m_dx.g) * i2dy;\n  }\n\n  gl_FragColor = data2;\n}\n"}),define("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/conserve-step2.fs.glsl",[],function(){return"// texture 1: \n// - R: q\n// - G: capacity\n// - B: density\n// - A: fluidity\nuniform sampler2D data1_tex;\n// texture 2: \n// - R: u\n// - G: v\n// - B: u0\n// - A: v0\nuniform sampler2D data2_tex;\n\nuniform vec2 grid;\nuniform float s;\nuniform float idxsq;\nuniform float idysq;\n\nvarying vec2 coord;\n\nvoid main() {\n  vec4 data2 = texture2D(data2_tex, coord);\n  float fluidity = texture2D(data1_tex, coord).a;\n  \n  if (coord.x > grid.x && coord.x < 1.0 - grid.x &&\n      coord.y > grid.y && coord.y < 1.0 - grid.y &&\n      fluidity == 1.0) {\n    \n    vec2 dx = vec2(grid.x, 0.0);\n    vec2 dy = vec2(0.0, grid.y);\n    \n    vec4 data2_m_dy = texture2D(data2_tex, coord - dy);\n    vec4 data2_p_dy = texture2D(data2_tex, coord + dy);\n    vec4 data2_m_dx = texture2D(data2_tex, coord - dx);\n    vec4 data2_p_dx = texture2D(data2_tex, coord + dx);\n    \n    // Phi.\n    data2.b = s * ((data2_m_dy.b + data2_p_dy.b) * idxsq + (data2_m_dx.b + data2_p_dx.b) * idysq - data2.a);\n  }\n\n  gl_FragColor = data2;\n}\n"}),define("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/conserve-step3.fs.glsl",[],function(){return"// texture 1: \n// - R: q\n// - G: capacity\n// - B: density\n// - A: fluidity\nuniform sampler2D data1_tex;\n// texture 2: \n// - R: u\n// - G: v\n// - B: u0\n// - A: v0\nuniform sampler2D data2_tex;\n\nuniform vec2 grid;\nuniform float i2dx;\nuniform float i2dy;\n\nvarying vec2 coord;\n\nvoid main() {\n  vec4 data2 = texture2D(data2_tex, coord);\n  float fluidity = texture2D(data1_tex, coord).a;\n  \n  if (coord.x > grid.x && coord.x < 1.0 - grid.x &&\n      coord.y > grid.y && coord.y < 1.0 - grid.y &&\n      fluidity == 1.0) {\n    \n    vec2 dx = vec2(grid.x, 0.0);\n    vec2 dy = vec2(0.0, grid.y);\n    \n    vec4 data2_m_dy = texture2D(data2_tex, coord - dy);\n    vec4 data2_p_dy = texture2D(data2_tex, coord + dy);\n    vec4 data2_m_dx = texture2D(data2_tex, coord - dx);\n    vec4 data2_p_dx = texture2D(data2_tex, coord + dx);\n    \n    // U.\n    data2.r -= (data2_p_dy.b - data2_m_dy.b) * i2dx;\n    // V.\n    data2.g -= (data2_p_dx.b - data2_m_dx.b) * i2dy;\n  }\n\n  gl_FragColor = data2;\n}\n"}),define("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/diffuse.fs.glsl",[],function(){return"// texture 1: \n// - R: q\n// - G: capacity\n// - B: density\n// - A: fluidity\nuniform sampler2D data1_tex;\n// texture 2: \n// - R: u\n// - G: v\n// - B: u0\n// - A: v0\nuniform sampler2D data2_tex;\n\nuniform vec2 grid;\nuniform float hx;\nuniform float hy;\nuniform float dn;\n\nvarying vec2 coord;\n\nvoid main() {\n  vec4 data2 = texture2D(data2_tex, coord);\n  float fluidity = texture2D(data1_tex, coord).a;\n  \n  if (coord.x > grid.x && coord.x < 1.0 - grid.x &&\n      coord.y > grid.y && coord.y < 1.0 - grid.y &&\n      fluidity == 1.0) {\n    \n    vec2 dx = vec2(grid.x, 0.0);\n    vec2 dy = vec2(0.0, grid.y);\n    \n    vec4 data2_m_dy = texture2D(data2_tex, coord - dy);\n    vec4 data2_p_dy = texture2D(data2_tex, coord + dy);\n    vec4 data2_m_dx = texture2D(data2_tex, coord - dx);\n    vec4 data2_p_dx = texture2D(data2_tex, coord + dx);\n    // Update velocity UV components.\n    data2.rg = (data2.ba + hx * (data2_m_dy.rg + data2_p_dy.rg)\n                         + hy * (data2_m_dx.rg + data2_p_dx.rg)) * dn;\n  }\n\n  gl_FragColor = data2;\n}\n"}),define("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/apply-buoyancy.fs.glsl",[],function(){return"// texture 0: \n// - R: t\n// - G: t0\n// - B: tb\n// - A: conductivity\nuniform sampler2D data0_tex;\n// texture 1: \n// - R: q\n// - G: capacity\n// - B: density\n// - A: fluidity\nuniform sampler2D data1_tex;\n// texture 2: \n// - R: u\n// - G: v\n// - B: u0\n// - A: v0\nuniform sampler2D data2_tex;\n\nuniform vec2 grid;\nuniform float g;\nuniform float b;\n\nvarying vec2 coord;\n\nvoid main() {\n  vec4 data2 = texture2D(data2_tex, coord);\n  float fluidity = texture2D(data1_tex, coord).a;\n  \n  if (coord.x > grid.x && coord.x < 1.0 - grid.x &&\n      coord.y > grid.y && coord.y < 1.0 - grid.y &&\n      fluidity == 1.0) {\n    \n    vec2 dx = vec2(grid.x, 0.0);\n    vec2 dy = vec2(0.0, grid.y);\n    \n    float t = texture2D(data0_tex, coord).r;\n    // Get average column temperature.\n\n    float avg_t = t;\n    float count = 1.0;\n    vec2 n_coord = coord - dx;\n    // Silly while(true) loop (almost).\n    // While loops are not allowed.\n    // For loops with non-constant expressions also.\n    for (int i = 1; i != 0; i++) {\n      if (n_coord.x > 0.0 && texture2D(data1_tex, n_coord).a == 1.0) {\n        avg_t += texture2D(data0_tex, n_coord).r;\n        count += 1.0;\n        n_coord -= dx;\n      } else {\n        break;\n      }\n    }\n    n_coord = coord + dx;\n    // Silly while(true) loop (almost).\n    // While loops are not allowed.\n    // For loops with non-constant expressions also.\n    for (int i = 1; i != 0; i++) {\n      if (n_coord.x < 1.0 && texture2D(data1_tex, n_coord).a == 1.0) {\n        avg_t += texture2D(data0_tex, n_coord).r;\n        count += 1.0;\n        n_coord += dx;\n      } else {\n        break;\n      }\n    }\n    avg_t /= count;\n\n    // Update velocity V component.\n    data2.g += (g - b) * t + b * avg_t;\n  }\n\n  gl_FragColor = data2;\n}\n"}),define("models/energy2d/models/physics-solvers-gpu/fluid-solver-gpu",["require","exports","module","models/energy2d/gpu/shader","models/energy2d/gpu/gpgpu","text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/basic.vs.glsl","text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/maccormack-step1.fs.glsl","text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/maccormack-step2.fs.glsl","text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/apply-uv-boundary.fs.glsl","text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/apply-u0v0-boundary.fs.glsl","text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/set-obstacle-boundary.fs.glsl","text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/set-obstacle-velocity.fs.glsl","text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/uv-to-u0v0.fs.glsl","text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/conserve-step1.fs.glsl","text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/conserve-step2.fs.glsl","text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/conserve-step3.fs.glsl","text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/diffuse.fs.glsl","text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/apply-buoyancy.fs.glsl"],function(e,t){"use strict";var n=e("models/energy2d/gpu/shader"),r=e("models/energy2d/gpu/gpgpu"),i=e("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/basic.vs.glsl"),o=e("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/maccormack-step1.fs.glsl"),a=e("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/maccormack-step2.fs.glsl"),s=e("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/apply-uv-boundary.fs.glsl"),l=e("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/apply-u0v0-boundary.fs.glsl"),u=e("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/set-obstacle-boundary.fs.glsl"),c=e("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/set-obstacle-velocity.fs.glsl"),d=e("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/uv-to-u0v0.fs.glsl"),h=e("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/conserve-step1.fs.glsl"),p=e("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/conserve-step2.fs.glsl"),f=e("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/conserve-step3.fs.glsl"),m=e("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/diffuse.fs.glsl"),g=e("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/apply-buoyancy.fs.glsl"),v=10,y=0;t.makeFluidSolverGPU=function(e){var t=new n(i,o),b=new n(i,a),x=new n(i,s),w=new n(i,l),_=new n(i,u),T=new n(i,c),A=new n(i,d),C=new n(i,h),E=new n(i,p),S=new n(i,f),k=new n(i,m),P=new n(i,g),R=e.getSimulationTexture(0),O=e.getSimulationTexture(1),M=e.getSimulationTexture(2),N=e.getSimulationTexture(3),I=e.getModelOptions(),L=I.grid_width,B=I.grid_height,D=I.timeStep,F=I.thermal_buoyancy,V=I.background_viscosity,G=I.model_width/I.grid_width,$=I.model_height/I.grid_height,U=v,j=y,q=.5/G,W=.5/$,H=1/(G*G),z=1/($*$),X=.5/(H+z),Y=D*V*H,K=D*V*z,J=1/(1+2*(Y+K)),Z=j*D,Q=F*D,et=[1/B,1/L],tt=[M],nt=[O,M],rt=[R,O,M],it=[O,M,N],ot=function(){var e;e={data1_tex:0,data2_tex:1,grid:et,tx:.5*D/G,ty:.5*D/$},t.uniforms(e),b.uniforms(e),e={data2_tex:0,grid:et},x.uniforms(e),w.uniforms(e),e={data1_tex:0,data2_tex:1,grid:et},_.uniforms(e),e={data1_tex:0,data2_tex:1,data3_tex:2,grid:et},T.uniforms(e),e={data1_tex:0,data2_tex:1,grid:et,i2dx:q,i2dy:W},C.uniforms(e),S.uniforms(e),e={data1_tex:0,data2_tex:1,grid:et,s:X,idxsq:H,idysq:z},E.uniforms(e),e={data1_tex:0,data2_tex:1,grid:et,hx:Y,hy:K,dn:J},k.uniforms(e),e={data0_tex:0,data1_tex:1,data2_tex:2,grid:et,g:Z,b:Q},P.uniforms(e)},at=function(){r.executeProgram(P,rt,M)},st=function(){r.executeProgram(t,nt,M),r.executeProgram(x,tt,M),r.executeProgram(b,nt,M),r.executeProgram(x,tt,M)},lt=function(){var e;for(r.executeProgram(C,nt,M),r.executeProgram(w,tt,M),r.executeProgram(_,nt,M),e=0;U>e;e+=1)r.executeProgram(E,nt,M);r.executeProgram(S,nt,M),r.executeProgram(x,tt,M)},ut=function(){var e;for(r.executeProgram(A,tt,M),e=0;U>e;e+=1)r.executeProgram(k,nt,M),r.executeProgram(x,tt,M)},ct=function(){r.executeProgram(T,it,M)},dt=function(){r.executeProgram(A,tt,M)},ht={solve:function(){0!==F&&at(),ct(),V>0&&(ut(),lt(),ct()),dt(),st(),lt(),ct()}};return ot(),ht}}),define("models/energy2d/models/helpers",["require","exports","module"],function(e,t){"use strict";t.hypot=function(e,t){var n;return e=Math.abs(e),t=Math.abs(t),n=Math.min(e,t),e=Math.max(e,t),0===e?0:(n/=e,e*Math.sqrt(1+n*n))}}),define("models/energy2d/models/shape",["require","exports","module"],function(e,t){"use strict";t.pointInsidePolygon=function(e,t,n,r,i){var o,a,s=0;for(o=0,a=e-1;e>o;a=o,o+=1)n[o]>i!=n[a]>i&&r<(t[a]-t[o])*(i-n[o])/(n[a]-n[o])+t[o]&&(s=!s);return!!s};var n=t.Line=function(e,t,n,r){this.x1=e,this.y1=t,this.x2=n,this.y2=r};n.prototype.intersectsLine=function(e){var t,n,r,i={x:this.x1,y:this.y1},o={x:this.x2,y:this.y2},a={x:e.x1,y:e.y1},s={x:e.x2,y:e.y2},l=(s.x-a.x)*(i.y-a.y)-(s.y-a.y)*(i.x-a.x),u=(o.x-i.x)*(i.y-a.y)-(o.y-i.y)*(i.x-a.x),c=(s.y-a.y)*(o.x-i.x)-(s.x-a.x)*(o.y-i.y);return 0!==c?(n=l/c,r=u/c,t=n>=0&&1>=n&&r>=0&&1>=r?!0:!1):t=0===l||0===u?!0:!1,t};var r=t.Polygon=function(e,t,n,r,i){this.count=e,this.raw_x_coords=t,this.raw_y_coords=n,this.x_coords=new Array(e),this.y_coords=new Array(e),this.x=r||0,this.y=i||0};Object.defineProperty(r.prototype,"x",{get:function(){return this._x},set:function(e){var t,n;for(t=0,n=this.count;n>t;t++)this.x_coords[t]=this.raw_x_coords[t]+e;this._x=e}}),Object.defineProperty(r.prototype,"y",{get:function(){return this._y},set:function(e){var t,n;for(t=0,n=this.count;n>t;t++)this.y_coords[t]=this.raw_y_coords[t]+e;this._y=e}}),r.prototype.polygonize=function(){return this},r.prototype.contains=function(e,t){var n,r,i=this.x_coords,o=this.y_coords,a=this.count,s=0;for(n=0,r=a-1;a>n;r=n,n+=1)o[n]>t!=o[r]>t&&e<(i[r]-i[n])*(t-o[n])/(o[r]-o[n])+i[n]&&(s=!s);return!!s};var i=t.Rectangle=function(e,t,n,r){this.x=e,this.y=t,this.width=n,this.height=r,this.polygon_cache=void 0};i.prototype.polygonize=function(){var e,t,n,i;return this.polygon_cache||(e=this.x,t=this.y,n=this.width,i=this.height,this.polygon_cache=new r(4,[e,e+n,e+n,e],[t,t,t+i,t+i])),this.polygon_cache},i.prototype.contains=function(e,t){return e>=this.x&&e<=this.x+this.width&&t>=this.y&&t<=this.y+this.height};var o=function(e,t,n,i,o){var a,s,l=new Array(o),u=new Array(o),c=2*Math.PI/o;for(s=0;o>s;s+=1)a=c*s,l[s]=e+n*Math.cos(a),u[s]=t+i*Math.sin(a);return new r(o,l,u)},a=t.Ellipse=function(e,t,n,r){this.x=e,this.y=t,this.a=n,this.b=r,this.polygon_cache=void 0};a.prototype.POLYGON_SEGMENTS=50,a.prototype.polygonize=function(){return this.polygon_cache||(this.polygon_cache=o(this.x,this.y,.5*this.a,.5*this.b,this.POLYGON_SEGMENTS)),this.polygon_cache},a.prototype.contains=function(e,t){var n=e-this.x,r=t-this.y,i=.5*this.a,o=.5*this.b;return 1>=n*n/(i*i)+r*r/(o*o)};var s=t.Ring=function(e,t,n,r){this.x=e,this.y=t,this.inner=n,this.outer=r,this.polygon_cache=void 0};s.prototype.POLYGON_SEGMENTS=50,s.prototype.polygonize=function(){return this.polygon_cache||(this.polygon_cache=o(this.x,this.y,.5*this.outer,.5*this.outer,this.POLYGON_SEGMENTS)),this.polygon_cache},s.prototype.contains=function(e,t){var n=e-this.x,r=t-this.y,i=.5*this.outer,o=.5*this.outer,a=.5*this.inner,s=.5*this.inner;return 1>=n*n/(i*i)+r*r/(o*o)&&n*n/(a*a)+r*r/(s*s)>=1}}),define("models/energy2d/models/photon",["require","exports","module","models/energy2d/models/helpers","models/energy2d/models/shape","models/energy2d/models/shape"],function(e,t){"use strict";var n=e("models/energy2d/models/helpers").hypot,r=e("models/energy2d/models/shape").Line,i=e("models/energy2d/models/shape").Rectangle,o=t.Photon=function(e,t,n,r,i){this.x=e,this.y=t,this.energy=n,this.c=r,void 0!==i&&(this.vx=Math.cos(i)*r,this.vy=Math.sin(i)*r)};o.prototype.isContained=function(e,t,n,r){return this.x>=e&&this.x<=t&&this.y>=n&&this.y<=r},o.prototype.move=function(e){this.x+=this.vx*e,this.y+=this.vy*e},o.prototype.reflectFromLine=function(e,t){var i,o,a,s,l,u=this.x,c=this.y,d=this.x-this.vx*t,h=this.y-this.vy*t,p=new r(u,c,d,h),f=this.vx,m=this.vy;return p.intersectsLine(e)?(u=e.x1,c=e.y1,d=e.x2,h=e.y2,i=1/n(u-d,c-h),o=(h-c)*i,a=(d-u)*i,s=f*a+m*o,l=m*a-f*o,this.vx=s*a+l*o,this.vy=s*o-l*a,!0):!1},o.prototype.reflectFromRectangle=function(e,t){var n,r,i=e.x,o=e.y,a=e.x+e.width,s=e.y+e.height;n=this.vx*t,this.x-n<i?this.vx=-Math.abs(this.vx):this.x-n>a&&(this.vx=Math.abs(this.vx)),r=this.vy*t,this.y-r<o?this.vy=-Math.abs(this.vy):this.y-r>s&&(this.vy=Math.abs(this.vy))},o.prototype.reflectFromPolygon=function(e,t){var n,i,o=new r;for(n=0,i=e.count-1;i>n;n+=1)if(o.x1=e.x_coords[n],o.y1=e.y_coords[n],o.x2=e.x_coords[n+1],o.y2=e.y_coords[n+1],this.reflectFromLine(o,t))return;o.x1=e.x_coords[e.count-1],o.y1=e.y_coords[e.count-1],o.x2=e.x_coords[0],o.y2=e.y_coords[0],this.reflectFromLine(o,t)},o.prototype.reflect=function(e,t){return e.contains(this.x,this.y)?(e instanceof i?this.reflectFromRectangle(e,t):this.reflectFromPolygon(e.polygonize(),t),!0):!1}}),define("models/energy2d/models/physics-solvers/ray-solver",["require","exports","module","models/energy2d/models/photon"],function(e,t){"use strict";var n=e("models/energy2d/models/photon").Photon;t.makeRaySolver=function(e){var t=e.getModelOptions(),r=e.getPowerArray(),i=e.getPartsArray(),o=e.getPhotonsArray(),a=t.model_width,s=t.model_height,l=t.grid_width,u=t.grid_height,c=l-1,d=u-1,h=t.model_width/t.grid_width,p=t.model_height/t.grid_height,f=function(){return Math.PI-t.sun_angle},m=function(){for(var e=0;e<o.length;)void 0===o[e]?o.splice(e,1):e+=1},g=function(){var e,t;for(e=0,t=o.length;t>e;e+=1)o[e].isContained(0,a,0,s)||(o[e]=void 0);m()},v=function(e,t){var n,r;for(n=0,r=i.length;r>n;n+=1)if(i[n].contains(e,t))return!0;return!1},y=function(e,r){var i,l,u,c=f(),d=t.solar_power_density,h=t.solar_ray_speed,p=Math.floor(a/e),m=Math.floor(s/r);if(c>=0&&c<.5*Math.PI){for(l=0,u=1;p>=u;u+=1)i=e*u,v(i,l)||o.push(new n(i,l,d,h,c));for(i=0,u=0;m>=u;u+=1)l=r*u,v(i,l)||o.push(new n(i,l,d,h,c))}else if(0>c&&c>=-.5*Math.PI){for(l=s,u=1;p>=u;u+=1)i=e*u,v(i,l)||o.push(new n(i,l,d,h,c));for(i=0,u=0;m>=u;u+=1)l=s-r*u,v(i,l)||o.push(new n(i,l,d,h,c))}else if(c<Math.PI+.001&&c>=.5*Math.PI){for(l=0,u=0;p>=u;u+=1)i=a-e*u,v(i,l)||o.push(new n(i,l,d,h,c));for(i=a,u=1;m>=u;u+=1)l=r*u,v(i,l)||o.push(new n(i,l,d,h,c))}else if(c>=-Math.PI&&c<-.5*Math.PI){for(l=s,u=0;p>=u;u+=1)i=a-e*u,v(i,l)||o.push(new n(i,l,d,h,c));for(i=a,u=1;m>=u;u+=1)l=s-r*u,v(i,l)||o.push(new n(i,l,d,h,c))}};return{solve:function(){var e,n,a,s,l,f,v,y,b=t.timeStep,x=t.photon_emission_interval,w=1/(b*x),_=1/h,T=1/p;for(l=0,v=o.length;v>l;l+=1)for(e=o[l],e.move(b),f=0,y=i.length;y>f&&(n=i[f],!n.reflect(e,b));f+=1)if(n.absorb(e)){a=Math.max(Math.min(Math.round(e.x*_),c),0),s=Math.max(Math.min(Math.round(e.y*T),d),0),r[a*u+s]=e.energy*w,o[l]=void 0;break}m(),g()},radiate:function(){var t,n,r;for(n=0,r=i.length;r>n;n+=1)t=i[n],t.emissivity>0&&t.radiate(e)},sunShine:function(){var e,n,r,i=f();0>i||(e=Math.abs(Math.sin(i)),n=Math.abs(Math.cos(i)),r=n*a>e*s?s/n:a/e,r/=t.solar_ray_count,y(r/e,r/n))}}}}),define("models/energy2d/models/part",["require","exports","module","models/energy2d/models/constants","models/energy2d/models/helpers","models/energy2d/models/photon","models/energy2d/models/shape","models/energy2d/models/shape","models/energy2d/models/shape","models/energy2d/models/shape","models/energy2d/models/shape","models/energy2d/models/shape"],function(e,t){"use strict";var n=e("models/energy2d/models/constants"),r=e("models/energy2d/models/helpers").hypot,i=e("models/energy2d/models/photon").Photon,o=e("models/energy2d/models/shape"),a=e("models/energy2d/models/shape").Line,s=e("models/energy2d/models/shape").Polygon,l=e("models/energy2d/models/shape").Rectangle,u=e("models/energy2d/models/shape").Ellipse,c=e("models/energy2d/models/shape").Ring,d=.5,h=20,p=100,f=Math.sin(Math.PI/6),m=Math.cos(Math.PI/6),g=Math.sin(Math.PI/3),v=Math.cos(Math.PI/3),y=t.Part=function(e){var t,n,r;if(this._options=e,"rectangle"===e.shapeType)this.shape=new l(e.x,e.y,e.width,e.height);else if("ellipse"===e.shapeType)this.shape=new u(e.x,e.y,e.a,e.b);else if("ring"===e.shapeType)this.shape=new c(e.x,e.y,e.inner,e.outer);else{if("polygon"!==e.shapeType)throw new Error("Part: shape not defined or not supported.");for(t=e.vertices.split(", "),this.x_coords=[],this.y_coords=[],r=0,n=.5*t.length;n>r;r+=1)this.x_coords[r]=Number(t[2*r]),this.y_coords[r]=Number(t[2*r+1]);this.shape=new s(n,this.x_coords,this.y_coords,e.x,e.y)}};Object.defineProperty(y.prototype,"shapeType",{get:function(){return this._options.shapeType}}),["x","y","width","height","inner","outer","a","b","raw_x_coords","raw_y_coords"].forEach(function(e){Object.defineProperty(y.prototype,e,{get:function(){return this.shape[e]},set:function(t){this.shape[e]=t,this.polygon_cache=void 0}})}),Object.defineProperty(y.prototype,"vertices",{get:function(){if("polygon"!==this.shapeType)return void 0;var e,t,n=this.shape.raw_x_coords,r=this.shape.raw_y_coords,i=[];for(e=0,t=n.length;t>e;e++)i.push(n[e]),i.push(r[e]);return i.join(", ")}}),["thermal_conductivity","specific_heat","density","temperature","constant_temperature","power","wind_speed","wind_angle","transmission","reflection","absorption","emissivity","visible","filled","color","texture","label","draggable"].forEach(function(e){Object.defineProperty(y.prototype,e,{get:function(){return this._options[e]},set:function(t){this._options[e]=t}})}),y.prototype.getLabel=function(){function e(e,t){var n;return n=e>=100?e.toFixed():e>=10?e.toFixed(1):e.toFixed(2),n+t}var t,n=this.label;return"%temperature"===n?t=e(this.temperature," C"):"%density"===n?t=e(this.density," kg/m"):"%specific_heat"===n?t=e(this.specific_heat," J/(kgC)"):"%thermal_conductivity"===n?t=e(this.thermal_conductivity," W/(mC)"):"%power_density"===n?t=e(this.power," W/m"):"%area"===n?"rectangle"===this.shapeType?t=e(this.width*this.height," m"):"ellipse"===this.shapeType&&(t=e(this.a*this.b*.25*Math.PI," m")):"%width"===n?"rectangle"===this.shapeType?t=e(this.width," m"):"ellipse"===this.shapeType&&(t=e(this.a," m")):"%height"===n?"rectangle"===this.shapeType?t=e(this.height," m"):"ellipse"===this.shapeType&&(t=e(this.b," m")):t=n,t},y.prototype.getGridCells=function(e,t,n,r){var i=e-1,a=t-1,s=i/n,l=a/r,u=function(e){var n,r,o,u,c,d,h,p=[];for(o=Math.min(Math.max(Math.ceil(e.x*s),0),i),u=Math.min(Math.max(Math.ceil(e.y*l),0),a),c=Math.min(Math.max(Math.floor((e.x+e.width)*s),0),i),d=Math.min(Math.max(Math.floor((e.y+e.height)*l),0),a),p=new Array((c-o+1)*(d-u+1)),h=0,n=o;c>=n;n+=1)for(r=u;d>=r;r+=1)p[h+=1]=n*t+r;return p},c=function(e){var n,r,o,u,c,d,h,p,f=e.x*s,m=e.y*l,g=.5*e.a*s,v=.5*e.b*l,y=[];for(o=Math.min(Math.max(Math.ceil(f-g),0),i),u=Math.min(Math.max(Math.floor(f+g),0),i),y=[],p=0,r=o;u>=r;r+=1)for(n=Math.sqrt(1-(r-f)*(r-f)/(g*g)),d=Math.min(Math.max(Math.ceil(m-v*n),0),a),h=Math.min(Math.max(Math.floor(m+v*n),0),a),c=d;h>=c;c+=1)y[p+=1]=r*t+c;return y},d=function(e){var n,r,o,u,c,d,h,p,f,m,g=e.x*s,v=e.y*l,y=.5*e.outer*s,b=.5*e.outer*l,x=.5*e.inner*s,w=.5*e.inner*l,_=[];for(r=Math.min(Math.max(Math.ceil(g-y),0),i),o=Math.min(Math.max(Math.floor(g+y),0),i),n=r;o>=n;n+=1)if(f=Math.sqrt(1-(n-g)*(n-g)/(y*y)),c=Math.min(Math.max(Math.ceil(v-b*f),0),a),p=Math.min(Math.max(Math.floor(v+b*f),0),a),Math.abs(n-g)<x){for(f=Math.sqrt(1-(n-g)*(n-g)/(x*x)),d=Math.min(Math.max(Math.ceil(v-w*f),0),a),h=Math.min(Math.max(Math.floor(v+w*f),0),a),u=c;d>=u;u+=1)_[m+=1]=n*t+u;for(u=h;p>=u;u+=1)_[m+=1]=n*t+u}else for(u=c;p>=u;u+=1)_[m+=1]=n*t+u;return _},h=function(e){var n,r,u,c,d,h,p,f=e.x_coords.length,m=new Array(f),g=new Array(f),v=Number.MAX_VALUE,y=Number.MIN_VALUE,b=Number.MAX_VALUE,x=Number.MIN_VALUE,w=[];for(n=0;f>n;n+=1)m[n]=e.x_coords[n]*s,g[n]=e.y_coords[n]*l,m[n]<v&&(v=m[n]),m[n]>y&&(y=m[n]),g[n]<b&&(b=g[n]),g[n]>x&&(x=g[n]);for(r=Math.min(Math.max(Math.round(v),0),i),d=Math.min(Math.max(Math.round(b),0),a),u=Math.min(Math.max(Math.round(y),0),i),h=Math.min(Math.max(Math.round(x),0),a),w=[],p=0,n=r;u>=n;n+=1)for(c=d;h>=c;c+=1)o.pointInsidePolygon(f,m,g,n,c)&&(w[p+=1]=n*t+c);return w};if("rectangle"===this.shapeType)return u(this.shape);if("ellipse"===this.shapeType)return c(this.shape);if("ring"===this.shapeType)return d(this.shape);if("polygon"===this.shapeType)return h(this.shape);throw new Error("Part: unknown shape.")},y.prototype.contains=function(e,t){return this.shape.contains(e,t)},y.prototype.reflect=function(e,t){return Math.abs(this.reflection-1)<.001?e.reflect(this.shape,t):!1
},y.prototype.absorb=function(e){return Math.abs(this.absorption-1)<.001?this.shape.contains(e.x,e.y):!1},y.prototype.getIrradiance=function(e){var t;return 0===this.emissivity?0:(t=273+e,t*=t,this.emissivity*n.STEFAN_CONSTANT*p*t*t)},y.prototype.radiate=function(e){var t,n,r=this.shape.polygonize(),i=new a;if(0!==this.emissivity){for(t=0,n=r.count-1;n>t;t+=1)i.x1=r.x_coords[t],i.y1=r.y_coords[t],i.x2=r.x_coords[t+1],i.y2=r.y_coords[t+1],this.radiateFromLine(e,i);i.x1=r.x_coords[r.count-1],i.y1=r.y_coords[r.count-1],i.x2=r.x_coords[0],i.y2=r.y_coords[0],this.radiateFromLine(e,i)}},y.prototype.radiateFromLine=function(e,t){var n,o,a,s,l,u,c,p,y,b,x,w,_,T,A,C,E;if(0!==this.emissivity)if(n=e.getModelOptions(),o=r(t.x1-t.x2,t.y1-t.y2),a=(t.x2-t.x1)/o,s=(t.y2-t.y1)/o,l=Math.max(1,Math.round(o/d)),b=n.solar_ray_speed*s,x=-n.solar_ray_speed*a,1===l)y=.5*o,u=t.x1+y*a,c=t.y1+y*s,y=e.getAverageTemperatureAt(u,c),y>h&&(y=e.getTemperatureAt(u,c),p=new i(u,c,this.getIrradiance(y),n.solar_ray_speed),p.vx=b,p.vy=x,e.addPhoton(p),this.constant_temperature||e.setTemperatureAt(u,c,y-p.energy/this.specific_heat));else for(w=new Array(4),_=new Array(4),w[0]=b*m-x*f,_[0]=b*f+x*m,w[1]=x*f+b*m,_[1]=x*m-b*f,w[2]=b*v-x*g,_[2]=b*g+x*v,w[3]=x*g+b*v,_[3]=x*v-b*g,T=1+w.length,C=0;l>C;C+=1)if(y=(C+.5)*d,u=t.x1+y*a,c=t.y1+y*s,y=e.getAverageTemperatureAt(u,c),A=this.getIrradiance(y)/T,y>h){for(p=new i(u,c,A,n.solar_ray_speed),p.vx=b,p.vy=x,e.addPhoton(p),E=0;T-1>E;E+=1)p=new i(u,c,A,n.solar_ray_speed),p.vx=w[E],p.vy=_[E],e.addPhoton(p);this.constant_temperature||e.changeAverageTemperatureAt(u,c,-A*T/this.specific_heat)}}}),define("models/energy2d/models/core-model",["require","exports","module","arrays","models/energy2d/models/physics-solvers/heat-solver","models/energy2d/models/physics-solvers-gpu/heat-solver-gpu","models/energy2d/models/physics-solvers/fluid-solver","models/energy2d/models/physics-solvers-gpu/fluid-solver-gpu","models/energy2d/models/physics-solvers/ray-solver","models/energy2d/models/part","models/energy2d/gpu/gpgpu","models/energy2d/models/helpers"],function(e,t){"use strict";var n=e("arrays"),r=e("models/energy2d/models/physics-solvers/heat-solver"),i=e("models/energy2d/models/physics-solvers-gpu/heat-solver-gpu"),o=e("models/energy2d/models/physics-solvers/fluid-solver"),a=e("models/energy2d/models/physics-solvers-gpu/fluid-solver-gpu"),s=e("models/energy2d/models/physics-solvers/ray-solver"),l=e("models/energy2d/models/part").Part,u=e("models/energy2d/gpu/gpgpu"),c=e("models/energy2d/models/helpers").hypot,d=function(){try{new Float32Array}catch(e){return"regular"}return"Float32Array"}();t.makeCoreModel=function(e,t){var h,p,f,m,g,v,y,b,x=e.grid_width,w=e.grid_height,_=x*w,T=e.model_width/x,A=e.model_height/w,C=0,E=!1,S={start:function(){},stop:function(){},startFPS:function(){},updateFPS:function(){},stopFPS:function(){}},k=n.create(_,e.background_temperature,d),P=n.create(_,0/0,d),R=n.create(_,0,d),O=n.create(_,0,d),M=n.create(_,0,d),N=n.create(_,0,d),I=n.create(_,0,d),L=n.create(_,e.background_conductivity,d),B=n.create(_,e.background_specific_heat,d),D=n.create(_,e.background_density,d),F=n.create(_,!0,d),V=[],G=[],$=function(){var e,r,i=[];if(t)for(n.isArray(t)||(t=[t]),i=new Array(t.length),e=0,r=t.length;r>e;e+=1)i[e]=new l(t[e]);return i}(),U=function(){if(E=!1,"undefined"==typeof window)throw new Error("Core model: WebGL GPGPU unavailable in the node.js environment.");u.init(w,x),G[0]=u.createTexture(),G[1]=u.createTexture(),G[2]=u.createTexture(),G[3]=u.createTexture(),j(),m=i.makeHeatSolverGPU(K),g=a.makeFluidSolverGPU(K),E=!0},j=function(){u.writeRGBATexture(G[0],k,k,P,L),u.writeRGBATexture(G[1],M,B,D,F),u.writeRGBATexture(G[2],R,O,R,O),u.writeRGBATexture(G[3],N,I,N,I)},q=function(){v=function(){var t,n;if(e.sunny)return!0;for(t=0,n=$.length;n>t;t+=1)if($[t].emissivity>0)return!0;return!1}(),y=function(){var e,t;for(e=0,t=$.length;t>e;e+=1)if($[e].power>0)return!0;return!1}()},W=function(t,n){var r,i,o,a,s=e.model_width,l=e.model_height;for(r=t.getGridCells(x,w,s,l),o=0,a=r.length;a>o;o+=1)i=r[o],n||(k[i]=t.temperature),F[i]=!1,L[i]=t.thermal_conductivity,B[i]=t.specific_heat,D[i]=t.density,0!==t.wind_speed&&(N[i]=t.wind_speed*Math.cos(t.wind_angle),I[i]=t.wind_speed*Math.sin(t.wind_angle)),t.constant_temperature&&(P[i]=t.temperature)},H=function(t){t||(n.fill(k,e.background_temperature),n.fill(R,0),n.fill(O,0)),n.fill(P,0/0),n.fill(M,0),n.fill(N,0),n.fill(I,0),n.fill(L,e.background_conductivity),n.fill(B,e.background_specific_heat),n.fill(D,e.background_density),n.fill(F,!0)},z=function(e){if($&&0!==$.length){var t;for(t=$.length-1;t>=0;t-=1)W($[t],e)}},X=function(){var e,t,n,r,i,o,a,s,l;for(r=0;x>r;r+=1)for(t=r*T,i=r*w,o=0;w>o;o+=1)if(n=o*A,M[i+o]=0,l=0,y){for(a=0,s=$.length;s>a;a+=1)e=$[a],e.shape.contains(t,n)&&(M[i+o]+=e.power,l++);l>0&&(M[i+o]/=l)}},Y=function(e,t){var n=(R[e*w+t+1]-R[e*w+t-1])/T,r=(O[(e+1)*w+t]-O[(e-1)*w+t])/A;return.5*(n-r)},K={nextStep:function(){S.start("Core model step"),E?(e.convective&&(S.start("Fluid solver GPU"),g.solve(),S.stop("Fluid solver GPU")),S.start("Heat solver GPU"),m.solve(e.convective),S.stop("Heat solver GPU")):(v&&(S.start("Ray solver CPU"),C%e.photon_emission_interval===0&&(X(),e.sunny&&f.sunShine(),f.radiate()),f.solve(),S.stop("Ray solver CPU")),e.convective&&(S.start("Fluid solver CPU"),p.solve(R,O),S.stop("Fluid solver CPU")),S.start("Heat solver CPU"),h.solve(e.convective,k,M),S.stop("Heat solver CPU")),C+=1,S.stop("Core model step")},setPerformanceTools:function(e){S=e},reset:function(){C=0,H(),q(),z(),X(),E&&j()},partsChanged:function(e,t){H(!0),q(),z(!0),X(),"temperature"===t&&W(e)},addPart:function(e){var t=new l(e);$.push(t),W(t)},removePart:function(e){$.splice(e,1),K.partsChanged()},useWebGL:function(e){return E!==e?K.isWebGLCompatible()?(e?U():(K.syncTemperature(),K.syncVelocity(),E=!1),void 0):(E=!1,void 0):void 0},isWebGLActive:function(){return E},isWebGLCompatible:function(){return!v},getWebGLError:function(){return b},syncTemperature:function(){E&&u.readTexture(G[0],k)},syncVelocity:function(){E&&(u.readTexture(G[2],R,0),u.readTexture(G[2],O,1))},getIndexOfStep:function(){return C},getModelOptions:function(){return e},getTemperatureAt:function(e,t){var n=Math.max(Math.min(x-1,Math.round(e/T)),0),r=Math.max(Math.min(w-1,Math.round(t/A)),0);return k[n*w+r]},setTemperatureAt:function(e,t,n){var r=Math.max(Math.min(x-1,Math.round(e/T)),0),i=Math.max(Math.min(w-1,Math.round(t/A)),0);k[r*w+i]=n},getAverageTemperatureAt:function(e,t){var n,r,i=0,o=x-1,a=w-1,s=Math.round(e/T),l=Math.round(t/A);return n=Math.max(Math.min(o,s),0),r=Math.max(Math.min(a,l),0),i+=k[n*w+r],n=Math.max(Math.min(o,s+1),0),r=Math.max(Math.min(a,l),0),i+=k[n*w+r],n=Math.max(Math.min(o,s-1),0),r=Math.max(Math.min(a,l),0),i+=k[n*w+r],n=Math.max(Math.min(o,s),0),r=Math.max(Math.min(a,l+1),0),i+=k[n*w+r],n=Math.max(Math.min(o,s),0),r=Math.max(Math.min(a,l-1),0),i+=k[n*w+r],.2*i},changeAverageTemperatureAt:function(e,t,n){var r,i,o=x-1,a=w-1,s=Math.round(e/T),l=Math.round(t/A);n*=.2,r=Math.min(o,s),i=Math.min(a,l),r>=0&&i>=0&&(k[r*w+i]+=n),r=Math.min(o,s+1),i=Math.min(a,l),r>=0&&i>=0&&(k[r*w+i]+=n),r=Math.min(o,s-1),i=Math.min(a,l),r>=0&&i>=0&&(k[r*w+i]+=n),r=Math.min(o,s),i=Math.min(a,l+1),r>=0&&i>=0&&(k[r*w+i]+=n),r=Math.min(o,s),i=Math.min(a,l-1),r>=0&&i>=0&&(k[r*w+i]+=n)},getVorticityAt:function(e,t){var n=Math.max(Math.min(x-1,Math.round(e/T)),0),r=Math.max(Math.min(w-1,Math.round(t/A)),0);return Y(n,r)},getAverageVorticityAt:function(e,t){var n=Math.max(Math.min(x-1,Math.round(e/T)),0),r=Math.max(Math.min(w-1,Math.round(t/A)),0),i=Y(n,r);return i+=Y(n-1,r),i+=Y(n+1,r),i+=Y(n,r-1),i+=Y(n,r+1),i+=Y(n-1,r-1),i+=Y(n-1,r+1),i+=Y(n+1,r-1),i+=Y(n+1,r+1),i/9},getSpeedAt:function(e,t){var n=Math.max(Math.min(x-1,Math.round(e/T)),0),r=Math.max(Math.min(w-1,Math.round(t/A)),0);return c(R[n*w+r],O[n*w+r])},getHeatFluxAt:function(e,t){var n=Math.max(Math.min(x-1,Math.round(e/T)),0),r=Math.max(Math.min(w-1,Math.round(t/A)),0),i=L[n*w+r]*(k[(n-1)*w+r]-k[(n+1)*w+r])/(2*T),o=L[n*w+r]*(k[n*w+r-1]-k[n*w+r+1])/(2*A);return[i,o]},addPhoton:function(e){V.push(e)},removePhoton:function(e){var t=V.indexOf(e);-1!==t&&V.splice(t,1)},getArrayType:function(){return d},getPerformanceModel:function(){return S},getTemperatureArray:function(){return k},getUVelocityArray:function(){return R},getVVelocityArray:function(){return O},getUWindArray:function(){return N},getVWindArray:function(){return I},getBoundaryTemperatureArray:function(){return P},getPowerArray:function(){return M},getConductivityArray:function(){return L},getCapacityArray:function(){return B},getDensityArray:function(){return D},getFluidityArray:function(){return F},getPhotonsArray:function(){return V},getPartsArray:function(){return $},getTemperatureTexture:function(){return G[0]},getVelocityTexture:function(){return G[2]},getSimulationTexture:function(e){return G[e]}};return q(),z(),X(),h=r.makeHeatSolver(K),p=o.makeFluidSolver(K),f=s.makeRaySolver(K),K}}),define("models/energy2d/modeler",["require","common/alert","common/console","common/validator","common/serialize","common/performance","common/lab-modeler-mixin","models/energy2d/metadata","models/energy2d/models/core-model"],function(e){"use strict";var t=e("common/alert"),n=e("common/console"),r=e("common/validator"),i=e("common/serialize"),o=e("common/performance"),a=e("common/lab-modeler-mixin"),s=e("models/energy2d/metadata"),l=e("models/energy2d/models/core-model"),u={units:{time:{name:"second",pluralName:"seconds",symbol:"s"},temperature:{name:"degree Celsius",pluralName:"degrees Celsius",symbol:"C"},length:{name:"meter",pluralName:"meters",symbol:"m"},velocity:{name:"meter per second",pluralName:"meters per second",symbol:"m/s"}}},c=0;return function(e){function d(e){try{y.useWebGL(e)}catch(t){n.warn("WebGL initialization failed. CPU solvers and rendering will be used."),n.warn(t.message)}}function h(){y.syncTemperature(),y.syncVelocity()}function p(){var e,t,n=v.getTemperatureArray();for(e=0,t=n.length;t>e;e++)if(isNaN(n[e])||Math.abs(n[e])>1e10)return v.stop(),y.reset(),!0;return!1}function f(e){var t=[];return e.forEach(function(e){t.push(r.validateCompleteness(s.part,e))}),t}function m(e){var t={thermometer:function(){return v.getTemperatureAt(this.x,this.y)},anemometer:function(){return this._rot},heatFlux:function(){var e=v.getHeatFluxAt(this.x,this.y);return e[0]*this._sin+e[1]*this._cos}},n={thermometer:{label:"Temperature",unitType:"temperature",format:".1f"},anemometer:{},heatFlux:{label:"Heat Flux",unitName:"Watt Per Square Meter",unitPluralName:"Watts Per Square Meter",unitAbbreviation:"W/m",format:".1f"}};A=[],e.forEach(function(e,i){e=r.validateCompleteness(s.sensor,e),"anemometer"===e.type&&(e._rot=0,C.push(e)),"heatFlux"===e.type&&(e.angle=e.angle||0,e._sin=Math.sin(-e.angle*Math.PI/180),e._cos=Math.cos(e.angle*Math.PI/180)),Object.defineProperty(e,"value",{enumerable:!0,get:t[e.type]}),A.push(e),v.defineOutput("sensor-"+i,n[e.type],function(){return e.value})})}function g(){var e,t,n;for(t=0,n=C.length;n>t;t++)e=C[t],e._rot+=v.getSpeedAt(e.x,e.y)*(v.getVorticityAt(e.x,e.y)<0?-1:1)*v.properties.timeStep*700,e._rot=e._rot%360}var v,y,b="energy2dModel"+ ++c,x=new a({metadata:s,unitsDefinition:u,initialProperties:e,setters:{use_WebGL:function(e){y&&d(e),T=v.properties.ticksPerGPUSync},ticksPerGPUSync:function(e){y&&h(),T=Number(e)}}}),w=x.propertySupport,_=x.dispatchSupport,T=0,A=[],C=[],E={parts:[],sensors:[]},S=function(){function e(e){Object.defineProperty(this,"_rawPart",{enumerable:!1,get:function(){return e}})}return Object.keys(s.part).forEach(function(t){Object.defineProperty(e.prototype,t,{enumerable:!0,get:function(){return this._rawPart[t]},set:function(e){var n=v.properties.use_WebGL;v.properties.use_WebGL=!1,w.invalidatingChangePreHook(),this._rawPart[t]=r.validateSingleProperty(s.part[t],t,e),v.isStopped()?y.reset():y.partsChanged(this._rawPart,t),w.invalidatingChangePostHook(),v.properties.use_WebGL=n,_.partsChanged()}})}),e.prototype.computeLabel=function(){return this._rawPart.getLabel()},function(){var t,n,r=y.getPartsArray(),i=E.parts;for(i.length=0,t=0,n=r.length;n>t;t++)i.push(new e(r[t]))}}(),k=function(){function e(e){Object.defineProperty(this,"_rawObj",{enumerable:!1,get:function(){return e}})}var t={x:function(e){return Math.max(0,Math.min(v.properties.model_width,e))},y:function(e){return Math.max(0,Math.min(v.properties.model_height,e))}};return Object.keys(s.sensor).forEach(function(n){Object.defineProperty(e.prototype,n,{enumerable:!0,get:function(){return this._rawObj[n]},set:function(e){w.invalidatingChangePreHook(),e=t[n]?t[n](e):e,this._rawObj[n]=r.validateSingleProperty(s.sensor[n],n,e),w.invalidatingChangePostHook(),_.sensorsChanged()}})}),function(){var t,n,r=E.sensors;for(r.length=0,t=0,n=A.length;n>t;t++)r.push(new e(A[t]))}}();return v={namespace:b,tick:function(){var e,n,r;for(o.enterScope("engine"),e=0,n=v.properties.timeStepsPerTick;n>e;e++)y.nextStep();o.leaveScope("engine"),y.isWebGLActive()?T>0?T--:(h(),T=Number(v.properties.ticksPerGPUSync),r=p()):r=p(),g(),v.updateAllOutputProperties(),_.tick(),r&&t("The model has diverged and has been reset!\n\nTry changing its parameters (e.g. 'timeStep', positions of parts etc.) or reload it to restore the initial configuration.")},syncTemperature:function(){w.invalidatingChangePreHook(),y.syncTemperature(),w.invalidatingChangePostHook()},syncVelocity:function(){w.invalidatingChangePreHook(),y.syncVelocity(),w.invalidatingChangePostHook()},addPart:function(e){var t=v.properties.use_WebGL;v.properties.use_WebGL=!1,e=r.validateCompleteness(s.part,e),w.invalidatingChangePreHook(),y.addPart(e),S(),w.invalidatingChangePostHook(),v.properties.use_WebGL=t,_.partsChanged()},removePart:function(e){var t=v.properties.use_WebGL;v.properties.use_WebGL=!1,w.invalidatingChangePreHook(),y.removePart(e),S(),w.invalidatingChangePostHook(),v.properties.use_WebGL=t,_.partsChanged()},reset:function(){_.willReset(),w.invalidatingChangePreHook(),v.stop(),y.reset();var t;e.structure&&e.structure.part&&(t=f(e.structure.part)),y=l.makeCoreModel(v.properties,t),d(v.properties.use_WebGL),e.sensors&&m(e.sensors),S(),k(),w.invalidatingChangePostHook(),v.resetAllOutputProperties(),_.reset(),_.invalidation()},stepCounter:function(){return y.getIndexOfStep()},isNewStep:function(){return!0},stepBack:function(){return y.getIndexOfStep()},stepForward:function(e){arguments.length||(e=1),this.isStopped()||this.stop();for(var t=-1;++t<e;)v.tick();return y.getIndexOfStep()},getTime:function(){return v.properties.timeStep*y.getIndexOfStep()},isWebGLActive:function(){return y.isWebGLActive()},isWebGLCompatible:function(){return y.isWebGLCompatible()},getWebGLError:function(){return y.getWebGLError()},getIndexOfStep:function(){return y.getIndexOfStep()},getTemperatureAt:function(e,t){return y.getTemperatureAt(e,t)},getAverageTemperatureAt:function(e,t){return y.getAverageTemperatureAt(e,t)},getVorticityAt:function(e,t){return y.getVorticityAt(e,t)},getHeatFluxAt:function(e,t){return y.getHeatFluxAt(e,t)},getAverageVorticityAt:function(e,t){return y.getAverageVorticityAt(e,t)},getSpeedAt:function(e,t){return y.getSpeedAt(e,t)},getTemperatureArray:function(){return y.getTemperatureArray()},getTemperatureTexture:function(){return y.getTemperatureTexture()},getUVelocityArray:function(){return y.getUVelocityArray()},getVVelocityArray:function(){return y.getVVelocityArray()},getVelocityTexture:function(){return y.getVelocityTexture()},getPhotonsArray:function(){return y.getPhotonsArray()},getPartsArray:function(){return E.parts},getSensorsArray:function(){return E.sensors},serialize:function(){var e={},t=w.rawValues;return e=i(s.mainProperties,t),e.viewOptions=i(s.viewOptions,t),e.structure={part:[]},E.parts.forEach(function(t){e.structure.part.push(i(s.part,t))}),e.sensors=[],E.sensors.forEach(function(t){e.sensors.push(i(s.sensor,t))}),e}},function(){function t(){w.invalidatingChangePreHook(),w.invalidatingChangePostHook()}var n;x.mixInto(v),_.addEventTypes("tick","partsChanged","sensorsChanged"),e.structure&&e.structure.part&&(n=f(e.structure.part)),y=l.makeCoreModel(v.properties,n),d(v.properties.use_WebGL),e.sensors&&m(e.sensors),S(),k(),v.on("play.model",t),v.on("stop.model",t),v.defineOutput("minX",{},function(){return 0}),v.defineOutput("minY",{},function(){return 0}),v.defineOutput("maxX",{},function(){return v.properties.model_width}),v.defineOutput("maxY",{},function(){return v.properties.model_height}),v.defineOutput("time",{label:"Time",unitType:"time",format:".2f"},function(){return v.getTime()}),v.defineOutput("displayTime",{label:"Time"},function(){var e=d3.format("02d");return function(){var t,n,r,i,o=v.getTime();return o=Math.floor(o),t=o%60,o=Math.floor(o/60),n=o%60,o=Math.floor(o/60),r=o%24,o=Math.floor(o/24),i=o,i+":"+e(r)+":"+e(n)+":"+e(t)}}())}(),v}}),define("models/energy2d/views/helpers",[],function(){"use strict";return{HSVToRGB:function(e,t,n){var r,i,o,a,s,l,u,c;if(e=Math.max(0,Math.min(360,e)),t=Math.max(0,Math.min(100,t)),n=Math.max(0,Math.min(100,n)),t/=100,n/=100,0===t)return r=i=o=n,[Math.round(255*r),Math.round(255*i),Math.round(255*o)];switch(e/=60,a=Math.floor(e),s=e-a,l=n*(1-t),u=n*(1-t*s),c=n*(1-t*(1-s)),a){case 0:r=n,i=c,o=l;break;case 1:r=u,i=n,o=l;break;case 2:r=l,i=n,o=c;break;case 3:r=l,i=u,o=n;break;case 4:r=c,i=l,o=n;break;default:r=n,i=l,o=u}return[Math.round(255*r),Math.round(255*i),Math.round(255*o)]}}}),define("models/energy2d/views/color-palette",["require","models/energy2d/views/helpers"],function(e){"use strict";var t,n,r=e("models/energy2d/views/helpers");return t={},t["0"]=t.RAINBOW=[[0,0,128],[20,50,120],[20,100,200],[10,150,150],[120,180,50],[220,200,10],[240,160,36],[225,50,50],[230,85,110],[250,250,250],[255,255,255]],t["1"]=t.IRON=[[40,20,100],[80,20,150],[150,20,150],[200,50,120],[220,80,80],[230,120,30],[240,200,20],[240,220,80],[255,255,125],[250,250,250],[255,255,255]],t["2"]=t.GRAY=[[50,50,50],[75,75,75],[100,100,100],[125,125,125],[150,150,150],[175,175,175],[200,200,200],[225,225,225],[250,250,250],[255,255,255]],t["3"]=t.RAINBOW2=function(){var e,t=(r.HSVToRGB,256),n=new Array(t);for(e=0;t>e;e+=1)n[e]=r.HSVToRGB(t-1-e,100,90);return n}(),n=function(e){(void 0===e||"DEFAULT"===e)&&(e="RAINBOW"),this.color_palette_id=e},n.prototype.getRGBArray=function(){return void 0!==t[this.color_palette_id]?t[this.color_palette_id]:void 0},n}),define("models/energy2d/views/heatmap",["require","models/energy2d/views/color-palette"],function(e){"use strict";var t=e("models/energy2d/views/color-palette");return function(e){var n,r,i,o,a,s,l,u="energy2d-heatmap-view",c=0,d=50,h=function(){n=$("<canvas />"),n.attr("id",e||u),r=n[0].getContext("2d")},p={renderHeatmap:function(){var e,t,n,u,h,p,f,m,g,v,y,b;if(!a)throw new Error("Heatmap: bind heatmap before rendering.");for(r.clearRect(0,0,s,l),r.fillStyle="rgb(0,0,0)",e=o/Math.max(1,d-c),p=r.getImageData(0,0,s,l),f=p.data,y=0,b=4*s,m=0;s>m;m+=1)for(v=m*l,y=4*m,g=0;l>g;g+=1)n=e*(a[v+g]-c),t=Math.floor(n),n-=t,0>t?(t=0,n=0):t>o-1&&(t=o-1,n=1),u=i[t],h=i[t+1],f[y]=u[0]*(1-n)+h[0]*n,f[y+1]=u[1]*(1-n)+h[1]*n,f[y+2]=u[2]*(1-n)+h[2]*n,f[y+3]=255,y+=b;r.putImageData(p,0,0)},bindHeatmap:function(e,t,n){if(t*n!==e.length)throw new Error("Heatmap: provided heatmap has wrong dimensions.");a=e,s=t,l=n,this.setCanvasSize(s,l)},getHTMLElement:function(){return n},resize:function(){},setCanvasSize:function(e,t){n.attr("width",e),n.attr("height",t)},setMinTemperature:function(e){c=e},setMaxTemperature:function(e){d=e},setColorPalette:function(e){i=new t(e).getRGBArray(),o=i.length-1}};return p.setColorPalette("DEFAULT"),h(),p}}),define("text!models/energy2d/views/heatmap-webgl-glsl/basic.vs.glsl",[],function(){return"varying vec2 coord;\n\nvoid main() {\n  coord = gl_TexCoord.xy;\n  gl_Position = vec4(gl_Vertex.xyz, 1.0);\n}\n"}),define("text!models/energy2d/views/heatmap-webgl-glsl/temp-renderer.fs.glsl",[],function(){return"// Provided textur contains temperature data in R channel.\nuniform sampler2D heatmap_tex;\nuniform sampler2D palette_tex;\n\nuniform float max_temp;\nuniform float min_temp;\n\nvarying vec2 coord;\n\nvoid main() {\n  float temp = texture2D(heatmap_tex, coord).r;\n  float scaled_temp = (temp - min_temp) / max(1.0, max_temp - min_temp);\n  gl_FragColor = texture2D(palette_tex, vec2(scaled_temp, 0.5));\n}\n"}),define("models/energy2d/views/heatmap-webgl",["require","models/energy2d/gpu/context","models/energy2d/gpu/texture","models/energy2d/gpu/shader","models/energy2d/gpu/mesh","models/energy2d/views/color-palette","text!models/energy2d/views/heatmap-webgl-glsl/basic.vs.glsl","text!models/energy2d/views/heatmap-webgl-glsl/temp-renderer.fs.glsl"],function(e){"use strict";var t=e("models/energy2d/gpu/context"),n=e("models/energy2d/gpu/texture"),r=e("models/energy2d/gpu/shader"),i=e("models/energy2d/gpu/mesh"),o=e("models/energy2d/views/color-palette"),a=e("text!models/energy2d/views/heatmap-webgl-glsl/basic.vs.glsl"),s=e("text!models/energy2d/views/heatmap-webgl-glsl/temp-renderer.fs.glsl");return function(e){var l,u,c,d,h,p=t.getWebGLContext(),f=new r(a,s),m=i.plane({coords:!0}),g="energy2d-heatmap-webgl-view",v=0,y=50,b=function(){u=$(p.canvas),u.attr("id",e||g)},x=function(){p.bindFramebuffer(p.FRAMEBUFFER,null),p.viewport(0,0,c,d)},w={renderHeatmap:function(){if(!h)throw new Error("Heatmap: bind heatmap texture before rendering.");x(),p.clear(p.COLOR_BUFFER_BIT),h.bind(0),l.bind(1),f.draw(m),l.unbind(1),h.unbind(0)},resize:function(){c=u.width(),d=u.height(),u.attr("width",c),u.attr("height",d)},bindHeatmapTexture:function(e){h=e},getHTMLElement:function(){return u},setMinTemperature:function(e){v=e,f.uniforms({min_temp:v})},setMaxTemperature:function(e){y=e,f.uniforms({max_temp:y})},setColorPalette:function(e){var t,r,i,a,s;for(t=new o(e).getRGBArray(),r=t.length,i=new Uint8Array(4*r),a=0;r>a;a+=1)s=4*a,i[s]=t[a][0],i[s+1]=t[a][1],i[s+2]=t[a][2],i[s+3]=255;l=new n(r,1,{type:p.UNSIGNED_BYTE,format:p.RGBA,filter:p.LINEAR}),p.bindTexture(p.TEXTURE_2D,l.id),p.texImage2D(p.TEXTURE_2D,0,l.format,r,1,0,l.format,l.type,i)}};return w.setColorPalette("DEFAULT"),f.uniforms({heatmap_tex:0,palette_tex:1,min_temp:v,max_temp:y}),m.coords=[[1,0],[1,1],[0,0],[0,1]],m.compile(),b(),w}}),define("models/energy2d/views/webgl-status",["require","common/controllers/checkbox-controller","models/energy2d/gpu/gpgpu"],function(e){"use strict";var t=e("common/controllers/checkbox-controller"),n=e("models/energy2d/gpu/gpgpu"),r='<p><a href="http://get.webgl.org" target="_blank">Click to learn more about WebGL.</a></p>';return function(e,i){function o(){var t;u=$("<div />"),u.attr("id",e||v),d=$('<div id="status-wrapper"/>'),d.appendTo(u),h=$("<div />"),h.appendTo(d),t=$('<a id="hide-webgl-status" class="button"><i class="icon-remove"></i></a>'),t.on("click",s),t.appendTo(d),f.appendTo(d),c=$('<a id="show-webgl-status" class="button"><i class="icon-bolt"></i></a>'),c.on("click",a),c.appendTo(u),d.hide()}function a(){c.hide(),d.fadeIn()}function s(){c.fadeIn(),d.fadeOut()}function l(){p=new t({type:"checkbox",id:"webgl-status-checkbox",text:"WebGL-accelerated physics engine",property:"use_WebGL"},y),f=p.getViewContainer(),o()}var u,c,d,h,p,f,m,g,v="e2d-webgl-status",y={getModel:function(){return i},getScriptingAPI:function(){return function(){}},getNextTabIndex:function(){return function(){}}};return g={bindModel:function(e){m=e,y.getModel=function(){return e},p.modelLoadedCallback(y)},render:function(){var e,t=m.isWebGLCompatible(),i=n.featuresInfo,o=!0,s=!0,l=m.properties.use_WebGL&&!m.isWebGLActive();h.empty(),Object.keys(i).forEach(function(e){var t=i[e];t.required&&!t.available&&(o=!1),t.required||t.available||(s=!1)}),o&&s?h.append('<p>Your browser <span class="happy">supports</span> WebGL as well as all required and optional extensions!</p>'):o?(h.append('<p>Your browser <span class="happy">supports</span> WebGL and all required extensions! However some optional extensions are unavailable:</p>'),Object.keys(i).forEach(function(e){var t,n=i[e];n.required||(t=n.available?'<span class="happy"><i class="icon-ok"></i></span>':'<span class="sad"><i class="icon-remove"></i></span>',h.append('<p class="extension">'+t+" "+e+"</p>"))}),h.append("<p>WebGL rendering quality can be affected.</p>")):i.WebGL?(h.append('<p>Your browser <span class="happy">supports</span> WebGL, however not all required extensions are available:</p>'),Object.keys(i).forEach(function(e){var t,n=i[e];n.required&&(t=n.available?'<span class="happy"><i class="icon-ok"></i></span>':'<span class="sad"><i class="icon-remove"></i></span>',h.append('<p class="extension">'+t+" "+e+"</p>"))}),h.append(r)):(h.append('<p>Sorry, your browser <span class="sad">does not support</span> WebGL.'),h.append(r)),t?(e='This model is <span class="happy">compatible</span> with WebGL-accelerated physics engine',m.isWebGLActive()?e+=' and it is <span class="happy">active</span>.':(e+=', but it is <span class="sad">inactive</span>.',l?e+=' Unfortunately, its initialization <span class="sad">failed</span>. Check the browser console for details.':o&&(e+=" Enable it to speed up simulation:")),h.append("<p>"+e+"</p>")):h.append('<p>Unfortunately, some features used in this model are <span class="sad">incompatible</span> with WebGL-accelerated physics engine.</p>'),o&&t&&!l?f.show():f.hide(),l?(e="WebGL initialization failed.",c.removeClass("happy"),c.addClass("sad")):o&&t?m.isWebGLActive()?(e="WebGL available and active.",c.removeClass("sad"),c.addClass("happy")):(e="WebGL available, but inactive.",c.removeClass("happy"),c.removeClass("sad")):(e="WebGL unavailable.",c.removeClass("happy"),c.addClass("sad")),e+=" Click for detailed information.",c.attr("title",e),l&&a()},getHTMLElement:function(){return u}},l(),g}}),define("models/energy2d/views/vectormap",[],function(){"use strict";return function(e){var t,n,r,i,o,a,s,l,u,c="energy2d-vectormap-view",d=100,h=8,p=Math.cos(.523598776),f=Math.sin(.523598776),m=4,g="rgb(175,175,175)",v=!0,y=function(){t=$("<canvas />"),t.attr("id",e||c),n=t[0].getContext("2d")},b=function(e,t,r,i){var o=1/Math.sqrt(r*r+i*i),a=r*o,s=i*o,l=e+a*h+r*d,u=t+s*h+i*d,c=m*(a*p+s*f),g=m*(s*p-a*f);n.beginPath(),n.moveTo(e,t),n.lineTo(l,u),n.lineTo(l-c,u-g),n.moveTo(l,u),c=m*(a*p-s*f),g=m*(s*p+a*f),n.lineTo(l-c,u-g),n.stroke()},x={renderVectormap:function(){if(v){var e,t,c,d,h,p,f,m,y,x;if(!o||!a)throw new Error("Vectormap: bind vectormap before rendering.");for(e=r/s,t=i/l,n.clearRect(0,0,r,i),n.strokeStyle=g,n.lineWidth=1,f=1;s-1>f;f+=u)for(y=f*l,c=(f+.5)*e,m=1;l-1>m;m+=u)x=y+m,d=(m+.5)*t,h=o[x],p=a[x],h*h+p*p>1e-15&&b(c,d,h,p)}},clear:function(){n.clearRect(0,0,r,i)},get enabled(){return v},set enabled(e){v=e,v||x.clear()},bindVectormap:function(e,t,n,r,i){if(n*r!==e.length)throw new Error("Heatmap: provided U component of vectormap has wrong dimensions.");if(n*r!==t.length)throw new Error("Heatmap: provided V component of vectormap has wrong dimensions.");o=e,a=t,s=n,l=r,u=Math.round(n/i)},getHTMLElement:function(){return t},resize:function(){r=t.width(),i=t.height(),t.attr("width",r),t.attr("height",i)}};return y(),x}}),define("text!models/energy2d/views/vectormap-webgl-glsl/vectormap.vs.glsl",[],function(){return"// Provided texture contains vector data in RG channels.\nattribute vec2 origin;\n\nuniform sampler2D vectormap_tex;\nuniform float base_length;\nuniform float vector_scale;\nuniform vec2 scale;\n\nvoid main() {\n  // Read vector which should be visualized.\n  vec2 vec = texture2D(vectormap_tex, gl_TexCoord.xy).xy;\n  vec.y = -vec.y;\n\n  if (length(vec) < 1e-15) {\n    // Do not draw to small vectors.\n    // Set position outside [-1, 1] region, which is rendered.\n    gl_Position = vec4(2.0);\n    return;\n  }\n\n  // Test which part of the vector arrow is being processed. \n  if (gl_Vertex.x == 0.0 && gl_Vertex.y == 0.0) {\n    // Origin of the arrow is being processed.\n    // Just transform its coordinates.\n    gl_Position = vec4(origin, 0.0, 1.0);\n  } else {\n    // Other parts of arrow are being processed.\n    // Set proper length of the arrow, rotate it, scale\n    // and finally transform.\n\n    // Calculate arrow length.\n    vec2 new_pos = gl_Vertex.xy;\n    new_pos.x += base_length + vector_scale * length(vec);\n\n    // Calculate angle between reference arrow (horizontal).\n    vec = normalize(vec);\n    float angle = acos(dot(vec, vec2(1.0, 0.0)));\n    if (vec.y < 0.0) {\n      angle = -angle;\n    }\n    // Prepare rotation matrix.\n    // See: http://en.wikipedia.org/wiki/Rotation_matrix\n    mat2 rot_m = mat2(\n      cos(angle), sin(angle),\n     -sin(angle), cos(angle)\n    );\n    // Rotate.\n    new_pos = rot_m * new_pos;\n    // Scale.\n    new_pos = new_pos * scale;\n    // Transform.\n    gl_Position = vec4(new_pos + origin, 0.0, 1.0);\n  }\n}\n"}),define("text!models/energy2d/views/vectormap-webgl-glsl/vectormap.fs.glsl",[],function(){return"uniform vec4 color;\n\nvoid main() {\n  gl_FragColor = color;\n}\n"}),define("models/energy2d/views/vectormap-webgl",["require","models/energy2d/gpu/context","models/energy2d/gpu/shader","models/energy2d/gpu/mesh","text!models/energy2d/views/vectormap-webgl-glsl/vectormap.vs.glsl","text!models/energy2d/views/vectormap-webgl-glsl/vectormap.fs.glsl"],function(e){"use strict";var t=e("models/energy2d/gpu/context"),n=e("models/energy2d/gpu/shader"),r=e("models/energy2d/gpu/mesh"),i=e("text!models/energy2d/views/vectormap-webgl-glsl/vectormap.vs.glsl"),o=e("text!models/energy2d/views/vectormap-webgl-glsl/vectormap.fs.glsl");return function(e){var a,s,l,u,c,d,h,p=t.getWebGLContext(),f=new n(i,o),m=new r({coords:!0,lines:!0}),g="energy2d-vectormap-webgl-view",v=100,y=8,b=[.7,.7,.7,1],x=!0,w=function(){var e,t,n,r,i,o=2/c,a=2/d,s=1/c,l=1/d;for(m.addVertexBuffer("origins","origin"),m.vertices=[],m.origins=[],m.coords=[],m.lines=[],n=0,e=1;c-1>e;e+=h)for(t=1;d-1>t;t+=h)m.vertices.push([0,0,0],[.01,0,0],[-3,2,0],[-3,-2,0]),r=[-1+(e+.5)*o,1-(t+.5)*a,0],m.origins.push(r,r,r,r),i=[(t+.5)*l,(e+.5)*s],m.coords.push(i,i,i,i),m.lines.push([n,n+1],[n+1,n+2],[n+1,n+3]),n+=4;m.compile()},_=function(){a=$(p.canvas),a.attr("id",e||g)},T=function(){p.bindFramebuffer(p.FRAMEBUFFER,null),p.viewport(0,0,s,l)},A={renderVectormap:function(){if(x){if(!u)throw new Error("Vectormap: bind heatmap texture before rendering.");T(),u.bind(0),f.draw(m,p.LINES),u.unbind(0)}},get enabled(){return x},set enabled(e){x=e},resize:function(){s=a.width(),l=a.height(),a.attr("width",s),a.attr("height",l),f.uniforms({scale:[2/s,2/l]})},bindVectormapTexture:function(e,t,n,r){u=e,c=t,d=n,h=Math.round(c/r),w()},getHTMLElement:function(){return a}};return f.uniforms({vectormap_tex:0,base_length:y,vector_scale:v,color:b}),_(),A}}),define("models/energy2d/views/photons",[],function(){"use strict";return function(e){var t,n,r,i,o,a,s,l,u,c="energy2d-photons-view",d="energy2d-photons-view",h=10,p=function(){t=$("<canvas />"),t.attr("id",e||c),t.addClass(d),n=t[0].getContext("2d")},f=function(){n.strokeStyle="rgba(255,255,255,128)",n.lineWidth=.5},m={renderPhotons:function(){var e,t,l,u,c,d;if(!o)throw new Error("Photons view: bind parts array before rendering.");for(n.clearRect(0,0,r,i),c=0,d=o.length;d>c;c+=1)e=o[c],t=e.x*a,l=e.y*s,u=1/Math.sqrt(e.vx*e.vx+e.vy*e.vy),n.beginPath(),n.moveTo(t,l),n.lineTo(t+h*e.vx*u,l+h*e.vy*u),n.stroke()},bindPhotonsArray:function(e,t,n){o=e,l=t,u=n,a=r/l,s=i/u},getHTMLElement:function(){return t},resize:function(){r=t.width(),i=t.height(),a=r/l,s=i/u,t.attr("width",r),t.attr("height",i),f()}};return p(),f(),m}}),define("models/energy2d/views/parts",[],function(){var e=-1,t=2;return function(n,r){function i(e){return"translate("+T(e.x||0)+","+A(e.y||0)+")"}function o(e){return T(e.width)+t}function a(e){return T(e.height)+t}function s(e){return T(.5*e.a)}function l(e){return T(.5*e.b)}function u(e){return e.visible?"visible":"hidden"}function c(e){return e.texture?"url(#texture-1)":"none"}function d(e){return e.computeLabel()
}function h(){return-this.getBBox().width/2}function p(e){if(!e.filled)return"rgba(0, 0, 0, 0)";var t;if("auto"===e.color)t=e.power>0?"#FFFF00":e.power<0?"#B0C4DE":e.constant_temperature?"rgba(0, 0, 0, 0)":"#999";else if(t=e.color,!isNaN(parseInt(t,16))){for(;t.length<6;)t="0"+t;t="#"+t}return t}function f(e){var t,n,r=[],i=e.raw_x_coords,o=e.raw_y_coords;for(t=0,n=i.length;n>t;t++)r.push(T(i[t])),r.push(A(o[t]));return"M"+r.join(",")+"Z"}function m(e){switch(e.shapeType){case"polygon":return f(e);case"ring":return E(e)}}function g(e){var t=e.shapeType;return"rectangle"===t||"polygon"===t?this.parentNode.firstElementChild.getBBox().width/2:0}function v(e){var t=e.shapeType;return"rectangle"===t||"polygon"===t?this.parentNode.firstElementChild.getBBox().height/2:0}function y(){var e=r.append("defs").append("pattern").attr("id","texture-1").attr("patternUnits","userSpaceOnUse").attr("x",0).attr("y",0).attr("width","0.7em").attr("height","0.7em").attr("viewBox","0 0 16 16");e.append("path").attr("class","e2d-texture-path-shadow").attr("d","M0,0 L16,16 M-1,15 L1,17 M15,-1 L17,1"),e.append("path").attr("class","e2d-texture-path").attr("d","M0,0 L16,16 M-1,15 L1,17 M15,-1 L17,1")}function b(t,n,r){switch(n=n.select(C[t]),n.append(t).attr("class","e2d-part-shape"),n.append(t).attr("class","e2d-part-shape-outline").attr("fill",c),r.select(".e2d-part-shape"),r.select(".e2d-part-shape-outline"),t){case"rect":r.selectAll("rect").attr("x",e).attr("y",e).attr("width",o).attr("height",a);break;case"ellipse":r.selectAll("ellipse").attr("rx",s).attr("ry",l);break;case"path":r.selectAll("path").attr("d",m)}}function x(e,t){e.append("text").attr("class","e2d-part-label-shadow").attr("dy",".35em"),e.append("text").attr("class","e2d-part-label").attr("dy",".35em"),t.select(".e2d-part-label"),t.select(".e2d-part-label-shadow"),t.selectAll(".e2d-part-label, .e2d-part-label-shadow").text(d).attr("dx",h).attr("x",g).attr("y",v)}var w,_,T=n.model2px,A=n.model2pxInv,C={rect:function(e){return"rectangle"===e.shapeType?this:null},ellipse:function(e){return"ellipse"===e.shapeType?this:null},path:function(e){return"polygon"===e.shapeType||"ring"===e.shapeType?this:null}},E=d3.svg.arc().innerRadius(function(e){return T(.5*e.inner)}).outerRadius(function(e){return T(.5*e.outer)}).startAngle(0).endAngle(2*Math.PI),S=function(){var e,t,n,r,i,o,a;return d3.behavior.drag().origin(function(e){return{x:T(e.x),y:A(e.y)}}).on("dragstart",function(s){var l,u;s.draggable&&(e=t=null,l=T.range(),u=A.range(),n=Math.min(l[0],l[1]),r=Math.max(l[0],l[1]),i=Math.min(u[0],u[1]),o=Math.max(u[0],u[1]),a=this.getBBox(),a.x0=a.x+10,a.y0=a.y+10,a.x1=a.x+a.width-10,a.y1=a.y+a.height-10,d3.select(this).style("opacity",.7))}).on("drag",function(s){s.draggable&&(e=d3.event.x,t=d3.event.y,e-=Math.max(0,a.x0+e-r)+Math.min(0,a.x1+e-n),t-=Math.max(0,a.y0+t-o)+Math.min(0,a.y1+t-i),d3.select(this).attr("transform","translate("+e+","+t+")"))}).on("dragend",function(n){n.draggable&&(d3.select(this).style("opacity",1),null!==e&&(n.x=T.invert(e),n.y=A.invert(t)))})}();return w={renderParts:function(){if(_){var e,t;e=r.selectAll(".e2d-part").data(_),t=e.enter().append("g").attr("class","e2d-part part"),b("rect",t,e),b("ellipse",t,e),b("path",t,e),x(t,e),t.call(S),e.attr("transform",i),e.select(".e2d-part-shape").attr("fill",p).style("visibility",u),e.exit().remove()}},bindPartsArray:function(e){_=e}},function(){y()}(),w}}),define("models/energy2d/views/sensors",[],function(){var e=2,t=4;return function(n,r){function i(e){return e+"%"}function o(e){return"translate("+A(e.x)+","+C(e.y)+")"}function a(){return-this.getBBox().width/2}function s(e){return e.label}function l(e){return e.value.toFixed(1)+" C"}function u(e){return i(E(e.value))}function c(e){return"rotate("+e.value+")"}function d(e){return e.value.toFixed(1)+" W/m"}function h(e){return"rotate("+e.angle+")"}function p(e){e=e.append("g").attr("class","e2d-measuring-point"),e.append("line").attr("x1",0).attr("y1","-0.8%").attr("x2",0).attr("y2","0.8%"),e.append("line").attr("x1","-0.8%").attr("y1",0).attr("x2","0.8%").attr("y2",0),e.append("circle").attr("r","0.8%")}function f(e,t){e.append("text").attr("class","e2d-sensor-reading-shadow"),e.append("text").attr("class","e2d-sensor-reading"),e.append("text").attr("class","e2d-sensor-label-shadow"),e.append("text").attr("class","e2d-sensor-label"),t.select(".e2d-sensor-label"),t.select(".e2d-sensor-label-shadow"),t.select(".e2d-sensor-reading"),t.select(".e2d-sensor-reading-shadow")}function m(n){var c=r.selectAll(".e2d-sensor.thermometer").data(n.filter(function(e){return"thermometer"===e.type})),d=c.enter().append("g").attr("class","e2d-sensor sensor thermometer").call(S);f(d,c),d.append("rect").attr("class","e2d-thermometer-fill"),d.append("rect").attr("class","e2d-thermometer-background"),d.call(p),c.attr("transform",o),c.select(".e2d-thermometer-fill").attr("x",i(-.5*e)).attr("y",i(-.5*t)).attr("width",i(e)).attr("height",i(t)),x=c.select(".e2d-thermometer-background").attr("x",i(-.5*e)).attr("y",i(-.5*t)).attr("width",i(e)).attr("height",u),w=c.selectAll(".e2d-sensor-reading, .e2d-sensor-reading-shadow").text(l).attr("y",i(-.5*t)).attr("dy","-.2em").attr("dx","-.7em"),c.selectAll(".e2d-sensor-label, .e2d-sensor-label-shadow").text(s).attr("dx",a).attr("dy","1em").attr("y",i(.5*t)),c.exit().remove()}function g(e){var t=r.selectAll(".e2d-sensor.anemometer").data(e.filter(function(e){return"anemometer"===e.type})),n=t.enter().append("g").attr("class","e2d-sensor sensor anemometer").call(S);f(n,t),n=n.append("svg").attr("class","e2d-anemometer-shape").attr("viewBox","-50 -50 100 100").attr("x","-3%").attr("y","-3%").attr("width","6%").attr("height","6%").append("g").attr("class","e2d-anemometer-rot"),n.append("path").attr("d","M-10,10 L0,50 L10,10 Z").attr("transform","rotate(0)"),n.append("path").attr("d","M-10,10 L0,50 L10,10 Z").attr("transform","rotate(120)"),n.append("path").attr("d","M-10,10 L0,50 L10,10 Z").attr("transform","rotate(240)"),n.append("circle").attr("r",12),t.attr("transform",o),_=t.select(".e2d-anemometer-rot").attr("transform",c),t.selectAll(".e2d-sensor-label, .e2d-sensor-label-shadow").text(s).attr("dx",a).attr("dy","0.7em").attr("y","3%"),t.exit().remove()}function v(e){var t=r.selectAll(".e2d-sensor.heatFlux").data(e.filter(function(e){return"heatFlux"===e.type})),n=t.enter().append("g").attr("class","e2d-sensor sensor heatFlux").call(S);n=n.append("g").attr("transform",h),n.append("rect").attr("class","e2d-heatflux-shape").attr("x","-3%").attr("y","-1%").attr("width","6%").attr("height","2%"),n.append("svg").attr("viewBox","0 0 6 1").attr("x","-3%").attr("y","-1%").attr("width","6%").attr("height","2%").append("path").attr("class","e2d-heatflux-pattern").attr("d","M0,0L1,1L2,0L3,1L4,0L5,1L6,0"),n.call(p),f(n,t),t.attr("transform",o),T=t.selectAll(".e2d-sensor-reading, .e2d-sensor-reading-shadow").text(d).attr("y","-1%").attr("dy","-.2em").attr("dx","-1.8em"),t.selectAll(".e2d-sensor-label, .e2d-sensor-label-shadow").text(s).attr("dx",a).attr("dy","0.9em").attr("y","1%"),t.exit().remove()}var y,b,x,w,_,T,A=n.model2px,C=n.model2pxInv,E=d3.scale.linear().clamp(!0).domain([0,50]).range([t,0]),S=d3.behavior.drag().origin(function(e){return{x:A(e.x),y:C(e.y)}}).on("drag",function(e){e.x=A.invert(d3.event.x),e.y=C.invert(d3.event.y)});return y={update:function(){x.attr("height",u),w.text(l),_.attr("transform",c),T.text(d)},renderSensors:function(){b&&(m(b),g(b),v(b))},bindSensorsArray:function(e){b=e},setMinMaxTemp:function(e,t){E.domain([e,t])}}}}),define("models/energy2d/views/renderer",["require","models/energy2d/views/heatmap","models/energy2d/views/heatmap-webgl","models/energy2d/views/webgl-status","models/energy2d/views/vectormap","models/energy2d/views/vectormap-webgl","models/energy2d/views/photons","models/energy2d/views/parts","models/energy2d/views/sensors"],function(e){var t=e("models/energy2d/views/heatmap"),n=e("models/energy2d/views/heatmap-webgl"),r=e("models/energy2d/views/webgl-status"),i=e("models/energy2d/views/vectormap"),o=e("models/energy2d/views/vectormap-webgl"),a=e("models/energy2d/views/photons"),s=e("models/energy2d/views/parts"),l=e("models/energy2d/views/sensors");return function(e,u){function c(e){var t=e.getHTMLElement();t.css("width","100%"),t.css("height","100%"),t.css("position","absolute"),t.css("top",0),t.css("left",0),t.css("z-index",_),_+=1,w.append(t)}function d(){var e=u.properties;w.empty(),_=0,u.isWebGLActive()?(f=new n,m=new o,c(m)):(f=new t,c(f),m=new i,c(m)),g=new a,c(g),f.resize(),m.resize(),g.resize(),u.isWebGLActive()?(f.bindHeatmapTexture(u.getTemperatureTexture()),m.bindVectormapTexture(u.getVelocityTexture(),e.grid_width,e.grid_height,25)):(f.bindHeatmap(u.getTemperatureArray(),e.grid_width,e.grid_height),m.bindVectormap(u.getUVelocityArray(),u.getVVelocityArray(),e.grid_width,e.grid_height,25)),g.bindPhotonsArray(u.getPhotonsArray(),e.model_width,e.model_height)}function h(){var e=u.properties;m.enabled=e.velocity,f.setMinTemperature(e.minimum_temperature),f.setMaxTemperature(e.maximum_temperature),f.setColorPalette(e.color_palette_type),y.setMinMaxTemp(e.minimum_temperature,e.maximum_temperature)}var p,f,m,g,v,y,b=new r(null,u),x=b.getHTMLElement(),w=$("<div id='e2d-canvas-views'>"),_=0,T=!1;return p={getHeightForWidth:function(e){return e*u.properties.grid_height/u.properties.grid_width},setup:function(e){T=!0,d(),v.bindPartsArray(e.getPartsArray()),y.bindSensorsArray(e.getSensorsArray()),b.bindModel(e),h(),v.renderParts(),y.renderSensors(),b.render(),p.update(),e.addPropertiesListener("use_WebGL",function(){d(),h(),b.render(),p.update()}),e.addPropertiesListener(["color_palette_type","velocity","minimum_temperature","maximum_temperature"],function(){h(),p.update()}),e.on("tick.view-update",p.update),e.on("partsChanged.view-update",function(){v.renderParts()}),e.on("sensorsChanged.view-update",function(){y.renderSensors()})},update:function(){T&&(f.renderHeatmap(),m.renderVectormap(),g.renderPhotons(),y.update())},resize:function(){T&&(f.resize(),m.resize(),g.resize(),v.renderParts(),y.renderSensors(),p.update())},reset:function(){},setFocus:function(){u.get("enableKeyboardHandlers")&&this.$el.focus()},bindModel:function(e){u=e}},function(){var t=e.appendViewport();v=new s(e,t.append("g")),y=new l(e,t.append("g")),e.$el.append(w),e.$el.append(x)}(),p}}),define("models/energy2d/views/view",["require","common/views/svg-container","models/energy2d/views/renderer"],function(e){var t=e("common/views/svg-container"),n=e("models/energy2d/views/renderer");return function(e,r){return new t(e,r,n,{origin:"top-left"})}}),define("models/energy2d/benchmarks/benchmarks",["common/performance"],function(){var e=require("common/performance"),t=5e3,n=1e3;return function(r){var i,o=r.model,a=[{name:"engine (ms)",numeric:!0,formatter:d3.format("5.1f"),run:function(r){o.start(),setTimeout(function(){o.stop(),o.properties.use_WebGL=!1,e.collectData(!0),i=o.get("time"),setTimeout(function(){o.start(),setTimeout(function(){o.stop(),e.collectData(!1),r(e.getAvgTime("engine"))},t)},100)},n)}},{name:"JS rendering (ms)",numeric:!0,formatter:d3.format("5.1f"),run:function(t){t(e.getAvgTime("js-rendering"))}},{name:"tick (ms)",numeric:!0,formatter:d3.format("5.1f"),run:function(t){t(e.getAvgTime("tick"))}},{name:"gap b/w frames (ms)",numeric:!0,formatter:d3.format("5.1f"),run:function(t){t(e.getAvgTime("gap"))}},{name:"fps",numeric:!0,formatter:d3.format("5.1f"),run:function(e){var n=o.get("time")-i;e(n/(o.get("timeStepsPerTick")*o.get("timeStep"))*1e3/t)}},{name:"engine WebGL (ms)",numeric:!0,formatter:d3.format("5.1f"),run:function(r){o.start(),setTimeout(function(){o.stop(),o.properties.use_WebGL=!0,e.collectData(!0),i=o.get("time"),setTimeout(function(){o.start(),setTimeout(function(){o.stop(),e.collectData(!1),r(e.getAvgTime("engine"))},t)},100)},n)}},{name:"JS rendering WebGL (ms)",numeric:!0,formatter:d3.format("5.1f"),run:function(t){t(e.getAvgTime("js-rendering"))}},{name:"tick WebGL (ms)",numeric:!0,formatter:d3.format("5.1f"),run:function(t){t(e.getAvgTime("tick"))}},{name:"gap b/w frames WebGL (ms)",numeric:!0,formatter:d3.format("5.1f"),run:function(t){t(e.getAvgTime("gap"))}},{name:"fps WebGL",numeric:!0,formatter:d3.format("5.1f"),run:function(e){var n=o.get("time")-i;e(n/(o.get("timeStepsPerTick")*o.get("timeStep"))*1e3/t)}},{name:"interactive",numeric:!1,run:function(e){e(window.location.pathname+window.location.hash)}}];return a}}),define("models/energy2d/controllers/scripting-api",[],function(){return function(e,t){return{getTemperatureAt:function(e,n){return t.getTemperatureAt(e,n)},getAverageTemperatureAt:function(e,n){return t.getAverageTemperatureAt(e,n)},getSensor:function(e){return t.getSensorsArray()[e]},getPart:function(e){return t.getPartsArray()[e]},addPart:function(e){t.addPart(e)},removePart:function(e){t.removePart(e)},getNumberOfParts:function(){return t.getPartsArray().length},syncTemperature:function(){t.syncTemperature()}}}}),define("models/energy2d/controllers/controller",["require","common/controllers/model-controller","models/energy2d/modeler","models/energy2d/views/view","models/energy2d/benchmarks/benchmarks","models/energy2d/controllers/scripting-api"],function(e){var t=e("common/controllers/model-controller"),n=e("models/energy2d/modeler"),r=e("models/energy2d/views/view"),i=e("models/energy2d/benchmarks/benchmarks"),o=e("models/energy2d/controllers/scripting-api");return function(e,a,s){return new t(e,a,s,n,r,o,i)}}),define("common/models/dataset",[],function(){var e=0;return function(t,n){function r(){s=0,l=[],o(),u=t.timeSeries.xProperty,c=t.timeSeries.properties,i()}function i(){var e,t=[];for(s++,t.push(n.get(u)),e=0;e<c.length;e++)t.push(n.get(c[e]));l.push(t)}function o(){n.on("tick."+d,function(){i()})}var a,s,l,u,c,d="dataset"+ ++e;return a={getData:function(e){function n(e){var t=[];return e.forEach(function(e){t.push(e)}),t}var r,i,o,a,s,u=[];if(void 0===e)return n(l);for(r=0;r<l.length;r++){for(i=l[r],s=[],a=0;a<e.length;a++)o=t.properties.indexOf(e[a]),s.push(i[o]);u.push(s)}return[u]},reset:function(){l=$.extend(!0,[],t.tableData),s=0},appendPropertyRow:i,serialize:function(){var e=$.extend(!0,{},t);return e.tableData=l,e}},r(),a}}),define("common/controllers/experiment-controller",["require","common/controllers/interactive-metadata","common/validator","common/models/dataset"],function(e){var t=e("common/controllers/interactive-metadata"),n=e("common/validator"),r=e("common/models/dataset"),i=0;return function(e,o,a){function s(){b=o.getScriptingAPI(),y=o.getModel(),e=n.validateCompleteness(t.experiment,e),_=e.timeSeries,T=e.parameters.inputs,A=e.parameters.outputs,C=e.destinations,E=e.stateButtons,S=e.onReset,a.length>0&&(P=a[0]),x=[]}function l(){function e(){R=o.getComponent(E.startRun),O=o.getComponent(E.stopRun),M=o.getComponent(E.saveRun),N=o.getComponent(E.nextRun),I=o.getComponent(E.clearAll)}function t(){var e,t,n,r;for(L=[],B=[],e=0;e<C.length;e++){for(n=C[e],n.components=[],t=0;t<n.componentIds.length;t++)n.components.push(o.getComponent(n.componentIds[t]));switch(n.type){case"timeSeries":L.push(n);break;case"parameterSeries":B.push(n);break;default:throw new Error("Experiment destination: invalid destination type: "+n.type)}}for(D=void 0,e=0;e<L.length;e++)for(n=L[e],t=0;t<n.components.length;t++)if(r=n.components[t],void 0!==r.type&&"graph"===r.type)return D=r,void 0}function n(){y.defineParameter("experimentCleared",{initialValue:!1},function(){y.get("experimentCleared")&&(m(),y.set("experimentCleared",!1))}),y.defineParameter("experimentRunning",{initialValue:!1},function(){y.get("experimentRunning")?p():f()})}function r(){R.setAction("set('experimentRunning', true);"),O.setAction("set('experimentRunning', false);"),M.setAction(function(){var e,t,n;for(x.push(w),e=0;e<B.length;e++)for(n=B[e],t=0;t<n.components.length;t++)n.components[t].appendDataPropertiesToComponent();M.setDisabled(!0)}),N.setAction("set('experimentCleared', true);"),I.setAction("reload();")}e(),t(),n(),r(),h(),S&&(k=b.makeFunctionInScriptContext(S))}function u(){var e;if(D){for(e=0;e<x.length;e++)D.addDataSet(x[e].getData());D.update()}}function c(){for(var e=0;e<T.length;e++)y.unfreeze(T[e])}function d(){for(var e=0;e<T.length;e++)y.freeze(T[e])}function h(){R.setDisabled(!1),O.setDisabled(!0),M.setDisabled(!0),N.setDisabled(!0),I.setDisabled(!0),x=[],D&&D.clearDataSets(),c()}function p(){R.setDisabled(!0),O.setDisabled(!1),M.setDisabled(!0),N.setDisabled(!0),I.setDisabled(!1),d(),w=new r({timeSeries:_},y),b.api.start()}function f(){R.setDisabled(!0),O.setDisabled(!0),M.setDisabled(!1),N.setDisabled(!1),b.api.stop()}function m(){R.setDisabled(!1),O.setDisabled(!0),M.setDisabled(!0),N.setDisabled(!0),y.set("experimentCleared",!1),o.resetModel({retainParameters:T}),c(),k&&P.apply(k,null),u()}function g(){y.on("tick."+F,function(){return null}),y.on("invalidation."+F,function(){return null}),y.on("reset."+F,function(){return null})}var v,y,b,x,w,_,T,A,C,E,S,k,P,R,O,M,N,I,L,B,D,F="experimentController"+ ++i;return v={modelLoadedCallback:function(){b=o.getScriptingAPI(),y=o.getModel(),g(),l()},serialize:function(){var t=$.extend(!0,{},e);return t}},s(),v}}),define("common/controllers/interactives-controller",["require","lab.config","arrays","fastclick","common/alert","common/controllers/interactive-metadata","common/validator","common/interactive-not-found","common/controllers/bar-graph-controller","common/controllers/graph-controller","common/controllers/export-controller","common/controllers/scripting-api","common/controllers/button-controller","common/controllers/checkbox-controller","common/controllers/text-controller","common/controllers/image-controller","common/controllers/radio-controller","common/controllers/slider-controller","common/controllers/pulldown-controller","common/controllers/numeric-output-controller","common/controllers/table-controller","common/controllers/parent-message-api","common/controllers/thermometer-controller","common/controllers/playback-controller","common/controllers/div-controller","common/dispatch-support","common/controllers/help-system","common/views/tooltip","common/cookies","common/controllers/setup-banner","common/controllers/about-dialog","common/controllers/share-dialog","common/controllers/credits-dialog","common/layout/semantic-layout","common/layout/templates","models/md2d/controllers/controller","models/solar-system/controllers/controller","models/signal-generator/controller","models/sensor/controller","models/energy2d/controllers/controller","common/controllers/experiment-controller"],function(e){var t=e("lab.config"),n=e("arrays"),r=e("fastclick"),i=e("common/alert"),o=e("common/controllers/interactive-metadata"),a=e("common/validator"),s=e("common/interactive-not-found"),l=e("common/controllers/bar-graph-controller"),u=e("common/controllers/graph-controller"),c=e("common/controllers/export-controller"),d=e("common/controllers/scripting-api"),h=e("common/controllers/button-controller"),p=e("common/controllers/checkbox-controller"),f=e("common/controllers/text-controller"),m=e("common/controllers/image-controller"),g=e("common/controllers/radio-controller"),v=e("common/controllers/slider-controller"),y=e("common/controllers/pulldown-controller"),b=e("common/controllers/numeric-output-controller"),x=e("common/controllers/table-controller"),w=e("common/controllers/parent-message-api"),_=e("common/controllers/thermometer-controller"),T=e("common/controllers/playback-controller"),A=e("common/controllers/div-controller"),C=e("common/dispatch-support"),E=e("common/controllers/help-system"),S=e("common/views/tooltip"),k=e("common/cookies"),P=e("common/controllers/setup-banner"),R=e("common/controllers/about-dialog"),O=e("common/controllers/share-dialog"),M=e("common/controllers/credits-dialog"),N=e("common/layout/semantic-layout"),I=e("common/layout/templates"),L={md2d:e("models/md2d/controllers/controller"),"solar-system":e("models/solar-system/controllers/controller"),"signal-generator":e("models/signal-generator/controller"),sensor:e("models/sensor/controller"),energy2d:e("models/energy2d/controllers/controller")},B=e("common/controllers/experiment-controller"),D={text:f,image:m,button:h,checkbox:p,pulldown:y,radio:g,thermometer:_,barGraph:l,graph:u,slider:v,numericOutput:b,table:x,div:A,playback:T};return function(e,l){function u(e){if(Q=e,pt[Q])return pt[Q];throw new Error("No model found with id "+Q)}function h(){lt.isReady()&&(lt.layoutInteractive(),St.layoutUpdated())}function p(){et.off("keydown.interactiveController"),J&&J.enableKeyboardHandlers()&&et.on("keydown.interactiveController",function(e){var t=e.keycode||e.which;switch(t){case 13:e.preventDefault(),nt.api.start();break;case 32:e.preventDefault(),nt.api.isStopped()?nt.api.start():nt.api.stop();break;case 37:e.preventDefault(),nt.api.isStopped()?nt.api.stepBack():nt.api.stop();break;case 39:e.preventDefault(),nt.api.isStopped()?nt.api.stepForward():nt.api.stop()}})}function f(){var e,t,n,r,i,o;e="string"==typeof ct.template?I[ct.template]:ct.template,t=ct.layout,i=P(dt,ct,Z,st,ot,at),r=i.components;for(n in r)r.hasOwnProperty(n)&&(n=r[n],n.modelLoadedCallback&&ft.push($.proxy(n.modelLoadedCallback,n)));e=i.template.concat(e),t=$.extend({},t,i.layout),r=$.extend({},At,i.components),lt.initialize(e,t,r,ct.aspectRatio,ct.fontScale),b()&&($(window).unbind("resize"),$(window).on("resize",function(){dt.resize()})),o=function(){dt.resize(),setTimeout(dt.resize,50)},document.addEventListener("fullscreenchange",o,!1),document.addEventListener("mozfullscreenchange",o,!1),document.addEventListener("webkitfullscreenchange",o,!1)}function m(e){var t,n=e.type,r=e.id;if(t=new D[n](e,dt),!t.getViewContainer().hasClass("component"))throw new Error("Invalid Interactive Component implementation. Each component has to have 'component' class.");At[r]=t,Ct.push(t),t.modelLoadedCallback&&ft.push($.proxy(t.modelLoadedCallback,t))}function g(e){return"string"==typeof e?e:e.join("\n")}function v(){var e;for(e=0;e<_t.length;e++)_t[e]();Tt=!0}function y(e){function t(e,t){var n,r,s;if(t)try{for(n=0,r=t.length;r>n;n++)t[n]=a.validateCompleteness(o[e],t[n])}catch(l){throw s="Incorrect "+e+" definition:\n"+l.message,i(s),new Error(s)}}var n,r,s,l,u,c;try{e=a.validateCompleteness(o.interactive,e)}catch(d){throw c="Incorrect interactive definition:\n"+d.message,i(c),new Error(c)}for(t("model",e.models),t("parameter",e.parameters),t("output",e.outputs),t("filteredOutput",e.filteredOutputs),t("helpTip",e.helpTips),s=e.models,n=0,r=s.length;r>n;n++)l=s[n],t("parameter",l.parameters),t("output",l.outputs),t("filteredOutput",l.filteredOutputs);e.experiment&&(K=e.experiment,a.validateCompleteness(o.experimentTimeSeries,K.timeSeries),t("experimentParameter",K.parameters),t("experimentDestination",K.destinations),t("experimentSavedRun",K.savedRuns)),u=e.components;try{for(n=0,r=u.length;r>n;n++)u[n]=a.validateCompleteness(o[u[n].type],u[n])}catch(d){throw c="Incorrect "+u[n].type+" component definition:\n"+d.message,i(c),new Error(c)}if(e.exports)try{e.exports=a.validateCompleteness(o.exports,e.exports)}catch(d){throw c="Incorrect exports definition:\n"+d.message,i(c),new Error(c)}return e}function b(){return"BODY"===et.parent().parent().prop("nodeName")}function x(){nt=new d(dt),nt.exposeScriptingAPI(),J.ScriptingAPI&&(nt.extend(J.ScriptingAPI),nt.exposeScriptingAPI())}function _(e){function t(){dt.interactive=y(dt.interactive),ct=dt.interactive,ht=ct.models;for(var e=0,t=ht.length;t>e;e++)pt[ht[e].id]=ht[e];T()}wt=!1,Tt=!1,"string"==typeof e?$.get(e).done(function(e){"string"==typeof e&&(e=JSON.parse(e)),dt.interactive=e,t()}).fail(function(){document.title="Interactive not found",dt.interactive=s(e),t()}):(dt.interactive=e,t())}function T(){ht&&ht.length>0?A(ht[0].id):(J={getViewContainer:function(){var e=$("<div>").attr({id:"model-container","class":"container",tabindex:ut}).css({width:"0px",height:"0px"});return e},getHeightForWidth:function(){return 0},resize:function(){},model:{on:function(){},isStopped:function(){},set:function(){},get:function(){},addObserver:function(){},properties:{}},modelSetupComplete:function(){},initializeView:function(){}},Z=J.model,dt.currentModel={},x(),F())}function A(e,r){function i(e,t,r){function i(e,t){var r;for(r in e)void 0===t[r]?t[r]=n.isArray(e[r])?$.extend(!0,[],e[r]):"object"==typeof e[r]?$.extend(!0,{},e[r]):e[r]:"object"!=typeof t[r]||t[r]instanceof Array?t[r]instanceof Array&&e[r]instanceof Array&&(t[r]=$.extend(!0,e[r],t[r])):t[r]=i(e[r],t[r]);return t}var o,a;return a=$.extend(!0,{},r),a=i(e.viewOptions||{},a),o=$.extend(!0,{},t),o=i(e||{},o),o.viewOptions=a,o}function o(e,t){var n=i(t,l,s);J?J.reload(e,n,!0):(J=a(t.type,e,n),J.on("modelLoaded",G),J.on("modelReset",U)),p(),F()}function a(e,t,n){var r,i=e||"md2d";if(null===L[i])throw new Error("Couldn't understand modelType '"+i+"'!");return r=new L[i](t,n,dt)}var s,l,c=u(e);Q=e,wt=!1,dt.currentModel=c,s=c.viewOptions?$.extend(!0,{},c.viewOptions):{controlButtons:"play"},c.modelOptions&&(l=$.extend(!0,{},c.modelOptions)),r?o(c.url,r):c.url?$.get(t.actualRoot+c.url).done(function(e){e="string"==typeof e?JSON.parse(e):e,o(c.url,e)}).fail(function(){r={type:"md2d",width:2.5,height:1.5,viewOptions:{backgroundColor:"rgba(245,200,200,255)",showClock:!1,textBoxes:[{text:"Model could not be loaded:",x:0,y:1,width:2.5,height:.25,fontScale:1.4,layer:1,frame:"rectangle",textAlign:"center",strokeOpacity:0,backgroundColor:"rgb(232,231,231)"},{text:c.url,x:0,y:.8,width:2.5,height:.25,fontScale:.9,layer:1,frame:"rectangle",textAlign:"center",strokeOpacity:0,backgroundColor:"rgb(232,231,231)"}]}},o(c.url,r)}):(r=c.model,o("",r))}function F(){var e,t,n;for(ft=[],e=ct.components||[],Ct=[],At={},Z=J.model,x(),V(),mt=[],dt.currentModel.onLoad&&mt.push(nt.makeFunctionInScriptContext(g(dt.currentModel.onLoad))),t=0,n=e.length;n>t;t++)m(e[t]);for(ct.exports&&(rt=new c(ct.exports,dt,Z),ft.push(rt.modelLoadedCallback),c.canExportData()&&!ct.hideExportDataControl&&m({type:"button",text:"Analyze Data",id:"-lab-analyze-data",action:"exportData();"})),ct.helpTips.length>0&&(tt=new E(ct.helpTips,et),dt.on("interactiveRendered",function(){function e(e){var t,n,r=0,i=e.length;if(0===i)return r;for(t=0;i>t;t++)n=e.charCodeAt(t),r=(r<<5)-r+n,r&=r;return r}var t=e(JSON.stringify(ct));ct.helpOnLoad&&!k.hasItem("lab-help-"+t)&&(tt.start(),k.setItem("lab-help-"+t,!0))})),f(),lt.setupModel(J),t=0;t<ft.length;t++)ft[t](Z,nt);for(it=new w(Z,J.modelContainer,dt),t=0;t<mt.length;t++)mt[t]();for(ct.experiment&&(Y=new B(ct.experiment,dt,mt),vt.push(Y.modelLoadedCallback)),J.modelSetupComplete(),t=0;t<vt.length;t++)vt[t](Z);wt=!0,S(et),h(),J.initializeView(),v()}function V(){W("basic",dt.currentModel.outputs,ct.outputs),H(dt.currentModel.parameters,ct.parameters),W("filtered",dt.currentModel.filteredOutputs,ct.filteredOutputs)}function G(e){var t;for(Z=J.model,x(),V(),J.modelSetupComplete(),J.initializeView(),mt=[],dt.currentModel.onLoad&&mt.push(nt.makeFunctionInScriptContext(g(dt.currentModel.onLoad))),t=0;t<ft.length;t++)ft[t](Z,nt);for(it=new w(Z,J.modelContainer,dt),t=0;t<mt.length;t++)mt[t]();for(t=0;t<vt.length;t++)vt[t](Z,e);wt=!0}function U(e){xt||j(e)}function j(e){yt.forEach(function(t){t(e)})}function q(e){function t(){o||i!==r||e()}function n(){var e=!1;return{proceed:function(){e||(e=!0,i++,t())},cancel:function(){e||(e=!0,o=!0)}}}0===bt.length&&e();var r=bt.length,i=0,o=!1;bt.forEach(function(e){var t=n();e(Z,t)||t.proceed()})}function W(e,t,n){function r(e){if(e)for(var t=0;t<e.length;t++)a[e[t].name]=e[t]}if(t||n){var i,o,a={};r(n),r(t);for(i in a)if(a.hasOwnProperty(i))switch(o=a[i],e){case"basic":Z.defineOutput(o.name,{label:o.label,unitType:o.unitType,unitName:o.unitName,unitPluralName:o.unitPluralName,unitAbbreviation:o.unitAbbreviation},nt.makeFunctionInScriptContext(g(o.value)));break;case"filtered":Z.defineFilteredOutput(o.name,{label:o.label,unitType:o.unitType,unitName:o.unitName,unitPluralName:o.unitPluralName,unitAbbreviation:o.unitAbbreviation},o.property,o.type,o.period)}}}function H(e,t){if(e||t){var n,r,i,o,a={};for(n=(t||[]).concat(e||[]),r=0;r<n.length;r++)i=n[r],o=void 0,i.onChange&&(o=nt.makeFunctionInScriptContext("value",g(i.onChange))),Z.defineParameter(i.name,{label:i.label,unitType:i.unitType,unitName:i.unitName,unitPluralName:i.unitPluralName,unitAbbreviation:i.unitAbbreviation},o),void 0!==i.initialValue&&(a[i.name]=i.initialValue),Et[i.name]=i;Z.set(a)}}function z(e){var t={};return e.forEach(function(e){t[e]=!0}),Object.keys(Et).filter(function(e){return!t[e]})}function X(e){var t={};return e.forEach(function(e){t[e]=Z.properties[e]}),t}var Y,K,J,Z,Q,et,tt,nt,rt,it,ot,at,st,lt,ut,ct={},dt={},ht=[],pt={},ft=[],mt=[],gt=[],vt=[],yt=[],bt=[],xt=!1,wt=!1,_t=[],Tt=!1,At={},Ct=[],Et=[],St=new C("layoutUpdated");return ut=function(){var e=-1;return function(){return e++}},dt={get scriptingAPI(){return nt},get helpSystem(){return tt},get modelController(){return J},getDGExportController:function(){return rt},getModel:function(){return Z},getScriptingAPI:function(){return nt},getModelController:function(){return J},getComponent:function(e){return At[e]},pushOnLoadScript:function(e){mt.push(e)},getNextTabIndex:ut,reloadModel:function(){Z.stop(),q(function(){J.reload()})},resetModel:function(e){Z.stop(),q(function(){e=e||{};var t,n=e.retainParameters,r=e.resetParameters;if(r&&n)throw new Error("resetModel: resetParameters and retainParameters are mutually exclusive");n||r||(r="all"),"all"===n&&(n=void 0,r=[]),"all"===r&&(n=[],r=void 0),r&&(n=z(r)),t=X(n),xt=!0,J.reset(e.cause),Z.set(t),j(e.cause),xt=!1})},updateModelView:function(){J.updateView()},repaintModelView:function(){J.repaint()},resize:function(){h();for(var e=0;e<gt.length;e++)gt[e]()},on:function(e,t){var n;if("function"==typeof t)n=[t];else{if(!Array.isArray(t))throw new Error("Invalid callback, must be a function or array of functions.");if(n=t,n.some(function(e){return"function"!=typeof e}))throw new Error("Invalid callback, must be an array of functions.")}switch(e){case"resize":gt=gt.concat(n);break;case"modelLoaded":vt=vt.concat(n);break;case"modelReset":yt=yt.concat(n);break;case"willResetModel":bt=bt.concat(n);break;case"interactiveRendered":_t=_t.concat(n);break;default:if("function"!=typeof t)throw new Error("Event type "+e+" does not support multiple callbacks in one call to .on()");St.on(e,t)}},get:function(e){return ct[e]},serialize:function(){var e,t,r,i,o;if(void 0!==Z&&void 0!==Z.get)for(i in Et)Et.hasOwnProperty(i)&&(i=Et[i],o=Z.get(i.name),void 0!==o&&(i.initialValue=o));for(e={title:ct.title,publicationStatus:ct.publicationStatus,subtitle:ct.subtitle,aspectRatio:ct.aspectRatio,fontScale:ct.fontScale,helpOnLoad:ct.helpOnLoad,about:n.isArray(ct.about)?$.extend(!0,[],ct.about):ct.about,models:$.extend(!0,[],ct.models),parameters:$.extend(!0,[],ct.parameters),outputs:$.extend(!0,[],ct.outputs),filteredOutputs:$.extend(!0,[],ct.filteredOutputs),helpTips:$.extend(!0,[],ct.helpTips)},void 0!==ct.importedFrom&&(e.importedFrom=ct.importedFrom),void 0!==ct.hideExportDataControl&&(e.hideExportDataControl=ct.hideExportDataControl),void 0!==ct.exports&&(e.exports=$.extend(!0,{},ct.exports)),void 0!==ct.experiment&&(e.experiment=$.extend(!0,{},ct.experiment)),e.components=[],t=0,r=Ct.length;r>t;t++)Ct[t].serialize&&e.components.push(Ct[t].serialize());return e.layout=$.extend(!0,{},ct.layout),e.template="string"==typeof ct.template?ct.template:$.extend(!0,[],ct.template),e},modelLoaded:function(){return wt},interactiveRendered:function(){return Tt},benchmarks:[{name:"layout (iterations)",numeric:!0,formatter:d3.format("g"),run:function(e){e(lt.layoutInteractive())}},{name:"layout (ms)",numeric:!0,formatter:d3.format("5.1f"),run:function(e){var t=+Date.now();lt.layoutInteractive(),e(Date.now()-t)}}],getLoadedModelId:function(){return Q},loadInteractive:_,validateInteractive:y,loadModel:A,interactiveNotFound:s},et=$(l),r.attach(et[0]),dt.interactiveContainer=et,lt=new N(et),st=new M,ot=new R,at=new O,dt.on("resize",$.proxy(at.updateIframeSize,at)),_(e),dt
}}),define("grapher/public-api",["require","../lab.version","../lab.config","grapher/core/graph","grapher/bar-graph/bar-graph-model","grapher/bar-graph/bar-graph-view"],function(e){"use strict";var t,n=(e("../lab.version"),e("../lab.config")),r=e("grapher/core/graph"),i=e("grapher/bar-graph/bar-graph-model"),o=e("grapher/bar-graph/bar-graph-view");return t={version:"0.0.1",Graph:r,BarGraphModel:i,BarGraphView:o},window.Lab=window.Lab||{},window.Lab.config=n,window.Lab.grapher=t,t}),define("import-export/netlogo-importer",["require","underscore"],function(e){function t(e){return e.units?e.label+" ("+e.units+")":e.label}var n=e("underscore"),r=["computationalInputs","computationalOutputs","studentInputs"];return{importRun:function(e,i){return"string"==typeof e&&(e=JSON.parse(e)),{perRunLabels:n.flatten(r.map(function(t){return e.description[t]})).map(t),perRunValues:n.flatten(r.map(function(t){return e.runs[i][t]})),perTickLabels:e.description.timeSeriesData.map(t),perTickValues:e.runs[i].timeSeriesData.map(function(e){return e.map(n.identity)})}},numberOfRuns:function(e){return"string"==typeof e&&(e=JSON.parse(e)),e.runs.length},timeStamps:function(e){return"string"==typeof e&&(e=JSON.parse(e)),n.pluck(e.runs,"timeStamp")},runHavingTimeStamp:function(e,t){"string"==typeof e&&(e=JSON.parse(e));for(var n=0;n<e.runs.length;n++)if(e.runs[n].timeStamp===t)return n;return null}}}),define("import-export/public-api",["require","import-export/dg-exporter","import-export/netlogo-importer"],function(e){"use strict";return window.Lab=window.Lab||{},window.Lab.importExport={version:"0.0.1",dgExporter:e("import-export/dg-exporter"),netlogoImporter:e("import-export/netlogo-importer")}}),define("iframe-phone/iframe-phone",["require","iframe-phone/structured-clone"],function(e){var t=e("iframe-phone/structured-clone");return function(e,n){function r(n){h?(n.origin=c,t.supported()?e.contentWindow.postMessage(n,u):e.contentWindow.postMessage(JSON.stringify(n),u)):d.push(n)}function i(e,t){p[e]=t}function o(e){p[e]=null}function a(e,t,n){i(e,t),r({type:"listenForDispatchEvent",eventName:e,properties:n})}function s(e){r({type:"removeListenerForDispatchEvent",eventName:e}),o(e)}function l(t){var n;t.source===e.contentWindow&&t.origin===u&&(n=t.data,"string"==typeof n&&(n=JSON.parse(n)),p[n.type]?p[n.type](n.values):console.log("cant handle type: "+n.type))}var u=e.src.match(/(.*?\/\/.*?)\//)[1],c=window.location.href.match(/(.*?\/\/.*?)\//)[1],d=[],h=!1,p={};return i("hello",function(){for(h=!0,r({type:"hello"}),n&&"function"==typeof n&&n();d.length>0;)r(d.shift())}),window.addEventListener("message",l,!1),{post:r,addListener:i,removeListener:o,addDispatchListener:a,removeDispatchListener:s}}}),define("iframe-phone/public-api",["require","iframe-phone/iframe-phone","iframe-phone/structured-clone"],function(e){"use strict";var t=e("iframe-phone/iframe-phone"),n=e("iframe-phone/structured-clone");return window.Lab=window.Lab||{},window.Lab.IFramePhone=t,t.structuredClone=n,t.version="1.0",t}),define("public-api",["require","lab.version","lab.config","common/controllers/interactives-controller","common/benchmark/benchmark","grapher/public-api","import-export/public-api","iframe-phone/public-api"],function(e){var t=e("lab.version"),n=e("lab.config"),r=e("common/controllers/interactives-controller"),i=e("common/benchmark/benchmark");e("grapher/public-api"),e("import-export/public-api"),e("iframe-phone/public-api"),window.Lab=window.Lab||{},window.Lab.version=t,window.Lab.config=n,window.Lab.InteractivesController=r,window.Lab.benchmark=i}),require(["public-api"],void 0,void 0,!0)}();