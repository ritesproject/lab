{
  "title": "Radioactivity Experiment 2",
  "publicationStatus": "draft",
  "subtitle": "",
  "about": "",
  "aspectRatio": 0.8,
  "fontSize": 1,
  "models": [
    {
      "type": "md2d",
      "id": "syringe$0",
      "url": "imports/legacy-mw-content/converted/rites/empty.json",
      "viewOptions": {
        "controlButtons": ""
      },
      "onLoad": [
        "setComponentDisabled('run-model', false);",
        "setComponentDisabled('select-isotope', false);",
        "//TODO remove this hack!",
        "resetGraphAnnotations('num-parents-graph');",
        "resetGraphAnnotations('num-daughters-graph');",
        "set('timeStep',1);",
        "set('timeStepsPerTick',1);",
        "var count = 0,",
        "    parents = 1000,",
        "    prevParents = parents,",
        "    daughters = 0;",
        "batch(function(){",
        "  while(count < parents){",
        "    if( addAtom({pinned: true, x: Math.random()*get('width'), y: Math.random()*get('height'), element: 0}) ) {",
        "      ++count;",
        "    }",
        "  }",
        "  set('numElementsParent', count);",
        "  set('prevParents', count);",
        "});",
        "onPropertyChange('time',function(t){",
        "  var decaying = true,",
        "      decayProbability = get('decayProbability');",
        "  batch(function(){",
        "    // reset these in case the model has been scrubbed",
        "    parents      = get('numElementsParent');",
        "    daughters    = get('numElementsChild');",
        "    prevParents  = get('prevParents');",
        "    for(var i = 0; i < 1000; i++) {",
        "      if (getAtomProperties(i).element === 0 && Math.random() < decayProbability) {",
        "        setAtomProperties(i,{element: 1});",
        "        --parents;",
        "        ++daughters;",
        "        if (parents <= 0.5 * prevParents) {",
        "          set('prevParents', parents);",
        "          decaying = false;",
        "          break;",
        "        }",
        "      }",
        "    }",
        "    set('numElementsParent',parents);",
        "    set('numElementsChild',daughters);",
        "    if (!decaying) {",
        "      set('num-half-lives', get('num-half-lives') + 1);",
        "      setComponentDisabled('run-model', true);",
        "      addGraphAnnotation('num-parents-graph',{",
        "        type: 'line',",
        "        data: {",
        "          x1: t/1000,",
        "          x2: t/1000",
        "        }",
        "      });",
        "      addGraphAnnotation('num-parents-graph',{",
        "        type: 'line',",
        "        data: {",
        "          y1: parents,",
        "          y2: parents,",
        "          stroke: '#0f0'",
        "        }",
        "      });",
        "      addGraphAnnotation('num-daughters-graph',{",
        "        type: 'line',",
        "        data: {",
        "          x1: t/1000,",
        "          x2: t/1000",
        "        }",
        "      });",
        "      addGraphAnnotation('num-daughters-graph',{",
        "        type: 'line',",
        "        data: {",
        "          y1: daughters,",
        "          y2: daughters,",
        "          stroke: '#0f0'",
        "        }",
        "      });",
        "    }",
        "  });",
        "});"
      ]
    }
  ],
  "parameters": [
    {
      "name": "numElementsParent",
      "initialValue": 0
    },
    {
      "name": "numElementsChild",
      "initialValue": 0
    },
    {
      "name": "prevParents",
      "initialValue": 0
    },
    {
      "name": "decayProbability",
      "initialValue": 0.05
    },
    {
      "name": "num-half-lives",
      "initialValue": 0,
      "onChange": [
        "if (value >= 5) stop();"
      ]
    },
    {
      "name": "decayProbabilities",
      "initialValue": [0, 0.02, 0.05, 0.10, 0.20]
    },
    {
      "name": "isotope",
      "initialValue": 2,
      "onChange": [
        "if (!!value) set('decayProbability', get('decayProbabilities')[value]);"
      ]
    }
  ],
  "components": [
    {
      "type": "numericOutput",
      "id": "num-atoms-parent",
      "property": "numElementsParent",
      "label": "Parent atoms"
    },
    {
      "type": "numericOutput",
      "id": "num-atoms-child",
      "property": "numElementsChild",
      "label": "Daughter atoms"
    },
    {
      "type": "numericOutput",
      "id": "current-time",
      "property": "time",
      "displayValue": "return format('.3f')(value/1000) + ' ps';",
      "units": "ps"
    },
    {
      "type": "button",
      "id": "run-model",
      "text": "Go",
      "action": [
        "start();",
        "setComponentDisabled('select-isotope', true);"
      ]
    },
    {
      "type": "button",
      "id": "reset-model",
      "text": "Reset",
      "action": "reload()"
    },
    {
      "type": "pulldown",
      "id": "select-isotope",
      "label": "Isotope",
      "labelOn": "left",
      "property": "isotope",
      "options": [
        {
          "text": "A",
          "value": 1
        },
        {
          "text": "B",
          "value": 2
        },
        {
          "text": "C",
          "value": 3
        },
        {
          "text": "D",
          "value": 4
        }
      ]
    },
    {
      "type": "graph",
      "id": "num-parents-graph",
      "properties": ["numElementsParent"],
      "width": "100%",
      "height": "8em",
      "ymin": 0,
      "ymax": 1000,
      "ylabel": "Parent isotopes",
      "xmin": 0,
      "xmax": 0.1,
      "xTickCount": 6,
      "yTickCount": 4,
      "xFormatter": ".1r",
      "title": "Parent isotopes"
    },
    {
      "type": "graph",
      "id": "num-daughters-graph",
      "properties": ["numElementsChild"],
      "width": "100%",
      "height": "8em",
      "ymin": 0,
      "ymax": 1000,
      "ylabel": "Daughter isotopes",
      "xmin": 0,
      "xmax": 0.1,
      "xTickCount": 6,
      "yTickCount": 4,
      "xFormatter": ".1r",
      "title": "Daughter isotopes"
    }
  ],
  "layout": {
    "right-controls": [
      ["run-model"],
      ["reset-model"],
      ["select-isotope"],
      ["num-atoms-parent"],
      ["num-atoms-child"],
      ["current-time"]
    ],
    "right-graphs": [
      ["num-parents-graph"],
      ["num-daughters-graph"]
    ]
  },
  "template": [
    {
      "id": "right-controls",
      "left": "model.right",
      "top": "model.top",
      "width": "interactive.width / 3"
    },
    {
      "id": "right-graphs",
      "left": "model.right",
      "top": "right-controls.bottom",
      "width": "interactive.width / 3"
    }
  ]
}
